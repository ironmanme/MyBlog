<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>persilee&#39;s Blog</title>
    <link>https://h.lishaoy.net/</link>
    <atom:link href="/rss2.xml" rel="self" type="application/rss+xml"/>
    
    <description>李少颖的博客</description>
    <pubDate>Fri, 03 Jul 2020 17:11:46 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>Flutter(Flare) 最有趣用户交互动画没有之一</title>
      <link>https://h.lishaoy.net/flutter-flare.html</link>
      <guid>https://h.lishaoy.net/flutter-flare.html</guid>
      <pubDate>Fri, 03 Jul 2020 17:09:16 GMT</pubDate>
      <description>
      
        &lt;span itemprop=&quot;image&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/ImageObject&quot;&gt;&lt;img itemprop=&quot;url image&quot; src=&quot;/images/loading.gif&quot; data-original=&quot;https://cdn.lishaoy.net/flutterFlare/flutter-flare-cover.png&quot; class=&quot;full-image&quot; alt=&quot;Flutter Flare&quot; title=&quot;Flutter Flare&quot;&gt;&lt;meta itemprop=&quot;width&quot; content=&quot;auto&quot;&gt;&lt;meta itemprop=&quot;height&quot; content=&quot;auto&quot;&gt;&lt;/span&gt;
&lt;p&gt;2019年12月12日，&lt;strong&gt;Flutter&lt;/strong&gt; 在 &lt;strong&gt;Flutter Interact ‘19&lt;/strong&gt; 上发布了如何使用 &lt;strong&gt;Rive&lt;/strong&gt; 和 &lt;strong&gt;Flutter&lt;/strong&gt; 制作动态可交互的动画经验分享，我看了之后，觉得非常有趣，因此，写了3个小 demo，把它写成文章记录分享给大家。&lt;/p&gt;
&lt;hr&gt;
      
      </description>
      
      <content:encoded><![CDATA[<span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="/images/loading.gif" data-original="https://cdn.lishaoy.net/flutterFlare/flutter-flare-cover.png" class="full-image" alt="Flutter Flare" title="Flutter Flare"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><p>2019年12月12日，<strong>Flutter</strong> 在 <strong>Flutter Interact ‘19</strong> 上发布了如何使用 <strong>Rive</strong> 和 <strong>Flutter</strong> 制作动态可交互的动画经验分享，我看了之后，觉得非常有趣，因此，写了3个小 demo，把它写成文章记录分享给大家。</p><hr><a id="more"></a><h2 id="名词理解"><a href="#名词理解" class="headerlink" title="名词理解"></a>名词理解</h2><p>首先，我们来理解几个名词，不然后续文章，可能看着有些晕，如下：</p><ul><li>Flare：是 Flutter 的动画插件名称，完整名称是 <code>flare_flutter</code> 我们要在 <code>pubspec.yaml</code> 文件里引入</li><li>Rive：是制作 Flare 动画的<a href="https://rive.app/about-rive" target="_blank" rel="noopener">网站</a>，它既是一个网站也是制作工具，在此网站里有很多用户分享 Flare 动画供我们下载使用、Flare API使用文档、制作 Flare 动画的视频教程（大家也可以通过学习制作自己喜欢的动画）等</li></ul><h2 id="交互动画预览"><a href="#交互动画预览" class="headerlink" title="交互动画预览"></a>交互动画预览</h2><h3 id="登录交互动画"><a href="#登录交互动画" class="headerlink" title="登录交互动画"></a>登录交互动画</h3><p>登录交互动画，包含如下6种动画：</p><ul><li>idle：无任何操作时的状态（熊的身体会上下浮动和眨眼睛）</li><li>test：当我们在 email 输入框中输入时的状态（熊会看向输入框，且随着你输入的长度旋转头部）</li><li>hands_up：当我们在 password 输入框中输入时的状态 （熊会用手蒙上眼睛）</li><li>hands_down：当我们在 password 输入框输入完成时的状态 （熊会放下双手）</li><li>fail：当我们登录失败时的状态（熊会做出难过的表情）</li><li>success：当我们登录成功时的状态（熊会做出高兴的表情）</li></ul><p>以上6种状态，可以在 <strong>Rive</strong> 网站查看具体动画，<a href="https://rive.app/a/castor/files/flare/teddy-with-hands/preview" target="_blank" rel="noopener">点击进入查看</a></p><p>下面，我们来看看案例里实现动画效果</p><p>idle：无任何操作时的状态，如图：</p><p><img src="https://cdn.lishaoy.net/flutterFlare/sign-in.gif" alt="no-shadow" title="idle"></p><p>test：当我们在 email 输入框中输入时的状态，如图：</p><p><img src="https://cdn.lishaoy.net/flutterFlare/email.gif" alt="no-shadow" title="test"></p><p>hands_up：当我们在 password 输入框中输入时的状态，hands_down：当我们在 password 输入框输入完成时的状态，如图：</p><p><img src="https://cdn.lishaoy.net/flutterFlare/password.gif" alt="no-shadow" title="hands_up &amp; hands_down"></p><p>fail：当我们登录失败时的状态，如图：</p><p><img src="https://cdn.lishaoy.net/flutterFlare/failure.gif" alt="no-shadow" title="fail"></p><p>success：当我们登录成功时的状态，如图：</p><p><img src="https://cdn.lishaoy.net/flutterFlare/successful.gif" alt="no-shadow" title="success"></p><h3 id="Button交互动画"><a href="#Button交互动画" class="headerlink" title="Button交互动画"></a>Button交互动画</h3><p>button 交互动画，如图：</p><p><img src="https://cdn.lishaoy.net/flutterFlare/button.gif" alt="no-shadow" title="button"></p><h3 id="Menu交互动画"><a href="#Menu交互动画" class="headerlink" title="Menu交互动画"></a>Menu交互动画</h3><p>menu 交互动画，如图：</p><p><img src="https://cdn.lishaoy.net/flutterFlare/menu.gif" alt="no-shadow" title="menu"></p><p>以上所有动画，也可以 <a href="https://www.bilibili.com/video/BV14p4y1U7YN/" target="_blank" rel="noopener">点击观看视频</a></p><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><p>如何用代码实现，分为以下2个步骤：</p><ul><li>引入插件和资源：引入相关插件 <code>flare_flutter</code> 、 <code>smart_flare</code></li><li>编写代码：编写相关代码</li></ul><h3 id="引入插件和资源"><a href="#引入插件和资源" class="headerlink" title="引入插件和资源"></a>引入插件和资源</h3><p>引入插件和资源，如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">dependencies:</span><br><span class="line">  ...</span><br><span class="line">  flare_flutter: ^2.0.4  <span class="comment"># flare 插件</span></span><br><span class="line">  smart_flare: any  <span class="comment"># 对 flare API进行封装的插件，使用少量的代码即可实现交互动画</span></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">assets:</span><br><span class="line">  ...</span><br><span class="line">  - assets/Teddy.flr</span><br><span class="line">  - assets/button-animation.flr</span><br><span class="line">  - assets/slideout-menu.flr</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure><h3 id="编写代码"><a href="#编写代码" class="headerlink" title="编写代码"></a>编写代码</h3><p>由于，登录交互动画稍复杂一些，在此就不展示实现的代码，如感兴趣，可<a href="https://github.com/persilee/flutter_pro/blob/master/lib/demo/flare_demo/flare_sign_in_demo.dart" target="_blank" rel="noopener">移步GitHub查看源码</a></p><h3 id="Button交互动画代码实现"><a href="#Button交互动画代码实现" class="headerlink" title="Button交互动画代码实现"></a>Button交互动画代码实现</h3><p>button 交互动画代码实现如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:smart_flare/actors/smart_flare_actor.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:smart_flare/models.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlareButtonDemo</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _FlareButtonDemoState createState() =&gt; _FlareButtonDemoState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_FlareButtonDemoState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">FlareButtonDemo</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">var</span> animationWidth = <span class="number">295.0</span>;</span><br><span class="line">    <span class="keyword">var</span> animationHeight = <span class="number">251.0</span>;</span><br><span class="line">    <span class="keyword">var</span> animationWidthThirds = animationWidth / <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">var</span> halfAnimationHeight = animationHeight / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> activeAreas = [</span><br><span class="line"></span><br><span class="line">      ActiveArea(</span><br><span class="line">        area: Rect.fromLTWH(<span class="number">0</span>, <span class="number">0</span>, animationWidthThirds, halfAnimationHeight),</span><br><span class="line">        debugArea: <span class="keyword">false</span>,</span><br><span class="line">        guardComingFrom: [<span class="string">'deactivate'</span>],</span><br><span class="line">        animationName: <span class="string">'camera_tapped'</span>,</span><br><span class="line">      ),</span><br><span class="line"></span><br><span class="line">      ActiveArea(</span><br><span class="line">          area: Rect.fromLTWH(animationWidthThirds, <span class="number">0</span>, animationWidthThirds, halfAnimationHeight),</span><br><span class="line">          debugArea: <span class="keyword">false</span>,</span><br><span class="line">          guardComingFrom: [<span class="string">'deactivate'</span>],</span><br><span class="line">          animationName: <span class="string">'pulse_tapped'</span>),</span><br><span class="line"></span><br><span class="line">      ActiveArea(</span><br><span class="line">          area: Rect.fromLTWH(animationWidthThirds * <span class="number">2</span>, <span class="number">0</span>, animationWidthThirds, halfAnimationHeight),</span><br><span class="line">          debugArea: <span class="keyword">false</span>,</span><br><span class="line">          guardComingFrom: [<span class="string">'deactivate'</span>],</span><br><span class="line">          animationName: <span class="string">'image_tapped'</span>),</span><br><span class="line"></span><br><span class="line">      ActiveArea(</span><br><span class="line">          area: Rect.fromLTWH(<span class="number">0</span>, animationHeight / <span class="number">2</span>, animationWidth, animationHeight / <span class="number">2</span>),</span><br><span class="line">          debugArea: <span class="keyword">false</span>,</span><br><span class="line">          animationsToCycle: [<span class="string">'activate'</span>, <span class="string">'deactivate'</span>],</span><br><span class="line">          onAreaTapped: () &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">'Button tapped!'</span>);</span><br><span class="line">          &#125;)</span><br><span class="line"></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(<span class="string">'Flare Button Demo'</span>),</span><br><span class="line">      ),</span><br><span class="line">      body: Container(</span><br><span class="line">        decoration: BoxDecoration(</span><br><span class="line">          gradient: LinearGradient(</span><br><span class="line">              begin: Alignment.topCenter,</span><br><span class="line">              end: Alignment.bottomCenter,</span><br><span class="line">              colors: [</span><br><span class="line">                Color(<span class="number">0x3fffeb3b</span>),</span><br><span class="line">                Colors.orange,</span><br><span class="line">              ]),</span><br><span class="line">        ),</span><br><span class="line">        child: Align(</span><br><span class="line">          alignment: Alignment.bottomCenter,</span><br><span class="line">          child: SmartFlareActor(</span><br><span class="line">            width: animationWidth,</span><br><span class="line">            height: animationHeight,</span><br><span class="line">            filename: <span class="string">'assets/button-animation.flr'</span>,</span><br><span class="line">            startingAnimation: <span class="string">'deactivate'</span>,</span><br><span class="line">            activeAreas: activeAreas,</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Menu交互动画代码实现"><a href="#Menu交互动画代码实现" class="headerlink" title="Menu交互动画代码实现"></a>Menu交互动画代码实现</h3><p>menu 交互动画代码实现，如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:smart_flare/smart_flare.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlareSidebarMenuDemo</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="built_in">print</span>(MediaQuery.of(context).size.height);</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      body: Container(</span><br><span class="line">        child: Align(</span><br><span class="line">          alignment: Alignment.centerRight,</span><br><span class="line">          child: PanFlareActor(</span><br><span class="line">            width: MediaQuery.of(context).size.width / <span class="number">2.366</span>,</span><br><span class="line">            height: MediaQuery.of(context).size.height,</span><br><span class="line">            filename: <span class="string">'assets/slideout-menu.flr'</span>,</span><br><span class="line">            openAnimation: <span class="string">'open'</span>,</span><br><span class="line">            closeAnimation: <span class="string">'close'</span>,</span><br><span class="line">            direction: ActorAdvancingDirection.RightToLeft,</span><br><span class="line">            threshold: <span class="number">20.0</span>,</span><br><span class="line">            reverseOnRelease: <span class="keyword">true</span>,</span><br><span class="line">            completeOnThresholdReached: <span class="keyword">true</span>,</span><br><span class="line">            activeAreas: [</span><br><span class="line">              RelativePanArea(</span><br><span class="line">                  area: Rect.fromLTWH(<span class="number">0</span>, <span class="number">.7</span>, <span class="number">1.0</span>, <span class="number">.3</span>), debugArea: <span class="keyword">false</span>),</span><br><span class="line">            ],</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上3个交互动画案例的源码，放在了我2年前写的一个 <a href="https://github.com/persilee/flutter_pro" target="_blank" rel="noopener">Flutter案例</a> 的项目里了，此项目现已维护起来，以后会长期更新，感兴趣的小伙伴可以收藏，没事时来看看可能会有新的发现 😲</p><p>此篇文章到此结束，下篇文章计划给大家分享，Flutter 里的路由，会总结归纳所有的路由使用方法，最后来封装一个优秀的路由管理类。</p>]]></content:encoded>
      
      <comments>https://h.lishaoy.net/flutter-flare.html#disqus_thread</comments>
    </item>
    
    <item>
      <title>FutureBuilder and StreamBuilder 优雅的构建高质量项目</title>
      <link>https://h.lishaoy.net/futrueBuilder-streamBuilder.html</link>
      <guid>https://h.lishaoy.net/futrueBuilder-streamBuilder.html</guid>
      <pubDate>Mon, 29 Jun 2020 11:59:16 GMT</pubDate>
      <description>
      
        &lt;span itemprop=&quot;image&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/ImageObject&quot;&gt;&lt;img itemprop=&quot;url image&quot; src=&quot;/images/loading.gif&quot; data-original=&quot;https://cdn.lishaoy.net/fureBuilderStreamBuilder/cover.png&quot; class=&quot;full-image&quot; alt=&quot;Flutter&quot; title=&quot;Flutter&quot;&gt;&lt;meta itemprop=&quot;width&quot; content=&quot;auto&quot;&gt;&lt;meta itemprop=&quot;height&quot; content=&quot;auto&quot;&gt;&lt;/span&gt;
&lt;p&gt;本篇文章将介绍从 &lt;code&gt;setState&lt;/code&gt; 开始，到 &lt;code&gt;futureBuilder&lt;/code&gt; 、 &lt;code&gt;streamBuilder&lt;/code&gt; 来优雅的构建你的高质量项目，而不引发 &lt;code&gt;setState&lt;/code&gt; 带来的副作用，如对文章感兴趣，请 &lt;a href=&quot;https://github.com/persilee/flutter_pro&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;点击查看源码&lt;/a&gt;。&lt;/p&gt;
&lt;hr&gt;
      
      </description>
      
      <content:encoded><![CDATA[<span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="/images/loading.gif" data-original="https://cdn.lishaoy.net/fureBuilderStreamBuilder/cover.png" class="full-image" alt="Flutter" title="Flutter"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><p>本篇文章将介绍从 <code>setState</code> 开始，到 <code>futureBuilder</code> 、 <code>streamBuilder</code> 来优雅的构建你的高质量项目，而不引发 <code>setState</code> 带来的副作用，如对文章感兴趣，请 <a href="https://github.com/persilee/flutter_pro" target="_blank" rel="noopener">点击查看源码</a>。</p><hr><a id="more"></a><h2 id="基础的setState更新数据"><a href="#基础的setState更新数据" class="headerlink" title="基础的setState更新数据"></a>基础的setState更新数据</h2><p>首先，我们使用基础的 <code>StatefulWidget</code> 来创建页面，如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseStatefulDemo</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _BaseStatefulDemoState createState() =&gt; _BaseStatefulDemoState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_BaseStatefulDemoState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">BaseStatefulDemo</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后，我们使用 <code>Future</code> 来创建一些数据，来模拟网络请求，如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;&gt; _getListData() <span class="keyword">async</span> &#123;</span><br><span class="line">  <span class="keyword">await</span> Future.delayed(<span class="built_in">Duration</span>(seconds: <span class="number">1</span>)); <span class="comment">// 1秒之后返回数据</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;.generate(<span class="number">10</span>, (index) =&gt; <span class="string">'<span class="subst">$index</span> content'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在 <code>initState()</code> 方法中调用 <code>_getListData()</code> 来初始化数据，如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; _pageData = <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;();</span><br><span class="line"></span><br><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">void</span> initState() &#123;</span><br><span class="line">  _getListData().then((data) =&gt; setState(() &#123;</span><br><span class="line">            _pageData = data;</span><br><span class="line">          &#125;));</span><br><span class="line">  <span class="keyword">super</span>.initState();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用 <code>ListView.builder</code> 来处理这些数据构建UI，如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line">Widget build(BuildContext context) &#123;</span><br><span class="line">  <span class="keyword">return</span> Scaffold(</span><br><span class="line">    appBar: AppBar(</span><br><span class="line">      title: Text(<span class="string">'Base Stateful Demo'</span>),</span><br><span class="line">    ),</span><br><span class="line">    body: ListView.builder(</span><br><span class="line">      itemCount: _pageData.length,</span><br><span class="line">      itemBuilder: (buildContext, index) &#123;</span><br><span class="line">        <span class="keyword">return</span> Column(</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            ListTile(</span><br><span class="line">              title: Text(_pageData[index]),</span><br><span class="line">            ),</span><br><span class="line">            Divider(),</span><br><span class="line">          ],</span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">    ),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后，我们就可以看到界面了 😎 ，如图：</p><div style="width: 36%; margin:auto"><img src="https://cdn.lishaoy.net/fureBuilderStreamBuilder/list-data.png" alt="no-shadow" title="list data"></div><p>当然，你也可以将 <strong>UI</strong> 显示单独提取成一个方法，方便后期维护，使代码层次更清晰，如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line">Widget build(BuildContext context) &#123;</span><br><span class="line">  <span class="keyword">return</span> Scaffold(</span><br><span class="line">    appBar: AppBar(</span><br><span class="line">      title: Text(<span class="string">'Base Stateful Demo'</span>),</span><br><span class="line">    ),</span><br><span class="line">    body: ListView.builder(</span><br><span class="line">      itemCount: _pageData.length,</span><br><span class="line">      itemBuilder: (buildContext, index) &#123;</span><br><span class="line">        <span class="keyword">return</span> getListDataUi(<span class="built_in">int</span> index);</span><br><span class="line">      &#125;,</span><br><span class="line">    ),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Widget getListDataUi(<span class="built_in">int</span> index) &#123;</span><br><span class="line">  <span class="keyword">return</span> Column(</span><br><span class="line">              children: &lt;Widget&gt;[</span><br><span class="line">                ListTile(</span><br><span class="line">                  title: Text(_pageData[index]),</span><br><span class="line">                ),</span><br><span class="line">                Divider(),</span><br><span class="line">              ],</span><br><span class="line">            );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>继续，我们来完善它，正常从后端获取数据，后端应该会给我们返回不同信息，根据这些信息需要处理不同的状态，如：</p><ul><li>BusyState(加载中)：我们在界面上显示一个加载指示器</li><li>DataFetchedState(数据加载完成)：我们延迟2秒，来模拟数据加载完成</li><li>ErrorState(错误)：显示错误提示</li><li>NoData(没有数据)：请求成功，但没有数据，显示提示</li></ul><p>先来处理 <strong>BusyState</strong> 加载指示器，如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bool</span> <span class="keyword">get</span> _fetchingData =&gt; _pageData == <span class="keyword">null</span>; <span class="comment">// 判断数据是否为空</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(<span class="string">'Base Stateful Demo'</span>),</span><br><span class="line">      ),</span><br><span class="line">      body: _fetchingData</span><br><span class="line">          ? Center(</span><br><span class="line">              child: CircularProgressIndicator( <span class="comment">// 加载指示器 </span></span><br><span class="line">                valueColor: AlwaysStoppedAnimation&lt;Color&gt;(Colors.yellow), <span class="comment">// 设置指示器颜色</span></span><br><span class="line">                backgroundColor: Colors.yellow[<span class="number">100</span>],  <span class="comment">// 设置背景色</span></span><br><span class="line">              ),</span><br><span class="line">            )</span><br><span class="line">          : ListView.builder(</span><br><span class="line">              itemCount: _pageData.length,</span><br><span class="line">              itemBuilder: (buildContext, index) &#123;</span><br><span class="line">                <span class="keyword">return</span> getListDataUi(index);</span><br><span class="line">              &#125;,</span><br><span class="line">            ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>效果如图：</p><div style="width: 36%; margin:auto"><img src="https://cdn.lishaoy.net/fureBuilderStreamBuilder/indicator.png" alt="no-shadow" title="indicator"></div><p>接着，我们来处理 <strong>ErrorState</strong> ，我给 <code>_getListData()</code> 添加 <code>hasError</code> 参数来模拟后端返回的错误，如下</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;&gt; _getListData(&#123;<span class="built_in">bool</span> hasError = <span class="keyword">false</span>&#125;) <span class="keyword">async</span> &#123;</span><br><span class="line">  <span class="keyword">await</span> Future.delayed(<span class="built_in">Duration</span>(seconds: <span class="number">1</span>)); <span class="comment">// 1秒之后返回数据</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (hasError) &#123;</span><br><span class="line">    <span class="keyword">return</span> Future.error(<span class="string">'获取数据出现问题，请再试一次'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;.generate(<span class="number">10</span>, (index) =&gt; <span class="string">'<span class="subst">$index</span> content'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后，在 <code>initState()</code> 方法中捕获异常更新数据，如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">void</span> initState() &#123;</span><br><span class="line">  _getListData(hasError: <span class="keyword">true</span>)</span><br><span class="line">      .then((data) =&gt; setState(() &#123;</span><br><span class="line">            _pageData = data;</span><br><span class="line">          &#125;))</span><br><span class="line">      .catchError((error) =&gt; setState(() &#123;</span><br><span class="line">            _pageData = [error];</span><br><span class="line">          &#125;));</span><br><span class="line">  <span class="keyword">super</span>.initState();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>效果如图( <em>当然这里可以使用一个错误页面来展示</em> )：</p><div style="width: 36%; margin:auto"><img src="https://cdn.lishaoy.net/fureBuilderStreamBuilder/error.png" alt="no-shadow" title="error"></div><p>接着，我们来处理 <strong>NoData</strong> ，我给 <code>_getListData()</code> 添加 <code>hasData</code> 参数来模拟后端返回空数据，如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;&gt; _getListData(</span><br><span class="line">    &#123;<span class="built_in">bool</span> hasError = <span class="keyword">false</span>, <span class="built_in">bool</span> hasData = <span class="keyword">true</span>&#125;) <span class="keyword">async</span> &#123;</span><br><span class="line">  <span class="keyword">await</span> Future.delayed(<span class="built_in">Duration</span>(seconds: <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (hasError) &#123;</span><br><span class="line">    <span class="keyword">return</span> Future.error(<span class="string">'获取数据出现问题，请再试一次'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!hasData) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;.generate(<span class="number">10</span>, (index) =&gt; <span class="string">'<span class="subst">$index</span> content'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后，在 <code>initState()</code> 方法更新数据，如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">void</span> initState() &#123;</span><br><span class="line">  _getListData(hasError: <span class="keyword">false</span>, hasData: <span class="keyword">false</span>)</span><br><span class="line">      .then((data) =&gt; setState(() &#123;</span><br><span class="line">            <span class="keyword">if</span> (data.length == <span class="number">0</span>) &#123;</span><br><span class="line">              data.add(<span class="string">'No data fount'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            _pageData = data;</span><br><span class="line">          &#125;))</span><br><span class="line">      .catchError((error) =&gt; setState(() &#123;</span><br><span class="line">            _pageData = [error];</span><br><span class="line">          &#125;));</span><br><span class="line">  <span class="keyword">super</span>.initState();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>效果如图：</p><div style="width: 36%; margin:auto"><img src="https://cdn.lishaoy.net/fureBuilderStreamBuilder/no-data.png" alt="no-shadow" title="error"></div><div class="note success"><p>这就是通过 <code>setState()</code> 来更新数据，是不是很简单，通常情况下我们这么使用是没什么问题，但是，如果我们的页面足够复杂，要处理的状态足够多，我们需要使用更多的 <code>setState()</code> ，意味着我们要更多的代码来更新数据，而且，我们每次 <code>setState()</code> 的时候 <code>build()</code> 方法就会重新执行一次( <em>这就是上文提到的副作用</em> )。</p><p>其实，<strong>Flutter</strong> 已经提供了更优雅的方式来更新我们的数据及处理状态，它就是我们接下来要介绍的 <code>futureBuilder</code>。</p></div><h2 id="FutureBuilder"><a href="#FutureBuilder" class="headerlink" title="FutureBuilder"></a>FutureBuilder</h2><p><code>FutureBuilder</code> 通过 <strong>future:</strong> 参数可以接收一个 <code>Future</code> ，并且通过 <strong>builder:</strong> 参数来构建 <strong>UI</strong> ，<strong>builder:</strong> 参数是一个函数，它提供了一个 <code>snapshot</code> 参数里面带着我们需要的状态和数据。</p><p>接下来，我们将上面的 <code>StatefulWidget</code> 改成 <code>StatelessWidget</code> ，并使用 <code>FutureBuilder</code> 替换，如下:</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FutureBuilderDemo</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(<span class="string">'Future Builder Demo'</span>),</span><br><span class="line">      ),</span><br><span class="line">      body: FutureBuilder(</span><br><span class="line">        future: _getListData(),</span><br><span class="line">        builder: (buildContext, snapshot) &#123;</span><br><span class="line">          <span class="keyword">if</span> (snapshot.hasError) &#123;  <span class="comment">// FutureBuilder 已经给我们提供好了 error 状态</span></span><br><span class="line">            <span class="keyword">return</span> _getInfoMessage(snapshot.error);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (!snapshot.hasData) &#123; <span class="comment">// FutureBuilder 已经给我们提供好了空数据状态</span></span><br><span class="line">            <span class="keyword">return</span> Center(</span><br><span class="line">              child: CircularProgressIndicator(</span><br><span class="line">                valueColor: AlwaysStoppedAnimation&lt;Color&gt;(Colors.yellow),</span><br><span class="line">                backgroundColor: Colors.yellow[<span class="number">100</span>],</span><br><span class="line">              ),</span><br><span class="line">            );</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">var</span> listData = snapshot.data;</span><br><span class="line">          <span class="keyword">if</span> (listData.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> _getInfoMessage(<span class="string">'No data found'</span>);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> ListView.builder(</span><br><span class="line">            itemCount: listData.length,</span><br><span class="line">            itemBuilder: (buildContext, index) &#123;</span><br><span class="line">              <span class="keyword">return</span> Column(</span><br><span class="line">                children: &lt;Widget&gt;[</span><br><span class="line">                  ListTile(</span><br><span class="line">                    title: Text(listData[index]),</span><br><span class="line">                  ),</span><br><span class="line">                  Divider(),</span><br><span class="line">                ],</span><br><span class="line">              );</span><br><span class="line">            &#125;,</span><br><span class="line">          );</span><br><span class="line">        &#125;,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ...</span><br></pre></td></tr></table></figure><p>通过查看源码，我们可以了解的 <code>FutureBuilder</code> 已经给我处理好了一些基本状态，如图</p><div style="width: 66%; margin:auto"><img src="https://cdn.lishaoy.net/fureBuilderStreamBuilder/snapshot.png" alt="snapshot" title="snapshot"></div><p>我们使用 <code>_getInfoMessage()</code> 方法来处理状态提示，如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Widget _getInfoMessage(String msg) &#123;</span><br><span class="line">  return Center(</span><br><span class="line">    child: Text(msg),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>就这样我们不使用任何一个 <code>setState()</code> 就能完成和上面一样的效果，并且不会产生副作用，是不是很给力 💪。</p><div class="note info"><p>但是，它并不是完美的，比如，我们想刷新数据，我们需要重新调用 <code>_getListData()</code> 方法，结果它并没有刷新。</p></div>  <h2 id="StreamBuilder"><a href="#StreamBuilder" class="headerlink" title="StreamBuilder"></a>StreamBuilder</h2><p><code>StreamBuilder</code> 通过 <strong>stream:</strong> 参数可以接收一个 <code>stream</code> ，同样，通过 <strong>builder:</strong> 参数来构建 <strong>UI</strong> ，和 <code>futureBuilder</code> 用法类似，唯一的好处就是，我们可以随意控制 <code>stream</code> 的输入输出，添加任何的状态来更新指定状态下的 <strong>UI</strong> 。</p><p>首先，我们使用 <code>enum</code> 来表示我们的状态，在文件的头部添加它，如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> StreamViewState &#123; Busy, DataRetrieved, NoData &#125;</span><br></pre></td></tr></table></figure><p>接着，使用 <code>StreamController</code> 创建一个流控制器，把 <code>FutureBuilder</code> 替换成 <code>StreamBuilder</code> ，把 <strong>future:</strong> 参数 改成 <strong>stream:</strong> 参数，如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">final</span> StreamController&lt;StreamDemoState&gt; _stateController = StreamController&lt;StreamDemoState&gt;();</span><br><span class="line"></span><br><span class="line"><span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line"></span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line">      body: StreamBuilder(</span><br><span class="line">        stream: model.homeState,</span><br><span class="line">        builder: (buildContext, snapshot) &#123;</span><br><span class="line">          <span class="keyword">if</span> (snapshot.hasError) &#123;</span><br><span class="line">            <span class="keyword">return</span> _getInfoMessage(snapshot.error);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// 使用 枚举的 Busy 来更新数据</span></span><br><span class="line">          <span class="keyword">if</span> (!snapshot.hasData || StreamViewState.Busy) &#123;</span><br><span class="line">            <span class="keyword">return</span> Center(</span><br><span class="line">              child: CircularProgressIndicator(</span><br><span class="line">                valueColor: AlwaysStoppedAnimation&lt;Color&gt;(Colors.yellow),</span><br><span class="line">                backgroundColor: Colors.yellow[<span class="number">100</span>],</span><br><span class="line">              ),</span><br><span class="line">            );</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">//使用 枚举的 NoData 来更新数据</span></span><br><span class="line">          <span class="keyword">if</span> (listItems.length == StreamViewState.NoData) &#123;</span><br><span class="line">            <span class="keyword">return</span> _getInfoMessage(<span class="string">'No data found'</span>);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> ListView.builder(</span><br><span class="line">            itemCount: listItems.length,</span><br><span class="line">            itemBuilder: (buildContext, index) &#123;</span><br><span class="line">              <span class="keyword">return</span> Column(</span><br><span class="line">                children: &lt;Widget&gt;[</span><br><span class="line">                  ListTile(</span><br><span class="line">                    title: Text(listItems[index]),</span><br><span class="line">                  ),</span><br><span class="line">                  Divider(),</span><br><span class="line">                ],</span><br><span class="line">              );</span><br><span class="line">            &#125;,</span><br><span class="line">          );</span><br><span class="line">        &#125;,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>只是新增了枚举值来判断是否需要更新数据，其他基本保持不变。</p><p>接下来，我需要修改 <code>_getListData()</code> 方法，使用流控制器添加状态及数据，如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Future _getListData(&#123;<span class="built_in">bool</span> hasError = <span class="keyword">false</span>, <span class="built_in">bool</span> hasData = <span class="keyword">true</span>&#125;) <span class="keyword">async</span> &#123;</span><br><span class="line">  _stateController.add(StreamViewState.Busy);</span><br><span class="line">  <span class="keyword">await</span> Future.delayed(<span class="built_in">Duration</span>(seconds: <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (hasError) &#123;</span><br><span class="line">    <span class="keyword">return</span> _stateController.addError(<span class="string">'error'</span>); <span class="comment">// 往 stream 里新增 error 数据</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!hasData) &#123;</span><br><span class="line">    <span class="keyword">return</span> _stateController.add(StreamViewState.NoData); <span class="comment">// 往 stream 里新增无数据状态</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  _listItems = <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;.generate(<span class="number">10</span>, (index) =&gt; <span class="string">'<span class="subst">$index</span> content'</span>);</span><br><span class="line">  _stateController.add(StreamViewState.DataRetrieved); <span class="comment">// 往 stream 里新增数据获取完成状态</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此时我们并没有返回数据，所以我们需要创建 <code>listItems</code> 存储数据，然后把 <code>StatelessWidget</code> 改成 <code>StatefulWidget</code> ，以便我们根据 <code>stream</code> 的输出来更新数据，这个转换非常方便，<strong>VS Code</strong> 编辑器可以使用 <code>Option + Shift + R</code> （Mac）或者 <code>Ctrl + Shift + R</code> (Win)快捷键 ，<strong>Android Studio</strong> 使用<code>Option + Enter</code> 快捷键，之后在 <code>initState()</code> 方法中初始化数据，如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; listItems;</span><br><span class="line"></span><br><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">void</span> initState() &#123;</span><br><span class="line">  _getListData();</span><br><span class="line">  <span class="keyword">super</span>.initState();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>到这里我们已经解决了 <code>FutureBuilder</code> 的局限性问题，我们可以新增一个 <code>FloatingActionButton</code> 来刷新数据，如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(<span class="string">'Stream Builder Demo'</span>),</span><br><span class="line">      ),</span><br><span class="line">      floatingActionButton: FloatingActionButton(</span><br><span class="line">        backgroundColor: Colors.yellow,</span><br><span class="line">        child: Icon(</span><br><span class="line">          Icons.cached,</span><br><span class="line">          color: Colors.black87,</span><br><span class="line">        ),</span><br><span class="line">        onPressed: () &#123;</span><br><span class="line">          model.dispatch(FetchData());</span><br><span class="line">        &#125;,</span><br><span class="line">      ),</span><br><span class="line">      body: StreamBuilder(</span><br><span class="line"></span><br><span class="line">        ...</span><br><span class="line">        </span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>现在，点击 <code>FloatingActionButton</code> 加载指示器已经显示，但是，我们的 <code>listItems</code> 数据并没真正的更新，点击 <code>FloatingActionButton</code> 只是更新的加载状态而已，而且我们的业务逻辑代码和 <strong>UI</strong> 代码还在同一个文件中，很显然，他们已经解耦，所以，我们可以继续完善它，将业务逻辑代码和 <strong>UI</strong> 代码分离出来。</p><h2 id="分离业务逻辑代码和-UI-代码"><a href="#分离业务逻辑代码和-UI-代码" class="headerlink" title="分离业务逻辑代码和 UI 代码"></a>分离业务逻辑代码和 <strong>UI</strong> 代码</h2><p>我们可以把处理 <code>stream</code> 的代码抽离成一个类，如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:async'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'dart:math'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:pro_flutter/demo/stream_demo/stream_demo_event.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:pro_flutter/demo/stream_demo/stream_demo_state.dart'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> StreamViewState &#123; Busy, DataRetrieved, NoData &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StreamDemoModel</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> StreamController&lt;StreamDemoState&gt; _stateController = StreamController&lt;StreamDemoState&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; _listItems;</span><br><span class="line"></span><br><span class="line">  Stream&lt;StreamDemoState&gt; <span class="keyword">get</span> streamState =&gt; _stateController.stream;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> dispatch(StreamDemoEvent event)&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'Event dispatched: <span class="subst">$event<span class="string">');</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">    if(event is FetchData) &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">      _getListData(hasData: event.hasData, hasError: event.hasError);</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">    &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string"></span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  Future _getListData(&#123;bool hasError = false, bool hasData = true&#125;) async &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">    _stateController.add(BusyState());</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">    await Future.delayed(Duration(seconds: 2));</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string"></span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">    if (hasError) &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">      return _stateController.addError('</span></span>error'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!hasData) &#123;</span><br><span class="line">      <span class="keyword">return</span> _stateController.add(DataFetchedState(data: <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _listItems = <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;.generate(<span class="number">10</span>, (index) =&gt; <span class="string">'<span class="subst">$index</span> content'</span>);</span><br><span class="line">    _stateController.add(DataFetchedState(data: _listItems));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后，把状态也封装成一个文件且将数据和状态关联，如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StreamDemoState</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InitializedState</span> <span class="keyword">extends</span> <span class="title">StreamDemoState</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataFetchedState</span> <span class="keyword">extends</span> <span class="title">StreamDemoState</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; data;</span><br><span class="line"></span><br><span class="line">  DataFetchedState(&#123;<span class="keyword">this</span>.data&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">bool</span> <span class="keyword">get</span> hasData =&gt; data.length &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ErrorState</span> <span class="keyword">extends</span> <span class="title">StreamDemoState</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BusyState</span> <span class="keyword">extends</span> <span class="title">StreamDemoState</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>再封装一个事件文件，如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StreamDemoEvent</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FetchData</span> <span class="keyword">extends</span> <span class="title">StreamDemoEvent</span></span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">bool</span> hasError;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">bool</span> hasData;</span><br><span class="line"></span><br><span class="line">  FetchData(&#123;<span class="keyword">this</span>.hasError = <span class="keyword">false</span>, <span class="keyword">this</span>.hasData = <span class="keyword">true</span>&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">String</span> toString() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'FetchData &#123; hasError: <span class="subst">$hasError</span>, hasData: <span class="subst">$hasData</span> &#125;'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后，我们 <strong>UI</strong> 部分的代码如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_StreamBuilderDemoState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">StreamBuilderDemo</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> model = StreamDemoModel(); <span class="comment">// 创建 model</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    model.dispatch(FetchData(hasData: <span class="keyword">true</span>)); <span class="comment">// 获取 model 里的数据</span></span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line"></span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line">      body: StreamBuilder(</span><br><span class="line">        stream: model.streamState,</span><br><span class="line">        builder: (buildContext, snapshot) &#123;</span><br><span class="line">          <span class="keyword">if</span> (snapshot.hasError) &#123;</span><br><span class="line">            <span class="keyword">return</span> _getInformationMessage(snapshot.error);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">var</span> streamState = snapshot.data;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (!snapshot.hasData || streamState <span class="keyword">is</span> BusyState) &#123;  <span class="comment">// 通过封装的状态类来判断是否更新UI</span></span><br><span class="line">            <span class="keyword">return</span> Center(</span><br><span class="line">              child: CircularProgressIndicator(</span><br><span class="line">                valueColor: AlwaysStoppedAnimation&lt;Color&gt;(Colors.yellow),</span><br><span class="line">                backgroundColor: Colors.yellow[<span class="number">100</span>],</span><br><span class="line">              ),</span><br><span class="line">            );</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (streamState <span class="keyword">is</span> DataFetchedState) &#123; <span class="comment">// 通过封装的状态类来判断是否更新UI</span></span><br><span class="line">            <span class="keyword">if</span> (!homeState.hasData) &#123;</span><br><span class="line">              <span class="keyword">return</span> _getInformationMessage(<span class="string">'not found data'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> ListView.builder(</span><br><span class="line">            itemCount: streamState.data.length,  <span class="comment">// 此时，数据不再是本地数据，而是从 stream 中输出的数据</span></span><br><span class="line">            itemBuilder: (buildContext, index) =&gt;</span><br><span class="line">                _getListItem(index, streamState.data),</span><br><span class="line">          );</span><br><span class="line">        &#125;,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此时，业务逻辑代码和 <strong>UI</strong> 代码已完全分离，且可扩展性和维护增强，且我们的数据和状态已关联起来，此时，点击 <code>FloatingActionButton</code> 效果和上面一样，且数据已更新。</p>]]></content:encoded>
      
      <comments>https://h.lishaoy.net/futrueBuilder-streamBuilder.html#disqus_thread</comments>
    </item>
    
    <item>
      <title>Android Flutter 混合开发高仿大厂App</title>
      <link>https://h.lishaoy.net/androidCtrip.html</link>
      <guid>https://h.lishaoy.net/androidCtrip.html</guid>
      <pubDate>Thu, 18 Jun 2020 22:36:43 GMT</pubDate>
      <description>
      
        &lt;span itemprop=&quot;image&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/ImageObject&quot;&gt;&lt;img itemprop=&quot;url image&quot; src=&quot;/images/loading.gif&quot; data-original=&quot;https://cdn.lishaoy.net/ctrip/android/android_ctrip_h.png&quot; class=&quot;full-image&quot; alt=&quot;Flutter&quot; title=&quot;Flutter&quot;&gt;&lt;meta itemprop=&quot;width&quot; content=&quot;auto&quot;&gt;&lt;meta itemprop=&quot;height&quot; content=&quot;auto&quot;&gt;&lt;/span&gt;
&lt;p&gt;自上篇 &lt;a href=&quot;https://h.lishaoy.net/flutterctrip&quot;&gt;Flutter 10天高仿大厂App及小技巧积累总结&lt;/a&gt; 的续篇，这次更是干货满满。&lt;/p&gt;
&lt;p&gt;这篇文章将概述 &lt;strong&gt;Android组件化的架构搭建&lt;/strong&gt; 及 &lt;strong&gt;Flutter&lt;/strong&gt; 和 &lt;strong&gt;Android&lt;/strong&gt; 如何混合开发 &lt;em&gt;(整个App只有首页是用原生Android完成，其他页面都是引入之前的做好的Flutter页面)&lt;/em&gt; ，主宿主程序由 Android 搭建，采用了组件化的架构搭建整个 &lt;strong&gt;App&lt;/strong&gt; ，不同业务，对应不同的 module 工程，业务之间采用接口通信 &lt;em&gt;(ARouter)&lt;/em&gt; ，以 module 的形式混入 Flutter，通过 &lt;strong&gt;MethodChannel&lt;/strong&gt; 和 &lt;strong&gt;Flutter&lt;/strong&gt; 端进行数据通信等，且这些功能实现源码开源，感兴趣的小伙伴可以移步至 &lt;a href=&quot;https://github.com/persilee/android_ctrip&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;GitHub&lt;/a&gt;。&lt;/p&gt;
&lt;hr&gt;
      
      </description>
      
      <content:encoded><![CDATA[<span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="/images/loading.gif" data-original="https://cdn.lishaoy.net/ctrip/android/android_ctrip_h.png" class="full-image" alt="Flutter" title="Flutter"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><p>自上篇 <a href="https://h.lishaoy.net/flutterctrip">Flutter 10天高仿大厂App及小技巧积累总结</a> 的续篇，这次更是干货满满。</p><p>这篇文章将概述 <strong>Android组件化的架构搭建</strong> 及 <strong>Flutter</strong> 和 <strong>Android</strong> 如何混合开发 <em>(整个App只有首页是用原生Android完成，其他页面都是引入之前的做好的Flutter页面)</em> ，主宿主程序由 Android 搭建，采用了组件化的架构搭建整个 <strong>App</strong> ，不同业务，对应不同的 module 工程，业务之间采用接口通信 <em>(ARouter)</em> ，以 module 的形式混入 Flutter，通过 <strong>MethodChannel</strong> 和 <strong>Flutter</strong> 端进行数据通信等，且这些功能实现源码开源，感兴趣的小伙伴可以移步至 <a href="https://github.com/persilee/android_ctrip" target="_blank" rel="noopener">GitHub</a>。</p><hr><a id="more"></a><p>以下博文会分为4个部分概述：</p><ul><li>项目完成的功能预览</li><li>项目组件化结构分析</li><li>项目功能详细概述（所用知识点）</li><li>Android Flutter 混合开发</li></ul><h2 id="项目完成的功能预览"><a href="#项目完成的功能预览" class="headerlink" title="项目完成的功能预览"></a>项目完成的功能预览</h2><p>首先，我们还是通过一个视频来快速预览下项目完成的功能和运行效果，如下</p><video id="flutter" class="video-js vjs-default-skin" controls preload="auto" poster="https://cdn.lishaoy.net/ctrip/android_ctripb_bg.png" data-setup="{'example_option':true}">    <source src="https://cdn.lishaoy.net/ctrip/android_ctrip.mp4" type="video/mp4"></video><div class="note warning"><p><i class="fa fa-fw fa-bell  faa-horizontal animated faa-slow" style="color: #faab33;"></i> 如视频播放失败， <a href="https://www.bilibili.com/video/BV1W54y1B72U/" target="_blank" rel="noopener">请移步这里点击观看</a> <em>(点击齿轮 –&gt; 更多播放设置，可以隐藏黑边)</em></p></div><p>看完视频后，其实大部分功能和之前的 <a href="https://h.lishaoy.net/flutterctrip">纯flutter项目</a> 功能相同，只是首页新增了4个tab推荐页面及携程二楼和布局改变。</p><p>大家也可扫描，安装体验：</p><div style="width:166px; margin:auto"><img src="https://www.pgyer.com/app/qrcode/AsHK?sign=&amp;auSign=&amp;code=" alt="no-shadow" title="手机扫描二维码安装"></div><h2 id="项目组件化结构分析"><a href="#项目组件化结构分析" class="headerlink" title="项目组件化结构分析"></a>项目组件化结构分析</h2><h3 id="项目结构图预览"><a href="#项目结构图预览" class="headerlink" title="项目结构图预览"></a>项目结构图预览</h3><p>其次，分析梳理下项目结构，项目的结构大致如图，还有一些细枝末节的没有体现在图里：</p><p><img src="https://cdn.lishaoy.net/ctrip/android/project.png" alt="no-shadow" title="project structure"></p><h3 id="项目结构分析"><a href="#项目结构分析" class="headerlink" title="项目结构分析"></a>项目结构分析</h3><h4 id="业务工程"><a href="#业务工程" class="headerlink" title="业务工程"></a>业务工程</h4><p>把具体独立的业务都拆分成单独的 module 减小项目的维护压力</p><ul><li>ft_home: 首页模块，这个模块其实还可以继续拆分，可把4个 tab <em>(精选、附近、景点、美食)</em> 页都拆成模块，这里我暂时没有拆分，后续会完成</li><li>ft_destination: 目的地模块，其实并没有建立这个模块，因为直接引入了之前做好的 flutter 页面</li><li>ft_travel: 旅拍模块，同样也使用了 flutter 页面</li><li>flutter: flutter模块，这个模块是从 flutter_module 中自动生成的，后面介绍到</li></ul><h3 id="基础库工程"><a href="#基础库工程" class="headerlink" title="基础库工程"></a>基础库工程</h3><p>把具体的功能都封装成独立的库供业务模块使用，降低项目的维护成本及代码之间耦合性</p><ul><li>lib_network: 网络库，使用 <a href="https://github.com/square/okhttp" target="_blank" rel="noopener">okhttp</a> 插件二次封装，业务层简单的调用即可</li><li>lib_webview: 打开网页的webview库，使用了 <a href="https://github.com/Justson/AgentWeb" target="_blank" rel="noopener">agentweb</a> 插件二次封装，业务层只需要一句代码即可完成网页的跳转</li><li>lib_image_loader: 图片加载库，使用了 <a href="https://github.com/bumptech/glide" target="_blank" rel="noopener">glide</a> 插件二次封装，业务层只需一句代码即可加载不同参数的图片</li><li>lib_asr: 百度AI语音库，通过 Android 集成好供 Flutter 端使用</li><li>lib_common_ui: 公共UI库，重复多次使用的页面集中管理</li><li>lib_base: 基础库，通过 <a href="https://github.com/alibaba/ARouter" target="_blank" rel="noopener">ARouter</a> 的 service 功能暴露接口提供服务给业务层，当然业务层也可以在这里暴露接口供外界使用</li></ul><p>这里有一些使用的插件并没有在项目结构图里体现出来(结构图空间有限)。</p><h3 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h3><p>在这里把项目使用的插件整理列举出来供大家参考：</p><ul><li><a href="https://github.com/hackware1993/MagicIndicator" target="_blank" rel="noopener">magicindicator</a> 强大、可定制、易扩展的 ViewPager 指示器框架，首页的4个 tab <em>(精选、附近、景点、美食)</em> 就是用这个实现的。</li><li><a href="https://github.com/gyf-dev/ImmersionBar" target="_blank" rel="noopener">immersionbar</a> 一句代码轻松实现状态栏、导航栏沉浸式管理</li><li><a href="https://github.com/tyzlmjj/PagerBottomTabStrip" target="_blank" rel="noopener">pagerBottomTabStrip</a> 页面底部和侧边的导航栏，首页、目的地、旅拍、我的页面切换就是用这个实现的。</li><li><a href="https://github.com/ReactiveX/RxAndroid" target="_blank" rel="noopener">rxjava/rxandroid</a> 异步和链式编程</li><li><a href="https://github.com/JakeWharton/butterknife" target="_blank" rel="noopener">butterknife</a> view注入插件，配合Android插件使用，可快速自动生成 init view的代码，不用写一句 <code>findViewById</code> 的代码。</li><li><a href="https://github.com/google/gson" target="_blank" rel="noopener">gson</a> json解析，配合Android插件使用，可快速生成实体类</li><li><a href="https://github.com/scwang90/SmartRefreshLayout" target="_blank" rel="noopener">smartRefreshLayout</a> 智能下拉刷新框架，携程二楼及下拉刷新加载更多就是用这个实现的</li><li><a href="https://github.com/greenrobot/EventBus" target="_blank" rel="noopener">eventbus</a> 发布/订阅事件总线，优雅的完成组件之间通信</li><li><a href="https://github.com/alibaba/ARouter" target="_blank" rel="noopener">arouter</a> 依赖注入、路由跳转、注册service，优雅的完成模块之间的通信</li><li><a href="https://github.com/square/okhttp" target="_blank" rel="noopener">okhttp</a> 网络请求插件</li><li><a href="https://github.com/Justson/AgentWeb" target="_blank" rel="noopener">agentweb</a> webview框架，进行简单的二次封装可优雅的进行网页跳转</li><li><a href="https://github.com/bumptech/glide" target="_blank" rel="noopener">glide</a> 高性能、可扩展的图片加载插件</li><li><a href="https://github.com/youth5201314/banner" target="_blank" rel="noopener">banner</a> 图片轮播控件</li></ul><p>基本就是这些了，应该没有漏的，插件的详细使用，请进入各插件的 GitHub 主页。</p><p>在此，把我项目的插件引入代码及版本管理的 <code>gradle</code> 代码贴出来，如下：</p><p>插件引入代码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    implementation fileTree(dir: <span class="string">'libs'</span>, include: [<span class="string">'*.jar'</span>])</span><br><span class="line"></span><br><span class="line">    implementation rootProject.depsLibs.appcompat</span><br><span class="line">    implementation rootProject.depsLibs.legacy</span><br><span class="line">    implementation rootProject.depsLibs.recyclerview</span><br><span class="line">    implementation rootProject.depsLibs.constraintlayout</span><br><span class="line">    implementation rootProject.depsLibs.cardview</span><br><span class="line"></span><br><span class="line">    //tab指示器</span><br><span class="line">    implementation rootProject.depsLibs.magicindicator</span><br><span class="line">    //沉浸式</span><br><span class="line">    implementation rootProject.depsLibs.immersionbar</span><br><span class="line">    //导航栏</span><br><span class="line">    implementation rootProject.depsLibs.pagerBottomTabStrip</span><br><span class="line">    //rxjava</span><br><span class="line">    implementation rootProject.depsLibs.rxjava</span><br><span class="line">    //rxandroid</span><br><span class="line">    implementation rootProject.depsLibs.rxandroid</span><br><span class="line">    //view 注入</span><br><span class="line">    implementation rootProject.depsLibs.butterknife</span><br><span class="line">    //view 注入</span><br><span class="line">    annotationProcessor rootProject.depsLibs.butterknifeCompiler</span><br><span class="line">    //gson</span><br><span class="line">    implementation rootProject.depsLibs.gson</span><br><span class="line">    //banner</span><br><span class="line">    implementation rootProject.depsLibs.banner</span><br><span class="line">    //smartRefreshLayout 上下拉刷新</span><br><span class="line">    implementation rootProject.depsLibs.smartRefreshLayout</span><br><span class="line">    implementation rootProject.depsLibs.refreshHeader</span><br><span class="line">    implementation rootProject.depsLibs.refreshHeaderTwoLevel</span><br><span class="line">    implementation rootProject.depsLibs.refreshFooter</span><br><span class="line">    //eventbus</span><br><span class="line">    implementation rootProject.depsLibs.eventbus</span><br><span class="line">    //arouter库</span><br><span class="line">    implementation(rootProject.depsLibs.arouterapi) &#123;</span><br><span class="line">        exclude group: <span class="string">'com.android.support'</span></span><br><span class="line">    &#125;</span><br><span class="line">    annotationProcessor rootProject.depsLibs.aroutercompiler</span><br><span class="line"></span><br><span class="line">    //引入home模块</span><br><span class="line">    implementation project(<span class="string">':ft_home'</span>)</span><br><span class="line">    //引入图片加载库</span><br><span class="line">    implementation project(<span class="string">':lib_image_loader'</span>)</span><br><span class="line">    //引入网络库</span><br><span class="line">    implementation project(<span class="string">':lib_network'</span>)</span><br><span class="line">    //webview</span><br><span class="line">    implementation project(<span class="string">':lib_webview'</span>)</span><br><span class="line">    //引入基础ui库</span><br><span class="line">    implementation project(<span class="string">':lib_common_ui'</span>)</span><br><span class="line">    //base库</span><br><span class="line">    implementation project(<span class="string">':lib_base'</span>)</span><br><span class="line">    //引入flutter模块</span><br><span class="line">    implementation project(<span class="string">':flutter'</span>)</span><br><span class="line">    //引入百度AI语音库</span><br><span class="line">    implementation project(<span class="string">':lib_asr'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>版本管理代码 <em>(统一管理版本号)</em> : </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">ext &#123;</span><br><span class="line">    android = [</span><br><span class="line">            compileSdkVersion: 29,</span><br><span class="line">            buildToolsVersion: <span class="string">"29.0.0"</span>,</span><br><span class="line">            minSdkVersion    : 19,</span><br><span class="line">            targetSdkVersion : 29,</span><br><span class="line">            applicationId    : <span class="string">'net.lishaoy.android_ctrip'</span>,</span><br><span class="line">            versionCode      : 1,</span><br><span class="line">            versionName      : <span class="string">'1.0'</span>,</span><br><span class="line">            multiDexEnabled  : <span class="literal">true</span>,</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    depsVersion = [</span><br><span class="line">            appcompat            : <span class="string">'1.1.0'</span>,</span><br><span class="line">            legacy               : <span class="string">'1.0.0'</span>,</span><br><span class="line">            recyclerview         : <span class="string">'1.0.0'</span>,</span><br><span class="line">            constraintlayout     : <span class="string">'1.1.3'</span>,</span><br><span class="line">            cardview             : <span class="string">'1.0.0'</span>,</span><br><span class="line">            magicindicator       : <span class="string">'1.5.0'</span>,</span><br><span class="line">            immersionbar         : <span class="string">'3.0.0'</span>,</span><br><span class="line">            pagerBottomTabStrip  : <span class="string">'2.3.0X'</span>,</span><br><span class="line">            glide                : <span class="string">'4.11.0'</span>,</span><br><span class="line">            glidecompiler        : <span class="string">'4.11.0'</span>,</span><br><span class="line">            butterknife          : <span class="string">'10.2.1'</span>,</span><br><span class="line">            butterknifeCompiler  : <span class="string">'10.2.1'</span>,</span><br><span class="line">            rxjava               : <span class="string">'3.0.0'</span>,</span><br><span class="line">            rxandroid            : <span class="string">'3.0.0'</span>,</span><br><span class="line">            okhttp               : <span class="string">'4.7.2'</span>,</span><br><span class="line">            okhttpLogging        : <span class="string">'4.7.2'</span>,</span><br><span class="line">            gson                 : <span class="string">'2.8.6'</span>,</span><br><span class="line">            banner               : <span class="string">'2.0.10'</span>,</span><br><span class="line">            smartRefreshLayout   : <span class="string">'2.0.1'</span>,</span><br><span class="line">            refreshHeader        : <span class="string">'2.0.1'</span>,</span><br><span class="line">            refreshFooter        : <span class="string">'2.0.1'</span>,</span><br><span class="line">            refreshHeaderTwoLevel: <span class="string">'2.0.1'</span>,</span><br><span class="line">            eventbus             : <span class="string">'3.2.0'</span>,</span><br><span class="line">            agentweb             : <span class="string">'4.1.3'</span>,</span><br><span class="line">            arouterapi           : <span class="string">'1.5.0'</span>,</span><br><span class="line">            aroutercompiler      : <span class="string">'1.2.2'</span>,</span><br><span class="line"></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    depsLibs = [</span><br><span class="line">            appcompat            : <span class="string">"androidx.appcompat:appcompat:<span class="variable">$&#123;depsVersion.appcompat&#125;</span>"</span>,</span><br><span class="line">            legacy               : <span class="string">"androidx.legacy:legacy-support-v4:<span class="variable">$&#123;depsVersion.legacy&#125;</span>"</span>,</span><br><span class="line">            recyclerview         : <span class="string">"androidx.recyclerview:recyclerview:<span class="variable">$&#123;depsVersion.recyclerview&#125;</span>"</span>,</span><br><span class="line">            constraintlayout     : <span class="string">"androidx.constraintlayout:constraintlayout:<span class="variable">$&#123;depsVersion.constraintlayout&#125;</span>"</span>,</span><br><span class="line">            cardview             : <span class="string">"androidx.cardview:cardview:<span class="variable">$&#123;depsVersion.cardview&#125;</span>"</span>,</span><br><span class="line">            magicindicator       : <span class="string">"com.github.hackware1993:MagicIndicator:<span class="variable">$&#123;depsVersion.magicindicator&#125;</span>"</span>,</span><br><span class="line">            immersionbar         : <span class="string">"com.gyf.immersionbar:immersionbar:<span class="variable">$&#123;depsVersion.immersionbar&#125;</span>"</span>,</span><br><span class="line">            pagerBottomTabStrip  : <span class="string">"me.majiajie:pager-bottom-tab-strip:<span class="variable">$&#123;depsVersion.pagerBottomTabStrip&#125;</span>"</span>,</span><br><span class="line">            glide                : <span class="string">"com.github.bumptech.glide:glide:<span class="variable">$&#123;depsVersion.glide&#125;</span>"</span>,</span><br><span class="line">            glidecompiler        : <span class="string">"com.github.bumptech.glide:compiler:<span class="variable">$&#123;depsVersion.glidecompiler&#125;</span>"</span>,</span><br><span class="line">            butterknife          : <span class="string">"com.jakewharton:butterknife:<span class="variable">$&#123;depsVersion.butterknife&#125;</span>"</span>,</span><br><span class="line">            butterknifeCompiler  : <span class="string">"com.jakewharton:butterknife-compiler:<span class="variable">$&#123;depsVersion.butterknifeCompiler&#125;</span>"</span>,</span><br><span class="line">            rxjava               : <span class="string">"io.reactivex.rxjava3:rxjava:<span class="variable">$&#123;depsVersion.rxjava&#125;</span>"</span>,</span><br><span class="line">            rxandroid            : <span class="string">"io.reactivex.rxjava3:rxandroid:<span class="variable">$&#123;depsVersion.rxandroid&#125;</span>"</span>,</span><br><span class="line">            okhttp               : <span class="string">"com.squareup.okhttp3:okhttp:<span class="variable">$&#123;depsVersion.okhttp&#125;</span>"</span>,</span><br><span class="line">            okhttpLogging        : <span class="string">"com.squareup.okhttp3:logging-interceptor:<span class="variable">$&#123;depsVersion.okhttpLogging&#125;</span>"</span>,</span><br><span class="line">            gson                 : <span class="string">"com.google.code.gson:gson:<span class="variable">$&#123;depsVersion.gson&#125;</span>"</span>,</span><br><span class="line">            banner               : <span class="string">"com.youth.banner:banner:<span class="variable">$&#123;depsVersion.banner&#125;</span>"</span>,</span><br><span class="line">            smartRefreshLayout   : <span class="string">"com.scwang.smart:refresh-layout-kernel:<span class="variable">$&#123;depsVersion.smartRefreshLayout&#125;</span>"</span>,</span><br><span class="line">            refreshHeader        : <span class="string">"com.scwang.smart:refresh-header-classics:<span class="variable">$&#123;depsVersion.refreshHeader&#125;</span>"</span>,</span><br><span class="line">            refreshHeaderTwoLevel: <span class="string">"com.scwang.smart:refresh-header-two-level:<span class="variable">$&#123;depsVersion.refreshHeader&#125;</span>"</span>,</span><br><span class="line">            refreshFooter        : <span class="string">"com.scwang.smart:refresh-footer-classics:<span class="variable">$&#123;depsVersion.refreshFooter&#125;</span>"</span>,</span><br><span class="line">            eventbus             : <span class="string">"org.greenrobot:eventbus:<span class="variable">$&#123;depsVersion.eventbus&#125;</span>"</span>,</span><br><span class="line">            agentweb             : <span class="string">"com.just.agentweb:agentweb:<span class="variable">$&#123;depsVersion.agentweb&#125;</span>"</span>,</span><br><span class="line">            arouterapi           : <span class="string">"com.alibaba:arouter-api:<span class="variable">$&#123;depsVersion.arouterapi&#125;</span>"</span>,</span><br><span class="line">            aroutercompiler      : <span class="string">"com.alibaba:arouter-compiler:<span class="variable">$&#123;depsVersion.aroutercompiler&#125;</span>"</span>,</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="项目功能详细概述（所用知识点）"><a href="#项目功能详细概述（所用知识点）" class="headerlink" title="项目功能详细概述（所用知识点）"></a>项目功能详细概述（所用知识点）</h2><p>这里主要对首页功能及知识点进行概述，由于其他页面是引入了之前的 Flutter 页面， 具体功能在 <a href="https://h.lishaoy.net/flutterctrip">Flutter 10天高仿大厂App及小技巧积累总结</a> 已经介绍过了，在这就不再阐述。</p><p>首页重点概述以下功能的实现：</p><ul><li>下拉刷新、携程二楼</li><li>搜索appBar</li><li>渐变色网格导航</li><li>banner组件</li><li>多状态的tab指示器 <em>(滚动固定顶部)</em></li></ul><h3 id="下拉刷新、携程二楼"><a href="#下拉刷新、携程二楼" class="headerlink" title="下拉刷新、携程二楼"></a>下拉刷新、携程二楼</h3><p>首先，看看具体的效果图，如图：</p><p><img src="https://cdn.lishaoy.net/ctrip/android/second_floor.gif" alt="no-shadow" title="second floor"></p><p>下拉刷新和携程二楼是使用 <a href="https://github.com/scwang90/SmartRefreshLayout" target="_blank" rel="noopener">smartRefreshLayout</a> 插件完成的，实现代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initRefreshMore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    homeHeader.setRefreshHeader(<span class="keyword">new</span> ClassicsHeader(getContext()), -<span class="number">1</span>, (<span class="keyword">int</span>) Utils.dp2px(<span class="number">76</span>)); <span class="comment">//设置下拉刷新及二楼header的高度</span></span><br><span class="line">    homeHeader.setFloorRate(<span class="number">1.6f</span>); <span class="comment">//设置二楼触发比率</span></span><br><span class="line">    homeRefreshContainer.setPrimaryColorsId(R.color.colorPrimary, R.color.white); <span class="comment">//设置下拉刷新及二楼提示文字颜色</span></span><br><span class="line">    homeRefreshContainer.setOnMultiListener(<span class="keyword">new</span> SimpleMultiListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLoadMore</span><span class="params">(@NonNull RefreshLayout refreshLayout)</span> </span>&#123;</span><br><span class="line">            loadMore(refreshLayout); <span class="comment">//加载更多</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRefresh</span><span class="params">(@NonNull RefreshLayout refreshLayout)</span> </span>&#123;</span><br><span class="line">            refreshLayout.finishRefresh(<span class="number">1600</span>); <span class="comment">//设置下拉刷新延迟</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onHeaderMoving</span><span class="params">(RefreshHeader header, <span class="keyword">boolean</span> isDragging, <span class="keyword">float</span> percent, <span class="keyword">int</span> offset, <span class="keyword">int</span> headerHeight, <span class="keyword">int</span> maxDragHeight)</span> </span>&#123;</span><br><span class="line">            homeSecondFloorImg.setVisibility(View.VISIBLE);  <span class="comment">//隐藏二楼背景图</span></span><br><span class="line">            homeSearchBarContainer.setAlpha(<span class="number">1</span> - Math.min(percent, <span class="number">1</span>)); <span class="comment">//改变searchBar透明度</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStateChanged</span><span class="params">(@NonNull RefreshLayout refreshLayout, @NonNull RefreshState oldState, @NonNull RefreshState newState)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (oldState == RefreshState.ReleaseToTwoLevel) &#123;  <span class="comment">//即将去往二楼状态处理</span></span><br><span class="line">                homeSecondFloorImg.setVisibility(View.GONE);</span><br><span class="line">                homeHeaderContent.animate().alpha(<span class="number">1</span>).setDuration(<span class="number">666</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newState == RefreshState.PullDownCanceled) &#123; <span class="comment">//下拉取消状态处理</span></span><br><span class="line">                homeHeaderContent.animate().alpha(<span class="number">0</span>).setDuration(<span class="number">666</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newState == RefreshState.Refreshing) &#123; <span class="comment">//正在刷新状态处理</span></span><br><span class="line">                homeHeaderContent.animate().alpha(<span class="number">0</span>).setDuration(<span class="number">666</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldState == RefreshState.TwoLevelReleased) &#123; <span class="comment">// 准备去往二楼完成状态处理，这里打开webview</span></span><br><span class="line">                WebViewImpl.getInstance().gotoWebView(<span class="string">"https://m.ctrip.com/webapp/you/tsnap/secondFloorIndex.html?isHideNavBar=YES&amp;s_guid=feb780be-c55a-4f92-a6cd-2d81e04d3241"</span>, <span class="keyword">true</span>);</span><br><span class="line">                homeHeader.finishTwoLevel();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldState == RefreshState.TwoLevel) &#123; <span class="comment">//到达二楼状态处理</span></span><br><span class="line">                homeCustomScrollView.setVisibility(View.GONE);</span><br><span class="line">                homeHeaderContent.animate().alpha(<span class="number">0</span>).setDuration(<span class="number">666</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldState == RefreshState.TwoLevelFinish) &#123; <span class="comment">//二楼完成状态处理</span></span><br><span class="line">                homeCustomScrollView.setVisibility(View.VISIBLE);</span><br><span class="line">                homeCustomScrollView.animate().alpha(<span class="number">1</span>).setDuration(<span class="number">666</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>XML</code> 页面布局文件代码如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">com.scwang.smart.refresh.layout.SmartRefreshLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/home_refresh_container"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:clipChildren</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:srlAccentColor</span>=<span class="string">"@color/colorPrimary"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:srlPrimaryColor</span>=<span class="string">"@color/colorPrimary"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">com.scwang.smart.refresh.header.TwoLevelHeader</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/home_header"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:gravity</span>=<span class="string">"top"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/home_second_floor_img"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"460dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_alignTop</span>=<span class="string">"@+id/home_header"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:scaleType</span>=<span class="string">"fitXY"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">"@drawable/second_floor"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:visibility</span>=<span class="string">"gone"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">FrameLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/home_header_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:alpha</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:scaleType</span>=<span class="string">"fitXY"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:src</span>=<span class="string">"@drawable/second_floor"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">com.scwang.smart.refresh.header.TwoLevelHeader</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">com.scwang.smart.refresh.footer.ClassicsFooter</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">com.scwang.smart.refresh.layout.SmartRefreshLayout</span>&gt;</span></span><br></pre></td></tr></table></figure><p>具体实现详情，可移步 <a href="https://github.com/persilee/android_ctrip" target="_blank" rel="noopener">GitHub</a> 查看源码。</p><h3 id="搜索appBar"><a href="#搜索appBar" class="headerlink" title="搜索appBar"></a>搜索appBar</h3><p>搜索栏的滚动的 placeholder 文字是使用 <a href="https://github.com/youth5201314/banner" target="_blank" rel="noopener">banner</a> 插件实现的，点击搜索框可跳转到搜索页面 <em>(flutter写的搜索页面)</em> ，跳转页面后可以把 placeholder 文字带到 flutter 搜索页面。</p><p>效果如图：</p><p><img src="https://cdn.lishaoy.net/ctrip/android/searchBar.gif" alt="no-shadow" title="search bar"></p><p>滚动的placeholder文字实现代码如下 <em>(搜索框的实现就不再这里展示都是一些XML布局代码)</em>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    homeSearchBarPlaceholder</span><br><span class="line">            .setAdapter(<span class="keyword">new</span> HomeSearchBarPlaceHolderAdapter(homeData.getSearchPlaceHolderList())) <span class="comment">// 设置适配器</span></span><br><span class="line">            .setOrientation(Banner.VERTICAL) <span class="comment">// 设置滚动方向</span></span><br><span class="line">            .setDelayTime(<span class="number">3600</span>) <span class="comment">// 设置间隔时间</span></span><br><span class="line">            .setOnBannerListener(<span class="keyword">new</span> OnBannerListener() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnBannerClick</span><span class="params">(Object data, <span class="keyword">int</span> position)</span> </span>&#123;  <span class="comment">//点击打开 flutter 搜索页面</span></span><br><span class="line">                    ARouter.getInstance()</span><br><span class="line">                            .build(<span class="string">"/home/search"</span>)</span><br><span class="line">                            .withString(<span class="string">"placeHolder"</span>, ((Home.SearchPlaceHolderListBean) data).getText())</span><br><span class="line">                            .navigation();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>searchBar的具体功能不过多阐述，和之前的项目一致。</p><h3 id="渐变色网格导航"><a href="#渐变色网格导航" class="headerlink" title="渐变色网格导航"></a>渐变色网格导航</h3><p>渐变色网格导航基本都是一些 <code>XML</code> 页面布局代码，只是我把它封装成了单独的组件，效果如图</p><p><img src="https://cdn.lishaoy.net/ctrip/android/gridBar.png" alt="GridNav" width="36%" title="GridNav" align="center"></p><p>封装之后的引入就非常简单，代码如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">"@color/white"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 网格导航 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">net.lishaoy.ft_home.GridNavView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/home_grid_nav_container"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure><p>具体实现详情，可移步 <a href="https://github.com/persilee/android_ctrip" target="_blank" rel="noopener">GitHub</a> 查看源码。</p><h3 id="banner组件"><a href="#banner组件" class="headerlink" title="banner组件"></a>banner组件</h3><p>banner组件也是用 <a href="https://github.com/youth5201314/banner" target="_blank" rel="noopener">banner</a> 插件实现的，如图</p><p><img src="https://cdn.lishaoy.net/ctrip/android/banner.gif" alt="no-shadow" title="banner"></p><p>实现代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initBanner</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    homeBanner.addBannerLifecycleObserver(<span class="keyword">this</span>)</span><br><span class="line">            .setAdapter(<span class="keyword">new</span> HomeBannerAdapter(homeData.getBannerList())) <span class="comment">//设置适配器</span></span><br><span class="line">            .setIndicator(<span class="keyword">new</span> EllipseIndicator(getContext()))           <span class="comment">//设置指示器，如图的指示器是我自定义的插件里并没有提供</span></span><br><span class="line">            .setIndicatorSelectedColorRes(R.color.white)                <span class="comment">//设置指示器颜色</span></span><br><span class="line">            .setIndicatorSpace((<span class="keyword">int</span>) BannerUtils.dp2px(<span class="number">10</span>))             <span class="comment">//设置间距</span></span><br><span class="line">            .setBannerRound(BannerUtils.dp2px(<span class="number">6</span>));                      <span class="comment">//设置圆角</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="多状态的tab指示器"><a href="#多状态的tab指示器" class="headerlink" title="多状态的tab指示器"></a>多状态的tab指示器</h3><p>多状态的tab指示器的实现需要注意很多细节，因为它是在首页的 <code>fragment</code> 的 <code>ScrollView</code> 里嵌入 <code>viewPaper</code>，首先你会发现 viewPaper 不显示的问题，其次是滚动不流畅的问题，这两个问题我的解决方案是：</p><ul><li>viewPaper 不显示的问题：使用自定义的 <code>ViewPager</code> 重写 <code>onMeasure</code> 方法，重新计算高度</li><li>滚动不流畅的问题：使用自定义的 <code>ScrollView</code>，重写 <code>computeScroll</code> 和 <code>onScrollChanged</code> 重新获取滚动距离</li></ul><p>实现效果如图：</p><p><img src="https://cdn.lishaoy.net/ctrip/android/tab_bar.gif" alt="no-shadow" title="tab page"></p><p>这个功能实现代码过多不便在这里展示，具体实现详情，可移步 <a href="https://github.com/persilee/android_ctrip" target="_blank" rel="noopener">GitHub</a> 查看源码。</p><h2 id="Android-Flutter-混合开发"><a href="#Android-Flutter-混合开发" class="headerlink" title="Android Flutter 混合开发"></a>Android Flutter 混合开发</h2><p>这个项目的实现只有首页是用 Android 原生实现，其他的页面均是 Flutter 实现的，之前 <a href="https://h.lishaoy.net/flutterctrip">纯Flutter项目</a>。</p><p>Android 引入 Flutter 进行混合开发，需要以下几个步骤</p><ul><li>建立一个flutter module</li><li>编写flutter代码 <em>(创建 flutter 路由)</em></li><li>flutter 和 android 之间相互通信</li></ul><p>下面依次概述这几部分是如何操作实现的。</p><h3 id="建立一个flutter-module"><a href="#建立一个flutter-module" class="headerlink" title="建立一个flutter module"></a>建立一个flutter module</h3><p>这个应该不用过多描述，基本操作大家都会 File –&gt; New –&gt; New Module 如图：</p><p><img src="https://cdn.lishaoy.net/ctrip/android/flutter_module.png" alt="no-shadow" title="flutter module"></p><p>新建完成之后，android studio 会自动生成配置代码到 gradle 配置文件里，且生成一个 flutter 的 library 模块。</p><div class="note warning"><p><i class="fa fa-fw fa-bell  faa-horizontal animated faa-slow" style="color: #faab33;"></i> <strong>Tips：</strong> <br \="">新建的时候最好 flutter module 和 android 项目放到同级目录下；<br \="">新版的 android studio 才会自动生成 gradle 配置代码，老版本貌似需要手动配置</p></div><p>如，没有生成 gradle 配置代码，你需要在根项目的 <code>settings.gradle</code> 文件里手动加入如下配置：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">setBinding(<span class="keyword">new</span> Binding([gradle: <span class="keyword">this</span>]))</span><br><span class="line">evaluate(<span class="keyword">new</span> File(</span><br><span class="line">  settingsDir, <span class="comment">//设置根路径，根据具体flutter module路径配置</span></span><br><span class="line">  <span class="string">'flutter_module/.android/include_flutter.groovy'</span></span><br><span class="line">))</span><br><span class="line"></span><br><span class="line">include <span class="string">':flutter_module'</span></span><br></pre></td></tr></table></figure><p>还需在宿主工程 <em>(没改名的话都是app)</em> 的 <code>build.gradle</code> 引入 flutter， 如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">//引入flutter模块</span></span><br><span class="line">    <span class="function">implementation <span class="title">project</span><span class="params">(<span class="string">':flutter'</span>)</span></span></span><br><span class="line"><span class="function">    ...</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="编写flutter代码"><a href="#编写flutter代码" class="headerlink" title="编写flutter代码"></a>编写flutter代码</h3><p>编写flutter代码，在 flutter module 里按照正常 flutter 开发流程编写 flutter 代码即可。 <em>(我项目里的 flutter 的代码是之前项目都写好的，复制过来，改改包的引入问题，就可以运行了。)</em></p><p>这里需要注意的是，flutter 有且只有一个入口，就是 <code>main()</code> 函数，我们需要在这里处理好 flutter 页面的跳转问题。</p><p>在 android 端，创建 flutter 页面，代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Flutter.createView(getActivity(),getLifecycle(),<span class="string">"destination"</span>);</span><br></pre></td></tr></table></figure><p><code>Flutter.createView</code> 需要3个参数 <code>activity</code> 、<code>lifecycle</code> 、<code>route</code> ，这个 route 就是要传递到 flutter 端的，当然，它是 String 类型的，我们可以自由发挥传递普通字符串或 json 字符串等。</p><p>我们也可以通过其他的方式创建 flutter 页面，如： <code>Flutter.createFragment()</code> 、 <code>FlutterActivity.withNewEngine()</code>、 <code>FlutterFragment.createDefault()</code> 等。</p><p>具体的使用，可前往 <a href="https://flutter.dev/docs/development/add-to-app/android" target="_blank" rel="noopener">Flutter官方文档</a> 查阅。</p><p>那么，flutter 端如何接收这个 route 参数，是通过 <code>window.defaultRouteName</code>，此项目里管理 flutter 端路由代码如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main() =&gt; runApp(MyApp());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      debugShowCheckedModeBanner: <span class="keyword">false</span>,</span><br><span class="line">      title: <span class="string">'Flutter model'</span>,</span><br><span class="line">      theme: ThemeData(</span><br><span class="line">        primarySwatch: Colors.blue,</span><br><span class="line">        fontFamily: <span class="string">'PingFang'</span>,</span><br><span class="line">      ),</span><br><span class="line">      home: _widgetRoute(<span class="built_in">window</span>.defaultRouteName), <span class="comment">// 通过 window.defaultRouteName 接收 android 端传来的参数</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Widget _widgetRoute(<span class="built_in">String</span> defaultRouteName) &#123;</span><br><span class="line">    <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="keyword">dynamic</span>&gt; params = convert.jsonDecode(defaultRouteName); <span class="comment">//解析参数</span></span><br><span class="line">    defaultRouteName = params[<span class="string">'routeName'</span>];</span><br><span class="line">    placeHolder = params[<span class="string">'placeHolder'</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (defaultRouteName) &#123; <span class="comment">// 根据参数返回对应的页面</span></span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'destination/search'</span>:</span><br><span class="line">            <span class="keyword">return</span> DestinationSearchPage(</span><br><span class="line">                hideLeft: <span class="keyword">false</span>,</span><br><span class="line">        );</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> Center(</span><br><span class="line">                child: Column(</span><br><span class="line">                mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">                children: &lt;Widget&gt;[</span><br><span class="line">                    Text(<span class="string">'not found <span class="subst">$defaultRouteName<span class="string">',</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                        textDirection: TextDirection.ltr),</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                ],</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                ),</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">            );</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">    &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">&#125;</span></span></span></span><br></pre></td></tr></table></figure><p>其实，flutter 端接收这个 route 参数，还有一种方法，就是通过 <code>onGenerateRoute</code>，它是 MaterialApp 里的一个方法。</p><p>代码如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">onGenerateRoute: (settings)&#123; <span class="comment">//通过 settings.name 获取android端传来的参数</span></span><br><span class="line">    <span class="keyword">return</span> _widgetRoute(settings.name);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h3 id="flutter-和-android-之间相互通信"><a href="#flutter-和-android-之间相互通信" class="headerlink" title="flutter 和 android 之间相互通信"></a>flutter 和 android 之间相互通信</h3><p>flutter 端可以调用 android 端的方法及相互传递数据是如何实现的，flutter 官方提供了3个方法可以实现，分别是：</p><ul><li>EventChannel：单向的持续通信，如：网络变化、传感器等。</li><li>MethodChannel：一次性通信，一般适用如方法的调用。</li><li>BasicMessageChannel：持续的双向通信。</li></ul><p>此项目里采用了 <code>MethodChannel</code> 方法进行通信，如：flutter 端调用 android 端的AI智能语音方法以及 flutter 打开 android 端页面就是用 <code>MethodChannel</code> 实现的。</p><p>flutter 端调用 android 端的AI智能语音方法代码如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AsrManager</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> MethodChannel _channel = <span class="keyword">const</span> MethodChannel(<span class="string">'lib_asr'</span>);</span><br><span class="line">  <span class="comment">//开始录音</span></span><br><span class="line">  <span class="keyword">static</span> Future&lt;<span class="built_in">String</span>&gt; start(&#123;<span class="built_in">Map</span> params&#125;) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> _channel.invokeMethod(<span class="string">'start'</span>, params ?? &#123;&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//停止录音</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="comment">//取消录音</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="comment">//销毁</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>flutter 打开 android 端页面代码如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MethodChannelPlugin</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> MethodChannel methodChannel = MethodChannel(<span class="string">'MethodChannelPlugin'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> Future&lt;<span class="keyword">void</span>&gt; gotoDestinationSearchPage() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> methodChannel.invokeMethod(<span class="string">'gotoDestinationSearchPage'</span>); <span class="comment">//gotoDestinationSearchPage 参数会传到android端</span></span><br><span class="line">    &#125; on PlatformException &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">'Failed go to gotoDestinationSearchPage'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>android 接收也是通过 <code>MethodChannel</code> ，具体实现代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MethodChannelPlugin</span> <span class="keyword">implements</span> <span class="title">MethodChannel</span>.<span class="title">MethodCallHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> MethodChannel methodChannel;</span><br><span class="line">    <span class="keyword">private</span> Activity activity;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MethodChannelPlugin</span><span class="params">(Activity activity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.activity = activity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//调用方通过 registerWith 来注册flutter页面</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">registerWith</span><span class="params">(FlutterView flutterView)</span> </span>&#123;</span><br><span class="line">        methodChannel = <span class="keyword">new</span> MethodChannel(flutterView, <span class="string">"MethodChannelPlugin"</span>);</span><br><span class="line">        MethodChannelPlugin instance = <span class="keyword">new</span> MethodChannelPlugin((Activity) flutterView.getContext());</span><br><span class="line">        methodChannel.setMethodCallHandler(instance);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMethodCall</span><span class="params">(MethodCall methodCall, MethodChannel.Result result)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (methodCall.method.equals(<span class="string">"gotoDestinationSearchPage"</span>)) &#123; <span class="comment">// 收到消息进行具体操作</span></span><br><span class="line">            EventBus.getDefault().post(<span class="keyword">new</span> GotoDestinationSearchPageEvent());</span><br><span class="line">            result.success(<span class="number">200</span>);</span><br><span class="line">        &#125; </span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            result.notImplemented();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>android flutter 混合开发基本就是这3个步骤，其他一些细节及具体的流程请参考 <a href="https://github.com/persilee/android_ctrip" target="_blank" rel="noopener">GitHub</a> 项目源码。</p>]]></content:encoded>
      
      <comments>https://h.lishaoy.net/androidCtrip.html#disqus_thread</comments>
    </item>
    
    <item>
      <title>Flutter 10天高仿大厂App及小技巧积累总结</title>
      <link>https://h.lishaoy.net/flutterCtrip.html</link>
      <guid>https://h.lishaoy.net/flutterCtrip.html</guid>
      <pubDate>Mon, 11 May 2020 13:53:05 GMT</pubDate>
      <description>
      
        &lt;span itemprop=&quot;image&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/ImageObject&quot;&gt;&lt;img itemprop=&quot;url image&quot; src=&quot;/images/loading.gif&quot; data-original=&quot;https://cdn.lishaoy.net/flutterCtrip/iOS-andorid.png&quot; class=&quot;full-image&quot; alt=&quot;Flutter&quot; title=&quot;Flutter&quot;&gt;&lt;meta itemprop=&quot;width&quot; content=&quot;auto&quot;&gt;&lt;meta itemprop=&quot;height&quot; content=&quot;auto&quot;&gt;&lt;/span&gt;
&lt;p&gt;之前，也写过几篇关于 &lt;code&gt;Flutter&lt;/code&gt; 的博文，最近，又花了一些时间学习研究 &lt;code&gt;Flutter&lt;/code&gt;，完成了高仿大厂 &lt;strong&gt;App&lt;/strong&gt; 项目 &lt;em&gt;(项目使用的接口都是来自线上真实App抓包而来，可以做到和线上项目相同的效果)&lt;/em&gt;，也总结积累了一些小技巧和知识点，所以，在这里记录分享出来，也希望 &lt;code&gt;Flutter&lt;/code&gt; 生态越来越好 &lt;em&gt;（flutter开发App效率真的很高，开发体验也是很好的 🙂）&lt;/em&gt;。&lt;/p&gt;
&lt;hr&gt;
      
      </description>
      
      <content:encoded><![CDATA[<span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="/images/loading.gif" data-original="https://cdn.lishaoy.net/flutterCtrip/iOS-andorid.png" class="full-image" alt="Flutter" title="Flutter"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><p>之前，也写过几篇关于 <code>Flutter</code> 的博文，最近，又花了一些时间学习研究 <code>Flutter</code>，完成了高仿大厂 <strong>App</strong> 项目 <em>(项目使用的接口都是来自线上真实App抓包而来，可以做到和线上项目相同的效果)</em>，也总结积累了一些小技巧和知识点，所以，在这里记录分享出来，也希望 <code>Flutter</code> 生态越来越好 <em>（flutter开发App效率真的很高，开发体验也是很好的 🙂）</em>。</p><hr><a id="more"></a><p>以下博文会分为4个部分概述：</p><ul><li>项目完成的功能预览</li><li>项目结构分析</li><li>项目功能详细概述（所用知识点）</li><li>小技巧积累总结</li></ul><h2 id="项目完成的功能预览"><a href="#项目完成的功能预览" class="headerlink" title="项目完成的功能预览"></a>项目完成的功能预览</h2><p>首先，我们来通过一个视频来快速预览下项目完成的功能和运行效果，如下</p><video id="flutter" class="video-js vjs-default-skin" controls preload="auto" poster="https://cdn.lishaoy.net/ctrip/ctripV.png" data-setup="{'example_option':true}">    <source src="https://cdn.lishaoy.net/flutterCtrip/ctrip.mp4" type="video/mp4"></video><div class="note warning"><p><i class="fa fa-fw fa-bell  faa-horizontal animated faa-slow" style="color: #faab33;"></i> 如视频播放失败， <a href="https://www.bilibili.com/video/BV16p4y1Q71f/" target="_blank" rel="noopener">请移步这里点击观看</a> （可点击齿轮设置隐藏黑边）</p></div><p><br>大家看完视频，大概了解到，完成度基本可以和线上的 <strong>App</strong> 相差无异了，大家如果对项目感兴趣，想了解具体怎么实现的，可以去我的 <a href="https://github.com/persilee" target="_blank" rel="noopener">GitHub</a> clone 源码查看。</p><p>也可扫描，安装体验：</p><div style="width:166px; margin:auto"><img src="https://www.pgyer.com/app/qrcode/HqqH" alt="no-shadow" title="手机扫描二维码安装"></div><p>本视频是用真机录屏的，因为，语音搜索功能需要录音，模拟器无法录音，当然, <code>iOS</code> 和 <code>Andorid</code>都可以运行，效果是一样的，如图：</p><p><img src="https://cdn.lishaoy.net/flutterCtrip/iOS-andorid.png" alt="no-shadow" title="iOS Andorid"></p><h2 id="项目结构分析"><a href="#项目结构分析" class="headerlink" title="项目结构分析"></a>项目结构分析</h2><p>其次，梳理下项目的目录结构，理解每个文件都是干什么的，我们先来看看一级目录，如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">├── README.md  <span class="comment"># 描述文件</span></span><br><span class="line">├── android    <span class="comment"># android 宿主环境</span></span><br><span class="line">├── build      <span class="comment"># 项目构建目录，由flutter自动完成</span></span><br><span class="line">├── flutter_ctrip.iml</span><br><span class="line">├── fonts      <span class="comment"># 自己创建的目录，用于存放字体</span></span><br><span class="line">├── images     <span class="comment"># 自己创建的目录，用于存放图片</span></span><br><span class="line">├── ios        <span class="comment"># iOS 宿主环境</span></span><br><span class="line">├── lib        <span class="comment"># flutter 执行文件，自己写的代码都在这</span></span><br><span class="line">├── pubspec.lock <span class="comment"># 用来记录锁定插件版本</span></span><br><span class="line">├── pubspec.yaml <span class="comment"># 插件及资源配置文件</span></span><br><span class="line">└── <span class="built_in">test</span>       <span class="comment"># 测试目录</span></span><br></pre></td></tr></table></figure><p>这个就不用多解释，大多是 flutter 生成及管理的，我们需要关注的是 <strong>lib</strong> 目录。</p><p>我们再来看看二级目录，如下 <em>(重点关注下lib目录)</em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">├── README.md</span><br><span class="line">├── android</span><br><span class="line">│   ├── android.iml</span><br><span class="line">  ...</span><br><span class="line">│   └── settings.gradle</span><br><span class="line">├── build</span><br><span class="line">│   ├── app</span><br><span class="line">  ...</span><br><span class="line">│   └── snapshot_blob.bin.d.fingerprint</span><br><span class="line">├── flutter_ctrip.iml</span><br><span class="line">├── fonts</span><br><span class="line">│   ├── PingFang-Italic.ttf</span><br><span class="line">│   ├── PingFang-Regular.ttf</span><br><span class="line">│   └── PingFang_Bold.ttf</span><br><span class="line">├── images</span><br><span class="line">│   ├── grid-nav-items-dingzhi.png</span><br><span class="line">  ...</span><br><span class="line">│   └── yuyin.png</span><br><span class="line">├── ios</span><br><span class="line">│   ├── Flutter</span><br><span class="line">  ...</span><br><span class="line">│   └── ServiceDefinitions.json</span><br><span class="line">├── lib</span><br><span class="line">│   ├── dao           <span class="comment"># 请求接口的类</span></span><br><span class="line">│   ├── main.dart     <span class="comment"># flutter 入口文件</span></span><br><span class="line">│   ├── model         <span class="comment"># 实体类，把服务器返回的 json 数据，转换成 dart 类</span></span><br><span class="line">│   ├── navigator     <span class="comment"># bottom bar 首页底部导航路由</span></span><br><span class="line">│   ├── pages         <span class="comment"># 所以的页面</span></span><br><span class="line">│   ├── plugin        <span class="comment"># 封装的插件</span></span><br><span class="line">│   ├── util          <span class="comment"># 工具类，避免重复代码，封装成工具类以便各个 page 调用</span></span><br><span class="line">│   └── widget        <span class="comment"># 封装的组件</span></span><br><span class="line">├── pubspec.lock</span><br><span class="line">├── pubspec.yaml</span><br><span class="line">└── <span class="built_in">test</span></span><br><span class="line">    └── widget_test.dart</span><br></pre></td></tr></table></figure><p>再来看看，<strong>lib</strong> 目录下二级目录，看看整个项目创建了多少个文件，写了多少代码，如下 <em>（其实，并不是很多）</em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">├── dao/</span><br><span class="line">│   ├── destination_dao.dart*</span><br><span class="line">│   ├── destination_search_dao.dart*</span><br><span class="line">│   ├── home_dao.dart</span><br><span class="line">│   ├── search_dao.dart*</span><br><span class="line">│   ├── trave_hot_keyword_dao.dart*</span><br><span class="line">│   ├── trave_search_dao.dart*</span><br><span class="line">│   ├── trave_search_hot_dao.dart*</span><br><span class="line">│   ├── travel_dao.dart*</span><br><span class="line">│   ├── travel_params_dao.dart*</span><br><span class="line">│   └── travel_tab_dao.dart*</span><br><span class="line">├── main.dart</span><br><span class="line">├── model/</span><br><span class="line">│   ├── common_model.dart</span><br><span class="line">│   ├── config_model.dart</span><br><span class="line">│   ├── destination_model.dart</span><br><span class="line">│   ├── destination_search_model.dart</span><br><span class="line">│   ├── grid_nav_model.dart</span><br><span class="line">│   ├── home_model.dart</span><br><span class="line">│   ├── sales_box_model.dart</span><br><span class="line">│   ├── seach_model.dart*</span><br><span class="line">│   ├── travel_hot_keyword_model.dart</span><br><span class="line">│   ├── travel_model.dart*</span><br><span class="line">│   ├── travel_params_model.dart*</span><br><span class="line">│   ├── travel_search_hot_model.dart</span><br><span class="line">│   ├── travel_search_model.dart</span><br><span class="line">│   └── travel_tab_model.dart</span><br><span class="line">├── navigator/</span><br><span class="line">│   └── tab_navigater.dart</span><br><span class="line">├── pages/</span><br><span class="line">│   ├── destination_page.dart</span><br><span class="line">│   ├── destination_search_page.dart</span><br><span class="line">│   ├── home_page.dart</span><br><span class="line">│   ├── my_page.dart</span><br><span class="line">│   ├── search_page.dart</span><br><span class="line">│   ├── speak_page.dart*</span><br><span class="line">│   ├── test_page.dart</span><br><span class="line">│   ├── travel_page.dart</span><br><span class="line">│   ├── travel_search_page.dart</span><br><span class="line">│   └── travel_tab_page.dart*</span><br><span class="line">├── plugin/</span><br><span class="line">│   ├── asr_manager.dart*</span><br><span class="line">│   ├── side_page_view.dart</span><br><span class="line">│   ├── square_swiper_pagination.dart</span><br><span class="line">│   └── vertical_tab_view.dart</span><br><span class="line">├── util/</span><br><span class="line">│   └── navigator_util.dart*</span><br><span class="line">└── widget/</span><br><span class="line">    ├── grid_nav.dart</span><br><span class="line">    ├── grid_nav_new.dart</span><br><span class="line">    ├── loading_container.dart</span><br><span class="line">    ├── local_nav.dart</span><br><span class="line">    ├── sales_box.dart</span><br><span class="line">    ├── scalable_box.dart</span><br><span class="line">    ├── search_bar.dart*</span><br><span class="line">    ├── sub_nav.dart</span><br><span class="line">    └── webview.dart</span><br></pre></td></tr></table></figure><p>整个项目就是以上这些文件了 <em>（具体的就不一个一个分析了，如，感兴趣，大家可以 clone 源码运行起来，自然就清除了）</em>。</p><h2 id="项目功能详细概述（所用知识点）"><a href="#项目功能详细概述（所用知识点）" class="headerlink" title="项目功能详细概述（所用知识点）"></a>项目功能详细概述（所用知识点）</h2><p>首先，来看看首页功能及所用知识点，首页重点看下以下功能实现：</p><ul><li>渐隐渐现的 <strong>appBar</strong> </li><li>搜索组件的封装</li><li>语音搜索页面</li><li>banner组件</li><li>浮动的 icon 导航</li><li>渐变不规则带有背景图的网格导航</li></ul><h3 id="渐隐渐现的-appBar"><a href="#渐隐渐现的-appBar" class="headerlink" title="渐隐渐现的 appBar"></a>渐隐渐现的 appBar</h3><p>先来看看具体效果，一睹芳容，如图：</p><div style="width:36%; margin:auto"><img src="https://cdn.lishaoy.net/flutterCtrip/appBar.gif" alt="no-shadow" title="appBar"></div><p>滚动的时候 <strong>appBar</strong> 背景色从透明变成白色或白色变成透明，这里主要用了 <strong>flutter</strong> 的 <code>NotificationListener</code> 组件，它会去监听组件树冒泡事件，当被它包裹的的组件<em>（子组件）</em> 发生变化时，<code>Notification</code> 回调函数会被触发，所以，通过它可以去监听页面的滚动，来动态改变 <strong>appBar</strong> 的透明度<em>（alpha）</em>，代码如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">NotificationListener(</span><br><span class="line">  onNotification: (scrollNotification) &#123;</span><br><span class="line">    <span class="keyword">if</span> (scrollNotification <span class="keyword">is</span> ScrollUpdateNotification &amp;&amp;</span><br><span class="line">        scrollNotification.depth == <span class="number">0</span>) &#123;</span><br><span class="line">      _onScroll(scrollNotification.metrics.pixels);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  child: ...</span><br></pre></td></tr></table></figure><div class="note warning"><p><i class="fa fa-fw fa-bell  faa-horizontal animated faa-slow" style="color: #faab33;"></i> <strong>Tips：</strong> <span class="label danger">scrollNotification.depth</span>的值 0 表示其子组件<em>(只监听子组件，不监听孙组件)</em>；<span class="label danger">scrollNotification is ScrollUpdateNotification</span>来判断组件是否已更新，<strong>ScrollUpdateNotification</strong> 是 notifications 的生命周期一种情况，分别有一下几种：</p><ul><li>ScrollStartNotification 组件开始滚动</li><li>ScrollUpdateNotification 组件位置已经发生改变</li><li>ScrollEndNotification 组件停止滚动</li><li>UserScrollNotification 不清楚</li></ul><p>这里，我们不探究太深入，如想了解可多查看源码。</p></div> <p><strong>_onScroll</strong> 方法代码如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> _onScroll(offset) &#123;</span><br><span class="line">  <span class="built_in">double</span> alpha = offset / APPBAR_SCROLL_OFFSET;  <span class="comment">// APPBAR_SCROLL_OFFSET 常量，值：100；offset 滚动的距离</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//把 alpha 值控制值 0-1 之间</span></span><br><span class="line">  <span class="keyword">if</span> (alpha &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    alpha = <span class="number">0</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (alpha &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    alpha = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  setState(() &#123;</span><br><span class="line">    appBarAlpha = alpha;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="built_in">print</span>(alpha);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="搜索组件的封装"><a href="#搜索组件的封装" class="headerlink" title="搜索组件的封装"></a>搜索组件的封装</h3><p>搜索组件效果如图：</p><div style="width:36%; margin:auto"><img src="https://cdn.lishaoy.net/flutterCtrip/searchBar.gif" alt="no-shadow" title="searchBar"></div><p>以下是首页调用 <code>searchBar</code> 的代码：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SearchBar(</span><br><span class="line">  searchBarType: appBarAlpha &gt; <span class="number">0.2</span>  <span class="comment">//searchBar 的类：暗色、亮色</span></span><br><span class="line">      ? SearchBarType.homeLight</span><br><span class="line">      : SearchBarType.home,</span><br><span class="line">  inputBoxClick: _jumpToSearch,     <span class="comment">//点击回调函数</span></span><br><span class="line">  defaultText: SEARCH_BAR_DEFAULT_TEXT,   <span class="comment">// 提示文字</span></span><br><span class="line">  leftButtonClick: () &#123;&#125;,           <span class="comment">//左边边按钮点击回调函数</span></span><br><span class="line">  speakClick: _jumpToSpeak,         <span class="comment">//点击话筒回调函数</span></span><br><span class="line">  rightButtonClick: _jumpToUser,    <span class="comment">//右边边按钮点击回调函数</span></span><br><span class="line">),</span><br></pre></td></tr></table></figure><p>其实就是用 <code>TextField</code> 组件，再加一些样式，需要注意点是：<strong>onChanged</strong>，他是 <strong>TextField</strong> 用来监听文本框是否变化，通过它我们来监听用户输入，来请求接口数据;具体的实现细节，请查阅源码： <a href="https://github.com/persilee/flutter_ctrip/blob/master/lib/widget/search_bar.dart" target="_blank" rel="noopener">点击查看searchBar源码</a></p><h3 id="语音搜索页面"><a href="#语音搜索页面" class="headerlink" title="语音搜索页面"></a>语音搜索页面</h3><p>语音搜索页面效果如图：由于模拟器无法录音，所以无法展示正常流程，如果录音识别成功后会返回搜索页面，在项目预览视频中可以看到正常流程。</p><div style="width:36%; margin:auto"><img src="https://cdn.lishaoy.net/flutterCtrip/speak.gif" alt="no-shadow" title="speak"></div><p>语音搜索功能使用的是百度的语言识别SDK，原生接入之后，通过 <strong>MethodChannel</strong> 和原生Native端通信，这里不做重点讲述（这里会涉及原生Native的知识）。</p><p>重点看看点击录音按钮时的动画实现，这个动画用了 <strong>AnimatedWidget</strong> 实现的，代码如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnimatedWear</span> <span class="keyword">extends</span> <span class="title">AnimatedWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">bool</span> isStart;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> _opacityTween = Tween&lt;<span class="built_in">double</span>&gt;(begin: <span class="number">0.5</span>, end: <span class="number">0</span>); <span class="comment">// 设置透明度变化值</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> _sizeTween = Tween&lt;<span class="built_in">double</span>&gt;(begin: <span class="number">90</span>, end: <span class="number">260</span>);   <span class="comment">// 设置圆形线的扩散值</span></span><br><span class="line"></span><br><span class="line">  AnimatedWear(&#123;Key key, <span class="keyword">this</span>.isStart, Animation&lt;<span class="built_in">double</span>&gt; animation&#125;)</span><br><span class="line">      : <span class="keyword">super</span>(key: key, listenable: animation);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">final</span> Animation&lt;<span class="built_in">double</span>&gt; animation = listenable;  <span class="comment">// listenable 继承 AnimatedWidget，其实就是控制器，会自动监听组件的变化</span></span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      height: <span class="number">90</span>,</span><br><span class="line">      width: <span class="number">90</span>,</span><br><span class="line">      child: Stack(</span><br><span class="line">        overflow: Overflow.visible,</span><br><span class="line">        alignment: Alignment.center,</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">          ...</span><br><span class="line">          <span class="comment">// 扩散的圆线，其实就是用一个圆实现的，设置圆为透明，设置border</span></span><br><span class="line">          Positioned(</span><br><span class="line">            left: -((_sizeTween.evaluate(animation) - <span class="number">90</span>) / <span class="number">2</span>), <span class="comment">// 根据 _sizeTween 动态设置left偏移值</span></span><br><span class="line">            top: -((_sizeTween.evaluate(animation) - <span class="number">90</span>) / <span class="number">2</span>), <span class="comment">//  根据 _sizeTween 动态设置top偏移值</span></span><br><span class="line">            child: Opacity(</span><br><span class="line">              opacity: _opacityTween.evaluate(animation),      <span class="comment">// 根据 _opacityTween 动态设置透明值</span></span><br><span class="line">              child: Container(</span><br><span class="line">                width: isStart ? _sizeTween.evaluate(animation) : <span class="number">0</span>, <span class="comment">// 设置 宽</span></span><br><span class="line">                height: _sizeTween.evaluate(animation),              <span class="comment">// 设置 高</span></span><br><span class="line">                decoration: BoxDecoration(</span><br><span class="line">                    color: Colors.transparent,</span><br><span class="line">                    borderRadius: BorderRadius.circular(</span><br><span class="line">                        _sizeTween.evaluate(animation) / <span class="number">2</span>),</span><br><span class="line">                    border: Border.all(</span><br><span class="line">                      color: Color(<span class="number">0xa8000000</span>),</span><br><span class="line">                    )),</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其他细节，如：点击时提示录音，录音失败提示，点击录音按钮出现半透明黑色圆边框，停止后消失等，<a href="https://github.com/persilee/flutter_ctrip/blob/master/lib/pages/speak_page.dart" target="_blank" rel="noopener">请查看源码</a>。</p><h3 id="banner组件"><a href="#banner组件" class="headerlink" title="banner组件"></a>banner组件</h3><p>效果如图：</p><div style="width:36%; margin:auto"><img src="https://cdn.lishaoy.net/flutterCtrip/banner.gif" alt="no-shadow" title="banner"></div><p><code>banner</code>使用的是flutter的 <a href="https://pub.dev/packages/flutter_swiper" target="_blank" rel="noopener">flutter_swiper</a> 插件实现的，代码如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">Swiper(</span><br><span class="line">  itemCount: bannerList.length,              <span class="comment">// 滚动图片的数量</span></span><br><span class="line">  autoplay: <span class="keyword">true</span>,                            <span class="comment">// 自动播放</span></span><br><span class="line">  pagination: SwiperPagination(              <span class="comment">// 指示器</span></span><br><span class="line">      builder: SquareSwiperPagination(</span><br><span class="line">        size: <span class="number">6</span>,                             <span class="comment">// 指示器的大小</span></span><br><span class="line">        activeSize: <span class="number">6</span>,                       <span class="comment">// 激活状态指示器的大小</span></span><br><span class="line">        color: Colors.white.withAlpha(<span class="number">80</span>),   <span class="comment">// 颜色</span></span><br><span class="line">        activeColor: Colors.white,           <span class="comment">// 激活状态的颜色</span></span><br><span class="line">      ),</span><br><span class="line">    alignment: Alignment.bottomRight,        <span class="comment">// 对齐方式</span></span><br><span class="line">    margin: EdgeInsets.fromLTRB(<span class="number">0</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">28</span>), <span class="comment">// 边距</span></span><br><span class="line">  ),</span><br><span class="line">  itemBuilder: (BuildContext context, <span class="built_in">int</span> index) &#123; <span class="comment">// 构造器</span></span><br><span class="line">    <span class="keyword">return</span> GestureDetector(</span><br><span class="line">      onTap: () &#123;</span><br><span class="line">        CommonModel model = bannerList[index];</span><br><span class="line">        Navigator.push(</span><br><span class="line">          context,</span><br><span class="line">          MaterialPageRoute(</span><br><span class="line">            builder: (context) =&gt; WebView(</span><br><span class="line">              url: model.url,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">      child: Image.network(</span><br><span class="line">        bannerList[index].icon,</span><br><span class="line">        fit: BoxFit.fill,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;,</span><br><span class="line">),</span><br></pre></td></tr></table></figure><p>具体使用方法，可以去 flutter的官方插件库 <a href="https://pub.dev/" target="_blank" rel="noopener">pub.dev</a> 查看：<a href="https://pub.dev/packages/flutter_swiper" target="_blank" rel="noopener">点击flutter_swiper查看</a>。<div class="note warning"><p><i class="fa fa-fw fa-bell  faa-horizontal animated faa-slow" style="color: #faab33;"></i> <strong>Tips：</strong> 需要注意的是，我稍改造了一下指示器的样式，<code>flutter_swiper</code> 只提供了 3 种指示器样式，如下：</p><ul><li>dots = const DotSwiperPaginationBuilder()，圆形</li><li>fraction = const FractionPaginationBuilder()，百分数类型的,如：1/6，表示6页的第一页</li><li>rect = const RectSwiperPaginationBuilder()，矩形</li></ul><p>并没有上图的激活状态的长椭圆形，其实就是按葫芦画瓢，自己实现一个长椭圆类型，如知详情，可<a href="https://github.com/persilee/flutter_ctrip/blob/master/lib/plugin/square_swiper_pagination.dart" target="_blank" rel="noopener">点击查看长椭圆形指示器源码</a></p></div> </p><h3 id="浮动的-icon-导航"><a href="#浮动的-icon-导航" class="headerlink" title="浮动的 icon 导航"></a>浮动的 icon 导航</h3><p><strong>icon导航</strong>效果如图：</p><p><img src="https://cdn.lishaoy.net/flutterCtrip/iconBar.png" alt="iconBar" width="36%" title="iconBar" align="center"></p><p><strong>icon导航</strong>浮动在banner之上，其实用的是 <code>flutter</code> 的 <strong>Stack</strong> 组件，Stack 组件能让其子组件堆叠显示，它通常和 <strong>Positioned</strong> 组件配合使用，布局结构代码如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ListView(</span><br><span class="line">  children: &lt;Widget&gt;[</span><br><span class="line">    Container(</span><br><span class="line">      child: Stack(</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">          Container( ... ), <span class="comment">//这里放的是banner的代码</span></span><br><span class="line">          Positioned( ... ), <span class="comment">//这个就是icon导航，通过 Positioned 固定显示位置</span></span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    ),</span><br><span class="line">    Container( ... ), <span class="comment">// 这里放的网格导航及其他</span></span><br><span class="line">  ],</span><br><span class="line">),</span><br></pre></td></tr></table></figure><h3 id="渐变不规则带有背景图的网格导航"><a href="#渐变不规则带有背景图的网格导航" class="headerlink" title="渐变不规则带有背景图的网格导航"></a>渐变不规则带有背景图的网格导航</h3><p>网格导航效果如图：</p><p><img src="https://cdn.lishaoy.net/flutterCtrip/gridNav.png" alt="gridNav" width="46%" title="gridNav" align="center"></p><p>如图，网格导航分为三行四栏，而第一行分为三栏，每一行的第一栏宽度大于其余三栏，其余三栏均等，每一行都有渐变色，而且第一、二栏都有背景图;<code>flutter</code> 里 <strong>Column</strong> 组件能让子组件竖轴排列， <strong>Row</strong> 组件能让子组件横轴排列，布局代码如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">Column(                      <span class="comment">// 最外面放在 Column 组件</span></span><br><span class="line">  children: &lt;Widget&gt;[</span><br><span class="line">    Container(               <span class="comment">// 第一行包裹 Container 设置其渐变色</span></span><br><span class="line">      height: <span class="number">72</span>,</span><br><span class="line">      decoration: BoxDecoration(</span><br><span class="line">        gradient: LinearGradient(colors: [  <span class="comment">//设置渐变色</span></span><br><span class="line">          Color(<span class="number">0xfffa5956</span>),</span><br><span class="line">          Color(<span class="number">0xffef9c76</span>).withAlpha(<span class="number">45</span>)</span><br><span class="line">        ]),</span><br><span class="line">      ),</span><br><span class="line">      child: Row( ... ),    <span class="comment">// 第一行</span></span><br><span class="line">    ),</span><br><span class="line">    Padding(</span><br><span class="line">      padding: EdgeInsets.only(top: <span class="number">1</span>),  <span class="comment">// 设置行直接的间隔</span></span><br><span class="line">    ),</span><br><span class="line">    Container(</span><br><span class="line">      height: <span class="number">72</span>,</span><br><span class="line">      decoration: BoxDecoration(</span><br><span class="line">        gradient: LinearGradient(colors: [  <span class="comment">//设置渐变色</span></span><br><span class="line">          Color(<span class="number">0xff4b8fed</span>),</span><br><span class="line">          Color(<span class="number">0xff53bced</span>),</span><br><span class="line">        ]),</span><br><span class="line">      ),</span><br><span class="line">      child: Row( ... ),  <span class="comment">// 第二行</span></span><br><span class="line">    ),</span><br><span class="line">    Padding(</span><br><span class="line">      padding: EdgeInsets.only(top: <span class="number">1</span>),   <span class="comment">// 设置行直接的间隔</span></span><br><span class="line">    ),</span><br><span class="line">    Container(</span><br><span class="line">      height: <span class="number">72</span>,</span><br><span class="line">      decoration: BoxDecoration(</span><br><span class="line">        gradient: LinearGradient(colors: [  <span class="comment">//设置渐变色</span></span><br><span class="line">          Color(<span class="number">0xff34c2aa</span>),</span><br><span class="line">          Color(<span class="number">0xff6cd557</span>),</span><br><span class="line">        ]),</span><br><span class="line">      ),</span><br><span class="line">      child: Row( ... ),  <span class="comment">// 第三行</span></span><br><span class="line">    ),</span><br><span class="line">  ],</span><br><span class="line">),</span><br></pre></td></tr></table></figure><p>其实，具体实现的细节还是很多的，比如：</p><ul><li>怎么设置第一栏宽度偏大，其他均等；</li><li>第一行最后一栏宽度是其他的2倍；</li><li>第一、二栏的背景图及浮动的红色气泡tip等;</li></ul><p>在这里就不细讲，否则篇幅太长，如想了解详情 <a href="https://github.com/persilee/flutter_ctrip/blob/master/lib/widget/grid_nav_new.dart" target="_blank" rel="noopener">点击查看源码</a></p><p>其次，再来看看<strong>目的地</strong>页面功能及所用知识点，重点看下以下功能实现：</p><ul><li>左右布局tabBarListView </li><li>目的地搜索页面</li></ul><h3 id="左右布局tabBarListView"><a href="#左右布局tabBarListView" class="headerlink" title="左右布局tabBarListView"></a>左右布局tabBarListView</h3><p>具体效果如图：点击左边标签可以切换页面，左右滑动也可切换页面，点击展开显示更多等</p><div style="width:36%; margin:auto"><img src="https://cdn.lishaoy.net/flutterCtrip/destination.gif" alt="no-shadow" title="destination"></div><p>其实官方已经提供了 <strong>tabBar</strong> 和 <strong>TabBarView</strong> 组件可以实现上下布局的效果<em>(旅拍页面就是用这个实现的)</em>，但是它无法实现左右布局，而且不太灵活，所以，我使用的是 <a href="https://pub.dev/packages/vertical_tabs" target="_blank" rel="noopener">vertical_tabs</a>插件, 代码如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">VerticalTabView(</span><br><span class="line">    tabsWidth: <span class="number">88</span>,</span><br><span class="line">    tabsElevation: <span class="number">0</span>,</span><br><span class="line">    indicatorWidth: <span class="number">0</span>,</span><br><span class="line">    selectedTabBackgroundColor: Colors.white,</span><br><span class="line">    backgroundColor: Colors.white,</span><br><span class="line">    tabTextStyle: TextStyle(</span><br><span class="line">      height: <span class="number">60</span>,</span><br><span class="line">      color: Color(<span class="number">0xff333333</span>),</span><br><span class="line">    ),</span><br><span class="line">    tabs: tabs,</span><br><span class="line">    contents: tabPages,</span><br><span class="line">  ),</span><br><span class="line">),</span><br></pre></td></tr></table></figure><p>具体使用方法，在这里就不赘述了，<a href="https://pub.dev/packages/vertical_tabs" target="_blank" rel="noopener">点击vertical_tabs查看</a></p><div class="note warning"><p><i class="fa fa-fw fa-bell  faa-horizontal animated faa-slow" style="color: #faab33;"></i> <strong>Tips：</strong> 这里需要注意的是：<strong>展开</strong>显示更多span标签组件的实现，因为，这个组件在很多的其他组件里用到而且要根据接口数据动态渲染，且组件自身存在状态的变化，这种情况下，最好是把他单独封装成一个组件<em>(widget)</em>，否则，很难控制自身状态的变化，出现点击没有效果，或点击影响其他组件。 </p></div> <h3 id="目的地搜索页面"><a href="#目的地搜索页面" class="headerlink" title="目的地搜索页面"></a>目的地搜索页面</h3><p>效果如图：点击搜索结果，如：点击‘一日游‘，会搜索到‘一日游‘的相关数据</p><div style="width:36%; margin:auto"><img src="https://cdn.lishaoy.net/flutterCtrip/destination-search.gif" alt="no-shadow" title="destination"></div><p>目的地搜索页面，大多都是和布局和对接接口的代码，在这里就不再赘述。</p><p>然后就是<strong>旅拍页面</strong>功能及所用知识点，重点看下以下功能实现：</p><ul><li>左右布局tabBarListView</li><li>瀑布流卡片</li><li>旅拍搜索页</li></ul><h3 id="左右布局tabBarListView-1"><a href="#左右布局tabBarListView-1" class="headerlink" title="左右布局tabBarListView"></a>左右布局tabBarListView</h3><p>效果如图：可左右滑动切换页面，上拉加载更多，下拉刷新等</p><div style="width:36%; margin:auto"><img src="https://cdn.lishaoy.net/flutterCtrip/travel.gif" alt="no-shadow" title="travel"></div><p>这个是<code>flutter</code> 提供的组件，<strong>tabBar</strong> 和 <strong>TabBarView</strong>，代码如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Container(</span><br><span class="line">  color: Colors.white,</span><br><span class="line">  padding: EdgeInsets.only(left: <span class="number">2</span>),</span><br><span class="line">  child: TabBar(</span><br><span class="line">    controller: _controller,</span><br><span class="line">    isScrollable: <span class="keyword">true</span>,</span><br><span class="line">    labelColor: Colors.black,</span><br><span class="line">    labelPadding: EdgeInsets.fromLTRB(<span class="number">8</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">0</span>),</span><br><span class="line">    indicatorColor: Color(<span class="number">0xff2FCFBB</span>),</span><br><span class="line">    indicatorPadding: EdgeInsets.all(<span class="number">6</span>),</span><br><span class="line">    indicatorSize: TabBarIndicatorSize.label,</span><br><span class="line">    indicatorWeight: <span class="number">2.2</span>,</span><br><span class="line">    labelStyle: TextStyle(fontSize: <span class="number">18</span>),</span><br><span class="line">    unselectedLabelStyle: TextStyle(fontSize: <span class="number">15</span>),</span><br><span class="line">    tabs: tabs.map&lt;Tab&gt;((Groups tab) &#123;</span><br><span class="line">      <span class="keyword">return</span> Tab(</span><br><span class="line">        text: tab.name,</span><br><span class="line">      );</span><br><span class="line">    &#125;).toList(),</span><br><span class="line">  ),</span><br><span class="line">),</span><br><span class="line">Flexible(</span><br><span class="line">    child: Container(</span><br><span class="line">  padding: EdgeInsets.fromLTRB(<span class="number">6</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">0</span>),</span><br><span class="line">  child: TabBarView(</span><br><span class="line">      controller: _controller,</span><br><span class="line">      children: tabs.map((Groups tab) &#123;</span><br><span class="line">        <span class="keyword">return</span> TravelTabPage(</span><br><span class="line">          travelUrl: travelParamsModel?.url,</span><br><span class="line">          params: travelParamsModel?.params,</span><br><span class="line">          groupChannelCode: tab?.code,</span><br><span class="line">        );</span><br><span class="line">      &#125;).toList()),</span><br><span class="line">)),</span><br></pre></td></tr></table></figure><h3 id="瀑布流卡片"><a href="#瀑布流卡片" class="headerlink" title="瀑布流卡片"></a>瀑布流卡片</h3><p><strong>瀑布流卡片</strong> 用的是 <a href="https://pub.dev/packages/flutter_staggered_grid_view" target="_blank" rel="noopener">flutter_staggered_grid_view</a> 插件，代码如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">StaggeredGridView.countBuilder(</span><br><span class="line">  controller: _scrollController,</span><br><span class="line">  crossAxisCount: <span class="number">4</span>,</span><br><span class="line">  itemCount: travelItems?.length ?? <span class="number">0</span>,</span><br><span class="line">  itemBuilder: (BuildContext context, <span class="built_in">int</span> index) =&gt; _TravelItem(</span><br><span class="line">        index: index,</span><br><span class="line">        item: travelItems[index],</span><br><span class="line">      ),</span><br><span class="line">  staggeredTileBuilder: (<span class="built_in">int</span> index) =&gt; <span class="keyword">new</span> StaggeredTile.fit(<span class="number">2</span>),</span><br><span class="line">  mainAxisSpacing: <span class="number">2.0</span>,</span><br><span class="line">  crossAxisSpacing: <span class="number">2.0</span>,</span><br><span class="line">),</span><br></pre></td></tr></table></figure><p>如下了解更多相关信息，<a href="https://pub.dev/packages/flutter_staggered_grid_view" target="_blank" rel="noopener">点击flutter_staggered_grid_view查看</a>。</p><h3 id="旅拍搜索页"><a href="#旅拍搜索页" class="headerlink" title="旅拍搜索页"></a>旅拍搜索页</h3><p>效果如图：首先显示热门旅拍标签，点击可搜索相关内容，输入关键字可搜索相关旅拍信息，地点、景点、用户等</p><div style="width:36%; margin:auto"><img src="https://cdn.lishaoy.net/flutterCtrip/travel-search.gif" alt="no-shadow" title="travel-search"></div><p>旅拍搜索页，大多也是和布局和对接接口的代码，在这里就不再赘述。</p><h2 id="小技巧积累总结"><a href="#小技巧积累总结" class="headerlink" title="小技巧积累总结"></a>小技巧积累总结</h2><p>以下都是我在项目里使用的知识点，在这里记录分享出来，希望能帮到大家。</p><h3 id="PhysicalModel"><a href="#PhysicalModel" class="headerlink" title="PhysicalModel"></a>PhysicalModel</h3><p><strong>PhysicalModel</strong> 可以裁剪带背景图的容器，如，你在一个 Container 里放了一张图片，想设置图片圆角，设置 Container 的 decoration 的 borderRadius 是无效的，这时候就要用到 <strong>PhysicalModel</strong>，代码如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PhysicalModel(</span><br><span class="line">  borderRadius: BorderRadius.circular(<span class="number">6</span>),  <span class="comment">// 设置圆角</span></span><br><span class="line">  clipBehavior: Clip.antiAlias,            <span class="comment">// 裁剪行为</span></span><br><span class="line">  color: Colors.transparent,               <span class="comment">// 颜色</span></span><br><span class="line">  elevation: <span class="number">5</span>,                            <span class="comment">// 设置阴影</span></span><br><span class="line">  child: Container(</span><br><span class="line">        child: Image.network(</span><br><span class="line">          picUrl,</span><br><span class="line">          fit: BoxFit.cover,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">),</span><br></pre></td></tr></table></figure><h3 id="LinearGradient"><a href="#LinearGradient" class="headerlink" title="LinearGradient"></a>LinearGradient</h3><p>给容器添加渐变色，在网格导航、appBar等地方都使用到，代码如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Container(</span><br><span class="line">  height: <span class="number">72</span>,</span><br><span class="line">  decoration: BoxDecoration(</span><br><span class="line">    gradient: LinearGradient(colors: [</span><br><span class="line">      Color(<span class="number">0xff4b8fed</span>),</span><br><span class="line">      Color(<span class="number">0xff53bced</span>),</span><br><span class="line">    ]),</span><br><span class="line">  ),</span><br><span class="line">  child: ...</span><br><span class="line">),</span><br></pre></td></tr></table></figure><h3 id="Color-int-parse-‘0xff’-gridNavItem-startColor"><a href="#Color-int-parse-‘0xff’-gridNavItem-startColor" class="headerlink" title="Color(int.parse(‘0xff’ + gridNavItem.startColor))"></a>Color(int.parse(‘0xff’ + gridNavItem.startColor))</h3><p>颜色值转换成颜色，如果，没有变量的话，也可直接这样用 <code>Color(0xff53bced)</code>，</p><ul><li>ox：flutter要求，可固定不变</li><li>ff：代表透明度，不知道如何设置的话，可以用取色器，或者 withOpacity(opacity) 、 withAlpha(a)</li><li>53bced: 常规的6位RGB值</li></ul><h3 id="Expanded、FractionallySizedBox"><a href="#Expanded、FractionallySizedBox" class="headerlink" title="Expanded、FractionallySizedBox"></a>Expanded、FractionallySizedBox</h3><p><strong>Expanded</strong> 可以让子组件撑满父容器，通常和 <strong>Row</strong> 及 <strong>Column</strong> 组件搭配使用；<br><strong>FractionallySizedBox</strong> 可以让子组件撑满或超出父容器，可以单独使用，大小受 widthFactor 和 heightFactor 宽高因子的影响</p><h3 id="MediaQuery-removePadding"><a href="#MediaQuery-removePadding" class="headerlink" title="MediaQuery.removePadding"></a>MediaQuery.removePadding</h3><p><strong>MediaQuery.removePadding</strong> 可以移除组件的边距，有些组件自带有边距，有时候布局的时候，不需要边距，这时候就可以用 <strong>MediaQuery.removePadding</strong>，代码如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MediaQuery.removePadding(</span><br><span class="line">  removeTop: <span class="keyword">true</span>,</span><br><span class="line">  context: context,</span><br><span class="line">  child: ...</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="MediaQuery-of-context-size-width"><a href="#MediaQuery-of-context-size-width" class="headerlink" title="MediaQuery.of(context).size.width"></a>MediaQuery.of(context).size.width</h3><p><strong>MediaQuery.of(context).size.width</strong> 获取屏幕的宽度，同理，<strong>MediaQuery.of(context).size.height</strong> 获取屏幕的高度；如，想一行平均3等分： 0.3 * MediaQuery.of(context).size.width，在<strong>目的地页面</strong>的标签组件就使用到它，代码如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Container(</span><br><span class="line">  alignment: Alignment.center,</span><br><span class="line">  ...</span><br><span class="line">  width: <span class="number">0.3</span>*MediaQuery.of(context).size.width - <span class="number">12</span>, <span class="comment">// 屏幕平分三等分， - 12 是给每份中间留出空间 </span></span><br><span class="line">  height: <span class="number">40</span>,</span><br><span class="line">  ...</span><br><span class="line">  child: ...</span><br><span class="line">),</span><br></pre></td></tr></table></figure><h3 id="Theme-of-context-platform-TargetPlatform-iOS"><a href="#Theme-of-context-platform-TargetPlatform-iOS" class="headerlink" title="Theme.of(context).platform == TargetPlatform.iOS"></a>Theme.of(context).platform == TargetPlatform.iOS</h3><p>判断操作系统类型，有时候可能有给 Andorid 和 iOS 做出不同的布局，就需要用到它。</p><h3 id="with-AutomaticKeepAliveClientMixin"><a href="#with-AutomaticKeepAliveClientMixin" class="headerlink" title="with AutomaticKeepAliveClientMixin"></a>with AutomaticKeepAliveClientMixin</h3><p><code>flutter</code> 在切换页面时候每次都会重新加载数据，如果想让页面保留状态，不重新加载，就需要使用 <strong>AutomaticKeepAliveClientMixin</strong>,代码如下：<em>（在旅拍页面就有使用到它，为了让tabBar 和 tabBarView在切换时不重新加载）</em></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TravelTabPage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">//需要重写 wantKeepAlive 且 设置成 true</span></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">bool</span> <span class="keyword">get</span> wantKeepAlive =&gt; <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="with-SingleTickerProviderStateMixin"><a href="#with-SingleTickerProviderStateMixin" class="headerlink" title="with SingleTickerProviderStateMixin"></a>with SingleTickerProviderStateMixin</h3><p>混入 <code>SingleTickerProviderStateMixin</code> 可以在切换页面时候，使用动画效果，如：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">bottomNavigationBar: BottomNavigationBar(</span><br><span class="line">          currentIndex: _currentIndex,</span><br><span class="line">          onTap: (index) &#123;</span><br><span class="line">            _controller.animateToPage( <span class="comment">// _controller 是 PageView 的 PageController</span></span><br><span class="line">                index,</span><br><span class="line">                curve: Curves.easeIn, duration: <span class="built_in">Duration</span>(milliseconds: <span class="number">260</span>)</span><br><span class="line">            );</span><br><span class="line">            setState(() &#123;</span><br><span class="line">              _currentIndex = index;</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;,</span><br><span class="line">          ...</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="SystemUiOverlayStyle"><a href="#SystemUiOverlayStyle" class="headerlink" title="SystemUiOverlayStyle"></a>SystemUiOverlayStyle</h3><p><code>SystemUiOverlayStyle</code> 可实现状态栏沉浸式，设置全局配置，如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main() =&gt; runApp(MyApp());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    TextStyle textStyle = TextStyle(fontSize: <span class="number">20</span>);</span><br><span class="line">    SystemUiOverlayStyle style = SystemUiOverlayStyle(</span><br><span class="line">        statusBarColor: Colors.transparent,</span><br><span class="line">        statusBarIconBrightness: Brightness.light</span><br><span class="line">    );</span><br><span class="line">    SystemChrome.setSystemUIOverlayStyle(style);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>单页面设置如下：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_HomePageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">HomePage</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    SystemChrome.setSystemUIOverlayStyle(SystemUiOverlayStyle.light); <span class="comment">//设置状态栏沉浸式</span></span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      backgroundColor: Color(<span class="number">0xfffafafc</span>),</span><br><span class="line">      body: LoadingContainer(</span><br><span class="line">        ...</span><br><span class="line">      )</span><br><span class="line">      ...</span><br></pre></td></tr></table></figure><p>暂时只能想到这些常用的知识点，以后如有新的会慢慢补充。</p><p><strong>项目GitHub地址:</strong> <a href="https://github.com/persilee/flutter_ctrip" target="_blank" rel="noopener">https://github.com/persilee/flutter_ctrip</a></p>]]></content:encoded>
      
      <comments>https://h.lishaoy.net/flutterCtrip.html#disqus_thread</comments>
    </item>
    
    <item>
      <title>三招让你成为程序猿中优秀的射鸡湿</title>
      <link>https://h.lishaoy.net/goodDesigner.html</link>
      <guid>https://h.lishaoy.net/goodDesigner.html</guid>
      <pubDate>Fri, 01 Mar 2019 08:24:32 GMT</pubDate>
      <description>
      
        &lt;span itemprop=&quot;image&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/ImageObject&quot;&gt;&lt;img itemprop=&quot;url image&quot; src=&quot;/images/loading.gif&quot; data-original=&quot;https://cdn.lishaoy.net/goodDesigner/goodDesigner.jpg&quot; class=&quot;full-image&quot; alt=&quot;goodDesigner&quot; title=&quot;goodDesigner&quot;&gt;&lt;meta itemprop=&quot;width&quot; content=&quot;auto&quot;&gt;&lt;meta itemprop=&quot;height&quot; content=&quot;auto&quot;&gt;&lt;/span&gt;
&lt;p&gt;这篇文章总结一下之前项目中一些 &lt;strong&gt;前端&lt;/strong&gt; 工具及技巧，主要包括 &lt;strong&gt;Iconfont的正确使用姿势&lt;/strong&gt; 、 &lt;strong&gt;如何使用酷炫漂亮的动画（Lottie）&lt;/strong&gt; 、 &lt;strong&gt;如何加入页面滚动入场离场动效&lt;/strong&gt;。&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="/images/loading.gif" data-original="https://cdn.lishaoy.net/goodDesigner/goodDesigner.jpg" class="full-image" alt="goodDesigner" title="goodDesigner"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><p>这篇文章总结一下之前项目中一些 <strong>前端</strong> 工具及技巧，主要包括 <strong>Iconfont的正确使用姿势</strong> 、 <strong>如何使用酷炫漂亮的动画（Lottie）</strong> 、 <strong>如何加入页面滚动入场离场动效</strong>。</p><a id="more"></a><h2 id="Iconfont的正确使用姿势"><a href="#Iconfont的正确使用姿势" class="headerlink" title="Iconfont的正确使用姿势"></a>Iconfont的正确使用姿势</h2><p><a href="https://www.iconfont.cn" target="_blank" rel="noopener">Iconfont</a> 是阿里巴巴打造的矢量图标库，图标丰富多彩（单色和彩色），使用方便快捷（可筛选图片创建自己项目图标库），支持在线使用，摆脱了传统的图片的繁琐和css字体图标库引入的冗余。</p><p>下面介绍下如何使用 Iconfont</p><h3 id="搜索选择图标"><a href="#搜索选择图标" class="headerlink" title="搜索选择图标"></a>搜索选择图标</h3><p>点击 <a href="https://www.iconfont.cn" target="_blank" rel="noopener">Iconfont</a> 打开页面如图，可以搜索 🔍 关键字，找到想要的图标</p><p><img src="https://cdn.lishaoy.net/goodDesigner/Iconfont.png" alt="Iconfont" title="Iconfont"></p><p>例如，搜索 ‘image’ 关键字，如图</p><p><img src="https://cdn.lishaoy.net/goodDesigner/Iconfont2.png" alt="Iconfont" title="Iconfont"></p><p>鼠标放到图标上会出现 <strong>添加入库</strong> 、 <strong>收藏</strong> 、 <strong>下载图标</strong> 选项，一般我会选择 <strong>添加入库</strong> ，之后统一添加到项目，生成在线地址引入项目（后面会介绍到）</p><p>右边的蓝色皇冠按钮可以进行 <em>精选</em> 、 <em>全部</em> 的筛选，红色的按钮可以进行 <em>单色</em> 、 <em>多色</em> 、 <em>全部</em> 的筛选</p><p>点击 下载 会弹出下载页面，可以进行图标的编辑和不同格式的下载，如图</p><p><img src="https://cdn.lishaoy.net/goodDesigner/Iconfont3.1.png" alt="Iconfont" title="Iconfont"></p><h3 id="添加入库生成在线连接"><a href="#添加入库生成在线连接" class="headerlink" title="添加入库生成在线连接"></a>添加入库生成在线连接</h3><p>选择 <strong>添加入库</strong> 的图标，会在右上角的购物车显示数量，点击购物车图标，会弹出右侧栏，如图</p><p><img src="https://cdn.lishaoy.net/goodDesigner/Iconfont4.png" alt="Iconfont" title="Iconfont"></p><p>可以批量下载和添加到项目，点击 <strong>添加至项目</strong> 如图</p><p><img src="https://cdn.lishaoy.net/goodDesigner/Iconfont5.png" alt="Iconfont" title="Iconfont"></p><p>给项目取一个名字，点击确定，如图</p><p><img src="https://cdn.lishaoy.net/goodDesigner/Iconfont6.png" alt="Iconfont" title="Iconfont"></p><p>可以看到有三种图标引入的方式，默认选中的是 <strong>Font class</strong> 的方式，也推荐使用这种方式</p><p><strong>Unicode</strong> : 是以字体的方式引入，如下</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">font-face</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">'iconfont'</span>;  <span class="comment">/* project id 1066942 */</span></span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">'//at.alicdn.com/t/font_1066942_yvi703p2pv.eot'</span>);</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">'//at.alicdn.com/t/font_1066942_yvi703p2pv.eot?#iefix'</span>) <span class="built_in">format</span>(<span class="string">'embedded-opentype'</span>),</span><br><span class="line">  <span class="built_in">url</span>(<span class="string">'//at.alicdn.com/t/font_1066942_yvi703p2pv.woff2'</span>) <span class="built_in">format</span>(<span class="string">'woff2'</span>),</span><br><span class="line">  <span class="built_in">url</span>(<span class="string">'//at.alicdn.com/t/font_1066942_yvi703p2pv.woff'</span>) <span class="built_in">format</span>(<span class="string">'woff'</span>),</span><br><span class="line">  <span class="built_in">url</span>(<span class="string">'//at.alicdn.com/t/font_1066942_yvi703p2pv.ttf'</span>) <span class="built_in">format</span>(<span class="string">'truetype'</span>),</span><br><span class="line">  <span class="built_in">url</span>(<span class="string">'//at.alicdn.com/t/font_1066942_yvi703p2pv.svg#iconfont'</span>) <span class="built_in">format</span>(<span class="string">'svg'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Font class</strong> : 是以Css的方式引入，如下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//at.alicdn.com/t/font_1066942_yvi703p2pv.css</span><br></pre></td></tr></table></figure><p><strong>Symbol</strong> : 是以js的方式引入，如下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//at.alicdn.com/t/font_1066942_yvi703p2pv.js</span><br></pre></td></tr></table></figure><p>如想了解3中方式具体用法，可点击 <a href="https://www.iconfont.cn/help/detail?spm=a313x.7781069.1998910419.d8cf4382a&amp;helptype=code" target="_blank" rel="noopener">官方文档</a>，这里我主要介绍 <strong>Font class</strong> 的方式</p><h3 id="引入项目使用"><a href="#引入项目使用" class="headerlink" title="引入项目使用"></a>引入项目使用</h3><p>首先，把生成的链接引入到页面中，如下</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel="stylesheet" href="//at.alicdn.com/t/font_1066942_yvi703p2pv.css"&gt;</span><br></pre></td></tr></table></figure><p>其次，用 <code>&lt;i class=&quot;iconfont icon-Userselect&quot;&gt;&lt;/i&gt;</code> 在页面中使用，大小颜色都可以用 <code>css</code> 调整</p><p>阿里在代码的复制、图标的搜索、编辑、下载、筛选等一些操作上做的很到位，使用起来方便快捷</p><p>我在之前的项目里也使用过，还是很漂亮的 <a href="https://a.lishaoy.net" target="_blank" rel="noopener">https://a.lishaoy.net</a> ，如图是我在项目里使用的一些图标，每个图标是不是都做的很精致</p><p><img src="https://cdn.lishaoy.net/goodDesigner/Iconfont7.png" alt="Iconfont" title="Iconfont"></p><h2 id="Lottie开源动画库"><a href="#Lottie开源动画库" class="headerlink" title="Lottie开源动画库"></a>Lottie开源动画库</h2><p><strong>Lottie</strong> 是Airbnb开源的一个面向 iOS、Android、React Native 的动画库，能够直接把 <strong>AE</strong> 导出的动画文件（json），引入到页面使用，以下是官方给出的效果图</p><p><img src="https://cdn.lishaoy.net/goodDesigner/lottie.gif" alt="no-shadow" title="Lottie"></p><p><img src="https://cdn.lishaoy.net/goodDesigner/lottie2.gif" alt="no-shadow" title="Lottie"></p><p><strong>Lottie</strong> 支持 iOS、Android、React Native 、Web ，这里主要介绍 lottie-Web 是如何使用，更多使用方法可以参考 <a href="http://airbnb.io/lottie/" target="_blank" rel="noopener">http://airbnb.io/lottie/</a></p><p>首先，在页面中引入 <code>CDN</code> 上的文件，如下</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.4.2/lottie.min.js"</span> type=<span class="string">"text/javascript"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>其次，使用 <strong>AE</strong> 制作动画（UI提供或者自己制作）导出的 <code>json</code>，或者可以在 <a href="https://lottiefiles.com/featured" target="_blank" rel="noopener">Lottie Files</a> 下载 （<a href="https://lottiefiles.com/featured" target="_blank" rel="noopener">Lottie Files</a> 是一个拥有高质量 <strong>Lottie</strong> 文件格式动画的网站，不仅设计师可以在上面陈列他们的动画而且还提供免费下载）</p><p>以下是我在项目里使用的效果图（上传图片中会加重动画，上传成功动画停止），具体效果可以去我的项目上传图片体验 <a href="https://a.lishaoy.net/posts/56" target="_blank" rel="noopener">上传图片动画效果</a></p><p><img src="https://cdn.lishaoy.net/adonisjs/image_upload4.gif" alt="Lottie" title="Lottie"></p><p>具体的代码如下，在页面中创建需要加重动画的容器（<code>HTML</code> 代码）</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"image-load d-flex justify-content-center align-items-center"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"lottie"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text text-muted text-center"</span>&gt;</span>The picture is being uploaded ...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后，用 <code>js</code> 初始化动画，如下</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> anim = lottie.loadAnimation(&#123;</span><br><span class="line">  container: $(<span class="string">'.image-load .lottie'</span>)[<span class="number">0</span>], <span class="comment">//动画容器的元素</span></span><br><span class="line">  renderer: <span class="string">'svg'</span>, <span class="comment">//支持 svg 和 canvas</span></span><br><span class="line">  loop: <span class="literal">true</span>, <span class="comment">//是否循环</span></span><br><span class="line">  autoplay: <span class="literal">false</span>, <span class="comment">// 是否自动播放</span></span><br><span class="line">  path: <span class="string">'/EmojiReaction.json'</span> <span class="comment">//动画json文件的位置</span></span><br><span class="line">&#125;)</span><br><span class="line">anim.addEventListener(<span class="string">'loopComplete'</span>, () =&gt; &#123;  <span class="comment">// 监听 `loopComplete` 事件，每次播放完成执行</span></span><br><span class="line">  anim.pause() <span class="comment">//停止播放</span></span><br><span class="line">  $(<span class="string">'.image-load'</span>).removeClass(<span class="string">'loading'</span>) <span class="comment">//隐藏容器</span></span><br><span class="line">  $(<span class="string">'.image-load .box .text'</span>).text(<span class="string">'The picture is being uploaded...'</span>).removeClass(<span class="string">'text-success'</span>).addClass(<span class="string">'text-muted'</span>) <span class="comment">//改变说明文字状态及颜色</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>更多的参数和事件可查阅官方文档 <a href="http://airbnb.io/lottie/web/web.html" target="_blank" rel="noopener">Lottie-Web</a></p><h2 id="如何加入页面滚动入场离场动效"><a href="#如何加入页面滚动入场离场动效" class="headerlink" title="如何加入页面滚动入场离场动效"></a>如何加入页面滚动入场离场动效</h2><p>首先，让我们来先看看效果，如图（效果来源我的博客 <a href="https://lishaoy.net/laboratory/" target="_blank" rel="noopener">https://lishaoy.net</a>）</p><p><img src="https://cdn.lishaoy.net/goodDesigner/lottie3.gif" alt="Lottie" title="Lottie"></p><p>以上动效就是用的 <strong>AOS</strong> 这个库，具体的使用方法也很简单</p><p>在页面上引入 <code>css</code> 和 <code>js</code> 文件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://unpkg.com/aos@next/dist/aos.css"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/aos@next/dist/aos.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后，用 <code>AOS.init()</code> 初始化，这样初始化，使用的是默认设置，具体有很多参数可以调整，详情可查阅 <a href="https://github.com/michalsnik/aos" target="_blank" rel="noopener">项目文档</a>，如</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">AOS.init(&#123;</span><br><span class="line">  <span class="comment">// Global settings:</span></span><br><span class="line">  disable: <span class="literal">false</span>, <span class="comment">// accepts following values: 'phone', 'tablet', 'mobile', boolean, expression or function</span></span><br><span class="line">  startEvent: <span class="string">'DOMContentLoaded'</span>, <span class="comment">// name of the event dispatched on the document, that AOS should initialize on</span></span><br><span class="line">  initClassName: <span class="string">'aos-init'</span>, <span class="comment">// class applied after initialization</span></span><br><span class="line">  animatedClassName: <span class="string">'aos-animate'</span>, <span class="comment">// class applied on animation</span></span><br><span class="line">  useClassNames: <span class="literal">false</span>, <span class="comment">// if true, will add content of `data-aos` as classes on scroll</span></span><br><span class="line">  disableMutationObserver: <span class="literal">false</span>, <span class="comment">// disables automatic mutations' detections (advanced)</span></span><br><span class="line">  debounceDelay: <span class="number">50</span>, <span class="comment">// the delay on debounce used while resizing window (advanced)</span></span><br><span class="line">  throttleDelay: <span class="number">99</span>, <span class="comment">// the delay on throttle used while scrolling the page (advanced)</span></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  <span class="comment">// Settings that can be overridden on per-element basis, by `data-aos-*` attributes:</span></span><br><span class="line">  offset: <span class="number">120</span>, <span class="comment">// offset (in px) from the original trigger point</span></span><br><span class="line">  delay: <span class="number">0</span>, <span class="comment">// values from 0 to 3000, with step 50ms</span></span><br><span class="line">  duration: <span class="number">400</span>, <span class="comment">// values from 0 to 3000, with step 50ms</span></span><br><span class="line">  easing: <span class="string">'ease'</span>, <span class="comment">// default easing for AOS animations</span></span><br><span class="line">  once: <span class="literal">false</span>, <span class="comment">// whether animation should happen only once - while scrolling down</span></span><br><span class="line">  mirror: <span class="literal">false</span>, <span class="comment">// whether elements should animate out while scrolling past them</span></span><br><span class="line">  anchorPlacement: <span class="string">'top-bottom'</span>, <span class="comment">// defines which position of the element regarding to window should trigger the animation</span></span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>最后，在页面上使用即可，如</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">data-aos</span>=<span class="string">"fade-in"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>或者，也可以单独给元素设置参数，使用 <code>data-aos-*</code> ，如</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">data-aos</span>=<span class="string">"fade-in"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">data-aos-offset</span>=<span class="string">"200"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">data-aos-delay</span>=<span class="string">"50"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">data-aos-duration</span>=<span class="string">"1000"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">data-aos-easing</span>=<span class="string">"ease-in-out"</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>更多的载入效果可以参考官方给出的 <a href="http://michalsnik.github.io/aos/" target="_blank" rel="noopener">示例</a></p><p>如在您做的页面或应用中使用了这三招，<strong>精致小图标</strong> 、 <strong>炫酷的动画</strong> 、 <strong>页面滚动载入动效</strong> ，那么瞬间让您的页面或应用高大上且生动活泼起来。</p>]]></content:encoded>
      
      <comments>https://h.lishaoy.net/goodDesigner.html#disqus_thread</comments>
    </item>
    
    <item>
      <title>用 Node.js 快速开发出多功能的多人在线的文章分享平台</title>
      <link>https://h.lishaoy.net/adonisjs.html</link>
      <guid>https://h.lishaoy.net/adonisjs.html</guid>
      <pubDate>Sun, 16 Dec 2018 18:03:27 GMT</pubDate>
      <description>
      
        &lt;span itemprop=&quot;image&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/ImageObject&quot;&gt;&lt;img itemprop=&quot;url image&quot; src=&quot;/images/loading.gif&quot; data-original=&quot;https://cdn.lishaoy.net/adonisjs/adonisjs1.png&quot; class=&quot;full-image&quot; alt=&quot;Adonisjs&quot; title=&quot;Adonisjs&quot;&gt;&lt;meta itemprop=&quot;width&quot; content=&quot;auto&quot;&gt;&lt;meta itemprop=&quot;height&quot; content=&quot;auto&quot;&gt;&lt;/span&gt;
&lt;p&gt;最近在学习使用 &lt;code&gt;Node.js&lt;/code&gt; 框架，边学习边使用，花了大概 &lt;strong&gt;3周&lt;/strong&gt; 时间做完这个 &lt;strong&gt;Web应用&lt;/strong&gt; 且在 &lt;time&gt;12月16&lt;/time&gt; 凌晨左右上线成功（其实就是把开发环境搬到服务器）， 地址： &lt;a href=&quot;https://a.lishaoy.net&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://a.lishaoy.net&lt;/a&gt;  &lt;/p&gt;
&lt;p&gt;这个 &lt;strong&gt;Web应用&lt;/strong&gt; 的代码是开源的，如对这个应用感兴趣，想知道代码是如何运行的，可以去我 &lt;strong&gt;GitHub&lt;/strong&gt; 下载或 &lt;code&gt;clone&lt;/code&gt; ：&lt;a href=&quot;https://github.com/persilee/adonis_pro&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;应用源码&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
      
      </description>
      
      <content:encoded><![CDATA[<span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="/images/loading.gif" data-original="https://cdn.lishaoy.net/adonisjs/adonisjs1.png" class="full-image" alt="Adonisjs" title="Adonisjs"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><p>最近在学习使用 <code>Node.js</code> 框架，边学习边使用，花了大概 <strong>3周</strong> 时间做完这个 <strong>Web应用</strong> 且在 <time>12月16</time> 凌晨左右上线成功（其实就是把开发环境搬到服务器）， 地址： <a href="https://a.lishaoy.net" target="_blank" rel="noopener">https://a.lishaoy.net</a>  </p><p>这个 <strong>Web应用</strong> 的代码是开源的，如对这个应用感兴趣，想知道代码是如何运行的，可以去我 <strong>GitHub</strong> 下载或 <code>clone</code> ：<a href="https://github.com/persilee/adonis_pro" target="_blank" rel="noopener">应用源码</a></p><hr><a id="more"></a><p>首先，来看看用 <strong>3周</strong> 时间做出来的应用都有些什么功能，之后再看看选用的 <code>Node.js</code> 框架，最后看看 <code>Node.js</code> 项目如何部署到服务器。</p><h2 id="Web应用功能"><a href="#Web应用功能" class="headerlink" title="Web应用功能"></a>Web应用功能</h2><h3 id="登录、注册验证"><a href="#登录、注册验证" class="headerlink" title="登录、注册验证"></a>登录、注册验证</h3><p><strong>登录功能</strong></p><ul><li>输入框没有输入点击登录会提示：用户名、密码不能为空</li><li>输入的用户错误或不存在会提示：用户不存在</li><li>输入的密码错误会提示：密码错误</li><li>登录后会重定向到用户上次访问的地址</li></ul><p><img src="https://cdn.lishaoy.net/adonisjs/login.gif" alt="no-shadow" title="Login"></p><p><strong>注册功能</strong></p><ul><li>输入框没有输入点击注册会提示：用户名、邮箱、密码不能为空</li><li>用户名和邮箱与其他用户相同会提示：用户名、邮箱已存在</li><li>密码小于6位数会提示：最小长度是6位</li><li>注册成功后会发送验证邮件到用户邮箱，需点击邮箱按钮验证</li></ul><p><img src="https://cdn.lishaoy.net/adonisjs/register.gif" alt="no-shadow" title="Register"></p><h3 id="文章列表"><a href="#文章列表" class="headerlink" title="文章列表"></a>文章列表</h3><p>登录进来，会显示文章列表页面，显示内容如下：</p><ul><li>文章标题：点击可进入文章详情页</li><li>作者头像、作者名称：点击可进入作者信息页</li><li>时间：显示创建时间（多久以前方式显示）</li><li>阅读次数、点赞次数</li><li>文章简要：自动摘取章头文章</li><li>缩略图：自动摘取文章第一张图片</li></ul><p><img src="https://cdn.lishaoy.net/adonisjs/posts.png" alt="no-shadow" title="Post List"></p><h3 id="文章详情"><a href="#文章详情" class="headerlink" title="文章详情"></a>文章详情</h3><p>点击文章标题可进入文章详情页面，内容如下：</p><ul><li>文章标题</li><li>作者头像、作者名称</li><li>发布时间</li><li>阅读次数和点赞次数</li><li>编辑按钮（仅作者可见）</li><li>左侧浮动工具栏（点赞、发送邮件到自己邮箱、返回顶部、分享）</li><li>点赞：文章被点赞后，作者可以收到消息通知，且将文章收录到点赞列表（支持匿名点赞，但不会记录通知，只会加点赞数）</li></ul><p><img src="https://cdn.lishaoy.net/adonisjs/post.png" alt="no-shadow" title="Post"></p><h3 id="编辑文章支持-Markdown"><a href="#编辑文章支持-Markdown" class="headerlink" title="编辑文章支持 Markdown"></a>编辑文章支持 Markdown</h3><p>新建文章和修改文章都支持 <strong>Markdown</strong> 语法，且会每隔6秒钟自动保存</p><p><img src="https://cdn.lishaoy.net/adonisjs/post_edit.png" alt="no-shadow" title="Post Edit"></p><h3 id="个人信息"><a href="#个人信息" class="headerlink" title="个人信息"></a>个人信息</h3><p>个人信息页面显示内容如下</p><ul><li>作者的头像、姓名、简介（支持emoji）</li><li>信息栏：GitHub 链接、个人网站链接、发布文章数、总阅读次数、总点赞次数</li><li>发布文章列表：个人发布的所有文章(有删除和编辑按钮)</li><li>已赞文章列表：点过赞的文章会记录在这里</li><li>关注者列表：关注你的用户（关注过的用户，关注按钮高亮显示）</li><li>已关注列表：你关注的用户（关注过的用户，关注按钮高亮显示)</li><li>关注按钮：作者本人不可见，点击可关注，再次点击取消关注，关注后，用户会收到消息通知</li></ul><p><img src="https://cdn.lishaoy.net/adonisjs/profile.gif" alt="no-shadow" title="Profile"></p><p>文章删除编辑快捷入口，如图</p><p><img src="https://cdn.lishaoy.net/adonisjs/edit_delete_post.gif" alt="no-shadow" title="Edit &amp;&amp; Delete post"></p><p>下面是我用另一个用户登录，进入到个人信息页面就会显示关注按钮，如图</p><p><img src="https://cdn.lishaoy.net/adonisjs/follow.png" alt="no-shadow" title="Follow"></p><h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><p>点击文件上传小图标可进入文件上传页面，点击 <strong>Files</strong> 链接可进入文件上传列表，显示内容如图：</p><p><img src="https://cdn.lishaoy.net/adonisjs/file_upload.png" alt="no-shadow" title="File Upload"></p><p><img src="https://cdn.lishaoy.net/adonisjs/file_list.png" alt="no-shadow" title="File List"></p><h3 id="文件预览和编辑"><a href="#文件预览和编辑" class="headerlink" title="文件预览和编辑"></a>文件预览和编辑</h3><p>从文件列表页面点击标题可进入文件预览页面，显示内容如下：</p><ul><li>如果是图片显示图片，如果是视频显示视频</li><li>工具栏：发送邮件到自己邮箱（登录可见）、编辑按钮、删除按钮（登录自己上传可见）</li><li>文件名称</li><li>下载按钮</li><li>上传者头像</li></ul><p><img src="https://cdn.lishaoy.net/adonisjs/file_show.gif" alt="no-shadow" title="File Show"></p><h3 id="消息通知"><a href="#消息通知" class="headerlink" title="消息通知"></a>消息通知</h3><p>点击铃铛小图标可进入消息通知页面，内容如下：</p><ul><li>点赞消息列表：收到用户点赞通知，最新的未读消息会高亮显示，点击点赞者头像进入个人信息页面，点击文章标题进入你的文章详情页面</li><li>关注者列表：收到关注者的通知，最新未读消息会高亮显示，点关注按钮也可关注他，再点击取消关注</li><li>系统消息：目前还没有做功能实现</li></ul><p><img src="https://cdn.lishaoy.net/adonisjs/notification.gif" alt="no-shadow" title="Notification"></p><h3 id="工具栏列表"><a href="#工具栏列表" class="headerlink" title="工具栏列表"></a>工具栏列表</h3><p>点击个人头像可展开工具栏列表，内容如下：</p><ul><li>写文章：点击可新建文章编辑页面，和 ➕ 小图标是同样功能</li><li>上传文件：点击可打开文件上传页面，和上传小图标是同样功能</li><li>个人信息： 点击可进入个人信息页面</li><li>已赞：点击可查看已赞过得文章</li><li>设置：点击可打开个人设置页面</li><li>登出：点击退出登录</li></ul><p><img src="https://cdn.lishaoy.net/adonisjs/tool_menu.png" alt="no-shadow" title="Tool Menu"></p><h3 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h3><p>点击工具栏上的设置按钮可以设置页面，内容如下：</p><p><strong>个人信息设置</strong></p><ul><li>头像：头像是使用的 <code>Gravatar</code> 提供的功能，根据邮箱生成头像</li><li>用户名</li><li>邮箱：已验证通过会显示验证小图标，没有通过的会显示提示</li><li>GitHub：只需填写有户名</li><li>个人简介：支持emoji</li><li>个人网站</li></ul><p><img src="https://cdn.lishaoy.net/setting_profile.png" alt="no-shadow" title="Setting Profile"></p><p><strong>修改密码设置</strong></p><p>需填写原密码，新密码，再次输入密码</p><p><img src="https://cdn.lishaoy.net/setting_pwd.png" alt="no-shadow" title="Setting Password"></p><h3 id="聊天室"><a href="#聊天室" class="headerlink" title="聊天室"></a>聊天室</h3><p>点击 <strong>Chatroom</strong> 链接可进入聊天室，当然这个是用的 <code>websocket</code> 做的，内容如下：</p><ul><li>状态图标：显示链接状态</li><li>活动用户：左侧黑色区域会动态显示活动用户</li><li>消息：会显示发送消息，进入、离开房间通知消息（支持匿名发送消息，但不会保存消息）</li><li>消息输入：消息输入框可输入消息，<kbd>Cmd</kbd> — <kbd>Enter</kbd> 换行（Windows会显示提示Ctrl+Enter），回车发送消息</li></ul><p><img src="https://cdn.lishaoy.net/adonisjs/chatroom1.gif" alt="no-shadow" title="Chart Room"></p><p>加入房间和离开房间都有消息通知，如图</p><p><img src="https://cdn.lishaoy.net/adonisjs/chatroom.png" alt="no-shadow" title="Chart Room"></p><h2 id="Node-js-框架"><a href="#Node-js-框架" class="headerlink" title="Node.js 框架"></a>Node.js 框架</h2><p>这个应用的开发我选择的是 <code>Adonisjs</code> 框架，他和 <code>PHP</code> 的 <code>Laravel</code> 有些像，<code>Adonisjs</code> 是在操作系统上运行的 <code>Node.js</code> <strong>MVC</strong> 框架。</p><p>接下来，来看看 <code>Adonisjs</code> 框架有哪些特性：</p><h3 id="环境安装简单"><a href="#环境安装简单" class="headerlink" title="环境安装简单"></a>环境安装简单</h3><p>不管是开发环境还是生产环境，安装 <code>Adonisjs</code> 运行环境都是非常简单，先来看看开发环境的安装，生产环境后面会提到。</p><p>首先，我们的电脑上需要安装好 <code>Node.js</code>大于 <em>8.00</em> 版本，管理 <code>Node.js</code> 可以使用 <code>nvm</code></p><p>其次，就可以使用 <code>npm</code> 安装 <code>Adonis CLI</code> 命令行工具（管理 <code>npm</code> 使用源可以使用 <code>nrm</code>）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -g @adonisjs/cli</span><br></pre></td></tr></table></figure><p>这样就可以在全局使用 <code>adonis</code> 命令</p><p>再次，可以是 <code>adonis new</code> 命令创建项目</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adonis new adonis_pro</span><br></pre></td></tr></table></figure><p>在 <code>cd</code> 进入项目，执行 <code>adonis serve --dev</code> 运行项目</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> adonis_pro</span><br><span class="line">adonis serve --dev</span><br></pre></td></tr></table></figure><p>这样您的开发环境就搭建完成。</p><h3 id="RMVC"><a href="#RMVC" class="headerlink" title="RMVC"></a>RMVC</h3><p><code>RMVC</code> 就是路由、模型、视图、控制器。</p><h4 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h4><p>创建一条路由非常简单，如 </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Route.get(<span class="string">'liked/:userId/:postId'</span>, <span class="string">'LikedController.liked'</span>)</span><br></pre></td></tr></table></figure><p>这条路由就是用来处理上面提到的点赞功能的</p><p>当然，<code>Adonisjs</code> 提供了 <strong>资源路由</strong> 以便您更方便的创建路由，例如</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Route.resource(<span class="string">'posts'</span>, <span class="string">'PostController'</span>).middleware(</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line">[ [ <span class="string">'create'</span>, <span class="string">'store'</span>, <span class="string">'edit'</span>, <span class="string">'update'</span>, <span class="string">'destroy'</span> ], [ <span class="string">'auth'</span> ] ],</span><br><span class="line">[ [ <span class="string">'update'</span>, <span class="string">'destroy'</span>, <span class="string">'edit'</span> ], [ <span class="string">'own:post'</span> ] ]</span><br><span class="line">])</span><br><span class="line">).validator(<span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line">  [[<span class="string">'posts.update'</span>, <span class="string">'posts.store'</span>], [<span class="string">'StorePost'</span>]]</span><br><span class="line">]))</span><br></pre></td></tr></table></figure><p>这个路由是来处理上面应用提到的文章的 <em>增、删、改、查</em> ，这个可能有些复杂，使用了 <strong>中间件</strong> 来处理用户登录状态和操作权限，使用了 <strong>验证器</strong> 来处理表单验证，这里不介绍的太复杂，如想了解这些具体功能，可以需要花点时间了解学习。</p><p>我们可以去掉 <strong>中间件</strong> 和 <strong>验证器</strong> ，如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Route.resource(<span class="string">'posts'</span>, <span class="string">'PostController'</span>)</span><br></pre></td></tr></table></figure><p>这条资源路由，其实就包含了以下路由：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Route.get(url, closure)</span><br><span class="line">Route.post(url, closure)</span><br><span class="line">Route.put(url, closure)</span><br><span class="line">Route.patch(url, closure)</span><br><span class="line">Route.delete(url, closure)</span><br></pre></td></tr></table></figure><p><code>Adonisjs</code> 还提供了路由组和其他一些功能，路由组如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Route.group(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">Route.get(<span class="string">'profile'</span>, <span class="string">'ProfileController.edit'</span>).as(<span class="string">'profile.edit'</span>)</span><br><span class="line">Route.post(<span class="string">'profile'</span>, <span class="string">'ProfileController.update'</span>).as(<span class="string">'profile.update'</span>).validator(<span class="string">'UpdateProfile'</span>)</span><br><span class="line">Route.get(<span class="string">'password'</span>, <span class="string">'PasswordController.edit'</span>).as(<span class="string">'password.edit'</span>)</span><br><span class="line">Route.post(<span class="string">'password'</span>, <span class="string">'PasswordController.update'</span>).as(<span class="string">'password.update'</span>).validator(<span class="string">'UpdatePassword'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">.prefix(<span class="string">'settings'</span>)</span><br><span class="line">.middleware([ <span class="string">'auth'</span> ])</span><br></pre></td></tr></table></figure><p>使用 <code>.prefix</code> 和 <code>Route.group</code> 来创建路由组，这条路由组是处理 个人信息设置 功能的，这样访问页面是就统一要带上 <code>settings/**</code> 。</p><h4 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h4><p><code>Adonisjs</code> 提供了命令行来创建控制器，如</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adonis make:controller User --<span class="built_in">type</span> http</span><br></pre></td></tr></table></figure><p>这样就创建了一个 <code>User</code> 控制器,自动生成代码如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = UserController</span><br></pre></td></tr></table></figure><p>当然，我们还可以使用 <code>--resource</code> 创建资源类型的控制器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adonis make:controller Post --resource</span><br></pre></td></tr></table></figure><p>自动生成代码，代码如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostController</span> </span>&#123;</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Show a list of all posts.</span></span><br><span class="line"><span class="comment">   * GET posts</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="keyword">async</span> index (&#123; request, response, view &#125;) &#123;&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Render a form to be used for creating a new posts.</span></span><br><span class="line"><span class="comment">   * GET posts/create</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="keyword">async</span> create (&#123; request, response, view &#125;) &#123;&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Create/save a new posts.</span></span><br><span class="line"><span class="comment">   * POST posts</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="keyword">async</span> store (&#123; request, response, view &#125;) &#123;&#125;</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Display a single posts.</span></span><br><span class="line"><span class="comment">   * GET posts/:id</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="keyword">async</span> show (&#123; request, response, view &#125;) &#123;&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Render a form to update an existing posts.</span></span><br><span class="line"><span class="comment">   * GET posts/:id/edit</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="keyword">async</span> edit (&#123; request, response, view &#125;) &#123;&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Update posts details.</span></span><br><span class="line"><span class="comment">   * PUT or PATCH posts/:id</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="keyword">async</span> update (&#123; request, response, view&#125;) &#123;&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Delete a posts with id.</span></span><br><span class="line"><span class="comment">   * DELETE posts/:id</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="keyword">async</span> destroy (&#123; params, request, response &#125;) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = PostController</span><br></pre></td></tr></table></figure><p>和上面的资源路由是对应的，如用 <code>GET</code> 请求访问 <em>posts</em> 就会调用 <code>index</code> 方法（一般用来显示） ，再如：用 <code>DELETE</code> 请求访问 <em>posts/1</em> 就会执行 <code>destroy</code> 方法（一般用来删除）。</p><h4 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h4><p><code>Adonisjs</code> 提供了两种模式来处理数据，<code>Query builder</code> 和 <code>LUCID</code></p><p>首先，我们可以通过 <code>adonis make:migration</code> 来创建数据表</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adonis make:migration users</span><br></pre></td></tr></table></figure><p>会自动生成代码，如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Schema = use(<span class="string">'Schema'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UsersSchema</span> <span class="keyword">extends</span> <span class="title">Schema</span> </span>&#123;</span><br><span class="line">  up () &#123;</span><br><span class="line">    <span class="keyword">this</span>.create(<span class="string">'users'</span>, (table) =&gt; &#123;</span><br><span class="line">      table.increments()</span><br><span class="line">      table.timestamps()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  down () &#123;</span><br><span class="line">    <span class="keyword">this</span>.drop(<span class="string">'users'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = UsersSchema</span><br></pre></td></tr></table></figure><p>这是我们只需在其中添加想要的字段就行，如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Schema = use(<span class="string">'Schema'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UsersSchema</span> <span class="keyword">extends</span> <span class="title">Schema</span> </span>&#123;</span><br><span class="line">  up () &#123;</span><br><span class="line">    <span class="keyword">this</span>.create(<span class="string">'users'</span>, (table) =&gt; &#123;</span><br><span class="line">      table.increments()</span><br><span class="line">      table.string(<span class="string">'username'</span>, <span class="number">80</span>).notNullable().unique()</span><br><span class="line">      table.string(<span class="string">'email'</span>, <span class="number">254</span>).notNullable().unique()</span><br><span class="line">      table.string(<span class="string">'password'</span>, <span class="number">60</span>).notNullable()</span><br><span class="line">      table.timestamps()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  down () &#123;</span><br><span class="line">    <span class="keyword">this</span>.drop(<span class="string">'users'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = UsersSchema</span><br></pre></td></tr></table></figure><p>在执行 <code>adonis migration:run</code> 命令就可以在数据库生成数据表</p><p>再来看看，如何获取数据，可以使用 <code>Query builder</code> 和 <code>LUCID</code> 两种方式</p><p>先来看看 <code>Query builder</code>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Database = use(<span class="string">'Database'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> index (request, response) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> Database</span><br><span class="line">      .table(<span class="string">'users'</span>)</span><br><span class="line">      .where(<span class="string">'username'</span>, <span class="string">'admin'</span>)</span><br><span class="line">      .first()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>查询 <code>user</code> 表 <code>name</code> 是 <code>admin</code> 的用户</p><p><code>Adonisjs</code> 提供了非常多的方法去操作数据，不是特复杂的关系都够用，如果，关系比较复杂，还可以用原生的 <code>sql</code> 操作，如</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Database = use(<span class="string">'Database'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">NotificationController</span> </span>&#123;</span><br><span class="line">  <span class="keyword">async</span> followNotice (&#123; auth, view &#125;) &#123;</span><br><span class="line">    <span class="keyword">const</span> notices = <span class="keyword">await</span> Database.raw(<span class="string">'select users.id as user_id,users.username,users.email,b.title,b.created_at,b.is_read,b.id as post_id from adonis.users , (select posts.id,posts.title, a.user_id,a.created_at,a.is_read from adonis.posts,(SELECT post_user.post_id, post_user.user_id, post_user.created_at, post_user.is_read FROM adonis.post_user where post_user.post_id in (SELECT posts.id FROM adonis.posts where user_id = ?)) as a where posts.id = a.post_id) as b where b.user_id = users.id and b.user_id &lt;&gt; ? order by b.created_at desc limit 50'</span>,[ auth.user.id, auth.user.id ])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = NotificationController</span><br></pre></td></tr></table></figure><p>使用 <code>Database.raw</code> 来运行原生的 <code>sql</code>，以上这条 <code>sql</code> 是用来查询所有用户给自己所有文章点赞的用户信息和文章信息用于消息通知。</p><p>再来看看，<code>LUCID</code> 的模式是如何操作数据的：</p><p>使用 <code>LUCID</code> 模式，我们先需要用命令行工具创建 <code>Models</code>，如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adonis make:model User</span><br></pre></td></tr></table></figure><p>自动生成代码如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Model = use(<span class="string">'Model'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = User</span><br></pre></td></tr></table></figure><p>模型和模型之间需要定义一些关系，如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Model = use(<span class="string">'Model'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;</span><br><span class="line">  profile () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.hasOne(<span class="string">'App/Models/Profile'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = User</span><br></pre></td></tr></table></figure><p>意思是 一个用户对应一个用户信息档案，<strong>一对一</strong> 的关系</p><p>定义好关系之后，就可以方便的获取数据，如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> User = use(<span class="string">'App/Models/User'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">await</span> User.find(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">const</span> userProfile = <span class="keyword">await</span> user.profile().fetch()</span><br></pre></td></tr></table></figure><p>意思是，从用户表和用户个人信息表里获取用户 <code>id</code> 是 <code>1</code> 的用户信息及个人信息，</p><p>其中，关系可以定义为 <strong>3</strong> 种 <strong>一对一、一对多、多对多</strong> ，多对多需要定义中间表</p><p>再来看看，上面的应用中的实际应用，如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> update (&#123; params, request, response, session, auth &#125;) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; title, content, user_id, tags &#125; = request.all()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> post = <span class="keyword">await</span> Post.findOrFail(params.id)</span><br><span class="line">  post.merge(&#123; title, content&#125;)</span><br><span class="line">  <span class="keyword">await</span> post.save()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> post.tags().sync(tags)</span><br><span class="line"></span><br><span class="line">  session.flash(&#123;</span><br><span class="line">    type: <span class="string">'primary'</span>,</span><br><span class="line">    message: <span class="string">'Post updated successfully.'</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> response.redirect(</span><br><span class="line">    Route.url(<span class="string">'PostController.show'</span>, &#123;</span><br><span class="line">      id: post.id</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上，是更新文章的方法，<strong>文章</strong> 和 <strong>标签</strong> 是 <strong>多对多</strong> 的关系，一个标签可以属于多篇文章，一篇文章可以有多个标签，<code>await post.tags().sync(tags)</code> 这句代码就可以通过 <code>Models</code> 里定义的关系自动把标签和文章关联起来保存到 <code>posts</code> 和 <code>tags</code> 表里且把关联关系保存到中间表 <code>post_tag</code>。</p><p>当然，<code>Adonisjs</code> 提供了很多方便的方法，想了解更多的话需要您花点时间去了解学习。</p><h4 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h4><p><code>Adonisjs</code> 框架里视图使用了 <code>edge</code> 模板，我们可以使用命令行工具创建视图文件，如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adonis make:view post</span><br></pre></td></tr></table></figure><p>我看可以看下简单的例子：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@loggedIn</span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span> You are logged in <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">@else</span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/login"</span>&gt;</span>Click here<span class="tag">&lt;/<span class="name">a</span>&gt;</span> to login <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">@endloggedIn</span><br></pre></td></tr></table></figure><p>视图模板里可以使用标签来做逻辑判断，视图模板就没什么好说的，基本都是通用的，关于 <code>edge</code> 视图模板更多语法 <a href="https://edge.adonisjs.com/docs/syntax-guide" target="_blank" rel="noopener">Edge官方文档</a></p><p>最后，<code>Adonisjs</code> 框架还提供了很多其它的实用工具，如：<code>Middleware</code> 中间件、<code>Validator</code> 验证器、<code>Error Handling</code> 自定义异常、<code>Events</code> 事件、<code>Mails</code> 邮件、<code>Websocket</code> 等来处理各种问题。</p><h2 id="Node-js项目发布到阿里云服务器"><a href="#Node-js项目发布到阿里云服务器" class="headerlink" title="Node.js项目发布到阿里云服务器"></a>Node.js项目发布到阿里云服务器</h2><p>首先，我们需要用 <code>ssh</code> 连接到阿里云（或者其他服务器供应商）的主机上，安装一些必要的工具。</p><h3 id="工具安装"><a href="#工具安装" class="headerlink" title="工具安装"></a>工具安装</h3><h4 id="安装-epel-release-软件包仓库"><a href="#安装-epel-release-软件包仓库" class="headerlink" title="安装 epel-release 软件包仓库"></a>安装 epel-release 软件包仓库</h4><p>我们需要安装 <code>epel-release</code> 软件包仓库，<code>epel-release</code> 里面有很多最新的软件包，如，之后安装的 <code>git</code> 就会用到</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install epel-release - y</span><br></pre></td></tr></table></figure><h4 id="安装-Git-版本控制命令行工具"><a href="#安装-Git-版本控制命令行工具" class="headerlink" title="安装 Git 版本控制命令行工具"></a>安装 Git 版本控制命令行工具</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install git -y</span><br></pre></td></tr></table></figure><h3 id="准备-Node-js-运行环境"><a href="#准备-Node-js-运行环境" class="headerlink" title="准备 Node.js 运行环境"></a>准备 Node.js 运行环境</h3><p>接下来，我们需要安装 <code>Node.js</code> 以便我们的 <code>Node.js</code> 项目能够跑起来，我们可以使用 <code>nvm</code> 安装和管理 <code>Node.js</code> ，使用 <code>nrm</code> 来管理切换安装源。</p><h4 id="安装-nvm"><a href="#安装-nvm" class="headerlink" title="安装 nvm"></a>安装 nvm</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh | bash</span><br></pre></td></tr></table></figure><p>安装好之后,我们需要配置下环境变量，以便能够在命令行使用 <code>nvm</code> 命令，用 <code>vi ~/.bash_profile</code> 编辑下配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi ~/.bash_profile</span><br></pre></td></tr></table></figure><p>加入以下代码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> NVM_DIR=<span class="string">"<span class="variable">$HOME</span>/.nvm"</span></span><br><span class="line">[ -s <span class="string">"<span class="variable">$NVM_DIR</span>/nvm.sh"</span> ] &amp;&amp; \. <span class="string">"<span class="variable">$NVM_DIR</span>/nvm.sh"</span></span><br><span class="line">[ -s <span class="string">"<span class="variable">$NVM_DIR</span>/bash_completion"</span> ] &amp;&amp; \. <span class="string">"<span class="variable">$NVM_DIR</span>/bash_completion"</span></span><br></pre></td></tr></table></figure><p>然后，在 <code>source ~/.bash_profile</code> 刷新下配置文件，让它生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure><p>此时，我们就可以使用 <code>nvm</code> 来安装 <code>Node.js</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm install node</span><br></pre></td></tr></table></figure><p>安装好后，可以使用 <code>nvm list</code> 来查看有哪些版本可以使用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm list</span><br></pre></td></tr></table></figure><p>结果：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-&gt;     v10.13.0</span><br><span class="line">        v11.2.0</span><br><span class="line">         system</span><br><span class="line">default -&gt; v10.13.0</span><br><span class="line">node -&gt; stable (-&gt; v11.2.0) (default)</span><br><span class="line">stable -&gt; 11.2 (-&gt; v11.2.0) (default)</span><br><span class="line">iojs -&gt; N/A (default)</span><br><span class="line">lts/* -&gt; lts/dubnium (-&gt; v10.13.0)</span><br><span class="line">lts/argon -&gt; v4.9.1 (-&gt; N/A)</span><br><span class="line">lts/boron -&gt; v6.14.4 (-&gt; N/A)</span><br><span class="line">lts/carbon -&gt; v8.13.0 (-&gt; N/A)</span><br><span class="line">lts/dubnium -&gt; v10.13.0</span><br></pre></td></tr></table></figure><p>我使用的是 <em>v10.13.0</em> 的版本，默认安装的都是比较新的版本，可能是 <em>v11.2.0</em> 或 <em>v11.1.0</em>，所以我们也可以用 <code>nvm install v10.13.0</code> 来安装指定版本。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm install v10.13.0</span><br></pre></td></tr></table></figure><p>然后，就可以使用 <code>nvm use  v10.13.0</code> 来使用指定版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm use nvm v10.13.0</span><br></pre></td></tr></table></figure><p>结果：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Now using node v10.13.0 (npm v6.4.1)</span><br></pre></td></tr></table></figure><h4 id="安装-nrm-管理安装源"><a href="#安装-nrm-管理安装源" class="headerlink" title="安装 nrm 管理安装源"></a>安装 nrm 管理安装源</h4><p>使用 npm 安装的程序包，默认的来源是 <a href="http://registry.npmjs.org" target="_blank" rel="noopener">http://registry.npmjs.org</a>，国内的下载速度会有些慢，我们可以是 <code>nrm</code> 来切换到 <code>taobao</code> 的源</p><p><strong>安装 nrm</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install nrm --global</span><br></pre></td></tr></table></figure><p><strong>切换到 taobao 源</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nrm use taobao</span><br></pre></td></tr></table></figure><h3 id="准备项目"><a href="#准备项目" class="headerlink" title="准备项目"></a>准备项目</h3><p>以上工作完成之后，我们的服务器就可以正常运行 <code>Node.js</code> 项目，现在我们需要把本地的项目上传到服务器，上传方法有很多，如：</p><ul><li>可以使用 <code>git</code>，先把项目传到 <strong>GitHub</strong>，然后用 <code>git</code> 下载到服务器</li><li>可以是 <strong>FTP</strong> 工具</li><li>可以是命令上传 <code>scp -r 本地目录  root@服务器IP:/var/www/</code></li></ul><p>发项目文件上传到服务器的指定目录下，如：<code>www</code></p><p>接下来，我们可以是 <strong>PM2</strong> 来管理 <strong>Node</strong> 进程，先需要安装 <strong>PM2</strong></p><h4 id="安装PM2"><a href="#安装PM2" class="headerlink" title="安装PM2"></a>安装PM2</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install pm2@latest --global</span><br></pre></td></tr></table></figure><p>这些工作作为之后，就可以来测试一下，启动项目，在本地访问服务器 <code>IP:PORT</code> 来测试是否可以访问</p><h4 id="测试项目是否可以运行"><a href="#测试项目是否可以运行" class="headerlink" title="测试项目是否可以运行"></a>测试项目是否可以运行</h4><p>在测试之前，我们需要改下应用的配置文件，<code>adonisjs</code> 框架里是 <code>.env</code> 文件，修改下 <code>HOST</code> 的值：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HOST=0.0.0.0</span><br><span class="line">PORT=3333</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><code>HOST</code> 默认是 <em>127.0.0.1</em>，需要改成 <em>0.0.0.0</em> 这样就可以在自己电脑上用服务器 <code>IP:PORT</code> 来访问应用</p><p>改完后，进入到项目的根目录，运行应用，<code>adonisjs</code> 的启动文件是 <code>server.js</code>，如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 start server.js</span><br></pre></td></tr></table></figure><p>如启动成功会提示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[PM2] Applying action restartProcessId on app [server](ids: 0)</span><br><span class="line">[PM2] [server](0) ✓</span><br><span class="line">[PM2] Process successfully started</span><br><span class="line">┌──────────┬────┬─────────┬──────┬──────┬────────┬─────────┬────────┬─────┬──────────┬──────┬──────────┐</span><br><span class="line">│ App name │ id │ version │ mode │ pid  │ status │ restart │ uptime │ cpu │ mem      │ user │ watching │</span><br><span class="line">├──────────┼────┼─────────┼──────┼──────┼────────┼─────────┼────────┼─────┼──────────┼──────┼──────────┤</span><br><span class="line">│ server   │ 0  │ 4.1.0   │ fork │ 7171 │ online │ 30      │ 0s     │ 0%  │ 3.4 MB   │ root │ disabled │</span><br><span class="line">└──────────┴────┴─────────┴──────┴──────┴────────┴─────────┴────────┴─────┴──────────┴──────┴──────────┘</span><br><span class="line"> Use `pm2 show &lt;id|name&gt;` to get more details about an app</span><br></pre></td></tr></table></figure><p>然后，在自己电脑上用服务器 <code>IP:PORT</code> 来访问应用。</p><h3 id="Nginx-代理"><a href="#Nginx-代理" class="headerlink" title="Nginx 代理"></a>Nginx 代理</h3><p>为了让服务器更好地处理网络请求，我们需要添加使用 <strong>Nginx 反向代理</strong> 把请求转发给 <code>Node.js</code> 应用</p><h4 id="安装-Nginx"><a href="#安装-Nginx" class="headerlink" title="安装 Nginx"></a>安装 Nginx</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install nginx -y</span><br></pre></td></tr></table></figure><p>如果你的服务之前安装过可不用安装，我的阿里云服务器运行了 4 个站点之前安装过，之后我只需添加配置就行。</p><h4 id="启动-Nginx"><a href="#启动-Nginx" class="headerlink" title="启动 Nginx"></a>启动 Nginx</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start nginx</span><br></pre></td></tr></table></figure><h4 id="配置-Nginx"><a href="#配置-Nginx" class="headerlink" title="配置 Nginx"></a>配置 Nginx</h4><p>一般情况 <strong>Nginx</strong> 安装好后会有 <em>/etc/nginx/conf.d</em>  目录，进入这个目录，创建一个配置文件为 <code>Node.js</code> 而准备，名字可随意命名，如：<code>adonis.conf</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  location / &#123;</span><br><span class="line">      proxy_pass http://127.0.0.1:3333;</span><br><span class="line">      proxy_http_version 1.1;</span><br><span class="line">      proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">      proxy_set_header Connection <span class="string">'upgrade'</span>;</span><br><span class="line">      proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">      proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">      proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">      proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">      proxy_cache_bypass <span class="variable">$http_upgrade</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后，在 <strong>Nginx</strong> 的主配置文件里把刚才新创建的配置文件（<em>/etc/nginx/nginx.conf</em>） <code>include</code> 进去就可以,如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include /etc/nginx/conf.d/*.conf;</span><br></pre></td></tr></table></figure><p>因为，我的主机里运行了4个站点，<code>*</code> 的意思就是加载这个目录下的所有配置文件</p><p>然后，记得把刚才项目里的 <em>.env</em> 配置文件改成 <em>127.0.0.1</em> ，因为我们现在使用了代理，网络请求交给了 <strong>Nginx</strong></p><p>再进入到项目的根目录下运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pm2 stop server.js <span class="comment">#停止项目</span></span><br><span class="line">pm2 start server.js <span class="comment">#启动项目</span></span><br></pre></td></tr></table></figure><p>这时候再用服务器 <strong>IP</strong> 访问就是用的 <strong>Nginx</strong> 去处理请求</p><h4 id="域名和SSL"><a href="#域名和SSL" class="headerlink" title="域名和SSL"></a>域名和SSL</h4><p>如果你有域名可以去对应的供应商解析好，如想使用 <code>https</code> 协议，也可以去对应的供应商下载好证书（下载好的证书要放到服务器某个目录里）。</p><p>再修改下刚才创建的配置文件，让它能够支持 <code>https</code> 和 域名 访问：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">      listen 443 ssl http2; <span class="comment">#SSL</span></span><br><span class="line">  server_name a.lishaoy.net; <span class="comment">#域名</span></span><br><span class="line">  ssl on;</span><br><span class="line"></span><br><span class="line">  ssl_certificate /etc/letsencrypt/live/a.lishaoy.net/server.pem; <span class="comment">#证书目录</span></span><br><span class="line">  ssl_certificate_key /etc/letsencrypt/live/a.lishaoy.net/server.key; <span class="comment">#证书目录</span></span><br><span class="line">  ssl_protocols TLSv1.1 TLSv1.2;</span><br><span class="line">  ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;</span><br><span class="line">  ssl_prefer_server_ciphers on;</span><br><span class="line">  ssl_session_cache shared:SSL:10m;</span><br><span class="line">  ssl_session_timeout 10m;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable">$ssl_protocol</span> = <span class="string">""</span>) &#123;</span><br><span class="line">    rewrite ^(.*) https://<span class="variable">$host</span><span class="variable">$1</span> permanent;</span><br><span class="line">  &#125;</span><br><span class="line">  error_page 497  https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line"></span><br><span class="line">  error_page 404 /404.html;</span><br><span class="line">  error_page 502 /502.html;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">      proxy_pass http://localhost:3333;</span><br><span class="line">      proxy_http_version 1.1;</span><br><span class="line">      proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">      proxy_set_header Connection <span class="string">'upgrade'</span>;</span><br><span class="line">      proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">      proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">      proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">      proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">      proxy_cache_bypass <span class="variable">$http_upgrade</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样再重启 <code>Ningx</code> 服务和项目的服务，就大功告成了。</p>]]></content:encoded>
      
      <comments>https://h.lishaoy.net/adonisjs.html#disqus_thread</comments>
    </item>
    
    <item>
      <title>Flutter：手拉手带你极速构建漂亮的跨平台移动应用 ✿ 初体验（实战）</title>
      <link>https://h.lishaoy.net/fristFlutter.html</link>
      <guid>https://h.lishaoy.net/fristFlutter.html</guid>
      <pubDate>Sat, 10 Nov 2018 17:04:15 GMT</pubDate>
      <description>
      
        &lt;span itemprop=&quot;image&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/ImageObject&quot;&gt;&lt;img itemprop=&quot;url image&quot; src=&quot;/images/loading.gif&quot; data-original=&quot;https://cdn.lishaoy.net/fristFlutter/flutterCover7.png&quot; class=&quot;full-image&quot; alt=&quot;Flutter&quot; title=&quot;Flutter&quot;&gt;&lt;meta itemprop=&quot;width&quot; content=&quot;auto&quot;&gt;&lt;meta itemprop=&quot;height&quot; content=&quot;auto&quot;&gt;&lt;/span&gt;
&lt;p&gt;我们上篇文章已经把 &lt;strong&gt;Flutter&lt;/strong&gt; 的开发运行环境搭建好了 &lt;a href=&quot;https://h.lishaoy.net/flutterInstall.html&quot;&gt;Flutter：环境搭建&lt;/a&gt; ，本篇文章将完成您的第一个 &lt;strong&gt;Flutter&lt;/strong&gt; 小应用，不用但是不会，跟着文章做就行，开始不必太纠结这些代码细节，明白它是干什么的就行，只是一个使用体验，体验 &lt;strong&gt;Flutter&lt;/strong&gt; 框架给你带来的开发感受，后面会有具体的组件（widget）的文章。&lt;/p&gt;
&lt;hr&gt;
      
      </description>
      
      <content:encoded><![CDATA[<span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="/images/loading.gif" data-original="https://cdn.lishaoy.net/fristFlutter/flutterCover7.png" class="full-image" alt="Flutter" title="Flutter"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><p>我们上篇文章已经把 <strong>Flutter</strong> 的开发运行环境搭建好了 <a href="https://h.lishaoy.net/flutterInstall.html">Flutter：环境搭建</a> ，本篇文章将完成您的第一个 <strong>Flutter</strong> 小应用，不用但是不会，跟着文章做就行，开始不必太纠结这些代码细节，明白它是干什么的就行，只是一个使用体验，体验 <strong>Flutter</strong> 框架给你带来的开发感受，后面会有具体的组件（widget）的文章。</p><hr><a id="more"></a><h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><p>在上篇文章我们已经创建了一个 Flutter 项目 <span class="label success">new_flutter</span>，如果您还没有创建，可以在终端执行以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/desktop <span class="comment">#进入桌面</span></span><br><span class="line">flutter create new_flutter <span class="comment">#创建 Flutter 项目</span></span><br><span class="line"><span class="built_in">cd</span> new_flutter <span class="comment">#进入项目</span></span><br><span class="line">code ./ <span class="comment">#用 VS Code 打开</span></span><br></pre></td></tr></table></figure><p>用 VS Code 打开项目后，按 <strong>F5</strong> 选择模拟器运行项目看看效果，这些操作在上篇文章都已经做过了，您应该有些印象，如成功的话，会看到如图效果：</p><p><img src="https://cdn.lishaoy.net/flutterInstall/demo.png" alt="no-shadow" title="Flutter run"></p><p>上图界面是 <code>flutter create</code> 命令创建项目时，给我们的案例（计数器），这些代码在 <em><span class="label default"> lib->main.dart</span></em> 文件里，如你关注的话可以看看这些代码都做了些什么，不过现在我们不需要这些代码，<kbd>⌘</kbd> - <kbd>A</kbd> 全选删除，我们需要自己写，如下：</p><figure class="highlight dart"><figcaption><span>Dart</span><a href="https://h.lishaoy.net/fristFlutter.html#创建项目">main.dart</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  runApp(</span><br><span class="line">    Center(</span><br><span class="line">      child: Text(</span><br><span class="line">        <span class="string">'Hello'</span>,</span><br><span class="line">        textDirection: TextDirection.ltr,</span><br><span class="line">        style: TextStyle(fontSize: <span class="number">36.0</span>),</span><br><span class="line">      ),</span><br><span class="line">    )</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>写入以上代码，按 <kbd>⌘</kbd> - <kbd>⇧</kbd> - <kbd>P</kbd> 打开 VS Code 的命令面板，搜索 <code>hot restart</code> 执行命令，效果如图：</p><div style="padding: 0 30%;"><img src="https://cdn.lishaoy.net/fristFlutter/flutter_hello.png" alt="no-shadow" title="hello"></div><p><code>main()</code> 是 Flutter 的入口函数，我们一般不会把代码写在里面，我们来修改下代码（自定义 widget）：</p><figure class="highlight dart"><figcaption><span>Dart</span><a href="https://h.lishaoy.net/fristFlutter.html#创建项目">main.dart</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() =&gt; runApp(App());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Center(</span><br><span class="line">      child: Text(</span><br><span class="line">        <span class="string">'Hello'</span>,</span><br><span class="line">        textDirection: TextDirection.ltr,</span><br><span class="line">        style: TextStyle(fontSize: <span class="number">36.0</span>),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行效果是一样的，这里我们自定义了一个 <code>StatelessWidget</code> 类型的 widget 叫 <span class="label primary">App</span>。</p><h2 id="新增-Material-AppBar"><a href="#新增-Material-AppBar" class="headerlink" title="新增 Material AppBar"></a>新增 Material AppBar</h2><p>我们再来修改下代码，让我们的应用去使用 <span class="label success">Material Design</span> 的 AppBar</p><figure class="highlight dart"><figcaption><span>Dart</span><a href="https://h.lishaoy.net/fristFlutter.html#新增-Material-AppBar">main.dart</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() =&gt; runApp(App());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      home: Scaffold(</span><br><span class="line">        appBar: AppBar(</span><br><span class="line">          title: Text(</span><br><span class="line">            <span class="string">'lishaoy.net'</span>.toUpperCase(),</span><br><span class="line">            style: TextStyle(letterSpacing: <span class="number">3.0</span>),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">        body: Hello(),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hello</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Center(</span><br><span class="line">      child: Text(</span><br><span class="line">        <span class="string">'Hello'</span>,</span><br><span class="line">        textDirection: TextDirection.ltr,</span><br><span class="line">        style: TextStyle(fontSize: <span class="number">36.0</span>),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行效果如图：</p><div style="padding: 0 30%;"><img src="https://cdn.lishaoy.net/fristFlutter/Appbar.png" alt="no-shadow" title="hello"></div><div class="note success"><p><i class="fa fa-fw fa-bell faa-horizontal animated faa-slow" style="color: #009688;"></i><strong>Tip：</strong></p><ol><li>自定义了一个 Hello 的 <span class="label info">StatelessWidget</span> 类型的 widget</li><li>新增了 MaterialApp ，这里面就有我们需要用的 AppBar （MaterialApp 里面有很多 <span class="label info">Material Design</span> 风格的组件，后面的文章提到）</li><li>Scaffold 可以理解为 MaterialApp 布局的架子，<span class="label info">Material Design</span> 风格的组件都会放到这里面</li><li>AppBar 就是顶部蓝色这部分，加了一个 title 转为大写和增加词间距</li><li>body 是主显示区，下面白色部分，放的是我们自定义的 Hello 小部件</li></ol></div>  <h2 id="新增列表视图（ListView）"><a href="#新增列表视图（ListView）" class="headerlink" title="新增列表视图（ListView）"></a>新增列表视图（ListView）</h2><p>在新增列表视图（ListView）之前，我们需要准备一些数据，我们可以在 lib 目录下新建一个目录 model 和文件 <span class="label default">post.dart</span>，如图：</p><p><img src="https://cdn.lishaoy.net/fristFlutter/model.png" alt="post.dart" width="26%" title="post.dart" align="center"></p><p>然后，把在 <span class="label success">GitHub</span> 准备好的 <a href="https://github.com/persilee/flutter_pro/blob/master/lib/model/post.dart" target="_blank" rel="noopener">post.dart</a> 数据放到里面。</p><p>现在我们再来改进下代码，让它更具有维护性，我们把 <code>home</code> 属性下的 Scaffold 放到单独的 widget ，取名为 <span class="label default">HomePage</span></p><figure class="highlight dart"><figcaption><span>Dart</span><a href="https://h.lishaoy.net/fristFlutter.html#新增列表视图（ListView）">main.dart</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() =&gt; runApp(App());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      home: HomePage(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">        appBar: AppBar(</span><br><span class="line">          title: Text(</span><br><span class="line">            <span class="string">'lishaoy.net'</span>.toUpperCase(),</span><br><span class="line">            style: TextStyle(letterSpacing: <span class="number">3.0</span>),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">        body: Hello(),</span><br><span class="line">      );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来，我们来创建 <span class="label primary">视图列表</span> </p><p>首先，在头部引入刚才创建的数据 <code>post.dart</code> 文件</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'./model/post.dart'</span>;</span><br></pre></td></tr></table></figure><p>然后，再把 <code>body</code> 下的 Hello() 换成 <code>ListView</code>，如下：</p><figure class="highlight dart"><figcaption><span>Dart</span><a href="https://h.lishaoy.net/fristFlutter.html#新增列表视图（ListView）">main.dart</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">        appBar: AppBar(</span><br><span class="line">          title: Text(</span><br><span class="line">            <span class="string">'lishaoy.net'</span>.toUpperCase(),</span><br><span class="line">            style: TextStyle(letterSpacing: <span class="number">3.0</span>),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">        body: ListView.builder(</span><br><span class="line">          itemCount: posts.length,</span><br><span class="line">          itemBuilder: (BuildContext context, <span class="built_in">int</span> index) =&gt; Text(posts[index].title),</span><br><span class="line">        ),</span><br><span class="line">      );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>效果如图：</p><div style="padding: 0 30%;"><img src="https://cdn.lishaoy.net/fristFlutter/listView.png" alt="no-shadow" title="ListView"></div><h2 id="完善列表项目"><a href="#完善列表项目" class="headerlink" title="完善列表项目"></a>完善列表项目</h2><p>现在，数据已经呈现在应用界面上了，接下来要做的是让数据展示更友好一点。</p><p>我们再来改造一下 <code>itemBuilder</code> 下的方法：</p><figure class="highlight dart"><figcaption><span>Dart</span><a href="https://h.lishaoy.net/fristFlutter.html#完善列表项目">main.dart</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      backgroundColor: Colors.grey[<span class="number">100</span>],</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(</span><br><span class="line">          <span class="string">'lishaoy.net'</span>.toUpperCase(),</span><br><span class="line">          style: TextStyle(letterSpacing: <span class="number">3.0</span>),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">      body: ListView.builder(</span><br><span class="line">        itemCount: posts.length,</span><br><span class="line">        itemBuilder: (BuildContext context, <span class="built_in">int</span> index) =&gt; Container(</span><br><span class="line">              margin: EdgeInsets.all(<span class="number">8.0</span>),</span><br><span class="line">              color: Colors.white,</span><br><span class="line">              child: Column(</span><br><span class="line">                children: &lt;Widget&gt;[</span><br><span class="line">                  Image.network(</span><br><span class="line">                    posts[index].imageUrl,</span><br><span class="line">                    fit: BoxFit.cover,</span><br><span class="line">                  ),</span><br><span class="line">                  SizedBox(</span><br><span class="line">                    height: <span class="number">16.0</span>,</span><br><span class="line">                  ),</span><br><span class="line">                  Text(</span><br><span class="line">                    posts[index].title,</span><br><span class="line">                    style: Theme.of(context).textTheme.title,</span><br><span class="line">                  ),</span><br><span class="line">                  Text(</span><br><span class="line">                    posts[index].author,</span><br><span class="line">                    style: Theme.of(context).textTheme.subhead,</span><br><span class="line">                  ),</span><br><span class="line">                  SizedBox(</span><br><span class="line">                    height: <span class="number">16.0</span>,</span><br><span class="line">                  ),</span><br><span class="line">                ],</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行效果如图：</p><div style="padding: 0 30%;"><img src="https://cdn.lishaoy.net/fristFlutter/listView1.png" alt="no-shadow" title="ListView"></div><div class="note success"><p><i class="fa fa-fw fa-bell faa-horizontal animated faa-slow" style="color: #009688;"></i><strong>Tip：</strong></p><ol><li><span class="label info">itemBuilder</span> 属性是个方法，可以传 2 个参数，context（内容）、index（索引）</li><li>我们用了 <span class="label info">Container</span> 的 widget 来装载我们的项目，因为 <span class="label info">Container</span> 有很多属性，例如 margin、padding、color、width、height等，后面我们会慢慢的熟悉它</li><li>我们用了一个 <span class="label info">Column</span> 的 widget 来布局，因为我们的图片、标题、小标题要纵向排列（Row、Column等一些布局的 widget 我们会经常用到）</li><li>用了 <span class="label info">Image.network</span> 来加载一个来自网络的图片（Image.asset可以加载本地图像）</li><li><span class="label info">Theme.of(context).textTheme.title</span> 是用 <span class="label info">Material Design</span> 主题里的标题样式</li></ol></div>  <p>最后，为了可阅读性和维护性考量，我们再可以调整一下代码 <span class="label success">ListView.builder</span> 方法单独提炼出来：</p><figure class="highlight dart"><figcaption><span>Dart</span><a href="https://h.lishaoy.net/fristFlutter.html#完善列表项目">main.dart</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  Widget _listItemBuilder(BuildContext context, <span class="built_in">int</span> index) =&gt; Container(</span><br><span class="line">        margin: EdgeInsets.all(<span class="number">8.0</span>),</span><br><span class="line">        color: Colors.white,</span><br><span class="line">        child: Column(</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            Image.network(</span><br><span class="line">              posts[index].imageUrl,</span><br><span class="line">              fit: BoxFit.cover,</span><br><span class="line">            ),</span><br><span class="line">            SizedBox(</span><br><span class="line">              height: <span class="number">16.0</span>,</span><br><span class="line">            ),</span><br><span class="line">            Text(</span><br><span class="line">              posts[index].title,</span><br><span class="line">              style: Theme.of(context).textTheme.title,</span><br><span class="line">            ),</span><br><span class="line">            Text(</span><br><span class="line">              posts[index].author,</span><br><span class="line">              style: Theme.of(context).textTheme.subhead,</span><br><span class="line">            ),</span><br><span class="line">            SizedBox(</span><br><span class="line">              height: <span class="number">16.0</span>,</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      backgroundColor: Colors.grey[<span class="number">100</span>],</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(</span><br><span class="line">          <span class="string">'lishaoy.net'</span>.toUpperCase(),</span><br><span class="line">          style: TextStyle(letterSpacing: <span class="number">3.0</span>),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">      body: ListView.builder(</span><br><span class="line">        itemCount: posts.length,</span><br><span class="line">        itemBuilder: _listItemBuilder,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>现在，第一个漂亮的界面已经完成，后面的文章我们一起来完成其他部分。</p>]]></content:encoded>
      
      <comments>https://h.lishaoy.net/fristFlutter.html#disqus_thread</comments>
    </item>
    
    <item>
      <title>Flutter：手拉手带你极速构建漂亮的跨平台移动应用 ✿ 环境搭建</title>
      <link>https://h.lishaoy.net/flutterInstall.html</link>
      <guid>https://h.lishaoy.net/flutterInstall.html</guid>
      <pubDate>Thu, 08 Nov 2018 02:22:29 GMT</pubDate>
      <description>
      
        &lt;span itemprop=&quot;image&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/ImageObject&quot;&gt;&lt;img itemprop=&quot;url image&quot; src=&quot;/images/loading.gif&quot; data-original=&quot;https://cdn.lishaoy.net/flutterInstall/flutterCover8.png&quot; class=&quot;full-image&quot; alt=&quot;Flutter&quot; title=&quot;Flutter&quot;&gt;&lt;meta itemprop=&quot;width&quot; content=&quot;auto&quot;&gt;&lt;meta itemprop=&quot;height&quot; content=&quot;auto&quot;&gt;&lt;/span&gt;
&lt;p&gt;上篇文章带大家认识了 &lt;code&gt;Flutter&lt;/code&gt; ，想必大家已迫不及待的想练练手，所以要行动起来，现在这篇文章就带您搭建一个 &lt;code&gt;Flutter&lt;/code&gt; 运行及开发环境。&lt;/p&gt;
&lt;hr&gt;
      
      </description>
      
      <content:encoded><![CDATA[<span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="/images/loading.gif" data-original="https://cdn.lishaoy.net/flutterInstall/flutterCover8.png" class="full-image" alt="Flutter" title="Flutter"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><p>上篇文章带大家认识了 <code>Flutter</code> ，想必大家已迫不及待的想练练手，所以要行动起来，现在这篇文章就带您搭建一个 <code>Flutter</code> 运行及开发环境。</p><hr><a id="more"></a><h2 id="安装-Flutter-SDK"><a href="#安装-Flutter-SDK" class="headerlink" title="安装 Flutter SDK"></a>安装 Flutter SDK</h2><p>想要在本地电脑上运行 <strong>Flutter</strong> ，需要安装 <strong>Flutter SDK</strong> 才可以运行， <strong>SDK</strong> 里面有一些用于创建、构建、测试和编译应用程序的命令行工具等，这些在开发的时候会用到。</p><p>首先，我们有 2 种方法获取 <strong>SDK</strong></p><ul><li>可以到 <a href="https://flutter.io/docs/development/tools/sdk/archive#macos" target="_blank" rel="noopener">下载 Flutter SDK </a> 到本地电脑</li><li>可以用 <code>git clone</code> 命令下载到本地电脑</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> -b master https://github.com/flutter/flutter.git</span><br></pre></td></tr></table></figure><p>其次，把下载下来的 <strong>Flutter SDK</strong> 解压，放到系统的某个目录，比如我是放到： <code>/Applications/flutter</code> ，如图：</p><p><img src="https://cdn.lishaoy.net/flutterInstall/flutterSDK.png" alt="no-shadow" title="Flutter SDK"></p><h2 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h2><p>配置环境变量的目的是为了让 <strong>Flutter SDK</strong> 命令行工具在全局范围都起作用，以便开发使用。</p><p>首先，您可以用编辑器打开主目录下的 <code>.bash_profile</code>，或者用 <code>vi</code> 命令编辑，我习惯用 <code>vi</code> 命令，如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi <span class="variable">$HOME</span>/.bash_profile</span><br></pre></td></tr></table></figure><p>新增以下配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$PATH:/Applications/flutter/bin</span><br><span class="line">export PUB_HOSTED_URL=https://pub.flutter-io.cn</span><br><span class="line">export FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn</span><br></pre></td></tr></table></figure><div class="note warning"><p><i class="fa fa-fw fa-bell faa-horizontal animated faa-slow" style="color: #faab33;"></i> <strong>Tips：</strong> <br>第一行 <span class="label danger">export PATH=$PATH:/Applications/flutter/bin</span> 中的 <span class="label danger">/Applications/flutter/bin</span> 就是刚才下载的 <strong>Flutter SDK</strong> 解压后放在本地电脑的目录，您要根据自己操作更改为自己电脑对应的目录。<br>第二、三行为解决国内下载或更新资源慢的国内镜像，配置这个下载或更新资源会快一些。</p></div>  <p>再执行 <code>source $HOME/.bash_profile</code> 命令刷新当前命令行窗口，或者关掉当前命令行窗口重新打开，效果一样</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> <span class="variable">$HOME</span>/.bash_profile</span><br></pre></td></tr></table></figure><p>再执行 <code>flutter --help</code>，来测试环境变量是否配置成功，如图：</p><p><img src="https://cdn.lishaoy.net/flutterSDK3.png" alt="no-shadow" title="flutter help"></p><div class="note warning"><p><i class="fa fa-fw fa-bell  faa-horizontal animated faa-slow" style="color: #faab33;"></i> <strong>Tips：</strong> 如果你使用的是 <span class="label danger">zsh</span>，需要在 ~/.zshrc 文件中添加：<span class="label danger">source ~/.bash_profile</span> ，否则 <span class="label danger">flutter</span> 命令将无法运行。</p></div> <h2 id="配置-iOS-开发环境"><a href="#配置-iOS-开发环境" class="headerlink" title="配置 iOS 开发环境"></a>配置 iOS 开发环境</h2><p>想用 <strong>Flutter</strong> 为 iOS 平台开发应用，需要安装 Xcode，我们可以去苹果应用商店下载。</p><p>安装好 Xcode 后，你需要打开一次 Xcode 同意许可协议（会提示），或者执行 <code>sudo xcodebuild -license</code> 同意许可协议。</p><p>然后执行 <code>open -a Simulator</code> 命令，就可以打开一个模拟器，来运行和测试 <strong>Flutter</strong> 程序，如图</p><p><img src="https://cdn.lishaoy.net/flutterInstall/Simulator2.png" alt="no-shadow" title="Simulator"></p><h2 id="配置-Android-开发环境"><a href="#配置-Android-开发环境" class="headerlink" title="配置 Android 开发环境"></a>配置 Android 开发环境</h2><p>想用 <strong>Flutter</strong> 为 Android 平台开发应用，需要下载安装 <a href="https://developer.android.com/studio/" target="_blank" rel="noopener">Android Studio</a>。</p><p>安装好 Android Studio 后，启动它，首次启动会安装最新的 <strong>Android SDK</strong> ，但是你可能会遇到这样的问题，如图：</p><p><img src="https://cdn.lishaoy.net/flutterInstall/AndroidStudio.png" alt="Android Studio" width="50%" title="Android Studio" align="center"></p><p>如果遇到这个问题应该就是网络问题（需要科学上网），点 <strong>Setup Proxy</strong> 来设置代理，如图：</p><p><img src="https://cdn.lishaoy.net/flutterInstall/AndroidStudio1.png" alt="Android Studio" width="50%" title="Android Studio" align="center"></p><p>如一切正常，就会提示你需要下载一些东西，如图</p><p><img src="https://cdn.lishaoy.net/flutterInstall/AndroidStudio2.png" alt="Android Studio" width="85%" title="Android Studio" align="center"></p><p>点击 Finish 按钮后就会下载安装以上列表的东西,下载安装完 SDK 后，如图：</p><p><img src="https://cdn.lishaoy.net/flutterInstall/AndroidStudio3.png" alt="Android Studio" width="85%" title="Android Studio" align="center"></p><p>需要我们打开一个项目，我们可以用刚才已经配置好的 <strong>Flutter SDK</strong> 的命令行创建一个 Flutter 项目，如执行以下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/desktop</span><br><span class="line">flutter create new_flutter</span><br></pre></td></tr></table></figure><p>命令执行完成后，在桌面就会生成一个 Flutter 项目，再用 Android Studio 打开，项目打开后会提示安装 Flutter 插件和依赖 Dart 语言插件 ，安装完之后我们可以去创建一个模拟器。</p><p>打开 <strong>Tools&gt;AVD Manager</strong> ，点击 <code>Create Virtual Device...</code> 来创建一个模拟器，选择一个设备，点击 Next，如图</p><p><img src="https://cdn.lishaoy.net/flutterInstall/AndroidStudio4.png" alt="Android Studio" width="85%" title="Android Studio" align="center"></p><p>为模拟器选择一个系统镜像（我选择的是第一个），点击 Download ，下载完成后，点击 Next 后，如图</p><p><img src="https://cdn.lishaoy.net/flutterInstall/AndroidStudio5.png" alt="Android Studio" width="85%" title="Android Studio" align="center"></p><p>最后，在模拟性能这里选择 <strong>Hardware - GLES 2.0</strong> 启动硬件加速，点击 Finish 完成</p><p><img src="https://cdn.lishaoy.net/flutterInstall/AndroidStudio6.png" alt="Android Studio" width="85%" title="Android Studio" align="center"></p><h2 id="配置编辑器"><a href="#配置编辑器" class="headerlink" title="配置编辑器"></a>配置编辑器</h2><p>前面我们已经配置好了 <strong>Flutter SDK</strong> 、<strong>iOS 模拟器</strong> 、<strong>Android 模拟器</strong> ，最后我们还需要配置一下编辑器，当然您可以选择 <code>Android Studio</code> 或者 <code>VS Code</code>，这里我选择的是轻量级的 <code>VS Code</code>。</p><div class="note default"><p>如对 VS Code 不是很熟悉，可参考我之前写的 <a href="https://h.lishaoy.net/VSCodeCodingSkills.html">VS Code 编辑技巧</a> </p></div>  <p>打开终端进入我们刚才新建的 Flutter 项目</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> new_flutter</span><br></pre></td></tr></table></figure><p>再用 VS Code 打开项目</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code ./</span><br></pre></td></tr></table></figure><p>打开项目之后 <kbd>⌘</kbd> - <kbd>⇧</kbd> - <kbd>X</kbd> ,打开扩展，安装 <strong>Flutter</strong> 插件，如图</p><p><img src="https://cdn.lishaoy.net/flutterInstall/flutter_install.gif" alt="Android Studio" width="88%" title="Flutter install" align="center"></p><p>完成之后，打开项目目录 <code>lib-&gt;main.dart</code> 文件， VS Code 会自动提示你安装 Dart 语言扩展包。</p><h2 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h2><p>现在，所有的准备工作都完成了，就可以开发、测试或运行项目了，在上面我们用 <code>Flutter create</code> 命令创建的 Flutter 项目，自带一个计数器的小功能，我们可以运行看看效果</p><p>首先，您需要执行 <code>flutter doctor</code> 来检查一下环境是否正常</p><p><img src="https://cdn.lishaoy.net/flutterInstall/flutter_run.png" alt="no-shadow" title="Flutter run"></p><p>如上图第二项提示 <code>Android license status unknown.</code> 意思是 Android 协议没安装好，可以执行以下命令，来解决问题</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter doctor --android-licenses</span><br></pre></td></tr></table></figure><p>如上图第三项是 iOS 真机的检查项，可以按照提示操作<br>如上图第四项是 Java 的编辑器检查，可不用理会，如你没有安装 IDEA 也不会有这个提示</p><p>其实在我另一台电脑上全部都配置好了 😝 ，如图</p><p><img src="https://cdn.lishaoy.net/flutterInstall/flutter_run1.png" alt="no-shadow" title="Flutter run"></p><p>最后，在 VS Code 编辑器里按 <strong>F5</strong> 后，会让你选择模拟器来运行 Flutter 程序，如图</p><p><img src="https://cdn.lishaoy.net/flutterInstall/flutter_run1.gif" alt="Flutter run" width="88%" title="Flutter run" align="center"></p><p>这个是分别在 iOS 和 Android 运行 Flutter 的效果，如图</p><p><img src="https://cdn.lishaoy.net/flutterInstall/demo.png" alt="no-shadow" title="Flutter run"></p><h2 id="运行-Flutter-案例"><a href="#运行-Flutter-案例" class="headerlink" title="运行 Flutter 案例"></a>运行 Flutter 案例</h2><p>现在所有的都准备好了，您可以去我的 GitHub 上下载上篇文章中的案例代码，也可以 <code>git clone</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$HOME</span>/Desktop <span class="comment">#进到桌面</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/persilee/flutter_pro.git <span class="comment">#下载案例</span></span><br><span class="line"><span class="built_in">cd</span> flutter_pro <span class="comment">#进入案例目录</span></span><br><span class="line">flutter packages get <span class="comment">#获取依赖包</span></span><br><span class="line">code ./ <span class="comment">#用 VS Code 打开</span></span><br></pre></td></tr></table></figure><p>完成以上步骤后，在 VS Code 按 F5 选择模拟器，查看运行效果，如图</p><p><img src="https://cdn.lishaoy.net/flutterInstall/flutter_run5.png" alt="no-shadow" title="Flutter Demo"></p><p>好的，大功告成，这篇到处为止，下篇将手拉手带大家完成一个实操小案例 。</p>]]></content:encoded>
      
      <comments>https://h.lishaoy.net/flutterInstall.html#disqus_thread</comments>
    </item>
    
    <item>
      <title>Flutter：手拉手带你极速构建漂亮的跨平台移动应用 ✿ 初识</title>
      <link>https://h.lishaoy.net/beautifulFlutter.html</link>
      <guid>https://h.lishaoy.net/beautifulFlutter.html</guid>
      <pubDate>Mon, 05 Nov 2018 02:41:09 GMT</pubDate>
      <description>
      
        &lt;span itemprop=&quot;image&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/ImageObject&quot;&gt;&lt;img itemprop=&quot;url image&quot; src=&quot;/images/loading.gif&quot; data-original=&quot;https://cdn.lishaoy.net/beautifulFlutter/flutter_750x400.png&quot; class=&quot;full-image&quot; alt=&quot;Flutter&quot; title=&quot;Flutter&quot;&gt;&lt;meta itemprop=&quot;width&quot; content=&quot;auto&quot;&gt;&lt;meta itemprop=&quot;height&quot; content=&quot;auto&quot;&gt;&lt;/span&gt;
&lt;p&gt;最近，学习了一些 &lt;code&gt;Flutter&lt;/code&gt; 相关的知识，做了如下的小移动应用，当然是一套代码即可在 &lt;code&gt;iOS&lt;/code&gt; 平台运行,也可以在 &lt;code&gt;Android&lt;/code&gt; 运行。&lt;/p&gt;
&lt;p&gt;下面我将手拉手带您快速构建出漂亮的移动应用界面（如下👇小视频）&lt;/p&gt;
&lt;video id=&quot;flutter&quot; class=&quot;video-js vjs-default-skin&quot; controls preload=&quot;auto&quot; poster=&quot;https://cdn.lishaoy.net/flutter_start/flutter5.1.png&quot; data-setup=&quot;{&#39;example_option&#39;:true}&quot;&gt;
    &lt;source src=&quot;https://cdn.lishaoy.net/flutter_start/flutter7.mp4&quot; type=&quot;video/mp4&quot;&gt;
&lt;/video&gt;

&lt;hr&gt;
      
      </description>
      
      <content:encoded><![CDATA[<span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="/images/loading.gif" data-original="https://cdn.lishaoy.net/beautifulFlutter/flutter_750x400.png" class="full-image" alt="Flutter" title="Flutter"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><p>最近，学习了一些 <code>Flutter</code> 相关的知识，做了如下的小移动应用，当然是一套代码即可在 <code>iOS</code> 平台运行,也可以在 <code>Android</code> 运行。</p><p>下面我将手拉手带您快速构建出漂亮的移动应用界面（如下👇小视频）</p><video id="flutter" class="video-js vjs-default-skin" controls preload="auto" poster="https://cdn.lishaoy.net/flutter_start/flutter5.1.png" data-setup="{'example_option':true}">    <source src="https://cdn.lishaoy.net/flutter_start/flutter7.mp4" type="video/mp4"></video><hr><a id="more"></a><h2 id="初识-Flutter"><a href="#初识-Flutter" class="headerlink" title="初识 Flutter"></a>初识 Flutter</h2><p><a href="https://flutterchina.club" target="_blank" rel="noopener">Flutter</a> 是谷歌的移动UI框架，可以快速在iOS和Android上构建高质量的原生用户界面。</p><p>Google 推出 Flutter 移动应用框架已经有三年，直到今年的 Google I/O 开发大会才正式介绍 <code>Flutter</code> 且发布 Beta 版本, <a href="https://www.youtube.com/watch?v=w2TcYP8qiRI" target="_blank" rel="noopener">Flutter Google I/O 视频</a> 这个是 <code>Flutter</code> 在油管（YouTube）的 Google I/O 开发者大会的视频，请自行观看。</p><p>再来看看更加生动的视频介绍，加速您的初识 <code>Flutter</code></p><video id="IntroducingFlutter" class="video-js vjs-default-skin" controls preload="auto" poster="https://cdn.lishaoy.net/beautifulFlutter/IntroducingFlutter1.png" data-setup="{'example_option':true}">    <source src="https://cdn.lishaoy.net/beautifulFlutter/IntroducingFlutter.mp4" type="video/mp4"></video><hr><p>Google 的广告应用 Adwords，阿里的闲鱼 App 都是基于 <code>Flutter</code> 框架开发的。</p><p>以下是阿里巴巴用 Flutter 打造了5000多万用户闲鱼 App (Flutter Developer Story) 的故事视频</p><video id="FlutterDeveloperStory" class="video-js vjs-default-skin" controls preload="auto" poster="https://cdn.lishaoy.net/beautifulFlutter/FlutterDeveloperStory2.png" data-setup="{'example_option':true}">    <source src="https://cdn.lishaoy.net/beautifulFlutter/FlutterDeveloperStory.mp4" type="video/mp4"></video><hr><p><code>Flutter</code> 作为谷歌推出的跨平台开发框架，一经推出便吸引了不少注意,在 GitHub 上的 Star 数已超过 <strong>4W+</strong> 。</p><p><a href="https://www.bilibili.com/video/av27857568/" target="_blank" rel="noopener">CMTC全球大前端技术大会 ㄧ Flutter视频</a> 这是 Google中国在 <strong>bilibili</strong> 上发布的视频，请自行观看。</p><h2 id="Flutter-特性"><a href="#Flutter-特性" class="headerlink" title="Flutter 特性"></a>Flutter 特性</h2><p>通过以上的视频，对于 <code>Flutter</code> 已有所认识，下面再来看看 <code>Flutter</code> 的以下特性</p><h3 id="热重载"><a href="#热重载" class="headerlink" title="热重载"></a>热重载</h3><p>当你修改了代码 <kbd>⌘</kbd> - <kbd>S</kbd> ，可立刻看到效果，而且可以保持界面状态不变（如文本框输入的信息不会改变），如图：</p><p><img src="https://cdn.lishaoy.net/beautifulFlutter/HotReload1.gif" alt="no-shadow" title="Hot reload"></p><h3 id="设计"><a href="#设计" class="headerlink" title="设计"></a>设计</h3><p><code>Flutter</code> 自带 Google 推行的设计系统：<a href="https://www.material.io" target="_blank" rel="noopener">Material Design</a> ，它提供了丰富的 <strong>Material Design</strong> 风格的组件（比如：按钮、输入框、对话框、导航栏、边栏等），而且也提供了丰富的 <strong>iOS（Cupertino）</strong> 风格的组件，利用这些风格的组件能够快速的构建应用，如图</p><p><img src="https://cdn.lishaoy.net/beautifulFlutter/Material.jpg" alt="no-shadow" title="Material Design"></p><h3 id="widget"><a href="#widget" class="headerlink" title="widget"></a>widget</h3><p><strong>widget</strong> 是 <code>Flutter</code> 应用程序基本构建块, <code>Flutter</code> 既不使用 WebView，也不使用操作系统的原生控件，相反 <code>Flutter</code> 使用自己的高性能渲染引擎来绘制<strong>widget</strong> ， <code>Flutter</code> 的中心思想是用 <strong>widget</strong> 构建你的 UI（<strong>一切皆为 widget</strong>） ，如图是官网给出的框架图：</p><p><img src="https://cdn.lishaoy.net/beautifulFlutter/widget.png" alt="no-shadow" title="widget"></p><p>在这个架构里，你可以实现 <code>Flutter</code> 提供的所有现成的 <strong>widget</strong> ，也可以创建自己定制的 <strong>widget</strong> ，每个 <strong>widget</strong> 都是公开的，你可以从高层次且统一的 <strong>widget</strong> 中获得开发效率优势，这个设计的目标是为了用更少的代码做更多的事情。</p><h3 id="语言"><a href="#语言" class="headerlink" title="语言"></a>语言</h3><p><code>Flutter</code> 使用 C、C ++、Dart 和 Skia（2D渲染引擎）技术构建，如上图，底层（engine）是用 C ++ ，框架是用 Dart ，当然我们开发使用的也是 Dart。</p><p>Dart 是 Google 发布的一种高效、简洁、拥有完整类型系统的 <code>结构化的Web编程</code> 语言， <code>Flutter</code> 官方给出为什么选择 Dart 作为开发语言的原因，如下</p><ul><li>开发人员的效率</li><li>面向对象</li><li>可预测，高性能</li><li>快速内存分配</li></ul><p>对于开发者（语言使用者）来说，不必太担心，Dart 和 Java 、 JavaScript 比较类似，有一些程序语言基础，便可拿来即用（不清楚的看看语法、关键字、类型即可）。</p><p>现在想必您对 <code>Flutter</code> 已经有了一定的认识，在之后的篇幅了会手拉手带你极速构如文头小视频的小应用。</p><p><img class="hidden" src="https://cdn.lishaoy.net/beautifulFlutter/flutter_750x400.png" alt="VS Code" width="100%" title="VS Code" align="center"></p>]]></content:encoded>
      
      <comments>https://h.lishaoy.net/beautifulFlutter.html#disqus_thread</comments>
    </item>
    
    <item>
      <title>VS Code：让你工作效率翻倍的23个插件和23个编辑技巧</title>
      <link>https://h.lishaoy.net/VSCodeCodingSkills.html</link>
      <guid>https://h.lishaoy.net/VSCodeCodingSkills.html</guid>
      <pubDate>Sat, 13 Oct 2018 07:39:44 GMT</pubDate>
      <description>
      
        &lt;span itemprop=&quot;image&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/ImageObject&quot;&gt;&lt;img itemprop=&quot;url image&quot; src=&quot;/images/loading.gif&quot; data-original=&quot;https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code.jpg&quot; class=&quot;full-image&quot; alt=&quot;VS Code&quot; title=&quot;VS Code&quot;&gt;&lt;meta itemprop=&quot;width&quot; content=&quot;auto&quot;&gt;&lt;meta itemprop=&quot;height&quot; content=&quot;auto&quot;&gt;&lt;/span&gt;
&lt;p&gt;总结了一些平时常用且好用的 &lt;strong&gt;VS Code&lt;/strong&gt; 的插件和编辑技巧分享出来。&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="/images/loading.gif" data-original="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code.jpg" class="full-image" alt="VS Code" title="VS Code"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><p>总结了一些平时常用且好用的 <strong>VS Code</strong> 的插件和编辑技巧分享出来。</p><a id="more"></a><h2 id="外观"><a href="#外观" class="headerlink" title="外观"></a>外观</h2><h3 id="主题"><a href="#主题" class="headerlink" title="主题"></a>主题</h3><p>这里我分享两款主题：</p><ol><li><strong><a href="https://marketplace.visualstudio.com/items?itemName=Equinusocio.vsc-material-theme" target="_blank" rel="noopener">Material Theme</a></strong></li></ol><p>效果如图：</p><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_theme1.jpg" alt="no-shadow" title="Material Theme"></p><ol start="2"><li><strong><a href="https://marketplace.visualstudio.com/items?itemName=dustinsanders.an-old-hope-theme-vscode" target="_blank" rel="noopener">An Old Hope Theme</a></strong></li></ol><p>效果如图：</p><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_theme2.jpg" alt="no-shadow" title="An Old Hope Theme"></p><h3 id="图标"><a href="#图标" class="headerlink" title="图标"></a>图标</h3><ol start="3"><li><strong><a href="https://marketplace.visualstudio.com/items?itemName=PKief.material-icon-theme" target="_blank" rel="noopener">Material Icon Theme</a></strong>当然，这两款主题的文件管理器（左侧）的 icon 小图标使用的是 Material Icon Theme</li></ol><h3 id="字体及其他"><a href="#字体及其他" class="headerlink" title="字体及其他"></a>字体及其他</h3><p>其他和外观相关的设置如下：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"editor.multiCursorModifier"</span>: <span class="string">"ctrlCmd"</span>,</span><br><span class="line">    <span class="attr">"editor.formatOnPaste"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"workbench.activityBar.visible"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"workbench.iconTheme"</span>: <span class="string">"eq-material-theme-icons-darker"</span>,</span><br><span class="line">    <span class="attr">"workbench.colorCustomizations"</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">"materialTheme.cache.workbench.settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"themeColours"</span>: <span class="string">"Darker"</span>,</span><br><span class="line">        <span class="attr">"accentPrevious"</span>: <span class="string">"Acid Lime"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"workbench.colorTheme"</span>: <span class="string">"Material Theme Darker"</span>,</span><br><span class="line">    <span class="attr">"material-icon-theme.angular.iconsEnabled"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"material-icon-theme.folders.icons"</span>: <span class="string">"specific"</span>,</span><br><span class="line">    <span class="attr">"editor.lineHeight"</span>: <span class="number">24</span>,</span><br><span class="line">    <span class="attr">"editor.fontLigatures"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"editor.fontFamily"</span>: <span class="string">"FiraCode-Medium"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>特别注意的是 <code>&quot;editor.lineHeight&quot;: 24,</code> 和 <code>&quot;editor.fontFamily&quot;: &quot;FiraCode-Medium&quot;</code> 。</p><p><code>&quot;editor.lineHeight&quot;: 24,</code> ： 设置代码的行间距，这里比默认的稍大些，就这一点小小的改变，让代码看起来清爽整洁。</p><p><code>&quot;editor.fontFamily&quot;: &quot;FiraCode-Medium&quot;</code> ： 设置字体，这种字体会让代码看起来更形象生动，如下</p><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_code3.png" alt="FiraCode-Medium字体" width="100%" title="FiraCode-Medium字体" align="center"></p><p>红色竖线左边是使用了 <strong>FiraCode-Medium</strong> 字体的效果，红色竖线右边是没有使用 <strong>FiraCode-Medium</strong> 字体的效果</p><p>关于 <strong>FiraCode-Medium</strong> 字体更多效果可查阅 <a href="https://github.com/tonsky/FiraCode" target="_blank" rel="noopener">https://github.com/tonsky/FiraCode</a> 地址。</p><h2 id="代码管理"><a href="#代码管理" class="headerlink" title="代码管理"></a>代码管理</h2><h3 id="格式化"><a href="#格式化" class="headerlink" title="格式化"></a>格式化</h3><ol start="4"><li><strong><a href="https://marketplace.visualstudio.com/items?itemName=HookyQR.beautify" target="_blank" rel="noopener">Beautify</a></strong> ：格式化的时候，给出格式化文本选项，如下</li></ol><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_Beatify.gif" alt="Beautify" width="100%" title="Beautify" align="center"></p><ol start="5"><li><strong><a href="https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode" target="_blank" rel="noopener">Prettier</a></strong> ：个人比较喜欢这个，看起来代码更清晰，如下</li></ol><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_Prettier.gif" alt="Prettier" width="100%" title="Prettier" align="center"></p><div class="note info"><p>当然，大家可以自定义快捷键，也可以按 <kbd>⌘</kbd> - <kbd>⇧</kbd> - <kbd>P</kbd>  来搜索相关命令 </p></div>  <h3 id="代码检查"><a href="#代码检查" class="headerlink" title="代码检查"></a>代码检查</h3><ol start="6"><li><a href="https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint" target="_blank" rel="noopener">ESLint</a> ：检查 <code>js</code> 语法规范，你可以使用不同的规范，如 <a href="https://www.npmjs.com/package/eslint-config-airbnb" target="_blank" rel="noopener">airbnb</a> 、<a href="https://github.com/standard/eslint-config-standard" target="_blank" rel="noopener">standard</a> 、<a href="https://github.com/google/eslint-config-google" target="_blank" rel="noopener">google</a>。</li><li><a href="https://marketplace.visualstudio.com/items?itemName=eg2.tslint" target="_blank" rel="noopener">TSLint</a> ：检查 <code>typescript</code> 语法规范。</li><li><a href="https://marketplace.visualstudio.com/items?itemName=shinnn.stylelint" target="_blank" rel="noopener">Stylelint</a> ：检查 <code>CSS/SCSS/Less</code> 语法规范。</li><li><a href="https://marketplace.visualstudio.com/items?itemName=DavidAnson.vscode-markdownlint" target="_blank" rel="noopener">Markdownlint</a> ：检查 <code>markdown</code> 语法规范。</li></ol><h3 id="自动补全"><a href="#自动补全" class="headerlink" title="自动补全"></a>自动补全</h3><p>以下插件点击链接可以查看gif动图，详细了解具体功能。</p><ol start="10"><li><a href="https://emmet.io" target="_blank" rel="noopener">Emmet</a> ：大家应该很熟悉这个插件了（很好用），VS Code 已经内置了，很到位。</li><li><a href="https://marketplace.visualstudio.com/items?itemName=formulahendry.auto-close-tag" target="_blank" rel="noopener">Auto Close Tag</a> ：自动闭合 <code>html</code> 等标签 （&lt;/…&gt;）。</li><li><a href="https://marketplace.visualstudio.com/items?itemName=formulahendry.auto-rename-tag" target="_blank" rel="noopener">Auto Rename Tag</a> ：修改 <code>html</code> 标签时，自动修改闭合标签。</li><li><a href="https://marketplace.visualstudio.com/items?itemName=christian-kohler.path-intellisense" target="_blank" rel="noopener">Path Intellisense</a> ：自动提示补全路径。</li></ol><h3 id="代码片段"><a href="#代码片段" class="headerlink" title="代码片段"></a>代码片段</h3><ol start="14"><li><strong>snippets</strong> ：搭建可以自己安装各种代码片段（vue、react、angular等），这里就不列举。</li></ol><h2 id="功能扩展"><a href="#功能扩展" class="headerlink" title="功能扩展"></a>功能扩展</h2><p>以下的功能扩展插件大部分都有gif动图，可点击链接了解详细功能</p><ol start="15"><li><a href="https://marketplace.visualstudio.com/items?itemName=CoenraadS.bracket-pair-colorizer" target="_blank" rel="noopener">Bracket Pair Colorizer</a> ：让代码的各种括号呈现不同的颜色。</li><li><a href="https://marketplace.visualstudio.com/items?itemName=formulahendry.code-runner" target="_blank" rel="noopener">Code Runner</a> ：可以在编辑器里直接运行代码，查看结果。</li><li><a href="https://marketplace.visualstudio.com/items?itemName=anseki.vscode-color" target="_blank" rel="noopener">Color Picker</a> ：可以直接在编辑器里打开色板，选择各种模式的颜色。</li><li><a href="https://marketplace.visualstudio.com/items?itemName=joelday.docthis" target="_blank" rel="noopener">Document This</a> ：可以给函数、类等自动的加上详细的注释。</li><li><a href="https://marketplace.visualstudio.com/items?itemName=donjayamanne.githistory" target="_blank" rel="noopener">Git History</a> ：方便的查看git版本管理的详细信息。</li><li><a href="https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer" target="_blank" rel="noopener">Live Server</a> ：可以一键在本地启动服务器。</li><li><a href="https://marketplace.visualstudio.com/items?itemName=Shan.code-settings-sync" target="_blank" rel="noopener">Settings Sync</a> ：重点介绍下这个插件，如果你有两台电脑（比如，家里和公司）都使用 VS Code ，可是在公司或家里对 VS Code 安装了插件或者修改了配置，回到家或公司又要重新弄一次，这个插件就能解决问题，同步多台电脑设置。</li></ol><p>只需要把配置上传到GitHub，在另一个地方下载配置即可，如下</p><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_Sync.gif" alt="Settings Sync" width="100%" title="Settings Sync" align="center"></p><ol start="22"><li><a href="https://marketplace.visualstudio.com/items?itemName=rubbersheep.gi" target="_blank" rel="noopener">gi</a> ：可以给 <code>.gitignore</code> 文件添加各种语言忽略文件配置。</li><li><a href="https://marketplace.visualstudio.com/items?itemName=pnp.polacode" target="_blank" rel="noopener">Polacode</a> ：可以把代码生成图片（有些地方发代码结构会乱也没有代码高亮，这时候就可以生成图片再发）。</li></ol><h2 id="编辑技巧"><a href="#编辑技巧" class="headerlink" title="编辑技巧"></a>编辑技巧</h2><h3 id="光标"><a href="#光标" class="headerlink" title="光标"></a>光标</h3><ol><li>把光标移到文件的首部或尾部</li></ol><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_1.gif" alt="⌘ - ↑ 或 ⌘ - ↓" width="100%" title="⌘ - ↑ 或 ⌘ - ↓" align="center"></p><ol start="2"><li>把光标移动到行的首部或者尾部</li></ol><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_2.gif" alt="⌘ - ← 或 ⌘ - →" width="100%" title="⌘ - ← 或 ⌘ - →" align="center"></p><ol start="3"><li>按单词移动</li></ol><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_3.gif" alt="⌥ - ← 或 ⌥ - →" width="100%" title="⌥ - ← 或 ⌥ - →" align="center"></p><ol start="4"><li>按单词大小写分解移动光标</li></ol><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_4.gif" alt="⌥ - ⌃ - ← 或 ⌥ - ⌃ - →" width="100%" title="⌥ - ⌃ - ← 或 ⌥ - ⌃ - →" align="center"></p><h3 id="选择"><a href="#选择" class="headerlink" title="选择"></a>选择</h3><ol start="5"><li>选择行以上或以下全部内容</li></ol><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_5.gif" alt="⇧ - ⌘ - ↑ 或 ⇧ - ⌘ - ↓" width="100%" title="⇧ - ⌘ - ↑ 或 ⇧ - ⌘ - ↓" align="center"></p><ol start="6"><li>选择到行首或行尾的内容</li></ol><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_6.gif" alt="⇧ - ⌘ - ← 或 ⇧ - ⌘ - →" width="100%" title="⇧ - ⌘ - ← 或 ⇧ - ⌘ - →" align="center"></p><ol start="7"><li>按字母或单词选择</li></ol><ul><li><kbd>⇧</kbd> - <kbd>←</kbd> 、 <kbd>⇧</kbd> - <kbd>→</kbd> 按字母选择   </li><li><kbd>⇧</kbd> - <kbd>⌥</kbd> - <kbd>←</kbd> 、 <kbd>⇧</kbd> - <kbd>⌥</kbd> - <kbd>→</kbd> 按单词选择</li></ul><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_7.gif" alt="⇧ - ← 、 ⇧ - → 或 ⇧ - ⌥ - ← 、 ⇧ - ⌥ - →" width="100%" title="⇧ - ← 、 ⇧ - → 或 ⇧ - ⌥ - ← 、⇧ - ⌥ - →" align="center"></p><ol start="8"><li>伸缩选择</li></ol><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_8.gif" alt="⇧ - ⌃ - ⌘ - ← 或 ⇧ - ⌃ - ⌘ - →" width="100%" title="⇧ - ⌃ - ⌘ - ← 或 ⇧ - ⌃ - ⌘ - →" align="center"></p><ol start="9"><li>选择匹配单词</li></ol><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_9.gif" alt="⌘ - D 或 ⌘ - U" width="100%" title="⌘ - D 或 ⌘ - U" align="center"></p><h3 id="行"><a href="#行" class="headerlink" title="行"></a>行</h3><ol start="10"><li>向上或向下移动行</li></ol><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_10.gif" alt="⌥ - ↑ 或 ⌥ - ↓" width="100%" title="⌥ - ↑ 或 ⌥ - ↓" align="center"></p><ol start="11"><li>复制或删除行</li></ol><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_11.gif" alt="⌥ - ⇧ - ↓ 或 ⌘ - ⇧ - K" width="100%" title="⌥ - ⇧ - ↓ 或 ⌘ - ⇧ - K" align="center"></p><ol start="12"><li>多行合并成一行</li></ol><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_12.gif" alt="⌘ - J" width="100%" title="⌘ - J" align="center"></p><ol start="13"><li>缩进或伸缩行</li></ol><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_13.gif" alt="⌘ - [ 或 ⌘ - ]" width="100%" title="⌘ - [ 或 ⌘ - ]" align="center"></p><ol start="14"><li>在当前行之上或下插入行</li></ol><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_14.gif" alt="⌘ - ↩ 或 ⌘ - ⇧ - ↩" width="100%" title="⌘ - ↩ 或 ⌘ - ⇧ - ↩" align="center"></p><h3 id="多行"><a href="#多行" class="headerlink" title="多行"></a>多行</h3><ol start="15"><li>鼠标点击，多行编辑</li></ol><p>按 <kbd>⌘</kbd> 选择编辑点，按 <kbd>⎋</kbd> 退出多行编辑</p><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_15.gif" alt="⌘" width="100%" title="⌘" align="center"></p><ol start="16"><li>使用快捷键多行编辑</li></ol><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_16.gif" alt="⌘ - ⌥ - ↓ 或 ⌘ - ⌥ - ↑" width="100%" title="⌘ - ⌥ - ↓ 或 ⌘ - ⌥ - ↑" align="center"></p><ol start="17"><li>在所选择的行的结尾插入编辑点</li></ol><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_17.gif" alt="⇧ - ⌥ - I" width="100%" title="⇧ - ⌥ - I" align="center"></p><ol start="18"><li>选择栏位</li></ol><p>按 <kbd>⇧</kbd> - <kbd>⌘</kbd> 再选择栏位</p><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_18.gif" alt="⇧ - ⌘" width="100%" title="⇧ - ⌘" align="center"></p><h3 id="高级"><a href="#高级" class="headerlink" title="高级"></a>高级</h3><ol start="19"><li>查看类或方法的定义</li></ol><ul><li>按 <kbd>⌥</kbd> 点击，可以在新页面查看</li><li>按 <kbd>⇧</kbd> - <kbd>⌥</kbd> - <kbd>⌘</kbd> 点击，可以在新组查看</li><li>按 <kbd>⇧</kbd> - <kbd>F12</kbd> 点击，可以在当前页面查看</li></ul><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_19.gif" alt="查看定义" width="100%" title="查看定义" align="center"></p><ol start="20"><li>折叠代码</li></ol><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_20.gif" alt="⌥ - ⌘ - ] 或 ⌥ - ⌘ - [" width="100%" title="⌥ - ⌘ - ] 或 ⌥ - ⌘ - [" align="center"></p><ol start="21"><li>去掉选择行的尾部空格</li></ol><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_21.gif" alt="⌘ - K 、 ⌘ - X" width="100%" title="⌘ - K 、 ⌘ - X" align="center"></p><ol start="22"><li>定位到指定行号</li></ol><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_22.gif" alt="⌃ - G" width="100%" title="⌃ - G" align="center"></p><ol start="23"><li>在文件里查找类或方法</li></ol><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_23.gif" alt="@" width="100%" title="@" align="center"></p><p>最后，如果记不住这些快捷键，可以按 <kbd>⌘</kbd> - <kbd>K</kbd> 、 <kbd>⌘</kbd> - <kbd>S</kbd> 搜索对应快捷键绑定</p><p><img src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code_24.gif" alt="搜索快捷键" width="100%" title="搜索快捷键" align="center"></p><p><img class="hidden" src="https://cdn.lishaoy.net/VSCodeCodingSkills/vs-code.jpg" alt="VS Code" width="100%" title="VS Code" align="center"></p>]]></content:encoded>
      
      <comments>https://h.lishaoy.net/VSCodeCodingSkills.html#disqus_thread</comments>
    </item>
    
    <item>
      <title>百度统计</title>
      <link>https://h.lishaoy.net/baidustatistics.html</link>
      <guid>https://h.lishaoy.net/baidustatistics.html</guid>
      <pubDate>Tue, 29 May 2018 19:48:15 GMT</pubDate>
      <description>
      
        &lt;span itemprop=&quot;image&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/ImageObject&quot;&gt;&lt;img itemprop=&quot;url image&quot; src=&quot;/images/loading.gif&quot; data-original=&quot;https://cdn.lishaoy.net/baidustatistics/lishaoy.net.990x699.jpg&quot; class=&quot;full-image&quot; alt=&quot;lishaoy.net&quot; title=&quot;lishaoy.net&quot;&gt;&lt;meta itemprop=&quot;width&quot; content=&quot;auto&quot;&gt;&lt;meta itemprop=&quot;height&quot; content=&quot;auto&quot;&gt;&lt;/span&gt;
&lt;p&gt;前天，弄了个百度统计，看看数据还挺有意思。。。&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="/images/loading.gif" data-original="https://cdn.lishaoy.net/baidustatistics/lishaoy.net.990x699.jpg" class="full-image" alt="lishaoy.net" title="lishaoy.net"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><p>前天，弄了个百度统计，看看数据还挺有意思。。。</p><a id="more"></a><p><strong>站点</strong> 接入 <strong>百度统计</strong> ，还是挺简单的：</p><ul><li>首先，去 <a href="https://tongji.baidu.com/web/welcome/login" target="_blank" rel="noopener">百度统计</a> 注册账号，根据提示绑定自己站点域名</li><li>之后，把提供的 <code>js</code> 代码放到自己站点</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//百度统计</span></span><br><span class="line"><span class="keyword">var</span> _hmt = _hmt || [];</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> hm = <span class="built_in">document</span>.createElement(<span class="string">"script"</span>);</span><br><span class="line">  hm.src = <span class="string">"https://hm.baidu.com/hm.js?5fd52c901f2213883f51a476eab3914b"</span>;</span><br><span class="line">  <span class="keyword">var</span> l = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"script"</span>).length;</span><br><span class="line">  <span class="keyword">var</span> s = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"script"</span>)[l - <span class="number">1</span>];</span><br><span class="line">  s.parentNode.insertBefore(hm, s);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>这些设置好之后，就可以看到统计数据了，来看看 👀 <em>2018-05-29</em> 当天的统计数据情况如何</p><h4 id="今日流量"><a href="#今日流量" class="headerlink" title="今日流量"></a>今日流量</h4><p>纵轴分别是 <em>今日、昨日、预计今日</em> ，横轴分别是 <em>PV、UV、IP、跳出率、平均访问时长</em> 等 （预计今日的数据，不是很靠谱）</p><p><img src="https://cdn.lishaoy.net/baidustatistics/1.png" alt="今日流量" width="100%" title="今日流量" align="center"></p><h4 id="来源网站"><a href="#来源网站" class="headerlink" title="来源网站"></a>来源网站</h4><p>会列出访客从哪儿来到你的<strong>站点</strong>，以及会统计访问时长等</p><p><img src="https://cdn.lishaoy.net/baidustatistics/2.png" alt="来源网站" width="100%" title="来源网站" align="center"></p><h4 id="受欢迎页面"><a href="#受欢迎页面" class="headerlink" title="受欢迎页面"></a>受欢迎页面</h4><p>会统计每个页面的 <em>浏览量、退出次数、平均停留时间</em> 等</p><p><img src="https://cdn.lishaoy.net/baidustatistics/3.png" alt="受欢迎页面" width="100%" title="受欢迎页面" align="center"></p><h4 id="新老访客"><a href="#新老访客" class="headerlink" title="新老访客"></a>新老访客</h4><p>会统计新老访客 <em>浏览量、平均访问时长、平均访问页数</em> 等</p><p><img src="https://cdn.lishaoy.net/baidustatistics/4.png" alt="新老访客" width="100%" title="新老访客" align="center"></p><h4 id="地域分布"><a href="#地域分布" class="headerlink" title="地域分布"></a>地域分布</h4><p>会统计访客来自哪个 <em>国家、省份、城市、网络运营商</em> 等</p><p><img src="https://cdn.lishaoy.net/baidustatistics/5.png" alt="地域分布" width="100%" title="地域分布" align="center"></p><p>这里我只展示部分统计功能，如想了解其它更多功能，可去 <a href="https://tongji.baidu.com/web/welcome/login" target="_blank" rel="noopener">百度统计</a> 网站查看。</p>]]></content:encoded>
      
      <comments>https://h.lishaoy.net/baidustatistics.html#disqus_thread</comments>
    </item>
    
    <item>
      <title>前端性能优化</title>
      <link>https://h.lishaoy.net/webOptimize.html</link>
      <guid>https://h.lishaoy.net/webOptimize.html</guid>
      <pubDate>Thu, 10 May 2018 04:55:59 GMT</pubDate>
      <description>
      
        &lt;span itemprop=&quot;image&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/ImageObject&quot;&gt;&lt;img itemprop=&quot;url image&quot; src=&quot;https://cdn.lishaoy.net/webOptimize/Optimize.png&quot; class=&quot;full-image&quot; alt=&quot;web optimize&quot; title=&quot;web optimize&quot;&gt;&lt;meta itemprop=&quot;width&quot; content=&quot;auto&quot;&gt;&lt;meta itemprop=&quot;height&quot; content=&quot;auto&quot;&gt;&lt;/span&gt;
&lt;p&gt;关于 &lt;strong&gt;性能优化&lt;/strong&gt; 是个大的面，这篇文章主要涉及到 &lt;strong&gt;前端&lt;/strong&gt; 的几个点，如 &lt;strong&gt;前端性能优化&lt;/strong&gt; 的流程、常见技术手段、工具等。&lt;/p&gt;
&lt;p&gt;提及 &lt;strong&gt;前端性能优化&lt;/strong&gt; ，大家应该都会想到 &lt;strong&gt;雅虎军规&lt;/strong&gt;，本文会结合 &lt;strong&gt;雅虎军规&lt;/strong&gt; 融入自己的了解知识，进行的总结和梳理 😜&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="https://cdn.lishaoy.net/webOptimize/Optimize.png" class="full-image" alt="web optimize" title="web optimize"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><p>关于 <strong>性能优化</strong> 是个大的面，这篇文章主要涉及到 <strong>前端</strong> 的几个点，如 <strong>前端性能优化</strong> 的流程、常见技术手段、工具等。</p><p>提及 <strong>前端性能优化</strong> ，大家应该都会想到 <strong>雅虎军规</strong>，本文会结合 <strong>雅虎军规</strong> 融入自己的了解知识，进行的总结和梳理 😜</p><a id="more"></a><p>首先，我们先来看看 👀 <strong>雅虎军规</strong> 的 <strong>35</strong> 条。</p><div class="note info"><ol><li>尽量减少 HTTP 请求个数——须权衡</li><li>使用 <strong>CDN</strong>（内容分发网络）</li><li>为文件头指定 Expires 或 Cache-Control ，使内容具有缓存性。</li><li>避免空的 src 和 href</li><li>使用 gzip 压缩内容</li><li>把 CSS 放到顶部</li><li>把 JS 放到底部</li><li>避免使用 CSS 表达式</li><li>将 CSS 和 JS 放到外部文件中</li><li>减少 DNS 查找次数</li><li>精简 CSS 和 JS</li><li>避免跳转</li><li>剔除重复的 JS 和 CSS</li><li>配置 ETags</li><li>使 AJAX 可缓存</li><li>尽早刷新输出缓冲</li><li>使用 GET 来完成 AJAX 请求</li><li>延迟加载</li><li>预加载</li><li>减少 DOM 元素个数</li><li>根据域名划分页面内容</li><li>尽量减少 iframe 的个数</li><li>避免 404</li><li>减少 Cookie 的大小</li><li>使用无 cookie 的域</li><li>减少 DOM 访问</li><li>开发智能事件处理程序</li><li>用 <link> 代替 @import</li><li>避免使用滤镜</li><li>优化图像</li><li>优化 CSS Spirite</li><li>不要在 HTML 中缩放图像——须权衡</li><li>favicon.ico要小而且可缓存</li><li>保持单个内容小于25K</li><li>打包组件成复合文本</li></ol></div>  <p>如对 <strong>雅虎军规</strong> 的具体细则内容不是很了解，可自行去各搜索 🔍 引擎 ，搜索 <strong>雅虎军规</strong> 了解详情。</p><h2 id="压缩-合并"><a href="#压缩-合并" class="headerlink" title="压缩 合并"></a>压缩 合并</h2><p>对于 <strong>前端性能优化</strong> 自然要关注 <strong>首屏</strong> 打开速度，而这个速度，很大因素是花费在网络请求上，那么怎么减少网络请求的时间呢？</p><ul><li>减少网络请求次数 </li><li>减小文件体积</li><li>使用 <code>CDN</code> 加速</li></ul><p>所以 <strong>压缩、合并</strong> 就是一个解决方案，当然可以用 <code>gulp</code> 、 <code>webpack</code> 、 <code>grunt</code> 等构建工具 <strong>压缩、合并</strong></p><h3 id="JS、CSS-压缩-合并"><a href="#JS、CSS-压缩-合并" class="headerlink" title="JS、CSS 压缩 合并"></a><code>JS、CSS</code> 压缩 合并</h3><p>例如：<code>gulp js、css</code> 压缩、合并代码如下 👇</p><figure class="highlight javascript"><figcaption><span>javascript</span><a href="https://lishaoy.net/webOptimize.html#JS、CSS-压缩-合并" target="_blank" rel="noopener">gulpfile.js</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//压缩、合并js</span></span><br><span class="line">gulp.task(<span class="string">'scripts'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.src([</span><br><span class="line">        <span class="string">'./public/lib/fastclick/lib/fastclick.min.js'</span>,</span><br><span class="line">        <span class="string">'./public/lib/jquery_lazyload/jquery.lazyload.js'</span>,</span><br><span class="line">        <span class="string">'./public/lib/velocity/velocity.min.js'</span>,</span><br><span class="line">        <span class="string">'./public/lib/velocity/velocity.ui.min.js'</span>,</span><br><span class="line">        <span class="string">'./public/lib/fancybox/source/jquery.fancybox.pack.js'</span>,</span><br><span class="line">        <span class="string">'./public/js/src/utils.js'</span>,</span><br><span class="line">        <span class="string">'./public/js/src/motion.js'</span>,</span><br><span class="line">        <span class="string">'./public/js/src/scrollspy.js'</span>,</span><br><span class="line">        <span class="string">'./public/js/src/post-details.js'</span>,</span><br><span class="line">        <span class="string">'./public/js/src/bootstrap.js'</span>,</span><br><span class="line">        <span class="string">'./public/js/src/push.js'</span>,</span><br><span class="line">        <span class="string">'./public/live2dw/js/perTips.js'</span>,</span><br><span class="line">        <span class="string">'./public/live2dw/lib/L2Dwidget.min.js'</span>,</span><br><span class="line">        <span class="string">'./public/js/src/love.js'</span>,</span><br><span class="line">        <span class="string">'./public/js/src/busuanzi.pure.mini.js'</span>,</span><br><span class="line">        <span class="string">'./public/js/src/activate-power-mode.js'</span></span><br><span class="line">    ]).pipe(concat(<span class="string">'all.js'</span>)).pipe(minify()).pipe(gulp.dest(<span class="string">'./public/dist/'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩、合并 CSS </span></span><br><span class="line">gulp.task(<span class="string">'css'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.src([</span><br><span class="line">        <span class="string">'./public/lib/font-awesome/css/font-awesome.min.css'</span>,</span><br><span class="line">        <span class="string">'./public/lib/fancybox/source/jquery.fancybox.css'</span>,</span><br><span class="line">        <span class="string">'./public/css/main.css'</span>,</span><br><span class="line">        <span class="string">'./public/css/lib.css'</span>,</span><br><span class="line">        <span class="string">'./public/live2dw/css/perTips.css'</span></span><br><span class="line">    ]).pipe(concat(<span class="string">'all.css'</span>)).pipe(minify()).pipe(gulp.dest(<span class="string">'./public/dist/'</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>然后，再把 <strong>压缩、合并</strong> 的 <code>JS、CSS</code> 放入 <code>CDN</code> , 👀 看看效果如何</p><p>如图：<em> <strong>压缩、合并</strong> 且放入 <code>CND</code> 之后的效果 </em></p><p><img src="https://cdn.lishaoy.net/webOptimize/concatJs.png" alt="首页请求速度(js)" width="100%" title="首页请求速度(js)" align="center"></p><p><img src="https://cdn.lishaoy.net/webOptimize/concatCss.png" alt="首页请求速度(css)" width="100%" title="首页请求速度(css)" align="center"></p><p>以上是 <a href="https://lishaoy.net" target="_blank" rel="noopener">lishaoy.net</a> 清除缓存后的 <strong>首页</strong> 请求速度。</p><p>可见，请求时间是 <strong>4.59 s</strong> ，总请求个数 <strong>51</strong> ， 而 <code>js</code> 的请求个数是 <strong>8</strong> ，<code>css</code> 的请求个数是 <strong>3</strong> <em>（其实就 all.css 一个，其它 2 个是 Google浏览器加载的）</em>， 而没使用 <strong>压缩、合并</strong> 时候，请求时间是 <strong>10</strong> 多秒，总请求个数有 <strong>70</strong> 多个，<code>js</code> 的请求个数是 <strong>20</strong> 多个 ，对比请求时间 <strong>性能</strong> 提升 <strong>1倍</strong> 多</p><p>如图：<em>有缓存下的首页效果</em></p><p><img src="https://cdn.lishaoy.net/webOptimize/concatJs2.png" alt="首页请求速度（缓存）" width="100%" title="首页请求速度（缓存）" align="center"></p><p>基本都是秒开 😝</p><div class="note warning"><p><em>Tips：在 <strong>压缩、合并</strong> 后，单个文件控制在 25 ~ 30 KB左右，同一个域下，最好不要多于5个资源</em></p></div> <h3 id="图片压缩、合并"><a href="#图片压缩、合并" class="headerlink" title="图片压缩、合并"></a>图片压缩、合并</h3><p>例如：<code>gulp</code> 图片压缩代码如下 👇</p><figure class="highlight javascript"><figcaption><span>javascript</span><a href="https://lishaoy.net/webOptimize.html#图片压缩、合并" target="_blank" rel="noopener">gulpfile.js</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//压缩image</span></span><br><span class="line">gulp.task(<span class="string">'imagemin'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    gulp.src(<span class="string">'./public/**/*.&#123;png,jpg,gif,ico,jpeg&#125;'</span>)</span><br><span class="line">        .pipe(imagemin())</span><br><span class="line">        .pipe(gulp.dest(<span class="string">'./public'</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>图片的合并可以采用 <code>CSS Spirite</code>，方法就是把一些小图用 <code>PS</code> 合成一张图，用 <code>css</code> 定位显示每张图片的位置</p><figure class="highlight css"><figcaption><span>css</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.top_right</span> <span class="selector-class">.phone</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(../images/top_right.png) no-repeat <span class="number">7px</span> -<span class="number">17px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">38px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.top_right</span> <span class="selector-class">.help</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(../images/top_right.png) no-repeat <span class="number">0</span> -<span class="number">47px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">38px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后，把 <strong>压缩</strong> 的图片放入 <code>CDN</code> , 👀 看看，效果如何</p><p><img src="https://cdn.lishaoy.net/webOptimize/minImages.png" alt="首页请求速度（images）" width="100%" title="首页请求速度（images）" align="center"></p><p>可见，请求时间是 <strong>1.70 s</strong> ,总请求个数 <strong>50</strong> ， 而 <code>img</code> 的请求个数是 <strong>15</strong> <em>（这里因为首页都是大图，就没有合并，只是压缩了）</em> ，但是，效果很好 😀 ，从 <strong>4.59 s</strong> 缩短到 <strong>1.70 s</strong>, 性能又提升一倍。</p><p>再看看有缓存情况如何 😏</p><p><img src="https://cdn.lishaoy.net/webOptimize/minImages1.png" alt="首页请求速度（images 缓存）" width="100%" title="首页请求速度（images 缓存）" align="center"></p><p>请求时间是 <strong>1.05 s</strong> ，有缓存和无缓存基本差不多</p><div class="note warning"><p><em>Tips：大的图片在不同终端，应该使用不同分辨率，而不应该使用缩放（百分比）</em></p></div> <p>整个 <strong>压缩、合并</strong> <em>（js、css、img）</em> 再放入 <code>CDN</code> ，请求时间从 <strong>10</strong> 多秒 ，到最后的 <strong>1.70 s</strong> ，性能提升 <strong>5</strong> 倍多，可见，这个操作必要性。</p><hr><h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><p>缓存会根据请求保存输出内容的副本，例如 <strong>页面、图片、文件</strong>，当下一个请求来到的时候:如果是相同的<code>URL</code>，缓存直接使 用本地的副本响应访问请求，而不是向源服务器再次发送请求。因此，可以从以下 <strong>2</strong> 个方面提升性能。</p><ul><li>减少相应延迟，提升响应时间</li><li>减少网络带宽消耗，节省流量</li></ul><p>我们用两幅图来了解下浏览器的 <strong>缓存机制</strong></p><p><strong>浏览器第一次请求</strong></p><p><img src="https://cdn.lishaoy.net/webOptimize/webCache3.png" alt="no-shadow" title="第一次请求"></p><p><strong>浏览器再次请求</strong></p><p><img src="https://cdn.lishaoy.net/webOptimize/webCache4.png" alt="no-shadow" title="再次请求"></p><p>从以上两幅图中，可以清楚的了解浏览器 <strong>缓存</strong> 的过程。首次访问一个 <code>URL</code> ，没有 <strong>缓存</strong> ，但是，服务器会响应一些 <code>header</code> 信息，如：<code>expires、cache-control、last-modified、etag</code> 等，来记录下次请求是否缓存、如何缓存。再次访问这个 <code>URL</code> 时候，浏览器会根据首次访问返回的 <code>header</code> 信息，来决策是否缓存、如何缓存。我们重点来分析下第二幅图，其实是分两条线路，如下 👇</p><ul><li><strong>第一条线路：</strong> 当浏览器再次访问某个 <code>URL</code> 时，会先获取资源的 <code>header</code> 信息，判断是否命中强缓存 <em>（cache-control和expires）</em> ，如命中，直接从缓存获取资源，包括响应的 <code>header</code> 信息 <em>（请求不会和服务器通信）</em> ，也就是 <strong>强缓存</strong> ，如图</li></ul><p><img src="https://cdn.lishaoy.net/webOptimize/webCache2.png" alt="强缓存" width="100%" title="强缓存" align="center"></p><ul><li><strong>第二条线路：</strong> 如没有命中 <strong>强缓存</strong> ，浏览器会发送请求到服务器，请求会携带第一次请求返回的有关缓存的 <code>header</code> 信息 <em>（Last-Modified/If-Modified-Since和Etag/If-None-Match）</em> ，由服务器根据请求中的相关 <code>header</code> 信息来比对结果是否协商缓存命中；若命中，则服务器返回新的响应 <code>header</code> 信息更新缓存中的对应 <code>header</code> 信息，但是并不返回资源内容，它会告知浏览器可以直接从缓存获取；否则返回最新的资源内容，也就是 <strong>协商缓存</strong>。</li></ul><p>现在，我们了解到浏览器缓存机制分为 <strong>强缓存、协商缓存</strong>，再来看看他们的区别 👇</p><table><thead><tr><th style="text-align:center">缓存策略</th><th style="text-align:center">获取资源形式</th><th style="text-align:center">状态码</th><th style="text-align:center">发送请求到服务器</th></tr></thead><tbody><tr><td style="text-align:center">强缓存</td><td style="text-align:center">从缓存取</td><td style="text-align:center">200（from memory cache）</td><td style="text-align:center">否，直接从缓存取</td></tr><tr><td style="text-align:center">协商缓存</td><td style="text-align:center">从缓存取</td><td style="text-align:center">304（not modified）</td><td style="text-align:center">是，通过服务器来告知缓存是否可用</td></tr></tbody></table><h3 id="强缓存"><a href="#强缓存" class="headerlink" title="强缓存"></a>强缓存</h3><p>与强缓存相关的 <code>header</code> 字段有两个：</p><h4 id="expires"><a href="#expires" class="headerlink" title="expires"></a>expires</h4><p><strong>expires：</strong> 这是 <code>http1.0</code> 时的规范，它的值为一个绝对时间的 <strong>GMT</strong> 格式的时间字符串，如 <code>Mon, 10 Jun 2015 21:31:12 GMT</code> ，如果发送请求的时间在 <strong>expires</strong> 之前，那么本地缓存始终有效，否则就会发送请求到服务器来获取资源</p><h4 id="cache-control"><a href="#cache-control" class="headerlink" title="cache-control"></a>cache-control</h4><p><strong>cache-control:</strong> <code>max-age=number</code> ，这是 <code>http1.1</code> 时出现的 <code>header</code> 信息，主要是利用该字段的 <code>max-age</code> 值来进行判断，它是一个相对值；资源第一次的请求时间和 <strong>Cache-Control</strong> 设定的有效期，计算出一个资源过期时间，再拿这个过期时间跟当前的请求时间比较，如果请求时间在过期时间之前，就能命中缓存，否则未命中， <strong>cache-control</strong> 除了该字段外，还有下面几个比较常用的设置值：</p><ul><li><strong>no-cache：</strong> 不使用本地缓存。需要使用缓存协商，先与服务器确认返回的响应是否被更改，如果之前的响应中存在 <code>ETag</code> ，那么请求的时候会与服务端验证，如果资源未被更改，则可以避免重新下载。</li><li><strong>no-store：</strong> 直接禁止游览器缓存数据，每次用户请求该资源，都会向服务器发送一个请求，每次都会下载完整的资源。</li><li><strong>public：</strong> 可以被所有的用户缓存，包括终端用户和 <code>CDN</code> 等中间代理服务器。</li><li><strong>private：</strong> 只能被终端用户的浏览器缓存，不允许 <code>CDN</code> 等中继缓存服务器对其缓存。</li></ul><div class="note warning"><p><em>Tips：如果 cache-control 与 expires 同时存在的话，cache-control 的优先级高于 expires</em></p></div> <h3 id="协商缓存"><a href="#协商缓存" class="headerlink" title="协商缓存"></a>协商缓存</h3><p>协商缓存都是由浏览器和服务器协商，来确定是否缓存，协商主要通过下面两组 <code>header</code> 字段，这两组字段都是成对出现的，即第一次请求的响应头带上某个字段 <em>（ <strong>Last-Modified</strong> 或者 <strong>Etag</strong> ）</em> ，则后续请求会带上对应的请求字段 <em>（<strong>If-Modified-Since</strong> 或者 <strong>If-None-Match</strong> ）</em> ，若响应头没有 <strong>Last-Modified</strong> 或者 <strong>Etag</strong> 字段，则请求头也不会有对应的字段。</p><h4 id="Last-Modified-If-Modified-Since"><a href="#Last-Modified-If-Modified-Since" class="headerlink" title="Last-Modified/If-Modified-Since"></a>Last-Modified/If-Modified-Since</h4><p>二者的值都是 <code>GMT</code> 格式的时间字符串，具体过程：</p><ul><li><p>浏览器第一次跟服务器请求一个资源，服务器在返回这个资源的同时，在 <code>respone</code> 的 <code>header</code> 加上 <strong>Last-Modified</strong> 字段，这个 <code>header</code> 字段表示这个资源在服务器上的最后修改时间</p></li><li><p>浏览器再次跟服务器请求这个资源时，在 <code>request</code> 的 <code>header</code> 上加上 <strong>If-Modified-Since</strong> 字段，这个 <code>header</code> 字段的值就是上一次请求时返回的 <strong>Last-Modified</strong> 的值</p></li><li><p>服务器再次收到资源请求时，根据浏览器传过来 <strong>If-Modified-Since</strong> 和资源在服务器上的最后修改时间判断资源是否有变化，如果没有变化则返回 <code>304 Not Modified</code> ，但是不会返回资源内容；如果有变化，就正常返回资源内容。当服务器返回 <code>304 Not Modified</code> 的响应时，<code>response header</code> 中不会再添加 <strong>Last-Modified的header</strong> ，因为既然资源没有变化，那么 <strong>Last-Modified</strong> 也就不会改变，这是服务器返回 <code>304</code> 时的 <code>response header</code></p></li><li><p>浏览器收到 <code>304</code> 的响应后，就会从缓存中加载资源</p></li><li><p>如果协商缓存没有命中，浏览器直接从服务器加载资源时，<strong>Last-Modified</strong> 的 <code>Header</code> 在重新加载的时候会被更新，下次请求时，<strong>If-Modified-Since</strong> 会启用上次返回的<strong>Last-Modified</strong> 值</p></li></ul><h4 id="Etag-If-None-Match"><a href="#Etag-If-None-Match" class="headerlink" title="Etag/If-None-Match"></a>Etag/If-None-Match</h4><p>这两个值是由服务器生成的每个资源的唯一标识字符串，只要资源有变化就这个值就会改变；其判断过程与 <strong>Last-Modified、If-Modified-Since</strong> 类似，与 <strong>Last-Modified</strong> 不一样的是，当服务器返回 <code>304 Not Modified</code> 的响应时，由于 <strong>ETag</strong> 重新生成过，<code>response header</code> 中还会把这个 <strong>ETag</strong> 返回，即使这个 <strong>ETag</strong> 跟之前的没有变化。</p><div class="note warning"><p><em>Tips：Last-Modified与ETag是可以一起使用的，服务器会优先验证ETag，一致的情况下，才会继续比对Last-Modified，最后才决定是否返回304。</em></p></div> <h3 id="Service-Worker"><a href="#Service-Worker" class="headerlink" title="Service Worker"></a>Service Worker</h3><h4 id="什么是-Service-Worker"><a href="#什么是-Service-Worker" class="headerlink" title="什么是 Service Worker"></a>什么是 Service Worker</h4><blockquote><p><strong>Service Worker</strong> 本质上充当Web应用程序与浏览器之间的代理服务器，也可以在网络可用时作为浏览器和网络间的代理。它们旨在（除其他之外）使得能够创建有效的离线体验，拦截网络请求并基于网络是否可用以及更新的资源是否驻留在服务器上来采取适当的动作。他们还允许访问推送通知和后台同步API。</p><footer><strong>Service Worker API</strong><cite><a href="http://sethgodin.typepad.com/seths_blog/2009/07/welcome-to-island-marketing.html" target="_blank" rel="noopener">developer.mozilla.org</a></cite></footer></blockquote><p><br><strong>Service worker</strong> 可以解决目前离线应用的问题，同时也可以做更多的事。 <strong>Service Worker</strong> 可以使你的应用先访问本地缓存资源，所以在离线状态时，在没有通过网络接收到更多的数据前，仍可以提供基本的功能（一般称之为 Offline First）。这是原生APP 本来就支持的功能，这也是相比于 <code>web app</code> ，原生 <code>app</code> 更受青睐的主要原因</p><p>再来看看 👀 <strong>service worker</strong> 能做些什么</p><ul><li>后台消息传递</li><li>网络代理，转发请求，伪造响应</li><li>离线缓存</li><li>消息推送</li><li>…</li></ul><div class="note success"><p><strong><em>本文主要以（<a href="https://lishaoy.net" target="_blank" rel="noopener">lishaoy.net</a>）资源缓存为例,阐述下 service worker如何工作</em></strong></p></div>  <h4 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h4><p><strong>service worker</strong> 初次安装的生命周期，如图 🌠</p><p><img src="https://cdn.lishaoy.net/webOptimize/serviceWorker.png" alt="no-shadow" title="sw生命周期"></p><p>从上 👆 图可知，<strong>service worker</strong> 工作的流程：</p><ol><li><strong>安装：</strong>  <code>service worker URL</code> 通过 <code>serviceWorkerContainer.register()</code> 来获取和注册。</li><li><strong>激活：</strong> 当 <code>service worker</code> 安装完成后，会接收到一个激活事件(activate event)。 <code>onactivate</code> 主要用途是清理先前版本的 <code>service worker</code> 脚本中使用的资源。</li><li><strong>监听：</strong> 两种状态<ul><li>终止以节省内存；</li><li>监听获取 <code>fetch</code> 和消息 <code>message</code> 事件。</li></ul></li><li><strong>销毁：</strong> 是否销毁由浏览器决定，如果一个 <code>service worker</code> 长期不使用或者机器内存有限，则可能会销毁这个 <code>worker</code> 。</li></ol><div class="note warning"><p><em>Tips：激活成功之后，在 Chrome 浏览器里，可以访问 chrome://inspect/#service-workers和 chrome://serviceworker-internals/ 可以查看到当前运行的service worker ，如图 👇。</em></p></div> <p><img src="https://cdn.lishaoy.net/webOptimize/serviceWorker1.png" alt="service worker" width="100%" title="service worker" align="center"></p><p><strong>现在，我们来写个简单的例子 🌰 </strong></p><h4 id="注册-service-worker"><a href="#注册-service-worker" class="headerlink" title="注册 service worker"></a>注册 service worker</h4><p>要安装 <code>service worker</code> ，你需要在你的页面上注册它。这个步骤告诉浏览器你的 <code>service worker</code> 脚本在哪里。</p><figure class="highlight javascript"><figcaption><span>javascript</span><a href="https://lishaoy.net/webOptimize.html#注册-service-worker" target="_blank" rel="noopener">app.js</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="string">'serviceWorker'</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">  navigator.serviceWorker.register(<span class="string">'/sw.js'</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">registration</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Registration was successful</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'ServiceWorker registration successful with scope: '</span>,    registration.scope);</span><br><span class="line">  &#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// registration failed :(</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'ServiceWorker registration failed: '</span>, err);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的代码检查 <code>service worker API</code> 是否可用，如果可用，<code>service worker /sw.js</code> 被注册。如果这个 <code>service worker</code> 已经被注册过，浏览器会自动忽略上面的代码。</p><h4 id="激活-service-worker"><a href="#激活-service-worker" class="headerlink" title="激活 service worker"></a>激活 service worker</h4><p>在你的 <code>service worker</code> 注册之后，浏览器会尝试为你的页面或站点安装并激活它。 <code>install</code> 事件会在安装完成之后触发。<code>install</code> 事件一般是被用来填充你的浏览器的离线缓存能力。你需要为 <code>install</code> 事件定义一个 <code>callback</code> ，并决定哪些文件你想要缓存.</p><figure class="highlight javascript"><figcaption><span>javascript</span><a href="https://lishaoy.net/webOptimize.html#激活-service-worker" target="_blank" rel="noopener">sw.js</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The files we want to cache</span></span><br><span class="line"><span class="keyword">var</span> CACHE_NAME = <span class="string">'my-site-cache-v1'</span>;</span><br><span class="line"><span class="keyword">var</span> urlsToCache = [</span><br><span class="line">  <span class="string">'/'</span>,</span><br><span class="line">  <span class="string">'/css/main.css'</span>,</span><br><span class="line">  <span class="string">'/js/main.js'</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">self.addEventListener(<span class="string">'install'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Perform install steps</span></span><br><span class="line">  event.waitUntil(</span><br><span class="line">    caches.open(CACHE_NAME)</span><br><span class="line">      .then(<span class="function"><span class="keyword">function</span>(<span class="params">cache</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Opened cache'</span>);</span><br><span class="line">        <span class="keyword">return</span> cache.addAll(urlsToCache);</span><br><span class="line">      &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>在我们的 <code>install callback</code> 中，我们需要执行以下步骤：</p><ul><li>开启一个缓存</li><li>缓存我们的文件</li><li>决定是否所有的资源是否要被缓存</li></ul><p>上面的代码中，我们通过 <code>caches.open</code> 打开我们指定的 <code>cache</code> 文件名，然后我们调用 <code>cache.addAll</code> 并传入我们的文件数组。这是通过一连串 <code>promise</code> <em>（caches.open 和 cache.addAll）</em> 完成的。<code>event.waitUntil</code> 拿到一个 <code>promise</code> 并使用它来获得安装耗费的时间以及是否安装成功。</p><h4 id="监听-service-worker"><a href="#监听-service-worker" class="headerlink" title="监听 service worker"></a>监听 service worker</h4><p>现在我们已经将你的站点资源缓存了，你需要告诉 <code>service worker</code> 让它用这些缓存内容来做点什么。有了 <code>fetch</code> 事件，这是很容易做到的。</p><p>每次任何被 <code>service worker</code> 控制的资源被请求到时，都会触发 <code>fetch</code> 事件，我们可以给 <code>service worker</code> 添加一个 <code>fetch</code> 的事件监听器，接着调用 <code>event</code> 上的 <code>respondWith()</code> 方法来劫持我们的 <strong>HTTP</strong> 响应，然后你用可以用自己的方法来更新他们。</p><figure class="highlight javascript"><figcaption><span>javascript</span><a href="https://lishaoy.net/webOptimize.html#监听-service-worker" target="_blank" rel="noopener">sw.js</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">self.addEventListener(<span class="string">'fetch'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  event.respondWith(</span><br><span class="line">    caches.match(event.request);</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>caches.match(event.request)</code> 允许我们对网络请求的资源和 <code>cache</code> 里可获取的资源进行匹配，查看是否缓存中有相应的资源。这个匹配通过 <code>url</code> 和 <code>vary header</code> 进行，就像正常的 <strong>HTTP</strong> 请求一样。</p><p>那么，我们如何返回 <code>request</code> 呢，下面 👇 就是一个例子 🌰</p><figure class="highlight javascript"><figcaption><span>javascript</span><a href="https://lishaoy.net/webOptimize.html#监听-service-worker" target="_blank" rel="noopener">sw.js</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">self.addEventListener(<span class="string">'fetch'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  event.respondWith(</span><br><span class="line">    caches.match(event.request)</span><br><span class="line">      .then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// Cache hit - return response</span></span><br><span class="line">        <span class="keyword">if</span> (response) &#123;</span><br><span class="line">          <span class="keyword">return</span> response;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> fetch(event.request);</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>上面的代码里我们定义了 <code>fetch</code> 事件，在 <code>event.respondWith</code> 里，我们传入了一个由 <code>caches.match</code> 产生的 <code>promise.caches.match</code> 查找 <code>request</code> 中被 <code>service worker</code> 缓存命中的 <code>response</code> 。如果我们有一个命中的 <code>response</code> ，我们返回被缓存的值，否则我们返回一个实时从网络请求 <code>fetch</code> 的结果。</p><h4 id="sw-toolbox"><a href="#sw-toolbox" class="headerlink" title="sw-toolbox"></a>sw-toolbox</h4><div class="note success"><p><em>当然，我也可以使用第三方库，例如：<a href="https://lishaoy.net" target="_blank" rel="noopener">lishaoy.net</a> 使用了 <strong>sw-toolbox</strong>。</em></p></div><p><strong>sw-toolbox</strong> 使用非常简单，下面 👇 就是 <a href="https://lishaoy.net" target="_blank" rel="noopener">lishaoy.net</a> 的一个例子 🌰</p><figure class="highlight javascript"><figcaption><span>javascript</span><a href="https://lishaoy.net/webOptimize.html#sw-toolbox" target="_blank" rel="noopener">persilee.js</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"serviceWorker"</span> <span class="keyword">in</span> navigator ? navigator.serviceWorker.register(<span class="string">'/sw.js'</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  navigator.serviceWorker.controller ? <span class="built_in">console</span>.log(<span class="string">"Assets cached by the controlling service worker."</span>) : <span class="built_in">console</span>.log(<span class="string">"Please reload this page to allow the service worker to handle network operations."</span>)</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"ERROR: "</span> + e)</span><br><span class="line">&#125;) : <span class="built_in">console</span>.log(<span class="string">"Service workers are not supported in the current browser."</span>)</span><br></pre></td></tr></table></figure><p>以上是 <strong>注册</strong> 一个 <code>service woker</code></p><figure class="highlight javascript"><figcaption><span>javascript</span><a href="https://lishaoy.net/webOptimize.html#sw-toolbox" target="_blank" rel="noopener">sw.js</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> cacheVersion = <span class="string">"20180527"</span>;</span><br><span class="line">    <span class="keyword">var</span> staticImageCacheName = <span class="string">"image"</span> + cacheVersion;</span><br><span class="line">    <span class="keyword">var</span> staticAssetsCacheName = <span class="string">"assets"</span> + cacheVersion;</span><br><span class="line">    <span class="keyword">var</span> contentCacheName = <span class="string">"content"</span> + cacheVersion;</span><br><span class="line">    <span class="keyword">var</span> vendorCacheName = <span class="string">"vendor"</span> + cacheVersion;</span><br><span class="line">    <span class="keyword">var</span> maxEntries = <span class="number">100</span>;</span><br><span class="line">    self.importScripts(<span class="string">"/lib/sw-toolbox/sw-toolbox.js"</span>);</span><br><span class="line">    self.toolbox.options.debug = <span class="literal">false</span>;</span><br><span class="line">    self.toolbox.options.networkTimeoutSeconds = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    self.toolbox.router.get(<span class="string">"/images/(.*)"</span>, self.toolbox.cacheFirst, &#123;</span><br><span class="line">        cache: &#123;</span><br><span class="line">            name: staticImageCacheName,</span><br><span class="line">            maxEntries: maxEntries</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    self.toolbox.router.get(<span class="string">'/js/(.*)'</span>, self.toolbox.cacheFirst, &#123;</span><br><span class="line">        cache: &#123;</span><br><span class="line">            name: staticAssetsCacheName,</span><br><span class="line">            maxEntries: maxEntries</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    self.toolbox.router.get(<span class="string">'/css/(.*)'</span>, self.toolbox.cacheFirst, &#123;</span><br><span class="line">        cache: &#123;</span><br><span class="line">            name: staticAssetsCacheName,</span><br><span class="line">            maxEntries: maxEntries</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    self.addEventListener(<span class="string">"install"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> event.waitUntil(self.skipWaiting())</span><br><span class="line">    &#125;);</span><br><span class="line">    self.addEventListener(<span class="string">"activate"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> event.waitUntil(self.clients.claim())</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>就这样搞定了 🍉 <em>(具体的用法可以去 <a href="https://googlechromelabs.github.io/sw-toolbox/api.html#main" target="_blank" rel="noopener">sw-toolbox</a> 查看)</em></p><p>有的同学就问，<code>service worker</code> 这么好用，这个缓存空间到底是多大？其实，在  <strong>Chrome</strong> 可以看到，如图</p><p><img src="https://cdn.lishaoy.net/webOptimize/storageQuota.png" alt="fstorage quota" width="100%" title="storage quota" align="center"></p><p>可以看到，大概有 <strong>30G</strong> ，我的站点只用了 <strong>183MB</strong> ，完全够用了 🍓</p><p>最后，来两张图 </p><p><img src="https://cdn.lishaoy.net/webOptimize/serviceWorker2.png" alt="from ServiceWorker" width="100%" title="from ServiceWorker" align="center"></p><p><img src="https://cdn.lishaoy.net/webOptimize/serviceWorker3.png" alt="Cache Storage" width="100%" title="Cache Storage" align="center"></p><p><img class="hidden" src="https://cdn.lishaoy.net/webOptimize/Optimize.png" alt="web optimize" width="100%" title="web optimize" align="center"></p><h2 id="未完，待续。。。-😜"><a href="#未完，待续。。。-😜" class="headerlink" title="未完，待续。。。 😜"></a>未完，待续。。。 😜</h2>]]></content:encoded>
      
      <comments>https://h.lishaoy.net/webOptimize.html#disqus_thread</comments>
    </item>
    
    <item>
      <title>Promise诞生记</title>
      <link>https://h.lishaoy.net/createPromise.html</link>
      <guid>https://h.lishaoy.net/createPromise.html</guid>
      <pubDate>Tue, 17 Apr 2018 17:34:09 GMT</pubDate>
      <description>
      
        &lt;span itemprop=&quot;image&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/ImageObject&quot;&gt;&lt;img itemprop=&quot;url image&quot; src=&quot;https://cdn.lishaoy.net/createPromise/promise.png&quot; class=&quot;full-image&quot; alt=&quot;Promise&quot; title=&quot;Promise&quot;&gt;&lt;meta itemprop=&quot;width&quot; content=&quot;auto&quot;&gt;&lt;meta itemprop=&quot;height&quot; content=&quot;auto&quot;&gt;&lt;/span&gt;
&lt;p&gt;前端近年的兴起，有大部分是因为 &lt;code&gt;NodeJS&lt;/code&gt; 的诞生，而 &lt;code&gt;NodeJS&lt;/code&gt; 是个适用于 &lt;strong&gt;异步IO&lt;/strong&gt; 密集型的语言，一些基于 &lt;code&gt;NodeJS&lt;/code&gt; 的框架，比喻 &lt;em&gt;KOA2、Adonis&lt;/em&gt; 就有大量的 &lt;code&gt;async&lt;/code&gt; 和 &lt;code&gt;await&lt;/code&gt; 语法，&lt;code&gt;async&lt;/code&gt;的函数的返回值就是 &lt;code&gt;Promise&lt;/code&gt; 对象，我们可以用 &lt;code&gt;async&lt;/code&gt; 和 &lt;code&gt;await&lt;/code&gt; 语法，写出优雅的异步代码，来替换难看且难维护的回调函数。&lt;/p&gt;
&lt;p&gt;这里我们会渐进式的来创建一个 &lt;code&gt;Promise&lt;/code&gt; 的实现，如果，你还不了解 &lt;code&gt;Promise&lt;/code&gt; ，赶快移步 &lt;a href=&quot;http://es6.ruanyifeng.com/#docs/promise&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Promise&lt;/a&gt; 了解学习，当然这个实现会符合 &lt;a href=&quot;https://promisesaplus.com&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Promise/A+&lt;/a&gt; 规范，&lt;code&gt;JavaScript&lt;/code&gt; 中有很多第三方的 &lt;code&gt;Promise&lt;/code&gt; 库，&lt;a href=&quot;http://bluebirdjs.com/docs/getting-started.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;bluebird&lt;/a&gt; 就是一个第三方 &lt;code&gt;Promise&lt;/code&gt; 类库，相比其它第三方类库或标准对象来说，其有以下优点：功能更齐全而不臃肿、浏览器兼容性更好,大家可以了解下。&lt;/p&gt;
&lt;hr&gt;
      
      </description>
      
      <content:encoded><![CDATA[<span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="https://cdn.lishaoy.net/createPromise/promise.png" class="full-image" alt="Promise" title="Promise"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><p>前端近年的兴起，有大部分是因为 <code>NodeJS</code> 的诞生，而 <code>NodeJS</code> 是个适用于 <strong>异步IO</strong> 密集型的语言，一些基于 <code>NodeJS</code> 的框架，比喻 <em>KOA2、Adonis</em> 就有大量的 <code>async</code> 和 <code>await</code> 语法，<code>async</code>的函数的返回值就是 <code>Promise</code> 对象，我们可以用 <code>async</code> 和 <code>await</code> 语法，写出优雅的异步代码，来替换难看且难维护的回调函数。</p><p>这里我们会渐进式的来创建一个 <code>Promise</code> 的实现，如果，你还不了解 <code>Promise</code> ，赶快移步 <a href="http://es6.ruanyifeng.com/#docs/promise" target="_blank" rel="noopener">Promise</a> 了解学习，当然这个实现会符合 <a href="https://promisesaplus.com" target="_blank" rel="noopener">Promise/A+</a> 规范，<code>JavaScript</code> 中有很多第三方的 <code>Promise</code> 库，<a href="http://bluebirdjs.com/docs/getting-started.html" target="_blank" rel="noopener">bluebird</a> 就是一个第三方 <code>Promise</code> 类库，相比其它第三方类库或标准对象来说，其有以下优点：功能更齐全而不臃肿、浏览器兼容性更好,大家可以了解下。</p><hr><a id="more"></a><p>废话不多说，直接开干。。。 😠</p><h2 id="定义-Promise-类型"><a href="#定义-Promise-类型" class="headerlink" title="定义 Promise 类型"></a>定义 Promise 类型</h2><p>一个简单 <code>Promise</code> 语法，如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ... doSomething</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="comment">/* 异步操作成功 */</span>)&#123;</span><br><span class="line">    resolve(value);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// success</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// failure</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="实现-resolve-和-then"><a href="#实现-resolve-和-then" class="headerlink" title="实现 resolve 和 then"></a>实现 resolve 和 then</h3><p>首先我们以上 👆 的语法，自己定义一个 <code>Promise</code> 实例</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> callback = <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">//实现 then 方法 , 先一步一步来，实现传一个参数 -- resolve</span></span><br><span class="line">  <span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">    callback = cb;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//实现 resolve , value:异步操作的最终值</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    callback(value);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//执行 function 参数</span></span><br><span class="line">  fn(resolve);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>一个简单的实例写好了，然后，来用一下,看看 👀 结果如何</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>)</span>&#123;</span><br><span class="line">  resolve(<span class="number">66</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p.then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><div class="note info"><p>执行结果是：<code>callback is not a function</code></p></div><h3 id="修改-callback-为异步"><a href="#修改-callback-为异步" class="headerlink" title="修改 callback 为异步"></a>修改 callback 为异步</h3><p><strong>这里就遇到一个问题： </strong>  </p><p><strong> 发现 <code>resolve()</code> 在 <code>then()</code> 之前调用，在 <code>resolve()</code> 被调用的时候， <code>callback</code> 还是 <code>null</code> ，我们的代码是同步的，而不是异步的。<br> 如是，想办法解决掉这个问题，就是利用 <code>setTimeout</code> , 把 <code>callback</code> 加入异步队列</strong> </p><p>代码如下 👇</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> callback = <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">//实现 then 方法 , 先一步一步来，实现传一个参数 -- resolve</span></span><br><span class="line">  <span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">    callback = cb;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//实现 resolve , value:异步操作的最终值</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 用 setTimeout 把 callback 加入到异步队列，这样就会，先执行 then() 方法</span></span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      callback(value);</span><br><span class="line">    &#125;,<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//执行 function 参数</span></span><br><span class="line">  fn(resolve);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后，再来用一下,看看 👀 结果如何</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>)</span>&#123;</span><br><span class="line">  resolve(<span class="number">66</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p.then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><div class="note info"><p>执行结果是：<code>66</code></p></div><h2 id="未完待续。。。"><a href="#未完待续。。。" class="headerlink" title="未完待续。。。"></a>未完待续。。。</h2>]]></content:encoded>
      
      <comments>https://h.lishaoy.net/createPromise.html#disqus_thread</comments>
    </item>
    
    <item>
      <title>CSSModules</title>
      <link>https://h.lishaoy.net/CSSModules.html</link>
      <guid>https://h.lishaoy.net/CSSModules.html</guid>
      <pubDate>Sat, 07 Apr 2018 01:58:11 GMT</pubDate>
      <description>
      
        &lt;span itemprop=&quot;image&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/ImageObject&quot;&gt;&lt;img itemprop=&quot;url image&quot; src=&quot;https://cdn.lishaoy.net/CSSModules/cssModules.png&quot; class=&quot;full-image&quot; alt=&quot;CSS Modules&quot; title=&quot;CSS Modules&quot;&gt;&lt;meta itemprop=&quot;width&quot; content=&quot;auto&quot;&gt;&lt;meta itemprop=&quot;height&quot; content=&quot;auto&quot;&gt;&lt;/span&gt;
&lt;p&gt;这篇文章来一起了解 &lt;code&gt;css&lt;/code&gt; 模块化的用法和原理 ，&lt;strong&gt;dome&lt;/strong&gt; 地址：&lt;a href=&quot;https://github.com/persilee/webpack_test&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;css modules&lt;/a&gt; 😮&lt;/p&gt;
&lt;hr&gt;
      
      </description>
      
      <content:encoded><![CDATA[<span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="https://cdn.lishaoy.net/CSSModules/cssModules.png" class="full-image" alt="CSS Modules" title="CSS Modules"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><p>这篇文章来一起了解 <code>css</code> 模块化的用法和原理 ，<strong>dome</strong> 地址：<a href="https://github.com/persilee/webpack_test" target="_blank" rel="noopener">css modules</a> 😮</p><hr><a id="more"></a><h4 id="局部作用域"><a href="#局部作用域" class="headerlink" title="局部作用域"></a>局部作用域</h4><p>一般我们引入页面的 <code>CSS</code> 的作用域都是全局的，都是对这个页面起作用，产生局部的作用域，就是使用一个独一无二的 <code>class</code> 的名称，不会和其它选择器重名的， <strong><code>CSS Modules</code></strong> 就是这个原理。下面我们看一段代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'./main.css'</span>;</span><br><span class="line"><span class="keyword">import</span> test <span class="keyword">from</span> <span class="string">'./test.html'</span>;</span><br><span class="line"></span><br><span class="line">$(<span class="string">'body'</span>).append($(<span class="string">'&lt;div&gt;&lt;h1&gt;我会变绿&lt;/h1&gt;&lt;/div&gt;'</span>));</span><br><span class="line">$(<span class="string">'div h1'</span>).addClass(styles.testGreen);</span><br><span class="line">$(<span class="string">'body'</span>).append(test).find(<span class="string">'h2'</span>).addClass(styles.testBlue);</span><br></pre></td></tr></table></figure><p>上面的代码我把 <code>main.css</code> 输入到 <code>style</code> 对象，然后下面用了 <code>styles.testGreen</code> 对象的属性形式调用，就会应用 <code>main.css</code> 里的样式</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.testGreen</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>构建工具（ <code>webpack</code> ）编译成一个哈希字符串</p><figure class="highlight vbscript-html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;h1 class="_305zeUSoiGREv3GqPa9H8F"&gt;我会变绿&lt;/h1&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p><code>main.css</code> 也会同时编译</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">._305zeUSoiGREv3GqPa9H8F</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#aaf200</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样一来，这个类名就是独一无二的了，只对应用的组件有效。<strong><code>CSS Modules</code></strong> 支持不同的构建工具，这里我使用的是 <code>webpack</code> ,下文都是以 <code>webpack</code> 为例。</p><p>下面我们来看下 <strong><code>webpack.config.js</code></strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  context: __dirname + <span class="string">'/src'</span>,</span><br><span class="line">  devtool: <span class="string">'eval-source-map'</span>, <span class="comment">//配置生成Source Maps，选择合适的选项</span></span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: [<span class="string">'./app.js'</span>, <span class="string">'./test.js'</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: __dirname + <span class="string">'/dist'</span>,</span><br><span class="line">    filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">    publicPath: <span class="string">'/assets'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    loaders: [</span><br><span class="line">      &#123;<span class="attr">test</span>: <span class="regexp">/\.json$/</span>,<span class="attr">loader</span>: <span class="string">'json-loader'</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">test</span>: <span class="regexp">/\.js$/</span>,<span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,<span class="attr">loader</span>: <span class="string">'babel-loader'</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">test</span>: <span class="regexp">/\.css$/</span>,<span class="attr">loader</span>: ExtractTextPlugin.extract(&#123;</span><br><span class="line">          fallbackLoader: <span class="string">"style-loader"</span>,</span><br><span class="line">          loader: &#123;</span><br><span class="line">            loader: <span class="string">"css-loader"</span>,</span><br><span class="line">            query: &#123;</span><br><span class="line">              modules: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;<span class="attr">test</span>: <span class="regexp">/\.html$/</span>,<span class="attr">loader</span>: <span class="string">'html-loader'</span>&#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> ExtractTextPlugin(<span class="string">'style.css'</span>)</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>上面的代码可以看到，<code>query:{modules:true}</code> 代表开启 <strong><code>CSS Modules</code></strong> 模块，这里还配置了把所以得 <code>css</code> 合并一个文件，具体的可以了解 <code>webpack</code> 的 <code>extract-text-webpack-plugin</code>插件。</p><h4 id="全局作用域"><a href="#全局作用域" class="headerlink" title="全局作用域"></a>全局作用域</h4><p><strong><code>CSS Modules</code></strong> 允许用 <code>:global(.className)</code> 的语法声明一个全局的作用域。加了 <code>:global</code> 的不会被编译成哈希值。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">:global(.title)</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: black;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.title</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>test.js</code> 使用普通的写法，就会引用全局的 <code>.title</code> 的样式</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'./main.css'</span>;</span><br><span class="line"><span class="keyword">import</span> test <span class="keyword">from</span> <span class="string">'./test.html'</span>;</span><br><span class="line"></span><br><span class="line">$(<span class="string">'body'</span>).append($(<span class="string">'&lt;div&gt;&lt;h1&gt;我是title&lt;/h1&gt;&lt;/div&gt;'</span>));</span><br><span class="line">$(<span class="string">'div h1'</span>).addClass(<span class="string">'title'</span>);</span><br></pre></td></tr></table></figure><p>结果 <code>h1</code> 的title显示黑色。</p><h4 id="Class的组合"><a href="#Class的组合" class="headerlink" title="Class的组合"></a>Class的组合</h4><p>在 <strong><code>CSS Modules</code></strong> 里，一个选择器可以继承另一个选择器。</p><p>在 <code>mian.css</code> 里，我让 <code>.testBlue</code> 继承 <code>.testBg</code> 类</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.testBg</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.testBlue</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">  <span class="attribute">composes</span>: testBg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>不用修改 <code>test.js</code> ,应用了 <code>.testBlue</code> 就会有一个红色的背景。</p><p>编译结果：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.eh33VC37uFHXkCZ8LfKYd</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#ff0000</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.xrmZso54fTBX29J9G65Ai</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#0c77f8</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>相应的 <code>html</code> 代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">"xrmZso54fTBX29J9G65Ai eh33VC37uFHXkCZ8LfKYd _2gsuNWm9029FHPYJP62C-t"</span>&gt;</span></span><br><span class="line">    我会变蓝</span><br><span class="line"><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="输入变量"><a href="#输入变量" class="headerlink" title="输入变量"></a>输入变量</h4><p><strong><code>CSS Modules</code></strong> 支持使用变量，不过要安装 <strong>PsotCSS</strong> 和 <strong>postcss-modules-values</strong>。</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save postcss-loader postcss-modules-<span class="built_in">values</span></span><br></pre></td></tr></table></figure><p>把 <code>postcss-loader</code> 加入 <code>webpack.config.js</code> .</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">    loader: <span class="string">'style-loader!css-loader?modules!postcss-loader'</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>然后我在 <code>colors.css</code> 里定义了一些变量。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">value</span> blue: #<span class="number">0</span>c77f8;</span><br><span class="line">@<span class="keyword">value</span> red: #ff0000;</span><br><span class="line">@<span class="keyword">value</span> green: #aaf200;</span><br></pre></td></tr></table></figure><p>在 <code>main.css</code> 里可以这样引用变量</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">value</span> colors: <span class="string">"./color.css"</span>;</span><br><span class="line">@<span class="keyword">value</span> blue, red, green from colors;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.title</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.testBg</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.testGreen</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.testBlue</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">  <span class="attribute">composes</span>: testBg;</span><br><span class="line">  <span class="attribute">composes</span>: div;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样就可以把 <code>colors.css</code> 的变量拿过来用了，是不是很神奇。</p>]]></content:encoded>
      
      <comments>https://h.lishaoy.net/CSSModules.html#disqus_thread</comments>
    </item>
    
    <item>
      <title>如何使用 markdown 语法写博客</title>
      <link>https://h.lishaoy.net/markdownGrammar.html</link>
      <guid>https://h.lishaoy.net/markdownGrammar.html</guid>
      <pubDate>Fri, 06 Apr 2018 23:25:19 GMT</pubDate>
      <description>
      
        &lt;span itemprop=&quot;image&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/ImageObject&quot;&gt;&lt;img itemprop=&quot;url image&quot; src=&quot;https://cdn.lishaoy.net/markdownGrammar/markdown.png&quot; class=&quot;full-image&quot; alt=&quot;markdown&quot; title=&quot;markdown&quot;&gt;&lt;meta itemprop=&quot;width&quot; content=&quot;auto&quot;&gt;&lt;meta itemprop=&quot;height&quot; content=&quot;auto&quot;&gt;&lt;/span&gt;
&lt;p&gt;平时我写日记、文档和博客都会用到 &lt;code&gt;markdown&lt;/code&gt; 语法，我用的是 &lt;code&gt;马克飞象&lt;/code&gt; 先在本地写好，而且可以和 &lt;code&gt;印象笔记&lt;/code&gt; 同步，如果知识积累的多了，也会总结下，分享到社区，直接 &lt;kbd&gt;⌘ -  C&lt;/kbd&gt;  然后 &lt;kbd&gt;⌘ -  V&lt;/kbd&gt;  就可以了，特别方便。 🙂&lt;/p&gt;
&lt;hr&gt;
      
      </description>
      
      <content:encoded><![CDATA[<span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="https://cdn.lishaoy.net/markdownGrammar/markdown.png" class="full-image" alt="markdown" title="markdown"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><p>平时我写日记、文档和博客都会用到 <code>markdown</code> 语法，我用的是 <code>马克飞象</code> 先在本地写好，而且可以和 <code>印象笔记</code> 同步，如果知识积累的多了，也会总结下，分享到社区，直接 <kbd>⌘ -  C</kbd>  然后 <kbd>⌘ -  V</kbd>  就可以了，特别方便。 🙂</p><hr><a id="more"></a><h3 id="什么是Markdown语法"><a href="#什么是Markdown语法" class="headerlink" title="什么是Markdown语法"></a>什么是Markdown语法</h3><p><code>Markdown</code> 是一种轻量级标记语言，目标是实现「易读易写」。</p><blockquote><p>Markdown 是一种轻量级标记语言，它允许人们使用易读易写的纯文本格式编写文档，然后转换成格式丰富的HTML页面。    —— <a href="https://zh.wikipedia.org/wiki/Markdown" target="_blank" rel="noopener">维基百科</a></p></blockquote><hr><h3 id="标题"><a href="#标题" class="headerlink" title="标题"></a>标题</h3><p><strong>在 <code>Markdown</code> 中，你只需要在文本前面加上 <code>#</code> 即可，同理、你还可以增加二级标题、三级标题、四级标题、五级标题和六级标题，总共六级，只需要增加 <code>#</code> 即可，标题字号相应降低。例如：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 一级标题</span><br><span class="line">## 二级标题</span><br><span class="line">### 三级标题</span><br><span class="line">#### 四级标题</span><br><span class="line">##### 五级标题</span><br><span class="line">###### 六级标题</span><br></pre></td></tr></table></figure><p>效果如下 ：</p><h1 id="一级标题"><a href="#一级标题" class="headerlink" title="一级标题"></a>一级标题</h1><h2 id="二级标题"><a href="#二级标题" class="headerlink" title="二级标题"></a>二级标题</h2><h3 id="三级标题"><a href="#三级标题" class="headerlink" title="三级标题"></a>三级标题</h3><h4 id="四级标题"><a href="#四级标题" class="headerlink" title="四级标题"></a>四级标题</h4><h5 id="五级标题"><a href="#五级标题" class="headerlink" title="五级标题"></a>五级标题</h5><h6 id="六级标题"><a href="#六级标题" class="headerlink" title="六级标题"></a>六级标题</h6><hr><h3 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h3><p><strong><code>Markdown</code> 标记区块引用是使用类似 email 中用的引用方式，只需要在整个段落的第一行最前面加上 &gt; 。</strong>例如：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;这是一个引用示例</span><br></pre></td></tr></table></figure></p><p>效果如下：</p><blockquote><p>这是一个引用示例</p></blockquote><p><strong>区块引用可以嵌套，只要根据层次加上不同数量的 &gt; ：</strong></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; 这是第一级引用。</span><br><span class="line">&gt;</span><br><span class="line">&gt; &gt; 这是第二级引用。</span><br><span class="line">&gt;</span><br><span class="line">&gt; 现在回到第一级引用。</span><br></pre></td></tr></table></figure><p>效果如下：</p><blockquote><p>这是第一级引用。</p><blockquote><p>这是第二级引用。</p></blockquote><p>现在回到第一级引用。</p></blockquote><hr><h3 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h3><p><strong>Markdown 支持有序列表和无序列表。</strong></p><ol><li>无序列表使用星号、加号或是减号作为列表标记：</li></ol><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*   Red</span><br><span class="line">*   Green</span><br><span class="line">*   Blue</span><br></pre></td></tr></table></figure><p>等同于<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+   Red</span><br><span class="line">+   Green</span><br><span class="line">+   Blue</span><br></pre></td></tr></table></figure></p><p>也等同于<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-   Red</span><br><span class="line">-   Green</span><br><span class="line">-   Blue</span><br></pre></td></tr></table></figure></p><p>效果如下：</p><ul><li>Red</li><li>Green</li><li>Blue</li></ul><hr><ol start="2"><li>有序列表则使用数字接着一个英文句点：</li></ol><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.  Bird</span><br><span class="line"><span class="number">2</span>.  McHale</span><br><span class="line"><span class="number">3</span>.  Parish</span><br></pre></td></tr></table></figure><p>效果如下：</p><ol><li>Bird</li><li>McHale</li><li>Parish</li></ol><p>如果你的列表标记写成：<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.  Bird</span><br><span class="line"><span class="number">1</span>.  McHale</span><br><span class="line"><span class="number">1</span>.  Parish</span><br></pre></td></tr></table></figure></p><p>效果是：</p><ol><li>Bird</li><li>McHale</li><li>Parish</li></ol><p>甚至是：<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3</span>. Bird</span><br><span class="line"><span class="number">1</span>. McHale</span><br><span class="line"><span class="number">8</span>. Parish</span><br></pre></td></tr></table></figure></p><p>效果是：</p><ol start="3"><li>Bird</li><li>McHale</li><li>Parish</li></ol><p>可以看到，数字还是正常的，所以，你可以让 <code>Markdown</code> 文件的列表数字和输出的结果相同，或是你懒一点，你可以完全不用在意数字的正确性。</p><p>如果要在列表项目内放进引用，那 &gt; 就需要缩进：<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*   A <span class="keyword">list</span> item with <span class="keyword">a</span> blockquote:</span><br><span class="line"></span><br><span class="line">    &gt; This <span class="keyword">is</span> <span class="keyword">a</span> blockquote</span><br><span class="line">    &gt; inside <span class="keyword">a</span> <span class="keyword">list</span> item.</span><br></pre></td></tr></table></figure></p><p>效果如下：</p><ul><li><p>A list item with a blockquote:</p><blockquote><p>This is a blockquoteinside a list item.</p></blockquote></li></ul><hr><h3 id="代码区块"><a href="#代码区块" class="headerlink" title="代码区块"></a>代码区块</h3><p>只要把你的代码块包裹在  <code>```</code>  之间，你就不需要通过无休止的缩进来标记代码块了。 在围栏式代码块中，你可以指定一个可选的语言标识符，然后我们就可以为它启用语法着色了。 举个例子，这样可以为一段 <code>Ruby</code> 代码着色：</p><p><code>```ruby <br>require ‘redcarpet’ <br>markdown = Redcarpet.new(“Hello World!”) <br>puts markdown.to_html <br>```</code></p><p>效果如下：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">'redcarpet'</span></span><br><span class="line">markdown = Redcarpet.new(<span class="string">"Hello World!"</span>)</span><br><span class="line">puts markdown.to_html</span><br></pre></td></tr></table></figure><hr><h3 id="强调"><a href="#强调" class="headerlink" title="强调"></a>强调</h3><p>在 <code>Markdown</code> 中，可以使用 * 和 _ 来表示斜体和加粗。</p><p>斜体：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*Coding，让开发更简单*</span><br><span class="line">_Coding，让开发更简单_</span><br></pre></td></tr></table></figure><p>效果如下：</p><p><em>Coding，让开发更简单</em> <br><em>Coding，让开发更简单</em></p><p>加粗：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">**Coding，让开发更简单**</span><br><span class="line">__Coding，让开发更简单__</span><br></pre></td></tr></table></figure><p>效果如下：</p><p><strong>Coding，让开发更简单</strong> <br><strong>Coding，让开发更简单</strong></p><hr><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p>如果要标记一小段行内代码，你可以用反引号把它包起来 <code>```</code> ，例如：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Use the `<span class="built_in">printf</span>()` <span class="function"><span class="keyword">function</span>.</span></span><br></pre></td></tr></table></figure><p>效果如下：</p><p>Use the <code>printf()</code> function.</p><hr><h3 id="自动链接"><a href="#自动链接" class="headerlink" title="自动链接"></a>自动链接</h3><p><code>Markdown</code> 支持以比较简短的自动链接形式来处理网址和电子邮件信箱，只要是用尖括号包起来，<code>Markdown</code> 就会自动把它转成链接。一般网址的链接文字就和链接地址一样，例如：<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;http://example.com/&gt;</span><br></pre></td></tr></table></figure></p><p>效果如下：</p><p><a href="http://example.com/" target="_blank" rel="noopener">http://example.com/</a></p><h3 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h3><p><code>Markdown</code> 支持两种形式的链接语法： <em>行内式</em> 和 <em>参考式</em> 两种形式。我个人比较喜欢用 <em>参考式</em> 。</p><p>不管是哪一种，链接文字都是用 [方括号] 来标记。</p><ol><li><em>行内式</em> 的链接，只要在方块括号后面紧接着圆括号并插入网址链接即可，如果你还想要加上链接的 <code>title</code> 文字，只要在网址后面，用双引号把 <code>title</code> 文字包起来即可，例如：</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This is [an example](http://example.com/ &quot;Title&quot;) inline link.</span><br></pre></td></tr></table></figure><p>效果如下：</p><p>This is <a href="http://example.com/" title="Title" target="_blank" rel="noopener">an example</a> inline link.</p><hr><h3 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h3><p><code>Markdown</code> 使用一种和链接很相似的语法来标记图片，同样也允许两种样式： <em>行内式</em> 和 <em>参考式</em> 。</p><ol><li>行内式的图片语法看起来像是：</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">![Alt text](/path/to/img.jpg)</span><br><span class="line"></span><br><span class="line">![Alt text](/path/to/img.jpg &quot;Optional title&quot;)</span><br></pre></td></tr></table></figure><p>详细叙述如下：</p><ul><li>一个惊叹号 <code>!</code></li><li>接着一个方括号，里面放上图片的替代文字</li><li>接着一个普通括号，里面放上图片的网址，最后还可以用引号包住并加上 选择性的 <code>title</code> 文字。</li></ul><hr><ol start="2"><li>参考式的图片语法则长得像这样：</li></ol><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!<span class="meta">[</span>Alt text<span class="meta">]</span><span class="meta">[</span>id<span class="meta">]</span></span><br></pre></td></tr></table></figure><p><code>id</code> 是图片参考的名称，图片参考的定义方式则和连结参考一样：<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[</span>id<span class="meta">]</span>: url/to/image  "Optional title attribute"</span><br></pre></td></tr></table></figure></p><p><code>Markdown</code> 还没有办法指定图片的宽高，如果你需要的话，你可以使用普通的 <code>&lt;img&gt;</code>  标签。</p><hr><h3 id="LaTeX-公式"><a href="#LaTeX-公式" class="headerlink" title="LaTeX 公式"></a>LaTeX 公式</h3><p>可以创建行内公式，例如 :<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$\Gamma(n) = (n-1)!\quad\forall n\in\mathbb N$</span><br></pre></td></tr></table></figure></p><p>效果如下：</p><p>$\Gamma(n) = (n-1)!\quad\forall n\in\mathbb N$</p><p>或者块级公式：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$$x = \dfrac&#123;-b \pm \sqrt&#123;b^2 - 4ac&#125;&#125;&#123;2a&#125; $$</span><br></pre></td></tr></table></figure></p><p>效果如下：</p><p>$$ x = \dfrac{-b \pm \sqrt{b^2 - 4ac}}{2a} $$</p><hr><h3 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h3><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">| Item      |    Value | Qty  |</span><br><span class="line">| :-------- | --------:| :--: |</span><br><span class="line">| Computer  | <span class="number">1600</span> USD |  <span class="number">5</span>   |</span><br><span class="line">| Phone     |   <span class="number">12</span> USD |  <span class="number">12</span>  |</span><br><span class="line">| Pipe      |    <span class="number">1</span> USD | <span class="number">234</span>  |</span><br></pre></td></tr></table></figure><p>效果如下：</p><table><thead><tr><th style="text-align:left">Item</th><th style="text-align:right">Value</th><th style="text-align:center">Qty</th></tr></thead><tbody><tr><td style="text-align:left">Computer</td><td style="text-align:right">1600 USD</td><td style="text-align:center">5</td></tr><tr><td style="text-align:left">Phone</td><td style="text-align:right">12 USD</td><td style="text-align:center">12</td></tr><tr><td style="text-align:left">Pipe</td><td style="text-align:right">1 USD</td><td style="text-align:center">234</td></tr></tbody></table><hr><h3 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h3><p><code>```flow <br>st=&gt;start: Start <br>e=&gt;end <br>op=&gt;operation: My Operation <br>cond=&gt;condition: Yes or No? <br><br>st-&gt;op-&gt;cond <br>cond(yes)-&gt;e <br>cond(no)-&gt;op <br>```</code></p><p>效果如下：</p><div id="flowchart-0" class="flow-chart"></div><p>以及时序图:</p><p><code>```sequence <br>Alice-&gt;Bob: Hello Bob, how are you? <br>Note right of Bob: Bob thinks <br>Bob–&gt;Alice: I am good thanks! <br>```</code></p><p>效果如下：</p><div id="sequence-0"></div><h3 id="复选框"><a href="#复选框" class="headerlink" title="复选框"></a>复选框</h3><p>使用 <code>- [ ]</code> 和 <code>- [x]</code> 语法可以创建复选框，实现 todo-list 等功能。例如：</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- <span class="meta">[</span>x<span class="meta">]</span> 已完成事项</span><br><span class="line">- <span class="meta">[</span> <span class="meta">]</span> 待办事项1</span><br><span class="line">- <span class="meta">[</span> <span class="meta">]</span> 待办事项2</span><br></pre></td></tr></table></figure><p>效果如下：</p><ul><li style="list-style: none"><input type="checkbox" checked> 已完成事项</li><li style="list-style: none"><input type="checkbox"> 待办事项1</li><li style="list-style: none"><input type="checkbox"> 待办事项2</li></ul><hr><h3 id="分割线"><a href="#分割线" class="headerlink" title="分割线"></a>分割线</h3><p>在 <code>Markdown</code> 中，可以制作分割线，例如：</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">---</span><br></pre></td></tr></table></figure><p>效果如下：</p><hr><h3 id="反斜杠"><a href="#反斜杠" class="headerlink" title="反斜杠"></a>反斜杠</h3><p><code>Markdown</code> 可以利用反斜杠来插入一些在语法中有其它意义的符号，例如：如果你想要用星号加在文字旁边的方式来做出强调效果（但不用 <code>&lt;em&gt;</code> 标签），你可以在星号的前面加上反斜杠：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\*literal asterisks\*</span><br></pre></td></tr></table></figure></p><p>效果如下：</p><p>*literal asterisks*</p><p><code>Markdown</code> 支持以下这些符号前面加上反斜杠来帮助插入普通的符号：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">\   反斜线</span><br><span class="line">`   反引号</span><br><span class="line">*   星号</span><br><span class="line">_   底线</span><br><span class="line">&#123;&#125;  花括号</span><br><span class="line">[]  方括号</span><br><span class="line">()  括弧</span><br><span class="line">#   井字号</span><br><span class="line">+   加号</span><br><span class="line">-   减号</span><br><span class="line">.   英文句点</span><br><span class="line">!   惊叹号</span><br></pre></td></tr></table></figure><p><script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js"></script><textarea id="flowchart-0-code" style="display: none">st=>start: Starte=>endop=>operation: My Operationcond=>condition: Yes or No?st->op->condcond(yes)->econd(no)->op</textarea><textarea id="flowchart-0-options" style="display: none">{"theme":"simple","scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-0-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-0", options);</script><script src="https://cdnjs.cloudflare.com/ajax/libs/webfont/1.6.27/webfontloader.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/snap.svg/0.4.1/snap.svg-min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/js-sequence-diagrams/1.0.6/sequence-diagram-min.js"></script><textarea id="sequence-0-code" style="display: none">Alice->Bob: Hello Bob, how are you?Note right of Bob: Bob thinksBob-->Alice: I am good thanks!</textarea><textarea id="sequence-0-options" style="display: none">{"theme":"simple","scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("sequence-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("sequence-0-options").value));  var diagram = Diagram.parse(code);  diagram.drawSVG("sequence-0", options);</script></p>]]></content:encoded>
      
      <comments>https://h.lishaoy.net/markdownGrammar.html#disqus_thread</comments>
    </item>
    
    <item>
      <title>被遗忘的CSS</title>
      <link>https://h.lishaoy.net/upsetCssSummary.html</link>
      <guid>https://h.lishaoy.net/upsetCssSummary.html</guid>
      <pubDate>Fri, 06 Apr 2018 22:45:52 GMT</pubDate>
      <description>
      
        &lt;span itemprop=&quot;image&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/ImageObject&quot;&gt;&lt;img itemprop=&quot;url image&quot; src=&quot;https://cdn.lishaoy.net/upsetCssSummary/css.png&quot; class=&quot;full-image&quot; alt=&quot;css&quot; title=&quot;css&quot;&gt;&lt;meta itemprop=&quot;width&quot; content=&quot;auto&quot;&gt;&lt;meta itemprop=&quot;height&quot; content=&quot;auto&quot;&gt;&lt;/span&gt;
&lt;p&gt;平时在工作中遇到一些比较偏门的 &lt;code&gt;css&lt;/code&gt; ，用过一两次，但是老是记不住，于是又需要去 &lt;strong&gt;baidu、 google&lt;/strong&gt; ，所以都积累起来，方便以后查看（持续更新…） 😀&lt;/p&gt;
&lt;hr&gt;
      
      </description>
      
      <content:encoded><![CDATA[<span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="https://cdn.lishaoy.net/upsetCssSummary/css.png" class="full-image" alt="css" title="css"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><p>平时在工作中遇到一些比较偏门的 <code>css</code> ，用过一两次，但是老是记不住，于是又需要去 <strong>baidu、 google</strong> ，所以都积累起来，方便以后查看（持续更新…） 😀</p><hr><a id="more"></a><h4 id="outline-当input选中的时候会出现一个边框"><a href="#outline-当input选中的时候会出现一个边框" class="headerlink" title="outline  当input选中的时候会出现一个边框"></a><code>outline</code>  <strong>当input选中的时候会出现一个边框</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*一般设置成 none*/</span></span><br><span class="line"><span class="selector-tag">textarea</span><span class="selector-pseudo">:focus</span>, <span class="selector-tag">input</span><span class="selector-pseudo">:focus</span>&#123;</span><br><span class="line">    <span class="attribute">outline</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="contenteditable-规定元素内容是否可编辑"><a href="#contenteditable-规定元素内容是否可编辑" class="headerlink" title="contenteditable 规定元素内容是否可编辑"></a><code>contenteditable</code> <strong>规定元素内容是否可编辑</strong></h4><figure class="highlight vbscript-html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"example-one"</span> <span class="attr">contenteditable</span>=<span class="string">"true"</span>&gt;</span></span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#example-one</span> &#123; </span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">10px</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[contenteditable="true"]</span> &#123; </span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span>; <span class="attribute">outline</span>: <span class="number">2px</span> dashed <span class="number">#CCC</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[contenteditable="true"]</span><span class="selector-pseudo">:hover</span> &#123; </span><br><span class="line">    <span class="attribute">outline</span>: <span class="number">2px</span> dashed <span class="number">#0090D2</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="webkit-playsinline-video-都可以在页面中播放，而不是全屏播放"><a href="#webkit-playsinline-video-都可以在页面中播放，而不是全屏播放" class="headerlink" title="webkit-playsinline video 都可以在页面中播放，而不是全屏播放"></a><code>webkit-playsinline</code> <strong>video 都可以在页面中播放，而不是全屏播放</strong></h4><figure class="highlight vbscript-html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">video</span> <span class="attr">id</span>=<span class="string">"myvideo"</span> <span class="attr">src</span>=<span class="string">"test.mp4"</span> <span class="attr">webkit-playsinline</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="clearfix-清除浮动"><a href="#clearfix-清除浮动" class="headerlink" title="clearfix 清除浮动"></a><code>clearfix</code> <strong>清除浮动</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.clearfix</span> &#123;</span><br><span class="line">    <span class="attribute">zoom</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">     <span class="attribute">visibility</span>: hidden;</span><br><span class="line">     <span class="attribute">display</span>: block;</span><br><span class="line">     <span class="attribute">font-size</span>: <span class="number">0</span>;</span><br><span class="line">     <span class="attribute">content</span>: <span class="string">" "</span>;</span><br><span class="line">     <span class="attribute">clear</span>: both;</span><br><span class="line">     <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h4 id="user-select-禁止选中文本"><a href="#user-select-禁止选中文本" class="headerlink" title="user-select 禁止选中文本"></a><code>user-select</code> <strong>禁止选中文本</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">    <span class="attribute">-webkit-user-select</span>: none; <span class="comment">/* Chrome, Opera, Safari */</span></span><br><span class="line">    <span class="attribute">-moz-user-select</span>: none; <span class="comment">/* Firefox 2+ */</span></span><br><span class="line">    <span class="attribute">-ms-user-select</span>: none; <span class="comment">/* IE 10+ */</span></span><br><span class="line">    <span class="attribute">user-select</span>: none; <span class="comment">/* Standard syntax */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="webkit-scrollbar-自定义浏览器滚动条"><a href="#webkit-scrollbar-自定义浏览器滚动条" class="headerlink" title="webkit-scrollbar 自定义浏览器滚动条"></a><code>webkit-scrollbar</code> <strong>自定义浏览器滚动条</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*定义滚动条宽高及背景，宽高分别对应横竖滚动条的尺寸*/</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-pseudo">::-webkit-scrollbar</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(245, 245, 245, 0.47);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*定义滚动条的轨道，内阴影及圆角*/</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-pseudo">::-webkit-scrollbar-track</span> &#123;</span><br><span class="line">    <span class="attribute">-webkit-box-shadow</span>: inset <span class="number">0</span> <span class="number">0</span> <span class="number">6px</span> <span class="built_in">rgba</span>(0, 0, 0, .3);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#f5f5f5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*定义滑块，内阴影及圆角*/</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-pseudo">::-webkit-scrollbar-thumb</span> &#123;</span><br><span class="line">    <span class="comment">/*width: 10px;*/</span></span><br><span class="line">    <span class="attribute">height</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">-webkit-box-shadow</span>: inset <span class="number">0</span> <span class="number">0</span> <span class="number">6px</span> <span class="built_in">rgba</span>(0, 0, 0, .3);</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(85, 85, 85, 0.25);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="webkit-appearance-去除默认样式"><a href="#webkit-appearance-去除默认样式" class="headerlink" title="webkit-appearance 去除默认样式"></a><code>webkit-appearance</code> <strong>去除默认样式</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">input</span>, <span class="selector-tag">button</span>, <span class="selector-tag">textarea</span>, <span class="selector-tag">select</span> &#123;</span><br><span class="line">    *font-size: 100%;</span><br><span class="line">    <span class="selector-tag">-webkit-appearance</span><span class="selector-pseudo">:none</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="使用CSS-transforms-或者-animations时可能会有页面闪烁的bug"><a href="#使用CSS-transforms-或者-animations时可能会有页面闪烁的bug" class="headerlink" title="使用CSS transforms 或者 animations时可能会有页面闪烁的bug"></a><strong>使用CSS transforms 或者 animations时可能会有页面闪烁的bug</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">elements</span> &#123;</span><br><span class="line">     <span class="attribute">-webkit-backface-visibility</span>: hidden; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="transform-style-preserve-3d-让元素支持3D"><a href="#transform-style-preserve-3d-让元素支持3D" class="headerlink" title="transform-style: preserve-3d 让元素支持3D"></a><code>transform-style: preserve-3d</code> <strong>让元素支持3D</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">elements</span> &#123;</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">rotateY</span>(60deg); <span class="comment">/* Chrome, Safari, Opera */</span></span><br><span class="line">    <span class="attribute">-webkit-transform-style</span>: preserve-<span class="number">3</span>d; <span class="comment">/* Chrome, Safari, Opera */</span></span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotateY</span>(60deg);</span><br><span class="line">    <span class="attribute">transform-style</span>: preserve-<span class="number">3</span>d;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="perspective-这个属性定义子元素会获得透视效果，而不是元素本身"><a href="#perspective-这个属性定义子元素会获得透视效果，而不是元素本身" class="headerlink" title="perspective 这个属性定义子元素会获得透视效果，而不是元素本身"></a><code>perspective</code> <strong>这个属性定义子元素会获得透视效果，而不是元素本身</strong></h4><figure class="highlight vbscript-html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cube pers250"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"face front"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"face back"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"face right"</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"face left"</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"face top"</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"face bottom"</span>&gt;</span>6<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.cube</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">backface-visibility</span>: visible;</span><br><span class="line">  <span class="attribute">perspective-origin</span>: <span class="number">150%</span> <span class="number">150%</span>;</span><br><span class="line">  <span class="attribute">transform-style</span>: preserve-<span class="number">3</span>d;</span><br><span class="line">  <span class="attribute">-webkit-backface-visibility</span>: visible;</span><br><span class="line">  <span class="attribute">-webkit-perspective-origin</span>: <span class="number">150%</span> <span class="number">150%</span>;</span><br><span class="line">  <span class="attribute">-webkit-transform-style</span>: preserve-<span class="number">3</span>d;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.pers250</span> &#123;</span><br><span class="line">  <span class="attribute">perspective</span>: <span class="number">250px</span>;</span><br><span class="line">  <span class="attribute">-webkit-perspective</span>: <span class="number">250px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.face</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">   <span class="attribute">border</span>: none;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">font-family</span>: sans-serif;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="css实现不换行、自动换行、强制换行"><a href="#css实现不换行、自动换行、强制换行" class="headerlink" title="css实现不换行、自动换行、强制换行"></a><strong>css实现不换行、自动换行、强制换行</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*不换行*/</span></span><br><span class="line"><span class="selector-tag">white-space</span><span class="selector-pseudo">:nowrap</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*自动换行*/</span></span><br><span class="line"><span class="selector-tag">word-wrap</span>: <span class="selector-tag">break-word</span>; </span><br><span class="line"><span class="selector-tag">word-break</span>: <span class="selector-tag">normal</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">/*强制换行*/</span></span><br><span class="line"><span class="selector-tag">word-break</span><span class="selector-pseudo">:break-all</span>;</span><br></pre></td></tr></table></figure><h4 id="font-smoothing-设置字体平滑，会让字体看起来比较舒服"><a href="#font-smoothing-设置字体平滑，会让字体看起来比较舒服" class="headerlink" title="font-smoothing 设置字体平滑，会让字体看起来比较舒服"></a><code>font-smoothing</code> <strong>设置字体平滑，会让字体看起来比较舒服</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span>, <span class="selector-class">.h1</span>, <span class="selector-tag">h2</span>, <span class="selector-class">.h2</span>, <span class="selector-tag">h3</span>, <span class="selector-class">.h3</span>, <span class="selector-tag">h4</span>, <span class="selector-class">.h4</span>, <span class="selector-tag">h5</span>, <span class="selector-class">.h5</span>, <span class="selector-tag">h6</span>, <span class="selector-class">.h6</span>, <span class="selector-tag">p</span>, <span class="selector-class">.navbar</span>, <span class="selector-class">.brand</span>, <span class="selector-tag">a</span>, <span class="selector-class">.td-name</span>, <span class="selector-tag">td</span> &#123;</span><br><span class="line">    <span class="attribute">-moz-osx-font-smoothing</span>: grayscale;</span><br><span class="line">    <span class="attribute">-webkit-font-smoothing</span>: antialiased;</span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">"Microsoft YaHei"</span>, <span class="string">"微软雅黑"</span>, <span class="string">'Muli'</span>, <span class="string">"Helvetica"</span>, Arial, sans-serif;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="selection-修改选中文本颜色"><a href="#selection-修改选中文本颜色" class="headerlink" title="::selection 修改选中文本颜色"></a><code>::selection</code> <strong>修改选中文本颜色</strong></h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">::selection</span> &#123;</span><br><span class="line"><span class="attribute">color</span>: white;</span><br><span class="line"><span class="attribute">background-color</span>: <span class="built_in">rgba</span>(0, 0, 0, 0.8);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-pseudo">::-webkit-selection</span> &#123;</span><br><span class="line"><span class="attribute">color</span>: white;</span><br><span class="line"><span class="attribute">background-color</span>: <span class="built_in">rgba</span>(0, 0, 0, 0.8);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-pseudo">::-moz-selection</span> &#123;</span><br><span class="line"><span class="attribute">color</span>: white;</span><br><span class="line"><span class="attribute">background-color</span>: <span class="built_in">rgba</span>(0, 0, 0, 0.8);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="让背景图片大小自适应且居中"><a href="#让背景图片大小自适应且居中" class="headerlink" title="让背景图片大小自适应且居中"></a>让背景图片大小自适应且居中</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">background-size</span>: <span class="selector-tag">contain</span>;</span><br><span class="line"><span class="selector-tag">background-repeat</span>: <span class="selector-tag">no-repeat</span>;</span><br><span class="line"><span class="selector-tag">background-position</span>: 50% 50%;</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      <comments>https://h.lishaoy.net/upsetCssSummary.html#disqus_thread</comments>
    </item>
    
    <item>
      <title>PHP ThinkPHP 初识</title>
      <link>https://h.lishaoy.net/phpThinkPHPBasis.html</link>
      <guid>https://h.lishaoy.net/phpThinkPHPBasis.html</guid>
      <pubDate>Fri, 06 Apr 2018 07:59:52 GMT</pubDate>
      <description>
      
        &lt;span itemprop=&quot;image&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/ImageObject&quot;&gt;&lt;img itemprop=&quot;url image&quot; src=&quot;https://cdn.lishaoy.net/phpThinkPHPBasis/php.png&quot; class=&quot;full-image&quot; alt=&quot;php &amp;&amp; thinkPHP 基础&quot; title=&quot;php &amp;&amp; thinkPHP 基础&quot;&gt;&lt;meta itemprop=&quot;width&quot; content=&quot;auto&quot;&gt;&lt;meta itemprop=&quot;height&quot; content=&quot;auto&quot;&gt;&lt;/span&gt;
&lt;p&gt;这篇文章主要带大家认识一下 &lt;code&gt;PHP&lt;/code&gt; 、 &lt;code&gt;thinkPHP&lt;/code&gt; ，都是一下基础，其中包括 &lt;strong&gt;PHP语法（变量、字符串、数组、表单、数据库）&lt;/strong&gt; 、&lt;strong&gt;面向对象（Class创建、属性、继承、访问控制、抽象、接口等）&lt;/strong&gt; 、 &lt;strong&gt;thinkPHP（控制器、视图、模型等）&lt;/strong&gt; 😝&lt;/p&gt;
&lt;hr&gt;
      
      </description>
      
      <content:encoded><![CDATA[<span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="https://cdn.lishaoy.net/phpThinkPHPBasis/php.png" class="full-image" alt="php && thinkPHP 基础" title="php && thinkPHP 基础"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><p>这篇文章主要带大家认识一下 <code>PHP</code> 、 <code>thinkPHP</code> ，都是一下基础，其中包括 <strong>PHP语法（变量、字符串、数组、表单、数据库）</strong> 、<strong>面向对象（Class创建、属性、继承、访问控制、抽象、接口等）</strong> 、 <strong>thinkPHP（控制器、视图、模型等）</strong> 😝</p><hr><a id="more"></a><h2 id="PHP基础知识"><a href="#PHP基础知识" class="headerlink" title="PHP基础知识"></a>PHP基础知识</h2><p>以下知识点所有内容都是来自官方提供的 <strong>PHP</strong> 文档《<a href="http://php.net/manual/zh/index.php" target="_blank" rel="noopener">PHP手册</a>》，更多细节及知识点可以查看《<a href="http://php.net/manual/zh/index.php" target="_blank" rel="noopener">PHP手册</a>》。</p><p>如果你平时用 <strong>Windows</strong> 系统，可以使用 <a href="http://wampserver.com" target="_blank" rel="noopener">WAMP</a> 来搭建一个本地的开发环境。如果你是 <strong>OSX</strong> ，可以使用 <a href="https://www.mamp.info/en/" target="_blank" rel="noopener">MAMP</a> 来搭建一个开发环境。</p><h3 id="PHP语法"><a href="#PHP语法" class="headerlink" title="PHP语法"></a>PHP语法</h3><h4 id="认识PHP"><a href="#认识PHP" class="headerlink" title="认识PHP"></a>认识PHP</h4><p>PHP 代码被包含在特殊的起始符和结束符 <code>&lt;?php</code> 和 <code>?&gt;</code> 中，使得可以进出“PHP 模式”。如果文件都是 <strong>PHP</strong> 代码，可以省略结束标记，但是必须以 <code>;</code> 结束。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;h1&gt;php&lt;/h1&gt;</span><br><span class="line">  &lt;?php</span><br><span class="line">    echo &quot;lishaoying&quot;;</span><br><span class="line">    $name = &apos;李少颖&apos;;</span><br><span class="line">    echo &quot;hello: &quot; . $name ;</span><br><span class="line">  ?&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure><p>结果会输出：<code>lishaoyinghello: 李少颖</code>, <strong>PHP</strong> 解析器会解析开始<code>&lt;?php</code> 和结束标记 <code>?&gt;</code> 之间的内容。</p><hr><h4 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h4><p><strong>PHP</strong> 中的变量用一个美元符号后面跟变量名来表示。变量名是区分大小写的。<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$name = <span class="string">'lishaoy.net'</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"hello $name \r\n"</span>;</span><br></pre></td></tr></table></figure></p><p>结果会输出：<code>hello lishaoy.net</code>。</p><hr><h4 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h4><p>在 <strong>PHP</strong> 里面定义一个字符串，可以使用单引号<code>&#39; &#39;</code>或者双引号<code>&quot; &quot;</code>。<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$email = <span class="string">"persilee@foxmail.com&lt;br /&gt;"</span>;</span><br></pre></td></tr></table></figure></p><p>第三种表达字符串的方法是用 <strong>heredoc</strong> 句法结构：<code>&lt;&lt;&lt;</code>。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$word = &lt;&lt;&lt; WORD</span><br><span class="line">这是一个测试 - $name 。 . &lt;br /&gt;</span><br><span class="line">今天，天气不错，我们出去玩吧！ . &lt;br /&gt;</span><br><span class="line">WORD;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $word;</span><br></pre></td></tr></table></figure><p>结果会输出： <code>这是一个测试 - lishaoy.net 。</code></p><hr><h4 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h4><p>可以用 <code>array()</code> 语言结构来新建一个数组。它接受任意数量用逗号分隔的 键（<strong>key</strong>） <code>=&gt;</code> 值（<strong>value</strong>）对。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$tracks = <span class="keyword">array</span>(</span><br><span class="line">  <span class="number">0</span> =&gt; <span class="string">'长城'</span>,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> var_dump(</span><br><span class="line">  $tracks[<span class="number">0</span>]</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>结果会输出： <code>string(6) &quot;长城&quot;</code>。</p><hr><h4 id="表单"><a href="#表单" class="headerlink" title="表单"></a>表单</h4><p><code>$_GET</code>，还有 <code>$_POST</code>，这两个东西里面会存储使用不同的方法提交的表单的内容，<code>$_GET</code> 里面存储的是用 <strong>GET</strong> 方法提交的表单内容。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">""</span> <span class="attr">action</span>=<span class="string">"process.php"</span> <span class="attr">method</span>=<span class="string">"get"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"user_name"</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">placeholder</span>=<span class="string">"用户名"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">placeholder</span>=<span class="string">"Email"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>提 交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>process.php</strong>文件内容：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;pre&gt;'</span>;</span><br><span class="line">  var_dump(</span><br><span class="line">    $_GET[<span class="string">'user_name'</span>]</span><br><span class="line">  );</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;/pre&gt;'</span>;</span><br></pre></td></tr></table></figure><p>点提交之后会把文本框的内容传递到<strong>process.php</strong>文件处理，这里会输出文本框的输入内容。</p><hr><h4 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h4><p><strong>PDO</strong> 类，代表 <strong>PHP</strong> 和数据库服务之间的一个连接。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$db_handle = <span class="keyword">new</span> PDO(<span class="string">'mysql:host=127.0.0.1;dbname=msg;port=8889;charset=utf8'</span>,<span class="string">'msg_test'</span>,<span class="string">'123'</span>);</span><br></pre></td></tr></table></figure><p>这样就可以创建一个和数据库的连接。<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  $db_handle = <span class="keyword">new</span> PDO(<span class="string">'mysql:host=127.0.0.1;dbname=msg;port=8889;charset=utf8'</span>,<span class="string">'msg_test'</span>,<span class="string">'123'</span>);</span><br><span class="line"></span><br><span class="line">$statement = $db_handle-&gt;prepare(</span><br><span class="line">  <span class="string">'insert into posts(title, content) values (:title, :content)'</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">$title = <span class="string">'Wall-e'</span>;</span><br><span class="line">$content = <span class="string">'wall-e已经在地球上孤独生活了几百年，他爱上了。。。'</span>;</span><br><span class="line"></span><br><span class="line">$statement-&gt;bindParam(<span class="string">':title'</span>, $title);</span><br><span class="line">$statement-&gt;bindParam(<span class="string">':content'</span>, $content);</span><br><span class="line"></span><br><span class="line">$statement-&gt;execute();</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (<span class="keyword">Exception</span> $e) &#123;</span><br><span class="line">  <span class="keyword">echo</span> $e-&gt;getMessage();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>可以向数据库的<strong>posts</strong>表插入一条数据。</p><hr><h3 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h3><h4 id="创建Class"><a href="#创建Class" class="headerlink" title="创建Class"></a>创建Class</h4><p>每个类的定义都以关键字 <code>class</code> 开头，后面跟着类名，后面跟着一对花括号，里面包含有类的属性与方法的定义。<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Track</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h4 id="增加属性"><a href="#增加属性" class="headerlink" title="增加属性"></a>增加属性</h4><p>类的变量成员叫做“<strong>属性</strong>”，或者叫“<strong>字段</strong>”、“<strong>特征</strong>”，在本文档统一称为“<strong>属性</strong>”。<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Track</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $track_name;</span><br><span class="line">    <span class="keyword">public</span> $track_artist;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h4 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h4><p><strong>继承</strong> 将会影响到类与类，对象与对象之间的关系。</p><p>比如，当扩展一个类，子类就会<strong>继承</strong>父类所有公有的和受保护的方法。除非子类覆盖了父类的方法，被<strong>继承</strong>的方法都会保留其原有功能。<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player</span> <span class="keyword">extends</span> <span class="title">Track</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h4 id="访问控制"><a href="#访问控制" class="headerlink" title="访问控制"></a>访问控制</h4><p>对属性或方法的访问控制，是通过在前面添加关键字 <code>public</code>（公有），<code>protected</code>（受保护）或 <code>private</code>（私有）来实现的。被定义为公有的类成员可以 <strong>在任何地方被访问</strong>。被定义为受保护的类成员则可以 <strong>被其自身以及其子类和父类访问</strong>。被定义为私有的类成员则 <strong>只能被其定义所在的类访问</strong>。</p><hr><h4 id="静态属性与方法"><a href="#静态属性与方法" class="headerlink" title="静态属性与方法"></a>静态属性与方法</h4><p>声明类属性或方法为<strong>静态</strong>( <code>static</code> )，就可以不实例化类而直接访问。静态属性不能通过一个类已实例化的对象来访问（但静态方法可以）。<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Track</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> $track_name = <span class="string">'Magic'</span>;</span><br><span class="line">    <span class="keyword">public</span> $track_artist;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">track_playing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'正在播放'</span> . <span class="keyword">self</span>::$track_name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h4 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h4><p>具有<strong>构造函数</strong>( <code>__construct</code> )的类会在每次创建新对象时先调用此方法，所以非常适合在使用对象之前做一些初始化工作。<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Track</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $track_name;</span><br><span class="line">    <span class="keyword">public</span> $track_artist;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'初始化数据...'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">track_playing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'正在播放'</span> . <span class="keyword">$this</span>-&gt;$track_name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h4 id="构造器与获取器"><a href="#构造器与获取器" class="headerlink" title="构造器与获取器"></a>构造器与获取器</h4><p>在给不可访问属性赋值时，<code>__set()</code> 会被调用。读取不可访问属性的值时，<code>__get()</code> 会被调用。<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Track</span></span></span><br><span class="line"><span class="class"></span>&#123;      </span><br><span class="line">    <span class="keyword">private</span> $track_name;</span><br><span class="line">    <span class="keyword">private</span> $track_artist;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span><span class="params">($name, $value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (property_exists(<span class="keyword">$this</span>, $name)) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;$name = $value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;$name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">track_playing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'正在播放'</span> . <span class="keyword">$this</span>-&gt;$track_name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h4 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h4><p><strong>定义为抽象的类不能被实例化</strong>( <code>abstract</code> )。任何一个类，如果它里面至少有一个方法是被声明为抽象的，那么这个类就必须被声明为抽象的。被定义为抽象的方法只是声明了其调用方式（参数），不能定义其具体的功能实现。<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Entity</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $entity_type;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_entity_type</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;entity_type;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Entity</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $entity_type = <span class="string">'user'</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;entity_type . <span class="string">'：保存成功！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h4 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h4><p>使用 <strong>接口</strong>（ <code>interface</code>），可以指定某个类必须实现哪些方法，但不需要定义这些方法的具体内容。</p><p><strong>接口</strong> 是通过 <code>interface</code> 关键字来定义的，就像定义一个标准的类一样，但其中定义所有的方法都是空的。</p><p><strong>接口</strong> 中定义的所有方法都必须是公有，这是接口的特性。<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">DataInterface</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_data</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">EntityInterface</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_entity_type</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Entity</span> <span class="keyword">implements</span> <span class="title">DataInterface</span>, <span class="title">EntityInterface</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_data</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'数据...'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_entity_type</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'类型...'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h2 id="ThinkPHP"><a href="#ThinkPHP" class="headerlink" title="ThinkPHP"></a>ThinkPHP</h2><p>以下内容基本都是来自<strong>ThinkPHP</strong><a href="http://document.thinkphp.cn/manual_3_2.html#preface" target="_blank" rel="noopener">官方文档</a>，更多细节及知识点可查看 <a href="http://document.thinkphp.cn/manual_3_2.html#preface" target="_blank" rel="noopener">官方文档</a>。</p><h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><h4 id="环境要求"><a href="#环境要求" class="headerlink" title="环境要求"></a>环境要求</h4><p><strong>PHP版本要求</strong></p><ul><li>PHP5.3以上版本</li></ul><p><strong>支持的服务器和数据库环境</strong></p><ul><li>支持Windows/Unix服务器环境</li><li>可运行于包括Apache、IIS和nginx在内的多种WEB服务器和模式</li><li>支持Mysql、MsSQL、PgSQL、Sqlite、Oracle、Ibase、Mongo以及PDO等多种数据库和连接</li></ul><p>如果你平时用 <strong>Windows</strong> 系统，可以使用 <a href="http://wampserver.com" target="_blank" rel="noopener">WAMP</a> 来搭建一个本地的开发环境。如果你是 <strong>OSX</strong> ，可以使用 <a href="https://www.mamp.info/en/" target="_blank" rel="noopener">MAMP</a> 来搭建一个开发环境。</p><hr><h4 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h4><p>初始的目录结构如下：<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">www  WEB部署目录（或者子目录）</span><br><span class="line">├─<span class="built_in">index</span>.php       入口文件</span><br><span class="line">├─README.md       README文件</span><br><span class="line">├─Application     应用目录</span><br><span class="line">├─Public          资源文件目录</span><br><span class="line">└─ThinkPHP        框架目录</span><br></pre></td></tr></table></figure></p><p>其中框架目录<strong>ThinkPHP</strong>的结构如下：<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">├─ThinkPHP 框架系统目录（可以部署在非web目录下面）</span><br><span class="line">│  ├─Common       核心公共函数目录</span><br><span class="line">│  ├─Conf         核心配置目录 </span><br><span class="line">│  ├─Lang         核心语言包目录</span><br><span class="line">│  ├─Library      框架类库目录</span><br><span class="line">│  │  ├─Think     核心Think类库包目录</span><br><span class="line">│  │  ├─Behavior  行为类库目录</span><br><span class="line">│  │  ├─Org       Org类库包目录</span><br><span class="line">│  │  ├─Vendor    第三方类库目录</span><br><span class="line">│  │  ├─ ...      更多类库目录</span><br><span class="line">│  ├─Mode         框架应用模式目录</span><br><span class="line">│  ├─Tpl          系统模板目录</span><br><span class="line">│  ├─LICENSE.txt  框架授权协议文件</span><br><span class="line">│  ├─logo.png     框架LOGO文件</span><br><span class="line">│  ├─README.txt   框架README文件</span><br><span class="line">│  └─ThinkPHP.php    框架入口文件</span><br></pre></td></tr></table></figure></p><hr><h4 id="入口文件"><a href="#入口文件" class="headerlink" title="入口文件"></a>入口文件</h4><p><strong>ThinkPHP</strong>采用单一入口模式进行项目部署和访问，无论完成什么功能，一个应用都有一个统一（但不一定是唯一）的入口。</p><p><strong>入口文件主要完成：</strong></p><ul><li>定义框架路径、项目路径（可选）</li><li>定义调试模式和应用模式（可选）</li><li>定义系统相关常量（可选）</li><li>载入框架入口文件（<strong>必须</strong>）</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开启调试模式 建议开发阶段开启 部署阶段注释或者设为false</span></span><br><span class="line">define(<span class="string">'APP_DEBUG'</span>,<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义应用目录</span></span><br><span class="line">define( <span class="string">'APP_PATH'</span>, dirname(<span class="keyword">__FILE__</span>).<span class="string">'/Application/'</span> );</span><br><span class="line"></span><br><span class="line"><span class="comment">//生成后台模块</span></span><br><span class="line">define(<span class="string">'BIND_MODULE'</span>,<span class="string">'Admin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入ThinkPHP入口文件</span></span><br><span class="line"><span class="keyword">require</span> dirname( <span class="keyword">__FILE__</span>).<span class="string">'/ThinkPHP/ThinkPHP.php'</span>;</span><br></pre></td></tr></table></figure><hr><h4 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h4><p>入口文件是应用的单一入口，对应用的所有请求都定向到应用入口文件，系统会从URL参数中解析当前请求的模块、控制器和操作：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://serverName/<span class="built_in">index</span>.php/模块/控制器/操作</span><br></pre></td></tr></table></figure><hr><h3 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h3><h4 id="控制器定义"><a href="#控制器定义" class="headerlink" title="控制器定义"></a>控制器定义</h4><p>一般来说，ThinkPHP的控制器是一个类，而操作则是控制器类的一个公共方法。下面就是一个典型的控制器类的定义：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">Admin</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'hello,thinkphp!'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>在浏览器里访问：<code>http://msg:8899/index.php/Login/hello</code>，会显示：<code>hello,thinkphp!</code>。</p><hr><h4 id="AJAX返回"><a href="#AJAX返回" class="headerlink" title="AJAX返回"></a>AJAX返回</h4><p><strong>ThinkPHP</strong> 可以很好的支持AJAX请求，系统的\Think\Controller类提供了ajaxReturn方法用于AJAX调用后返回数据给客户端。<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Admin</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      $data[<span class="string">'status'</span>]  = <span class="number">1</span>;</span><br><span class="line">      $data[<span class="string">'content'</span>] = <span class="string">'content'</span>;</span><br><span class="line">      <span class="keyword">$this</span>-&gt;ajaxReturn($data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h4 id="跳转和重定向"><a href="#跳转和重定向" class="headerlink" title="跳转和重定向"></a>跳转和重定向</h4><p><strong>页面跳转</strong></p><p>在应用开发中，经常会遇到一些带有提示信息的跳转页面，例如操作成功或者操作错误页面，并且自动跳转到另外一个目标页面。系统的<code>\Think\Controller</code>类内置了两个跳转方法<code>success</code>和<code>error</code>，用于页面跳转提示，而且可以支持ajax提交。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">jump</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  $posts = D(<span class="string">'posts'</span>); <span class="comment">//实例化User对象</span></span><br><span class="line">  $data[<span class="string">'title'</span>] = <span class="string">'cat'</span>;</span><br><span class="line">  $data[<span class="string">'content'</span>] = <span class="string">'猫，属于猫科动物，分家猫、野猫，是全世界家庭中较为广泛的宠物。'</span>;</span><br><span class="line">  $result = $posts-&gt;add($data);</span><br><span class="line">  <span class="keyword">if</span>($result)&#123;</span><br><span class="line">      <span class="comment">//设置成功后跳转页面的地址，默认的返回页面是$_SERVER['HTTP_REFERER']</span></span><br><span class="line">      <span class="keyword">$this</span>-&gt;success(<span class="string">'新增成功'</span>,<span class="string">'Login/login'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">//错误页面的默认跳转页面是返回前一页，通常不需要设置</span></span><br><span class="line">      <span class="keyword">$this</span>-&gt;error(<span class="string">'新增失败'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>重定向</strong></p><p><code>Controller</code>类的<code>redirect</code>方法可以实现页面的重定向功能。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//重定向到New模块的Category操作</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;redirect(<span class="string">'New/category'</span>, <span class="keyword">array</span>(<span class="string">'cate_id'</span> =&gt; <span class="number">2</span>), <span class="number">5</span>, <span class="string">'页面跳转中...'</span>);</span><br></pre></td></tr></table></figure><p>上面的用法是停留5秒后跳转到<code>New</code>模块的<code>category</code>操作，并且显示页面跳转中字样，重定向后会改变当前的<strong>URL</strong>地址。</p><hr><h4 id="输入变量"><a href="#输入变量" class="headerlink" title="输入变量"></a>输入变量</h4><p><strong>获取变量</strong></p><p><code>I</code>方法是<strong>ThinkPHP</strong>用于更加方便和安全的获取系统输入变量，可以用于任何地方，用法格式如下：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I(<span class="string">'变量类型.变量名/修饰符'</span>,[<span class="string">'默认值'</span>],[<span class="string">'过滤方法'</span>],[<span class="string">'额外数据源'</span>])</span><br></pre></td></tr></table></figure></p><p>变量类型是指请求方式或者输入类型，包括：</p><table><thead><tr><th style="text-align:left">变量类型</th><th style="text-align:left">含义</th></tr></thead><tbody><tr><td style="text-align:left">get</td><td style="text-align:left">获取GET参数</td></tr><tr><td style="text-align:left">post</td><td style="text-align:left">获取POST参数</td></tr><tr><td style="text-align:left">param</td><td style="text-align:left">自动判断请求类型获取GET、POST或者PUT参数</td></tr><tr><td style="text-align:left">request</td><td style="text-align:left">获取REQUEST 参数</td></tr><tr><td style="text-align:left">put</td><td style="text-align:left">获取PUT 参数</td></tr><tr><td style="text-align:left">session</td><td style="text-align:left">获取 $_SESSION 参数</td></tr><tr><td style="text-align:left">cookie</td><td style="text-align:left">获取 $_COOKIE 参数</td></tr><tr><td style="text-align:left">server</td><td style="text-align:left">获取 $_SERVER 参数</td></tr><tr><td style="text-align:left">globals</td><td style="text-align:left">获取 $GLOBALS参数</td></tr><tr><td style="text-align:left">path</td><td style="text-align:left">获取 PATHINFO模式的URL参数（3.2.2新增）</td></tr><tr><td style="text-align:left">data</td><td style="text-align:left">获取 其他类型的参数，需要配合额外数据源参数（3.2.2新增）</td></tr></tbody></table><p>我们以<code>GET</code>变量类型为例，说明下 <code>I</code> 方法的使用：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">variable</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $data[<span class="string">'title'</span>] = I(<span class="string">'get.title'</span>);</span><br><span class="line">    $data[<span class="string">'content'</span>] = I(<span class="string">'get.content'</span>);</span><br><span class="line">    dump($data);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;display();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出结果：<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">array(<span class="number">2</span>) &#123;</span><br><span class="line">  [<span class="string">"title"</span>] =&gt; <span class="built_in">string</span>(<span class="number">6</span>) <span class="string">"啊啊"</span></span><br><span class="line">  [<span class="string">"content"</span>] =&gt; <span class="built_in">string</span>(<span class="number">6</span>) <span class="string">"啊啊"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h3 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h3><h4 id="模板定义"><a href="#模板定义" class="headerlink" title="模板定义"></a>模板定义</h4><p>每个模块的模板文件是独立的，为了对模板文件更加有效的管理，<strong>ThinkPHP</strong>对模板文件进行目录划分，默认的模板文件定义规则是：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">视图目录/[模板主题]/控制器名/操作名+模板后缀</span><br></pre></td></tr></table></figure></p><p>默认的视图目录是模块的 <strong>View</strong> 目录（模块可以有多个视图文件目录，这取决于你的应用需要），框架的默认视图文件后缀是<code>.html</code>。 新版模板主题默认是空（表示不启用模板主题功能）。</p><p>在每个模板主题下面，是以模块下面的控制器名为目录，然后是每个控制器的具体操作模板文件，例如：</p><p>例如<strong>Login</strong>下的<strong>variable</strong>，对应的模板文件：<code>Admin/View/Login/variable.html</code></p><hr><h4 id="模板赋值"><a href="#模板赋值" class="headerlink" title="模板赋值"></a>模板赋值</h4><p>如果要在模板中输出变量，必须在在控制器中把变量传递给模板，系统提供了assign方法对模板变量赋值，无论何种变量类型都统一使用assign赋值。<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">variable</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      $data[<span class="string">'title'</span>] = I(<span class="string">'get.title'</span>);</span><br><span class="line">      $data[<span class="string">'content'</span>] = I(<span class="string">'get.content'</span>);</span><br><span class="line">      <span class="keyword">$this</span>-&gt;assign($data);</span><br><span class="line">      <span class="keyword">$this</span>-&gt;display();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p><code>assign</code>方法必须在<code>display</code>和<code>show</code>方法之前调用，并且系统只会输出设定的变量，其它变量不会输出（系统变量例外），一定程度上保证了变量的安全性。</p><p>赋值后，就可以在模板文件中输出变量了，如果使用的是内置模板的话，就可以这样输出： <code>{$title}</code>。</p><hr><h4 id="渲染模板"><a href="#渲染模板" class="headerlink" title="渲染模板"></a>渲染模板</h4><p>渲染模板输出最常用的是使用<code>display</code>方法，调用格式：<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">display</span>(<span class="string">'[模板文件]'</span>[,<span class="string">'字符编码'</span>][,<span class="string">'输出类型'</span>])</span><br></pre></td></tr></table></figure></p><p>如果没有按照模板定义规则来定义模板文件（或者需要调用其他控制器下面的某个模板），可以使用：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指定模板输出</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;display(<span class="string">'edit'</span>);</span><br></pre></td></tr></table></figure></p><p>表示调用当前模块下面的<code>edit</code>模板<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;display(<span class="string">'Member:read'</span>);</span><br></pre></td></tr></table></figure></p><p>表示调用<code>Member</code>模块下面的<code>read</code>模板。</p><hr><h3 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h3><h4 id="模型定义"><a href="#模型定义" class="headerlink" title="模型定义"></a>模型定义</h4><blockquote><p>模型类并非必须定义，只有当存在独立的业务逻辑或者属性的时候才需要定义。</p></blockquote><p>模型类通常需要继承系统的\Think\Model类或其子类，下面是一个Home\Model\UserModel类的定义：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Admin</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostsModel</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>模型类的作用大多数情况是操作数据表的，如果按照系统的规范来命名模型类的话，大多数情况下是可以自动对应数据表。</p><h4 id="模型实例化"><a href="#模型实例化" class="headerlink" title="模型实例化"></a>模型实例化</h4><p>在ThinkPHP中，可以无需进行任何模型定义。</p><p>根据不同的模型定义，我们有几种实例化模型的方法，根据需要采用不同的方式：<strong>直接实例化</strong>可以和实例化其他类库一样实例化模型类，例如：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$User = <span class="keyword">new</span> \Home\Model\UserModel();</span><br><span class="line">$Info = <span class="keyword">new</span> \Admin\Model\InfoModel();</span><br><span class="line"><span class="comment">// 带参数实例化</span></span><br><span class="line">$New  = <span class="keyword">new</span> \Home\Model\NewModel(<span class="string">'blog'</span>,<span class="string">'think_'</span>,$connection);</span><br></pre></td></tr></table></figure></p><p><strong>D方法实例化</strong>上面实例化的时候我们需要传入完整的类名，系统提供了一个快捷方法 <strong>D</strong> 用于数据模型的实例化操作。<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">jump</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      $posts = D(<span class="string">'posts'</span>); <span class="comment">//实例化posts对象</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p><strong>M方法实例化模型</strong><strong>D</strong> 方法实例化模型类的时候通常是实例化某个具体的模型类，如果你仅仅是对数据表进行基本的  <strong>CURD</strong> 操作的话，使用 <strong>M</strong> 方法实例化的话，由于不需要加载具体的模型类，所以性能会更高。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用M方法实例化</span></span><br><span class="line">$User = M(<span class="string">'User'</span>);</span><br><span class="line"><span class="comment">// 和用法 $User = new \Think\Model('User'); 等效</span></span><br><span class="line"><span class="comment">// 执行其他的数据操作</span></span><br><span class="line">$User-&gt;select();</span><br></pre></td></tr></table></figure><h4 id="CURD操作"><a href="#CURD操作" class="headerlink" title="CURD操作"></a>CURD操作</h4><p><strong>ThinkPHP</strong>提供了灵活和方便的数据操作方法，对数据库操作的四个基本操作（CURD）：创建、更新、读取和删除的实现是最基本的，也是必须掌握的，在这基础之上才能熟悉更多实用的数据操作方法。</p><p><strong>CURD</strong> 操作通常是可以和连贯操作配合完成的。</p><p><strong>创建数据对象</strong></p><p><strong>ThinkPHP</strong>可以帮助你快速地创建数据对象，最典型的应用就是自动根据表单数据创建数据对象，这个优势在一个数据表的字段非常之多的情况下尤其明显。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实例化User模型</span></span><br><span class="line">$User = M(<span class="string">'User'</span>);</span><br><span class="line"><span class="comment">// 根据表单提交的POST数据创建数据对象</span></span><br><span class="line">$User-&gt;create();</span><br></pre></td></tr></table></figure><p><strong>数据写入</strong></p><p><strong>ThinkPHP</strong>的数据写入操作使用<code>add</code>方法，使用示例如下：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">jump</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  $posts = D(<span class="string">'posts'</span>); <span class="comment">//实例化User对象</span></span><br><span class="line">  $data[<span class="string">'title'</span>] = <span class="string">'cat'</span>;</span><br><span class="line">  $data[<span class="string">'content'</span>] = <span class="string">'猫，属于猫科动物，分家猫、野猫，是全世界家庭中较为广泛的宠物。'</span>;</span><br><span class="line">  $result = $posts-&gt;add($data);</span><br></pre></td></tr></table></figure></p><p><strong>读取数据</strong></p><p>读取数据是指读取数据表中的一行数据（或者关联数据），主要通过<code>find</code>方法完成，例如：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPosts</span><span class="params">()</span></span>&#123;</span><br><span class="line">      $posts = D(<span class="string">'posts'</span>); <span class="comment">//实例化posts对象</span></span><br><span class="line"></span><br><span class="line">      $posts-&gt;where(<span class="string">'id=1'</span>)-&gt;find();</span><br><span class="line"></span><br><span class="line">      dump($posts);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p><code>find</code>方法查询数据的时候可以配合相关的连贯操作方法，其中最关键的则是where方法。</p><p><strong>更新数据</strong></p><p>更新数据使用<code>save</code>方法，例如：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">savePosts</span><span class="params">()</span></span>&#123;</span><br><span class="line">      $posts = D(<span class="string">'posts'</span>); <span class="comment">//实例化posts对象</span></span><br><span class="line">      $data[<span class="string">'title'</span>] = <span class="string">'dog'</span>;</span><br><span class="line">      $data[<span class="string">'content'</span>] = <span class="string">'狗，（拉丁文:Canis lupus familiaris,英文名称dog）中文亦称“犬”，狗属于食肉目，分布于世界各地。狗与马、牛、羊、猪、鸡并称“六畜”。有科学家认为狗是由早期人类从灰狼...'</span>;</span><br><span class="line">      $posts-&gt;where(<span class="string">'id=1'</span>)-&gt;save($data);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p><strong>数据删除</strong></p><p><strong>ThinkPHP</strong>删除数据使用<code>delete</code>方法，例如：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">deletePosts</span><span class="params">()</span></span>&#123;</span><br><span class="line">      $posts = D(<span class="string">'posts'</span>); <span class="comment">//实例化posts对象</span></span><br><span class="line"></span><br><span class="line">      $posts-&gt;delete(<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>表示删除主键为<strong>4</strong>的数据</p><h4 id="连贯操作"><a href="#连贯操作" class="headerlink" title="连贯操作"></a>连贯操作</h4><p><strong>ThinkPHP</strong>模型基础类提供的连贯操作方法（也有些框架称之为链式操作），可以有效的提高数据存取的代码清晰度和开发效率，并且支持所有的<strong>CURD</strong>操作。</p><p>使用也比较简单， 假如我们现在要查询一个<strong>User</strong>表的满足状态为<strong>1</strong>的前<strong>10</strong>条记录，并希望按照用户的创建时间排序 ，代码如下：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$User-&gt;where(<span class="string">'status=1'</span>)-&gt;order(<span class="string">'create_time'</span>)-&gt;limit(<span class="number">10</span>)-&gt;select();</span><br></pre></td></tr></table></figure></p><p>这里的<code>where</code>、<code>order</code>和<code>limit</code>方法就被称之为连贯操作方法，除了<code>select</code>方法必须放到最后一个外（因为select方法并不是连贯操作方法），连贯操作的方法调用顺序没有先后。</p>]]></content:encoded>
      
      <comments>https://h.lishaoy.net/phpThinkPHPBasis.html#disqus_thread</comments>
    </item>
    
    <item>
      <title>浅谈JavaScript作用域</title>
      <link>https://h.lishaoy.net/javascriptScope.html</link>
      <guid>https://h.lishaoy.net/javascriptScope.html</guid>
      <pubDate>Sat, 31 Mar 2018 17:03:45 GMT</pubDate>
      <description>
      
        &lt;span itemprop=&quot;image&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/ImageObject&quot;&gt;&lt;img itemprop=&quot;url image&quot; src=&quot;https://cdn.lishaoy.net/javascriptScope/javascriptScope01.png &quot; class=&quot;full-image&quot; alt=&quot;javascript Scope&quot; title=&quot;javascript Scope&quot;&gt;&lt;meta itemprop=&quot;width&quot; content=&quot;auto&quot;&gt;&lt;meta itemprop=&quot;height&quot; content=&quot;auto&quot;&gt;&lt;/span&gt;
&lt;p&gt;我们在面试时，总会碰到一些奇奇怪怪的关于 &lt;strong&gt;作用域&lt;/strong&gt; 的面试题，其实弄清楚原理，万变不离其宗，大部分的面试题都可以得 ‘姐’。 &lt;/p&gt;
&lt;p&gt;所以，今天我们来谈谈 &lt;code&gt;JavaScript&lt;/code&gt; 的 &lt;strong&gt;作用域(javascript scope)&lt;/strong&gt; ，这是老生常谈的话题，这里我们会从 &lt;strong&gt;作用域&lt;/strong&gt; 开始，会延伸到 &lt;strong&gt;预解析规则（预编译） 、 变量提升 、函数提升 、表达式 、语句 、IIFE 、 匿名函数表达式 、 具名函数表达式&lt;/strong&gt; 等，彻底搞明白作用域这些事 🤓&lt;/p&gt;
&lt;hr&gt;
      
      </description>
      
      <content:encoded><![CDATA[<span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="https://cdn.lishaoy.net/javascriptScope/javascriptScope01.png " class="full-image" alt="javascript Scope" title="javascript Scope"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><p>我们在面试时，总会碰到一些奇奇怪怪的关于 <strong>作用域</strong> 的面试题，其实弄清楚原理，万变不离其宗，大部分的面试题都可以得 ‘姐’。 </p><p>所以，今天我们来谈谈 <code>JavaScript</code> 的 <strong>作用域(javascript scope)</strong> ，这是老生常谈的话题，这里我们会从 <strong>作用域</strong> 开始，会延伸到 <strong>预解析规则（预编译） 、 变量提升 、函数提升 、表达式 、语句 、IIFE 、 匿名函数表达式 、 具名函数表达式</strong> 等，彻底搞明白作用域这些事 🤓</p><hr><a id="more"></a><h3 id="变量提升和函数提升"><a href="#变量提升和函数提升" class="headerlink" title="变量提升和函数提升"></a>变量提升和函数提升</h3><p>在开始阐述之前，我们来看一段代码，看看结果是什么？</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">alert(a);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123; alter(<span class="number">2</span>); &#125;</span><br><span class="line">alert(a);</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span></span><br><span class="line">alert(a);</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">3</span>;</span><br><span class="line">alert(a);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123; alter(<span class="number">4</span>); &#125;</span><br><span class="line">alert(a);</span><br><span class="line">a();</span><br></pre></td></tr></table></figure><p>这里先揭晓答案：<div class="note success"><ul><li>第一个 <code>alert(a)</code>  弹出 <code>function a(){ alter(4); }</code> 函数体</li><li>第二个 <code>alter(a)</code>  弹出 <code>function a(){ alter(4); }</code> 函数体</li><li>第三个 <code>alter(a)</code>  弹出 <strong>1</strong></li><li>第四个 <code>alter(a)</code>  弹出 <strong>3</strong></li><li>第五个 <code>alter(a)</code>  弹出 <strong>3</strong></li><li>最后一行报错 <code>a is not a function</code></li></ul></div>  </p><p>下面来分析一下这段代码：其实在 <code>javascript</code> 开始执行代码之前，有一个 <strong>预解析（预编译）</strong> 的过程，这个过程会产生 <strong>变量提升</strong> 和 <strong>函数提升</strong> ，其实整个执行过程可以分为两部分，方便理解：</p><ol><li><strong>预解析</strong>这个过程，会把 关键字 <code>var</code> 、 <code>function</code> 、 <strong>参数</strong> 提取出来</li></ol><p>上面这段代码 <strong>预解析</strong> 的过程是：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第1行，没有关键字 ， 不解析</span></span><br><span class="line"><span class="comment">// 第2行，遇到 function 关键字，解析到全局的头部</span></span><br><span class="line">a = <span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123; alter(<span class="number">2</span>); &#125;</span><br><span class="line"><span class="comment">// 第3行，没有关键字 ， 不解析</span></span><br><span class="line"><span class="comment">// 第4行，遇到关键字 var ， 解析到全局的头部</span></span><br><span class="line">a = <span class="literal">undefined</span></span><br><span class="line"><span class="comment">// 第5行，没有关键字 ， 不解析</span></span><br><span class="line"><span class="comment">// 第6行，遇到关键字 var ， 解析到全局的头部</span></span><br><span class="line">a = <span class="literal">undefined</span></span><br><span class="line"><span class="comment">// 第8行，遇到 function 关键字，解析到全局的头部</span></span><br><span class="line">a = <span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123; alter(<span class="number">4</span>); &#125;</span><br><span class="line"><span class="comment">// 第9行，没有关键字 ， 不解析</span></span><br><span class="line"><span class="comment">// 第10行，a() 函数调用</span></span><br></pre></td></tr></table></figure><p>此时这里有4个同名变量 a ，依循规则是：<code>function</code> 优先与 <code>var</code>, 同名的后面覆盖前面的因此，<code>a = function a(){ alter(2); }</code> 替换掉下面的2个 <del><code>a = undefined</code></del> ，<code>a = function a(){ alter(4); }</code> 又替换掉 <del><code>a = function a(){ alter(2); }</code></del> ,最终只剩下 <code>a = function a(){ alter(4); }</code></p><p><strong>预解析（预编译）</strong> 后的代码样子是这样的</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123; alter(<span class="number">4</span>); &#125;</span><br><span class="line">alert(a);</span><br><span class="line">alert(a);</span><br><span class="line">a = <span class="number">1</span></span><br><span class="line">alert(a);</span><br><span class="line">a = <span class="number">3</span>;</span><br><span class="line">alert(a);</span><br><span class="line">alert(a);</span><br><span class="line">a();</span><br></pre></td></tr></table></figure><ol start="2"><li>执行代码，就是执行的这段代码，依次从上到下执行，最后的 <code>a()</code> 函数调用，这时的 <code>a</code> 已被 <strong>表达式</strong> 赋值成 <strong>3</strong> ，而报错 <code>a is not a function</code></li></ol><hr><h3 id="全局作用域和局部作用域"><a href="#全局作用域和局部作用域" class="headerlink" title="全局作用域和局部作用域"></a>全局作用域和局部作用域</h3><p>再看这段代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(a);</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line">fn1();</span><br><span class="line">alert(a);</span><br></pre></td></tr></table></figure><p>这里先揭晓答案：<div class="note success"><ul><li>第一个 <code>alert(a)</code> 弹出 <code>undefined</code></li><li>第二个 <code>alert(a)</code> 弹出 <strong>1</strong></li></ul></div></p><p><code>JavaScript</code> 的作用域只用两种，一个是全局的，一个是函数的，也称为 <strong>全局作用域</strong> 和 <strong>局部作用域</strong> ；<strong>局部作用域</strong> 可以访问 <strong>全局作用域</strong> 。但是 <strong>全局作用域</strong> 不能访问 <strong>局部作用域</strong> </p><p>同样用 <strong>预解析（预编译）</strong> 的方法来分析这段代码</p><ol><li><strong>预解析（预编译）</strong> 全局作用域</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第1行，遇到 var 关键字，解析到全局的头部</span></span><br><span class="line">a = <span class="literal">undefined</span></span><br><span class="line"><span class="comment">// 第2行，遇到 function 关键字，解析到全局的头部</span></span><br><span class="line">fn1 = <span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(a);</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 第3行，没有遇到关键字，不解析</span></span><br><span class="line"><span class="comment">// 第4行，没有遇到关键字，不解析</span></span><br></pre></td></tr></table></figure><ol start="2"><li>开始执行代码</li></ol><p>第1行，遇到表达式 <code>a = 1</code>, <strong>a</strong> 被赋值成 <strong>1</strong> <br>第6行，遇到函数调用 <code>fn1()</code> ,开始 <strong>预解析（预编译）</strong> 局部</p><ol start="3"><li><strong>预解析（预编译）</strong> 局部作用域</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第3行，没有遇到关键字，不解析</span></span><br><span class="line"><span class="comment">// 第4行，遇到 var 关键字，解析到局部</span></span><br><span class="line">a = <span class="literal">undefined</span></span><br></pre></td></tr></table></figure><ol start="4"><li>开始执行 <strong>局部</strong> 代码</li></ol><p>第3行，弹出 <code>undefined</code> 第4行，遇到表达式，把局部 <strong>a</strong> 改成 <strong>2</strong></p><ol start="5"><li>局部执行完成，继续执行全局</li></ol><p>第7行，弹出 <strong>1</strong> ，因为全局和局部是两个独立的作用域</p><hr><h3 id="作用域链"><a href="#作用域链" class="headerlink" title="作用域链"></a>作用域链</h3><p>如果，把上面👆代码，稍作修改</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(a);</span><br><span class="line">    a = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line">fn1();</span><br><span class="line">alert(a);</span><br></pre></td></tr></table></figure><p>去掉了 <code>function</code> 里的 <code>var</code> ，结果就会不一样这次，输出的是：</p><ul><li>第一个 <code>alert</code> 弹出 <strong>1</strong></li><li>第二个 <code>alert</code> 弹出 <strong>2</strong>因为在解析局部是没有发现 <code>var a</code> ，如是在执行时，就会去全局查找，找到了全局的 <code>a = 1</code> ，所以 第一个 <code>alert</code> 弹出 <strong>1</strong> ，而不是 <code>undefined</code> ,这个就是 <strong>作用域连</strong></li></ul><hr><h3 id="表达式、语句-和-IIFE"><a href="#表达式、语句-和-IIFE" class="headerlink" title="表达式、语句 和 IIFE"></a>表达式、语句 和 IIFE</h3><p>在看下以下 👇 的代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b = <span class="number">10</span>;</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(b);</span><br><span class="line">    b = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(b);</span><br><span class="line">  &#125;</span><br><span class="line">)();</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    b = <span class="number">30</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>先揭晓答案：<div class="note success"><ul><li>第1个 <code>console.log(b)</code> 输出的是 <strong>10</strong></li><li>第2个 <code>console.log(b)</code> 输出函数体 <code>b() {console.log(b); b = 20; console.log(b);}</code></li><li>第3个 <code>console.log(b)</code> 输出函数体 <code>b() {console.log(b); b = 20; console.log(b);}</code></li><li>第4个 <code>console.log(b)</code> 输出的是 <strong>10</strong></li><li>第5个 没有任何输出</li></ul></div></p><p>在分析这段代码之前，我们需要掌握一点知识，什么是 <strong>语句</strong> ，什么是 <strong>表达式</strong> 以及 <strong>IIFE</strong></p><h4 id="表达式、语句"><a href="#表达式、语句" class="headerlink" title="表达式、语句"></a>表达式、语句</h4><p><code>JavaScript</code> 程序的执行单位为行 <code>（line）</code> ，也就是一行一行地执行。一般情况下，每一行就是一个语句。</p><p>语句 <code>（statement）</code> 是为了完成某种任务而进行的操作，比如下面就是一行赋值语句。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span> + <span class="number">3</span>;</span><br></pre></td></tr></table></figure><p><code>1 + 3</code> 叫做表达式 <code>（expression）</code> ，指一个为了得到返回值的计算式。语句和表达式的区别在于，前者主要为了进行某种操作，一般情况下不需要返回值；后者则是为了得到返回值，一定会返回一个值。凡是 JavaScript 语言中预期为值的地方，都可以使用表达式。比如，赋值语句的等号右边，预期是一个值，因此可以放置各种表达式。</p><h4 id="立即执行函数-–-IIFE-（Immediately-Invoked-Function-Expression）"><a href="#立即执行函数-–-IIFE-（Immediately-Invoked-Function-Expression）" class="headerlink" title="立即执行函数 – IIFE （Immediately-Invoked Function Expression）"></a>立即执行函数 – IIFE <em>（Immediately-Invoked Function Expression）</em></h4><p>在 <code>Javascript</code> 中，圆括号 <code>()</code> 是一种运算符，跟在 <strong>函数名</strong> 之后，表示调用该函数。例如： <code>a()</code></p><p>有时，我们需要在定义函数之后，立即调用该函数。这时，你不能在函数的定义之后加上圆括号，这会产生语法错误。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">/* code */</span> &#125;();</span><br><span class="line"><span class="comment">// SyntaxError: Unexpected token (</span></span><br></pre></td></tr></table></figure><p>产生这个错误的原因是，<code>function</code> 这个关键字即可以当作语句，也可以当作表达式。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 语句</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 表达式</span></span><br><span class="line"><span class="keyword">var</span> f = <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>为了避免解析上的歧义，<code>JavaScript</code> 引擎规定，如果 <code>function</code> 关键字出现在行首，一律解释成语句。因此，<code>JavaScript</code> 引擎看到行首是 <code>function</code> 关键字之后，认为这一段都是函数的定义，不应该以圆括号结尾，所以就报错了。</p><p>解决方法就是不要让 <code>function</code> 出现在行首，让引擎将其理解成一个表达式。最简单的处理，就是将其放在一个圆括号里面。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">/* code */</span> &#125;());</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">/* code */</span> &#125;)();</span><br></pre></td></tr></table></figure><p>上面两种写法都是以圆括号开头，引擎就会认为后面跟的是一个表示式，而不是函数定义语句，所以就避免了错误。这就叫做“立即调用的函数表达式” <em>（Immediately-Invoked Function Expression）</em> ，简称 <strong>IIFE</strong>。</p><p>了解这些知识之后，再来分析上面 👆 提到的这段代码</p><p>先拆开来分析下代码，把这段单独拿出来，看看 👀</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(b);</span><br><span class="line">    b = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(b);</span><br><span class="line">  &#125;</span><br><span class="line">)();</span><br></pre></td></tr></table></figure><p>其实这段是可以单独运行的，结果是</p><div class="note success"><ul><li>第1个 <code>console.log(b)</code> 输出函数体 <code>b() {console.log(b); b = 20; console.log(b);}</code></li><li>第2个 <code>console.log(b)</code> 输出函数体 <code>b() {console.log(b); b = 20; console.log(b);}</code></li></ul></div><p>再来分析下原因，很明显这个就是一个 <strong>IIFE</strong> , 由一个 <strong>函数表达式</strong> 和 圆括号 <code>()</code> 运算符组成，上面 👆 这段代码和下面 👇 是等价的</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b = <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(b);</span><br><span class="line">    b = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(b);</span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure><p>再来分析，就比较容易理解了</p><ul><li><strong>首先开始解析</strong></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b = <span class="literal">undefined</span>; <span class="comment">//第一行 遇到 var 关键字，变量提升</span></span><br></pre></td></tr></table></figure><p>解析完之后的样子</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b;</span><br><span class="line">b = <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(b);</span><br><span class="line">    b = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(b);</span><br><span class="line">&#125;;</span><br><span class="line">b();</span><br></pre></td></tr></table></figure><ul><li><strong>执行代码</strong></li></ul><p>第2行，遇到 <strong>表达式语句</strong> 将 <code>b(){console.log(b); b = 20; console.log(b);}</code> 赋值给 <code>b</code><br>第7行，调用函数，开始局部解析</p><p>局部解析没有发现关键字 <code>var</code> 和 <code>function</code> ，没有任何动作</p><p>继续执行 <strong>局部</strong> 代码</p><p>第3行， <code>console.log(b)</code> 输出外部的 <code>b = b(){console.log(b); b = 20; console.log(b);}</code> <br>第4行， 由第3行可知，此时， <code>b</code> 是个内部函数体，而不是外部变量 <code>b</code> ，解析器只会把 <code>b = 20;</code> 当成普通 <strong>表达式</strong> ，而不是 <strong>表达式语句</strong> ，不会进行赋值操作 <br>第5行， <code>b</code> 的值没有任何改变，依然输出函数体 <code>b = b(){console.log(b); b = 20; console.log(b);}</code> <br></p><p>最终，回到最开始代码本身</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b = <span class="number">10</span>;</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(b);</span><br><span class="line">    b = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(b);</span><br><span class="line">  &#125;</span><br><span class="line">)();</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    b = <span class="number">30</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>预解析：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">b = <span class="literal">undefined</span>; <span class="comment">//变量提升</span></span><br><span class="line">b = <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123; <span class="comment">//函数提升</span></span><br><span class="line">    b = <span class="number">30</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>遵循，函数 <code>一等公民</code> 原则，函数优先级高于变量， <del><code>b = undefined;</code></del> 被干掉</p><p>预解析之后，应该是这个样子</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b = <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    b = <span class="number">30</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(b);</span><br><span class="line">&#125;</span><br><span class="line">b = <span class="number">10</span>;</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(b);</span><br><span class="line">    b = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(b);</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br></pre></td></tr></table></figure><p>再来看下答案，就很清楚了</p><div class="note success"><ul><li>第1个 <code>console.log(b)</code> 输出的是 <strong>10</strong></li><li>第2个 <code>console.log(b)</code> 输出函数体 <code>b() {console.log(b); b = 20; console.log(b);}</code></li><li>第3个 <code>console.log(b)</code> 输出函数体 <code>b() {console.log(b); b = 20; console.log(b);}</code></li><li>第4个 <code>console.log(b)</code> 输出的是 <strong>10</strong></li><li>第5个 没有任何输出，由于函数提升，最终 被 <code>b = 10</code> 覆盖</li></ul></div><p>这里，可以把上面 👆 代码稍作改动，结果会不一样，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b = <span class="number">10</span>;</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(b);</span><br><span class="line">    <span class="keyword">var</span> b = <span class="number">20</span>;  <span class="comment">// ++++ 加了 var</span></span><br><span class="line">    <span class="built_in">console</span>.log(b);</span><br><span class="line">  &#125;</span><br><span class="line">)();</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    b = <span class="number">30</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里就不揭晓答案了，感兴趣的，可自行思考 🤔 ，看看 👀 最终答案如何。。。</p><hr><h3 id="匿名函数表达式、具名函数表达式"><a href="#匿名函数表达式、具名函数表达式" class="headerlink" title="匿名函数表达式、具名函数表达式"></a>匿名函数表达式、具名函数表达式</h3><p>在来看看这段代码👇</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">3</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    foo();</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    foo();</span><br><span class="line">    <span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    foo();</span><br><span class="line">    <span class="keyword">var</span> bar = <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(a &gt; <span class="number">3</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(++a);</span><br><span class="line">        foo();</span><br><span class="line">    &#125;;</span><br><span class="line">    foo();</span><br><span class="line">    bar();</span><br><span class="line">&#125;</span><br><span class="line">fn();</span><br></pre></td></tr></table></figure><p>先揭晓答案：<div class="note success"><ul><li>第1个 <code>foo()</code> 输出的是 <strong>1</strong></li><li>第2个 <code>foo()</code> 输出的是 <strong>1</strong></li><li>第3个 <code>foo()</code> 输出的是 <strong>2</strong></li><li>第4个 <code>foo()</code> 输出的是 <strong>2</strong></li><li>最后的 <code>bar()</code> 输出的是 <strong>4</strong></li></ul></div></p><p>以上代码包含了 <strong>函数声明</strong> 、 <strong>匿名函数表达式</strong> 、 <strong>具名函数表达式</strong> ，<strong>匿名函数表达式</strong> 、 <strong>具名函数表达式</strong> 是把函数体赋值给一个变量，因此拥有和变量相同的特性 <strong>变量提升</strong> ，而 <strong>具名函数表达式</strong> 的函数名只能在函数内部使用。</p><p>了解了这些，再来分析段代码</p><ul><li><strong>全局预解析</strong></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="literal">undefined</span></span><br><span class="line">fn = <span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><strong>执行代码</strong>第1行，遇到表达式,把 <strong>a</strong> 的值改变成3 <br>最后行，遇到函数调用，重新 <strong>预解析</strong> 局部</p></li><li><p><strong>局部预解析</strong></p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第4行，遇到 function 关键字，解析到局部的头部</span></span><br><span class="line">foo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 第8行，遇到 var 关键字，解析到局部的头部</span></span><br><span class="line">foo = <span class="literal">undefined</span></span><br><span class="line"><span class="comment">// 第12行，遇到 var 关键字，解析到局部的头部</span></span><br><span class="line">bar = <span class="literal">undefined</span></span><br></pre></td></tr></table></figure><p>由于有两个同名变量 <code>foo</code> ，遵循 <code>function</code> 优先 <code>var</code> 因此， <del><code>foo = undefined</code></del> 被干掉</p><p><strong>局部预解析</strong> 完之后的代码应该是这个样子👇</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">3</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> bar;</span><br><span class="line">    foo();</span><br><span class="line">    foo();</span><br><span class="line">    foo = <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    foo();</span><br><span class="line">    bar = <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(a &gt; <span class="number">3</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(++a);</span><br><span class="line">        foo();</span><br><span class="line">    &#125;;</span><br><span class="line">    foo();</span><br><span class="line">    bar();</span><br><span class="line">&#125;</span><br><span class="line">fn();</span><br></pre></td></tr></table></figure><ul><li><strong>执行局部代码</strong> <br>第1个 <code>foo()</code> 输出的是 <strong>1</strong> <br>第2个 <code>foo()</code> 输出的是 <strong>1</strong> <br>第3个 <code>foo()</code> 输出的是 <strong>2</strong> <br>第4个 <code>foo()</code> 输出的是 <strong>2</strong> ，注意这个 <code>foo()</code> 输出的是上面 <code>foo = function foo() {console.log(2);}</code> 的内容，因为 <strong>具名函数表达式</strong> 的函数名只能在函数内部使用，在外部无法访问。<br>最后的 <code>bar()</code> 输出的是 <strong>4</strong> ，这里才是输出 <code>function foo() {if(a &gt; 3) return;console.log(++a);foo();}</code> 里的内容，而且，这个函数体内也有自身的调用，结果 <code>a</code> 变量 <strong>+1</strong> ，说明可以调用，其实，可以用 <code>bar.name</code> 输出的就是 <code>foo</code></li></ul><p><strong>所以，注意：</strong></p><div class="note danger"><ul><li><code>bar = function foo()</code> , 不要用这种写法 ，优雅的写法是 <strong>变量名</strong> 和 <strong>函数名</strong> 保持一致 <code>foo = function foo()</code></li><li>不推荐使用 <strong>匿名函数表达式</strong> ，有以下 👇 几个缺点<ul><li>在追踪栈中没函数名，调试困难</li><li>如果需要引用自身，只能用非标准的 <code>arguments.callee</code>（ES5严格模式禁用）</li></ul></li></ul></div>]]></content:encoded>
      
      <comments>https://h.lishaoy.net/javascriptScope.html#disqus_thread</comments>
    </item>
    
    <item>
      <title>如何用 CSS + HTML + JS 创建桌面应用</title>
      <link>https://h.lishaoy.net/nwjsElectronjs.html</link>
      <guid>https://h.lishaoy.net/nwjsElectronjs.html</guid>
      <pubDate>Tue, 27 Mar 2018 17:42:26 GMT</pubDate>
      <description>
      
        &lt;p&gt;最近研究了一下基于 &lt;code&gt;Chromium&lt;/code&gt; 定制浏览器的方案，查阅了大量资料，具体方案也有了大概的蓝图 😉 &lt;/p&gt;
&lt;hr&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>最近研究了一下基于 <code>Chromium</code> 定制浏览器的方案，查阅了大量资料，具体方案也有了大概的蓝图 😉 </p><hr><a id="more"></a><p>在阐述方案之前，先要了解几个名词：</p><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><h4 id="Chromium"><a href="#Chromium" class="headerlink" title="Chromium"></a>Chromium</h4><blockquote><p>Chromium是一个由Google主导开发的网页浏览器，以BSD许可证等多重自由版权发行并开放源代码。Chromium的开发可能早自2006年即开始。</p></blockquote><blockquote><p>Chromium是Google为发展自家的浏览器Google Chrome而打开的项目，所以Chromium相当于Google Chrome的工程版或实验版（尽管Google Chrome本身也有β版），新功能会率先在Chromium上开放，待验证后才会应用在Google Chrome上，故Google Chrome的功能会相对落后但较稳定。 —— <a href="https://zh.wikipedia.org/wiki/Chromium#cite_note-3" target="_blank" rel="noopener">维基百科</a></p></blockquote><h4 id="CEF"><a href="#CEF" class="headerlink" title="CEF"></a>CEF</h4><blockquote><p>Chromium Embedded Framework (CEF)是个基于Google Chromium项目的开源Web browser控件，支持Windows, Linux, Mac平台。除了提供C/C++接口外，也有其他语言的移植版。</p></blockquote><blockquote><p>因为基于Chromium，所以CEF支持Webkit &amp; Chrome中实现的HTML5的特性，并且在性能上面，也比较接近Chrome。CEF还提供的如下特性：自定义插件、自定义协议、自定义JavaScript对象和扩展；可控制的resource loading, navigation, context menus等等  —— <a href="https://baike.baidu.com/item/CEF/20837917?fr=aladdin" target="_blank" rel="noopener">百度百科</a></p></blockquote><h4 id="NW"><a href="#NW" class="headerlink" title="NW"></a>NW</h4><blockquote><p>NW.js 是基于 Chromium 和 Node.js 运行的， 以前也叫nodeWebkit。这就给了你使用HTML和JavaScript来制作桌面应用的可能。在应用里你可以直接调用Node.js的各种api以及现有的第三方包。因为Chromium和 Node.js 的跨平台，那么你的应用也是可以跨平台的。—— <a href="https://segmentfault.com/a/1190000003870613" target="_blank" rel="noopener">SegmentFault</a></p></blockquote><h4 id="Electron"><a href="#Electron" class="headerlink" title="Electron"></a>Electron</h4><blockquote><p>Electron（最初名为Atom Shell）是GitHub开发的一个开源框架。它允许使用Node.js（作为后端）和Chromium（作为前端）完成桌面GUI应用程序的开发。Electron现已被多个开源Web应用程序用于前端与后端的开发，著名项目包括GitHub的Atom和微软的Visual Studio Code。—— <a href="https://zh.wikipedia.org/wiki/Electron_%28%E8%BD%AF%E4%BB%B6%E6%A1%86%E6%9E%B6%29" target="_blank" rel="noopener">维基百科</a></p></blockquote><p>所以 ，<strong>CEF</strong>、<strong>nw</strong>、<strong>Electron</strong> 都是基于 <code>Chromium</code> 的开源框架，可以实现所需的定制浏览器需求，准确的讲应该是用 <code>HTML5</code> 、 <code>CSS3</code> 、 <code>JavaScript</code> 来制作拥有漂亮界面的<strong>桌面应用</strong>。</p><p>就是一个本地客户端应用程序使用一个内置的浏览器内核渲染前端界面，另一方面还可以调用本地系统级API，实现本地应用程序的各种功能。</p><hr><h3 id="市场调研"><a href="#市场调研" class="headerlink" title="市场调研"></a>市场调研</h3><p>通过查阅大量资料得知，以各企业的线上产品及使用的技术供参考。</p><h4 id="CEF-案例"><a href="#CEF-案例" class="headerlink" title="CEF 案例"></a>CEF 案例</h4><p>据 <strong>CEF</strong> 官方介绍，以下（如图）桌面应用在使用 <code>CEF</code>。</p><p><img src="https://github.com/persilee/nwjs_electronjs/blob/master/desktop_application/CEF.png?raw=true" alt="CEF" width="85%" title="who is using CEF" align="center"></p><p>国内桌面应用有：<a href="http://note.youdao.com" target="_blank" rel="noopener">有道云笔记</a> <i style="color:#aaa">（网易）</i>、<a href="https://www.dingtalk.com/?source=2202&amp;lwfrom=2017120202092064209309201" target="_blank" rel="noopener">钉钉</a><i style="color:#aaa">（阿里巴巴）</i>、<a href="https://im.qq.com/pcqq/" target="_blank" rel="noopener">QQ</a><i style="color:#aaa">（腾讯）</i> 等，查看安装后目录及文件，可以看出 <strong>有道云笔记</strong>、<strong>钉钉</strong> 是使用的是<code>CEF</code>，而 <strong>钉钉</strong> 界面是使用 <code>AngularJs</code>，据了解后端应该用了<code>C++</code>和<code>Python</code>。</p><p><strong>QQ</strong> 很早之前就通过内嵌 <strong>IE</strong> 来实现一些功能和界面。从2013年开始，<strong>QQ</strong> 引入了 <code>CEF</code>，对一些之前用 <strong>IE</strong> 的地方进行了替换。</p><p><img src="https://github.com/persilee/nwjs_electronjs/blob/master/desktop_application/1520329975606.png?raw=true" alt="no-shadow" title="钉钉Mac版目录"></p><p><img src="https://github.com/persilee/nwjs_electronjs/blob/master/desktop_application/1520330256871.png?raw=true" alt="no-shadow" title="钉钉Mac版应用界面"></p><h4 id="NW-案例"><a href="#NW-案例" class="headerlink" title="NW 案例"></a>NW 案例</h4><p>这个是 <strong><a href="https://nwjs.io" target="_blank" rel="noopener">NW</a></strong> 官方给出的使用 <code>nw.js</code> 的应用列表：<a href="https://github.com/nwjs/nw.js/wiki/List-of-apps-and-companies-using-nw.js" target="_blank" rel="noopener">https://github.com/nwjs/nw.js/wiki/List-of-apps-and-companies-using-nw.js</a> </p><p>而国内的有，比如微信开发工具等，是基于 <code>nw.js</code> 开发的。</p><p><img src="https://github.com/persilee/nwjs_electronjs/blob/master/desktop_application/1520571438918.png?raw=true" alt="no-shadow" title="微信开发工具Mac版目录"></p><p><img src="https://github.com/persilee/nwjs_electronjs/blob/master/desktop_application/1520571517344.png?raw=true" alt="no-shadow" title="微信开发工具Mac版"></p><h4 id="Electron-案例"><a href="#Electron-案例" class="headerlink" title="Electron 案例"></a>Electron 案例</h4><p>这个是 <strong><a href="https://electronjs.org" target="_blank" rel="noopener">Electron</a></strong> 官方给出的是用 <code>electron</code> 的应用列表：<a href="https://electronjs.org/apps" target="_blank" rel="noopener">https://electronjs.org/apps</a></p><p>如图，<strong>Electron</strong> 已被像 <strong>微软</strong>、 <strong>Facebook</strong>、 <strong>Slack</strong> 和 <strong>Docker</strong> 这样的公司用于创建应用程序。</p><p><img src="https://github.com/persilee/nwjs_electronjs/blob/master/desktop_application/1520668439676.png?raw=true" alt="electron" width="85%" title="electron 应用" align="center"></p><p>我所用的编辑器 <strong>Visual Studio Code</strong> 就是基于 <code>electron</code> 开发的</p><p><img src="https://github.com/persilee/nwjs_electronjs/blob/master/desktop_application/1520669844227.png?raw=true" alt="no-shadow" title="VS Code Mac版"></p><hr><h3 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h3><p>下面会分别用 <code>nw.js</code> 和 <code>electron</code> 做一个简单的 <strong>Dome</strong>。</p><p>由于 <strong>CEF</strong> 文档资料少且原生是 <code>C\C++</code> ，虽然官方给出了 <code>java</code> 版的 <strong>JCEF</strong> ，开发起来效率较低，故此不知演示。</p><p>这个是 <strong><a href="https://bitbucket.org/chromiumembedded/cef" target="_blank" rel="noopener">CEF</a></strong> 官网，在 <em>External Projects</em> 章节列出支持语言：</p><blockquote><ul><li>Net (CEF3) - <a href="https://github.com/cefsharp/CefSharp" target="_blank" rel="noopener">https://github.com/cefsharp/CefSharp</a></li><li>Net (CEF1) - <a href="https://bitbucket.org/fddima/cefglue" target="_blank" rel="noopener">https://bitbucket.org/fddima/cefglue</a></li><li>Net/Mono (CEF3) - <a href="https://bitbucket.org/xilium/xilium.cefglue" target="_blank" rel="noopener">https://bitbucket.org/xilium/xilium.cefglue</a></li><li>Net (CEF3) - <a href="https://bitbucket.org/chromiumfx/chromiumfx" target="_blank" rel="noopener">https://bitbucket.org/chromiumfx/chromiumfx</a></li><li>Delphi (CEF1) - <a href="http://code.google.com/p/delphichromiumembedded/" target="_blank" rel="noopener">http://code.google.com/p/delphichromiumembedded/</a></li><li>Delphi (CEF3) - <a href="https://github.com/hgourvest/dcef3" target="_blank" rel="noopener">https://github.com/hgourvest/dcef3</a></li><li>Delphi (CEF3) - <a href="https://github.com/salvadordf/CEF4Delphi" target="_blank" rel="noopener">https://github.com/salvadordf/CEF4Delphi</a></li><li>Go - <a href="https://github.com/CzarekTomczak/cef2go" target="_blank" rel="noopener">https://github.com/CzarekTomczak/cef2go</a></li><li>Java - <a href="https://bitbucket.org/chromiumembedded/java-cef" target="_blank" rel="noopener">https://bitbucket.org/chromiumembedded/java-cef</a></li><li>Java - <a href="http://code.google.com/p/javacef/" target="_blank" rel="noopener">http://code.google.com/p/javacef/</a></li><li>Python - <a href="http://code.google.com/p/cefpython/" target="_blank" rel="noopener">http://code.google.com/p/cefpython/</a></li></ul></blockquote><h4 id="NW-gt-Hello-world"><a href="#NW-gt-Hello-world" class="headerlink" title="NW =&gt; Hello, world!"></a>NW =&gt; Hello, world!</h4><p>从一个简单的例子来让我们看看如何编写一个 <strong>NW</strong> 应用。</p><ul><li><strong>第一步</strong> 创建 <code>package.json</code> 配置文件</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"helloworld"</span>,</span><br><span class="line">    <span class="string">"main"</span>: <span class="string">"index.html"</span>,</span><br><span class="line">    <span class="string">"icon"</span>: <span class="string">"img/app.png"</span>,</span><br><span class="line">    <span class="string">"window"</span>: &#123;</span><br><span class="line">        <span class="string">"icon"</span>: <span class="string">"img/app.png"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>main</code> 配置应用打开首页，<code>name</code> 配置应用的名称。</p><ul><li><strong>第二步</strong> 创建 <code>index.html</code> </li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Holle NW<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    html,</span></span><br><span class="line"><span class="undefined">    body &#123;</span></span><br><span class="line"><span class="undefined">        height: 100%;</span></span><br><span class="line"><span class="undefined">        margin: 0;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.box</span> &#123;</span></span><br><span class="line"><span class="undefined">        height: 100%;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">display</span>: <span class="selector-tag">flex</span>; <span class="comment">/* css3 弹性盒子 */</span></span></span><br><span class="line"><span class="undefined">        justify-content: center;</span></span><br><span class="line"><span class="undefined">        align-items: center;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Holle NW!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这是一个简单的 <strong>HTML</strong> 文件，加入了一点CSS，目的是让 <strong>Holle NW!</strong> 水平垂直居中。</p><ul><li><strong>第三步</strong> 打包应用</li></ul><p>这里我只测试了 <strong>Mac</strong> 和 <strong>Windows</strong> 的打包，<strong>Linux</strong> 没有测试。</p><p><strong>Mac打包应用：</strong> 在项目根目录执行以下命令，把所有文件压缩成 <code>app.nw</code> 文件。</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip -r app.nw *</span><br></pre></td></tr></table></figure><p>然后把<code>app.nw</code> 文件放到 <code>nwjs.app/Contents/Resources/</code> 目录下即可，效果如图：</p><p><img src="https://github.com/persilee/nwjs_electronjs/blob/master/desktop_application/1520711078780.png?raw=true" alt="no-shadow" title="Mac下运行效果"></p><p><strong>Windows打包应用：</strong>  将应用的所有相关文件打成一个名为<code>package.nw</code> 的压缩包，将<code>package.nw</code> 与<strong>NW</strong>可执行文件放到相同目录即可，效果如图：</p><p><img src="https://github.com/persilee/nwjs_electronjs/blob/master/desktop_application/1520711343860.png?raw=true" alt="no-shadow" title="Windons下运行效果 "></p><hr><h4 id="Electron-gt-Hello-world"><a href="#Electron-gt-Hello-world" class="headerlink" title="Electron =&gt; Hello, world!"></a>Electron =&gt; Hello, world!</h4><p><strong>Electron</strong> 可以让你使用纯 <code>JavaScript</code> 调用丰富的原生(操作系统) <strong>APIs</strong> 来创造桌面应用。</p><p>只需3个文件就可以构建一个简单的应用</p><figure class="highlight zsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">your-app/</span><br><span class="line">  ├── package.json</span><br><span class="line">  ├── main.js</span><br><span class="line">  └── index.html</span><br></pre></td></tr></table></figure><ul><li><strong>第一步</strong> 创建配置文件</li></ul><p>首先需要安装 <strong>Node</strong> 环境，用 <code>npm</code> 来创建一个应用的配置文件 <code>package.json</code></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br></pre></td></tr></table></figure><p>在 <code>package.json</code> 里新增启动命令 <code>start</code> </p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"your-app"</span>,</span><br><span class="line">    <span class="string">"version"</span>: <span class="string">"0.1.0"</span>,</span><br><span class="line">    <span class="string">"main"</span>: <span class="string">"main.js"</span>,</span><br><span class="line">    <span class="string">"scripts"</span>: &#123;</span><br><span class="line">      <span class="string">"start"</span>: <span class="string">"electron ."</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><ul><li><strong>第二步</strong> 创建入口文件 <code>main.js</code></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;app, BrowserWindow&#125; = <span class="built_in">require</span>(<span class="string">'electron'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createWindow</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    win = <span class="keyword">new</span> BrowserWindow(&#123;</span><br><span class="line">        width: <span class="number">1008</span>,</span><br><span class="line">        height: <span class="number">759</span></span><br><span class="line">    &#125;)</span><br><span class="line">      </span><br><span class="line">    win.loadURL(url.format(&#123;</span><br><span class="line">        pathname: path.join(__dirname, <span class="string">'index.html'</span>),</span><br><span class="line">        protocol: <span class="string">'file:'</span>,</span><br><span class="line">        slashes: <span class="literal">true</span></span><br><span class="line">    &#125;))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">'ready'</span>, createWindow)</span><br></pre></td></tr></table></figure><p>代码已经很清晰直观，<code>createWindow</code> 创建一个桌面窗口，而大小由 <code>width</code>、<code>height</code> 控制，<code>win.loadURL</code> 用来加载页面。</p><ul><li><strong>第三步</strong> 创建展示文件 <code>index.html</code></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Hello Electron<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    html,</span></span><br><span class="line"><span class="undefined">    body &#123;</span></span><br><span class="line"><span class="undefined">        height: 100%;</span></span><br><span class="line"><span class="undefined">        margin: 0;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.box</span> &#123;</span></span><br><span class="line"><span class="undefined">        height: 100%;</span></span><br><span class="line"><span class="undefined">        display: flex;</span></span><br><span class="line"><span class="css">        <span class="comment">/* css3 弹性盒子 */</span></span></span><br><span class="line"><span class="undefined">        justify-content: center;</span></span><br><span class="line"><span class="undefined">        align-items: center;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello Electron!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这是一个简单的 <strong>HTML</strong> 文件，加入了一点CSS，目的是让 <strong>Holle NW!</strong> 水平垂直居中。</p><ul><li><strong>第四步</strong> 打包应用</li></ul><p><strong>打包应用：</strong> 打包应用可以是用 <code>electron-packager</code> 工具进行打包，需要在 <code>package.json</code> 配置以下命令</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">    "start": "electron .",</span><br><span class="line">    "packager": "electron-packager ./ HelloElectron --all --out ./OutApp --version 0.0.1 --overwrite --ignore=node_modules --icon=./app/img/app.ico"</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><p>然后，运行在终端执行命令 <code>npm run packagerMac</code> 即可打包<code>linux</code>、<code>Mac</code>、<code>windows</code> 三大平台应用包，效果如图：</p><p><img src="https://github.com/persilee/nwjs_electronjs/blob/master/desktop_application/1520791859473.png?raw=true" alt="打包后的应用" width="60%" title="打包后的应用" align="center"></p><p><img src="https://github.com/persilee/nwjs_electronjs/blob/master/desktop_application/1520790145115.png?raw=true" alt="no-shadow" title="Mac下运行效果"></p><p><img src="https://github.com/persilee/nwjs_electronjs/blob/master/desktop_application/1520792416456.png?raw=true" alt="no-shadow" title="Windows下运行效果"></p><hr><h3 id="GitHub关注度和活跃度"><a href="#GitHub关注度和活跃度" class="headerlink" title="GitHub关注度和活跃度"></a>GitHub关注度和活跃度</h3><p>首先我们需要先了解一下 <strong>GitHub</strong> 的以下三个状态的意思，</p><p><img src="https://github.com/persilee/nwjs_electronjs/blob/master/desktop_application/1520857435681.png?raw=true" alt="no-shadow"></p><p><img src="https://github.com/persilee/nwjs_electronjs/blob/master/desktop_application/1520857536175.png?raw=true" alt="no-shadow"> ：表示你以后会关注这个项目的所有动态，这个项目以后只要发生变动，如被别人提交了 <code>pull request</code>、被别人发起了<code>issue</code> 等等情况，你都会在自己的个人通知中心，收到一条通知消息，如果你设置了个人邮箱，那么你的邮箱也可能收到相应的邮件。</p><p><img src="https://github.com/persilee/nwjs_electronjs/blob/master/desktop_application/1520857569746.png?raw=true" alt="no-shadow">：表示你喜欢这个项目或者通俗点，可以把他理解成朋友圈的点赞，表示对这个项目的支持。</p><p><img src="https://github.com/persilee/nwjs_electronjs/blob/master/desktop_application/1520857709924.png?raw=true" alt="no-shadow">：当选择 <code>fork</code>，相当于你自己有了一份原项目的拷贝，当然这个拷贝只是针对当时的项目文件，如果后续原项目文件发生改变，你必须通过其他的方式去同步。<i style="color:#aaa">（一般用于修改<strong>bug</strong>和优化项目或者在此项目上开发新功能等）</i></p><h4 id="CEF-1"><a href="#CEF-1" class="headerlink" title="CEF"></a>CEF</h4><p><strong>CEF</strong> 在 <strong>GitHub</strong> 找不到项目，这个<a href="https://bitbucket.org/chromiumembedded/cef/overview" target="_blank" rel="noopener">官网</a> 提供的数据，如图<i style="color:#aaa">（由于在<strong>GitHub</strong> 没有项目，相关数据无法准确统计）</i>。</p><p><img src="https://github.com/persilee/nwjs_electronjs/blob/master/desktop_application/1520855809138.png?raw=true" alt="CEF关注度" title="CEF关注度"></p><h4 id="NW-1"><a href="#NW-1" class="headerlink" title="NW"></a>NW</h4><p><strong>NW关注度：</strong> <img src="https://github.com/persilee/nwjs_electronjs/blob/master/desktop_application/1520856387728.png?raw=true" alt="Alt text"></p><p><strong>NW活跃度：</strong>如图</p><p><img src="https://github.com/persilee/nwjs_electronjs/blob/master/desktop_application/1520858064076.png?raw=true" alt="2011年~2018年提交量" title="2011年~2018年提交量"></p><h4 id="Electron-1"><a href="#Electron-1" class="headerlink" title="Electron"></a>Electron</h4><p><strong>Electron关注度：</strong> <img src="https://github.com/persilee/nwjs_electronjs/blob/master/desktop_application/1520858325207.png?raw=true" alt="no-shadow"></p><p><strong>活跃度：</strong> 如图</p><p><img src="https://github.com/persilee/nwjs_electronjs/blob/master/desktop_application/1520858451333.png?raw=true" alt="electron2013年~2018年提交量" title="electron2013年~2018年提交量"></p><hr><p>通过以上的 <strong>市场调研</strong>、<strong>实战</strong>、<strong>GitHub关注度和活跃度</strong> 等 <strong>Electron</strong> 都占有优势，如下</p><ul><li>市场案例较多，各大型企业都在使用</li><li>开发实战代码更直观，容易理解和维护，各种文档健全、网络资料较多且质量较高，周边辅助工具齐全，开发效率可大大提高</li><li><strong>GitHub</strong> 关注度和活跃度持续攀升</li></ul><p>所有结合以上情况，之后会用以下技术栈做一个完善的案例</p><ul><li><strong>跨平台桌面应用框架：</strong><code>electron</code>  <i style="color:#aaa">（Chromium + Node.js）</i></li><li><strong>UI库：</strong> <code>iView</code></li><li><strong>js框架：</strong> <code>Vue.js</code></li><li><strong>自动化构建工具：</strong>  <code>webpack</code></li><li><strong>HTML5、CSS3、ES6</strong></li></ul>]]></content:encoded>
      
      <comments>https://h.lishaoy.net/nwjsElectronjs.html#disqus_thread</comments>
    </item>
    
    <item>
      <title>用 Hexo Next GitHubPages 搭建漂亮的免费博客</title>
      <link>https://h.lishaoy.net/hexoGithubpagesNext.html</link>
      <guid>https://h.lishaoy.net/hexoGithubpagesNext.html</guid>
      <pubDate>Sat, 24 Mar 2018 12:32:26 GMT</pubDate>
      <description>
      
        &lt;span itemprop=&quot;image&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/ImageObject&quot;&gt;&lt;img itemprop=&quot;url image&quot; src=&quot;https://cdn.lishaoy.net/hexoGithubpagesNext/git_hexo.jpeg&quot; class=&quot;full-image&quot; alt=&quot;GitHubPages + Hexo&quot; title=&quot;GitHubPages + Hexo&quot;&gt;&lt;meta itemprop=&quot;width&quot; content=&quot;auto&quot;&gt;&lt;meta itemprop=&quot;height&quot; content=&quot;auto&quot;&gt;&lt;/span&gt;
&lt;div class=&quot;text-center&quot;&gt;
    &lt;h3&gt;今天搭建了自己的博客 😝&lt;/h3&gt;
&lt;/div&gt;

&lt;p&gt;花费了 &lt;strong&gt;一天半&lt;/strong&gt; 的时间，终于把我的 &lt;strong&gt;个人博客&lt;/strong&gt; 搭建完成，下面我写下搭建博客的过程，其实挺简单的 🙃&lt;/p&gt;
&lt;hr&gt;
      
      </description>
      
      <content:encoded><![CDATA[<span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="https://cdn.lishaoy.net/hexoGithubpagesNext/git_hexo.jpeg" class="full-image" alt="GitHubPages + Hexo" title="GitHubPages + Hexo"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span><div class="text-center">    <h3>今天搭建了自己的博客 😝</h3></div><p>花费了 <strong>一天半</strong> 的时间，终于把我的 <strong>个人博客</strong> 搭建完成，下面我写下搭建博客的过程，其实挺简单的 🙃</p><hr><a id="more"></a><h3 id="博客所用技术-（Hexo-Next-GitHubPages）"><a href="#博客所用技术-（Hexo-Next-GitHubPages）" class="headerlink" title="博客所用技术 （Hexo + Next + GitHubPages）"></a>博客所用技术 （Hexo + Next + GitHubPages）</h3><p>在文章的末尾我会 <strong>贴出</strong> 我基于 <strong>Hexo + Next + GitHubPages</strong> 搭建博客，所参考的文章链接。</p><p>如果，你也想用这些技术搭建漂亮的博客，你就需要了解下 <code>Hexo</code> 、 <code>Next</code> 、 <code>GitHubPages</code> 这三个单词，下面会逐个解释。</p><h4 id="什么是-Hexo"><a href="#什么是-Hexo" class="headerlink" title="什么是 Hexo"></a>什么是 Hexo</h4><blockquote><p><strong>Hexo</strong> 是一个快速、简洁且高效的博客框架。<strong>Hexo</strong> 使用 <em>Markdown</em>（或其他渲染引擎）解析文章，在几秒内，即可利用靓丽的主题生成静态网页。 – <a href="https://hexo.io/zh-cn/docs/index.html" target="_blank" rel="noopener">Hexo</a></p></blockquote><h4 id="什么是-Next"><a href="#什么是-Next" class="headerlink" title="什么是 Next"></a>什么是 Next</h4><blockquote><p><strong>NexT</strong> 是 <strong>Hexo</strong>的一个主题（theme），拥有丰富而简单的配置，结合第三方服务，可以打造属于您自己的博客。 – <a href="http://theme-next.iissnan.com" target="_blank" rel="noopener">Next</a></p></blockquote><h4 id="什么是-GitHubPages"><a href="#什么是-GitHubPages" class="headerlink" title="什么是 GitHubPages"></a>什么是 GitHubPages</h4><blockquote><p>GitHub Pages is a static site hosting service designed to host your personal, organization, or project pages directly from a GitHub repository. – <a href="https://help.github.com/articles/what-is-github-pages/" target="_blank" rel="noopener">GitHubPages</a></p></blockquote><p><strong>翻译过来大概是：</strong> GitHub页面是一个静态的站点托管服务，旨在从GitHub存储库中直接托管您的个人、组织或项目页面。</p><p>所以，<code>Hexo</code> 、 <code>Next</code> 、 <code>GitHubPages</code> 配合起来就可以免费搭建漂亮的 <strong>个人博客</strong> , 是不是很爽 😆</p><hr><h3 id="如何基于-Hexo-搭建博客"><a href="#如何基于-Hexo-搭建博客" class="headerlink" title="如何基于 Hexo 搭建博客"></a>如何基于 Hexo 搭建博客</h3><p>基于 Hexo 搭建博客，只需简单的几步，就能完成 <strong>个人博客</strong> 的搭建。</p><h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><h5 id="下载安装-nodejs"><a href="#下载安装-nodejs" class="headerlink" title="下载安装 nodejs"></a>下载安装 <code>nodejs</code></h5><p><code>node</code> 会自带 <code>npm</code> 包管理工具，<em>建议安装</em> <code>yarn</code> 来管理依赖 （因为 <code>hexo</code> 貌似是用 <code>yarn</code> 管理 <strong>依赖</strong> 的，否则可以回出现 <strong>依赖</strong> 问题）。</p><p><strong>Mac</strong> 用户可以用 <code>brew</code> 安装，<strong>Windows</strong> 可以用 <code>cmder</code> 或去官网下安装包程序。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install node</span><br></pre></td></tr></table></figure><p>然后用 <code>npm</code> 安装 <code>yarn</code></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install yarn</span><br></pre></td></tr></table></figure><h5 id="安装-git"><a href="#安装-git" class="headerlink" title="安装 git"></a>安装 <code>git</code></h5><p><strong>Mac</strong> 用户可用刚安装的 <code>yarn</code> 包管理工具安装 <code>git</code>，<strong>Windows</strong> 可以 <code>cmder</code> 或去官网下安装包程序。</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn <span class="built_in">add</span> git -g</span><br></pre></td></tr></table></figure><h5 id="安装-hexo"><a href="#安装-hexo" class="headerlink" title="安装 hexo"></a>安装 <code>hexo</code></h5><p>进入你的项目目录，比如我的是 <code>myblog</code> ，</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> myblog</span><br></pre></td></tr></table></figure><p>然后用 <code>yarn</code> 安装 <code>hexo</code>。</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn <span class="built_in">add</span> hexo -S</span><br></pre></td></tr></table></figure><p>此时，环境都准备好了，就可以开始搭建 <strong>hexo</strong> 博客了 😜</p><hr><h4 id="搭建本地博客"><a href="#搭建本地博客" class="headerlink" title="搭建本地博客"></a>搭建本地博客</h4><h5 id="进入你的项目目录"><a href="#进入你的项目目录" class="headerlink" title="进入你的项目目录"></a>进入你的项目目录</h5><p>比如：我的是 <code>myblog</code>。</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> myblog</span><br></pre></td></tr></table></figure><h5 id="项目初始化"><a href="#项目初始化" class="headerlink" title="项目初始化"></a>项目初始化</h5><p>项目初始化，会自动生成博客模板，以后写博客只需用 <code>markdown</code> 语法编写对应的 <code>.md</code> 文件即可 ✍️ 。</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo init</span><br></pre></td></tr></table></figure><h5 id="安装所有的依赖"><a href="#安装所有的依赖" class="headerlink" title="安装所有的依赖"></a>安装所有的依赖</h5><p>建议使用用 <code>yarn</code> ，否则会出现依赖问题（<em>在本文之后有相关介绍</em>）。</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn install</span><br></pre></td></tr></table></figure><h5 id="最后，启动本地服务"><a href="#最后，启动本地服务" class="headerlink" title="最后，启动本地服务"></a>最后，启动本地服务</h5><p>在浏览器输入 <code>localhost:4000</code> 即可预览博客</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo server</span><br></pre></td></tr></table></figure><p><strong>如图:</strong> 🌁 <br><img src="https://cdn.lishaoy.net/hexoGithubpagesNext/hexoinit.png" alt="hexo" width="100%" title="hexo最初的样子 😂" align="center"></p><hr><h3 id="关联-GitHub"><a href="#关联-GitHub" class="headerlink" title="关联 GitHub"></a>关联 GitHub</h3><p>通过 <strong>GitHub</strong> 的 <code>pages</code> 功能，我们可以把我们的博客托管到 <strong>GitHub</strong> ，而无需去购买云服务器 😋 ,轻松愉快的构建免费博客。</p><h4 id="创建-GitHub-账户"><a href="#创建-GitHub-账户" class="headerlink" title="创建 GitHub 账户"></a>创建 GitHub 账户</h4><p>我相信 🤔 大家应该都有 <strong>GitHub</strong> 账号了，如果没有可去 <a href="https://github.com/" target="_blank" rel="noopener">GitHub</a> 官网按照步骤创建账户即可。</p><h4 id="配置关联-GitHub"><a href="#配置关联-GitHub" class="headerlink" title="配置关联 GitHub"></a>配置关联 GitHub</h4><ul><li>有了 <strong>GitHub</strong> 账号之后，登录 <strong>GitHub</strong> ，创建一个项目，项目名称最好和你本地的项目一致，比如： <code>myblog</code></li></ul><div class="note danger"><p>项目建好之后，一定要开启 <strong>GitHub Pages</strong> 功能 ⚠️</p></div><ul><li>点击如图 <code>Settings</code> 开启，<strong>GitHub Pages</strong> 功能</li></ul><p><img src="https://cdn.lishaoy.net/hexoGithubpagesNext/gitpages.png" alt="GitHubPages" width="100%" title="GitHubPages Settings" align="center"></p><ul><li>选择 <code>master branch</code> , 然后 <strong>Save</strong> </li></ul><p><img src="https://cdn.lishaoy.net/hexoGithubpagesNext/gitpages2.png" alt="GitHubPages" width="100%" title="GitHubPages Source" align="center"></p><ul><li>复制你的项目连接，如图</li></ul><p><img src="https://cdn.lishaoy.net/hexoGithubpagesNext/gitpages3.png" alt="GitHubPages" width="100%" title="GitHubPages URL" align="center"></p><ul><li>然后在你本地项目根目录找到 <code>_config.yml</code> 文件，粘贴到以下位置</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/deployment.html</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">git</span></span><br><span class="line"><span class="attr">  repository:</span> <span class="attr">https://github.com/persilee/MyBlog.git</span></span><br><span class="line"><span class="attr">  branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure><h4 id="完成关联"><a href="#完成关联" class="headerlink" title="完成关联"></a>完成关联</h4><p>完成以上步骤之后，就可以把自己本地项目推送到 <strong>GitHub</strong> 托管，只剩下3步 😋</p><ol><li>安装 <code>hexo-deployer-git</code> 插件（可以通过简单的命令,完成文件生成及推送功能）</li></ol><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn <span class="built_in">add</span> hexo-deployer-git -S</span><br></pre></td></tr></table></figure><ol start="2"><li>运行 <code>hexo g</code> （生成本地文件）</li></ol><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br></pre></td></tr></table></figure><ol start="3"><li>运行 <code>hexo d</code> （将本地文件推送到 <strong>GitHub</strong> ，和 <code>git push</code> 功能相同）</li></ol><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo d</span><br></pre></td></tr></table></figure><p>此时，<strong>GitHub</strong> 应该已给你生成了访问连接，连接格式是: <code>你的账号名称</code> + <code>.github.io</code> + <code>\项目名称</code>,也可以去刚才 <code>GitHubPages</code> 设置页面查看例如我的：<a href="https:\\persilee.github.io\MyBlog" target="_blank" rel="noopener">https:\persilee.github.io\MyBlog</a></p><p>这时，你就可以把连接发给小伙伴们，他们通过连接都可以访问你的 <strong>博客</strong> 🙃。</p><div class="note danger"><p><strong>这里需要注意的地方是：在执行 <code>hexo g</code> 命令时候，可能会出现以下 <code>error</code>,应该是 <code>yarn</code> 和 <code>npm</code> 冲突的依赖的问题，所以前面文章建议使用 <code>yarn</code> 管理包依赖</strong></p></div><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ERROR Plugin load failed: hexo-renderer-marked</span><br><span class="line">Error: EISDIR: illegal operation <span class="keyword">on</span> <span class="keyword">a</span> directory, <span class="keyword">read</span></span><br><span class="line">ERROR Plugin load failed: hexo-server</span><br><span class="line">Error: EISDIR: illegal operation <span class="keyword">on</span> <span class="keyword">a</span> directory, <span class="keyword">read</span></span><br><span class="line">ERROR Plugin load failed: hexo-renderer-stylus</span><br><span class="line">Error: EISDIR: illegal operation <span class="keyword">on</span> <span class="keyword">a</span> directory, <span class="keyword">read</span></span><br></pre></td></tr></table></figure><p>解决办法，先用 <code>yarn</code> 分别移除，再重新安装，如下</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">## 先移除</span><br><span class="line">yarn <span class="built_in">remove</span> hexo-renderer-marked</span><br><span class="line"></span><br><span class="line">yarn <span class="built_in">remove</span> hexo-renderer-stylus</span><br><span class="line"></span><br><span class="line">yarn <span class="built_in">remove</span> hexo-server</span><br><span class="line"></span><br><span class="line">## 再安装</span><br><span class="line">yarn <span class="built_in">add</span> hexo-renderer-marked -S </span><br><span class="line"></span><br><span class="line">yarn <span class="built_in">add</span> hexo-renderer-stylus -S</span><br><span class="line"></span><br><span class="line">yarn <span class="built_in">add</span> hexo-server -S</span><br></pre></td></tr></table></figure><p>在执行 <code>hexo g</code> ,顺利执行 👌</p><hr><h3 id="绑定域名"><a href="#绑定域名" class="headerlink" title="绑定域名"></a>绑定域名</h3><p>我们已经可以通过 <strong>GitHub</strong> 分发给我的地址访问 <strong>博客</strong> ，但是，这对于我们这些爱 <strong>折腾</strong> 的 <strong>程序猿👨‍💻‍</strong> 来说，还不够，弄个自己的 <strong>域名</strong> 才够拉风😂。</p><p>于是。。。</p><p>开始绑定自己的 <strong>域名</strong> <a href="https://lishaoy.net" target="_blank" rel="noopener">lishaoy.net</a></p><p>然而，我们绑定 <strong>域名</strong> 之后，只支持 <code>http</code> 协议，这样我们在 <strong>Google</strong> 浏览器访问时，会有不安全标准，而且，很容易被插入广告，于是。。。<strong>折腾</strong> 走起🌝：搞个 <code>https</code></p><p>转入正题，经过一番 <strong>折腾</strong> ，采用第三方服务 <a href="https://app.netlify.com/sites/lishaoy/settings/domain#ssl-tls-certificate" target="_blank" rel="noopener">Netlify</a> 来提供免费的SSL/TLS证书。</p><p>当然，这里我提供2种方式绑定域名，一种是 <code>HTTP</code> (不安全的网络协议)、一种是 <code>HTTPS</code> （安全的网络协议，在 <strong>Google</strong> 浏览器上回有一把小锁，如图）</p><p><img src="https://cdn.lishaoy.net/hexoGithubpagesNext/lock.png" alt="Netlity" width="100%" title="Google HTTPS 状态标识" align="center"></p><h4 id="HTTP-绑定域名"><a href="#HTTP-绑定域名" class="headerlink" title="HTTP 绑定域名"></a><code>HTTP</code> 绑定域名</h4><h5 id="设置域名解析规则"><a href="#设置域名解析规则" class="headerlink" title="设置域名解析规则"></a>设置域名解析规则</h5><p>首先，我们需要去运行商，新增域名解析规则，如图</p><p><img src="https://cdn.lishaoy.net/hexoGithubpagesNext/domain.png" alt="domain" width="100%" title="域名解析规则" align="center"></p><h5 id="新增-CNAME-文件"><a href="#新增-CNAME-文件" class="headerlink" title="新增 CNAME 文件"></a>新增 <code>CNAME</code> 文件</h5><p>配置好域名解析规则之后，还需要在项目的 <code>.\source\</code> 路径下新增 <code>CNAME</code> 文件，输入内容 <code>你的域名</code> ,如：<a href="https://lishaoy.net" target="_blank" rel="noopener">lishaoy.net</a></p><h5 id="重新新生成文件，推送到GitHub"><a href="#重新新生成文件，推送到GitHub" class="headerlink" title="重新新生成文件，推送到GitHub"></a>重新新生成文件，推送到GitHub</h5><p>重新生成文件，运行 <code>hexo g</code></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br></pre></td></tr></table></figure><p>推送 <strong>GitHub</strong></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo d</span><br></pre></td></tr></table></figure><hr><h4 id="HTTPS-绑定域名"><a href="#HTTPS-绑定域名" class="headerlink" title="HTTPS 绑定域名"></a><code>HTTPS</code> 绑定域名</h4><h5 id="注册-Netlify-账号"><a href="#注册-Netlify-账号" class="headerlink" title="注册 Netlify 账号"></a>注册 <code>Netlify</code> 账号</h5><p>首先，我们需要注册一个 <a href="https://app.netlify.com/sites/lishaoy/settings/domain#ssl-tls-certificate" target="_blank" rel="noopener">Netlify</a> 账号，地址：<a href="https://app.netlify.com/sites/lishaoy/settings/domain#ssl-tls-certificate" target="_blank" rel="noopener">Netlify</a> ，可以选择用 <strong>GitHub</strong> 注册。</p><p><img src="https://cdn.lishaoy.net/hexoGithubpagesNext/netlify.png" alt="Netlity" width="100%" title="Netlity Login" align="center"></p><h5 id="新增站点"><a href="#新增站点" class="headerlink" title="新增站点"></a>新增站点</h5><ul><li>点击如图按钮 <code>New site from Git</code>,来新增 <strong>站点</strong></li></ul><p><img src="https://cdn.lishaoy.net/hexoGithubpagesNext/netlify1.png" alt="Netlity" width="100%" title="New site from Git" align="center"></p><ul><li>然后，点击如图按钮 <code>GitHub</code> </li></ul><p><img src="https://cdn.lishaoy.net/hexoGithubpagesNext/netlify2.png" alt="Netlity" width="100%" title="GitHub" align="center"></p><ul><li>选择你的项目，比如我的 <code>MyBlog</code></li></ul><p><img src="https://cdn.lishaoy.net/hexoGithubpagesNext/netlify3.png" alt="Netlity" width="100%" title="Select Site" align="center"></p><ul><li>点击 <code>Deploy site</code></li></ul><p><img src="https://cdn.lishaoy.net/hexoGithubpagesNext/netlify4.png" alt="Netlity" width="100%" title="Deploy site" align="center"></p><ul><li>看到如图页面，表示成功，再点击 <code>Site settings</code> </li></ul><p><img src="https://cdn.lishaoy.net/hexoGithubpagesNext/netlify5.png" alt="Netlity" width="100%" title="Getting started" align="center"></p><p><img src="https://cdn.lishaoy.net/hexoGithubpagesNext/netlify6.png" alt="Netlity" width="100%" title="Site details" align="center"></p><ul><li><p>再点击 <code>Change site name</code> 修改短名称，方便记忆</p></li><li><p>在自己的域名管理中设置 <strong>DNS</strong> ，我使用的是 <strong>阿里云</strong> ，在管理界面添加如图规则</p></li></ul><p><img src="https://cdn.lishaoy.net/hexoGithubpagesNext/netlify7.png" alt="Netlity" width="100%" title="设置域名规则" align="center"></p><ul><li>在点击 <code>Domain management</code> 下的 <code>HTTPS</code> ，按照步骤完成操作，稍等片刻，即可看到我们的 <strong>域名</strong> 已经上锁 🔐 </li></ul><p><img src="https://cdn.lishaoy.net/hexoGithubpagesNext/netlify8.png" alt="Netlity" width="100%" title="lishaoy.net上锁" align="center"></p><p>😝 😜 😄 😆 😂 🤣 …</p><hr><h3 id="更换-next-主题"><a href="#更换-next-主题" class="headerlink" title="更换 next 主题"></a>更换 <code>next</code> 主题</h3><p><code>hexo</code> 的主题很多，你可以选择其他喜欢 ❤️ 的主题，我使用的是 <code>next</code> 主题。</p><h4 id="安装-next-主题"><a href="#安装-next-主题" class="headerlink" title="安装 next 主题"></a>安装 <code>next</code> 主题</h4><p>执行以下命令，安装 <code>next</code> 主题</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone http<span class="variable">s:</span>//github.<span class="keyword">com</span>/iissnan/hexo-theme-<span class="keyword">next</span>.git themes/<span class="keyword">next</span></span><br></pre></td></tr></table></figure><h4 id="更改配置文件"><a href="#更改配置文件" class="headerlink" title="更改配置文件"></a>更改配置文件</h4><p>修改根目录下的 <code>./_config.yml</code> 文件，如下</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Extensions</span><br><span class="line">## Plugin<span class="variable">s:</span> http<span class="variable">s:</span>//hexo.io/plugins/</span><br><span class="line">## Theme<span class="variable">s:</span> http<span class="variable">s:</span>//hexo.io/themes/</span><br><span class="line">theme: <span class="keyword">next</span></span><br></pre></td></tr></table></figure><h5 id="重新新生成文件，推送到GitHub-1"><a href="#重新新生成文件，推送到GitHub-1" class="headerlink" title="重新新生成文件，推送到GitHub"></a>重新新生成文件，推送到GitHub</h5><p>重新生成文件，运行 <code>hexo g</code></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br></pre></td></tr></table></figure><p>推送 <strong>GitHub</strong></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo d</span><br></pre></td></tr></table></figure><p>也可以运行以下命令，启动一个本地服务，调试确定无问题之后再 推送到 <strong>GitHub</strong> </p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo s --<span class="keyword">debug</span></span><br></pre></td></tr></table></figure><p>本地服务启动后，可以在浏览器输入 <code>http://localhost:4000</code> 预览，如图</p><p><img src="https://cdn.lishaoy.net/hexoGithubpagesNext/nextpage.png" alt="next" width="100%" title="next 主题最初的样子🙃" align="center"></p><p><strong>本文到此告一段落，关于 <code>next</code> 主题美化的问题，可以参考以下链接文章 🤗</strong></p><p>以下是我搭建 <strong>博客</strong> 参考的文章链接 👇 </p><div class="note default"><ul><li><a href="http://shenzekun.cn/hexo%E7%9A%84next%E4%B8%BB%E9%A2%98%E4%B8%AA%E6%80%A7%E5%8C%96%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B.html" target="_blank" rel="noopener">hexo的next主题个性化教程:打造炫酷网站</a></li><li><a href="https://thief.one/2017/03/03/Hexo%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2%E6%95%99%E7%A8%8B/" target="_blank" rel="noopener">Hexo搭建博客教程</a></li><li><a href="https://www.jianshu.com/p/d95cff938277" target="_blank" rel="noopener">Hexo博客搭建全攻略(二)：NexT主题配置</a></li></ul></div>]]></content:encoded>
      
      <comments>https://h.lishaoy.net/hexoGithubpagesNext.html#disqus_thread</comments>
    </item>
    
  </channel>
</rss>
